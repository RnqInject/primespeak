<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrimeSpeak Academy</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* –°–¢–ò–õ–ò –î–õ–Ø –°–ò–°–¢–ï–ú–´ –†–ï–ü–û–†–¢–û–í */
        .reports-section {
            margin-top: 20px;
        }
        
        .report-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border-left: 4px solid var(--warning);
        }
        
        .report-card.urgent {
            border-left-color: var(--danger);
            background: #fef2f2;
        }
        
        .report-card.resolved {
            border-left-color: var(--secondary);
            background: #f0fdf4;
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .report-student {
            font-weight: bold;
            font-size: 1.1em;
            color: var(--dark);
        }
        
        .report-teacher {
            color: var(--gray);
            font-size: 0.9em;
        }
        
        .report-date {
            color: var(--gray);
            font-size: 0.8em;
        }
        
        .report-reason {
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .report-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .report-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-pending {
            background: #fffbeb;
            color: #f59e0b;
        }
        
        .status-resolved {
            background: #f0fdf4;
            color: #10b981;
        }
        
        .status-urgent {
            background: #fef2f2;
            color: #ef4444;
        }
        
        .report-count {
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            margin-left: 5px;
        }
        
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root { --primary: #4f46e5; --primary-dark: #3730a3; --secondary: #10b981; --danger: #ef4444; --warning: #f59e0b; --light: #f8fafc; --dark: #1e293b; --gray: #64748b; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 15px; color: var(--dark); }
        .login-container { max-width: 400px; margin: 50px auto; background: white; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); padding: 30px; text-align: center; }
        .login-container h1 { color: var(--primary-dark); margin-bottom: 10px; }
        .login-container p { color: var(--gray); margin-bottom: 25px; }
        .login-tabs { display: flex; margin-bottom: 20px; border-radius: 10px; overflow: hidden; background: #f1f5f9; }
        .login-tab { flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 600; }
        .login-tab.active { background: var(--primary); color: white; }
        .login-input { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; }
        .login-input:focus { border-color: var(--primary); outline: none; }
        .login-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .login-btn:hover { background: var(--primary-dark); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ "–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è" */
        .remember-me { 
            display: flex; 
            align-items: center; 
            margin: 15px 0; 
            cursor: pointer;
            font-size: 14px;
            color: var(--gray);
        }
        .remember-me input { 
            margin-right: 8px; 
            width: 16px; 
            height: 16px;
            cursor: pointer;
        }
        
        .container { max-width: 100%; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; margin: 0 auto; display: none; }
        .header { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 25px 15px; text-align: center; position: relative; }
        .user-info { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; font-size: 0.9em; }
        .logout-btn { background: rgba(255,255,255,0.3); border: none; color: white; padding: 5px 10px; border-radius: 10px; cursor: pointer; margin-left: 10px; }
        .nav { display: flex; background: var(--primary-dark); flex-wrap: wrap; }
        .nav-btn { flex: 1; min-width: 80px; background: none; border: none; color: white; padding: 15px 10px; cursor: pointer; font-size: 12px; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .nav-btn.active { background: var(--primary); }
        .content { padding: 20px 15px; min-height: 500px; }
        .section { display: none; }
        .section.active { display: block; }
        .card { background: var(--light); border-radius: 12px; padding: 20px; margin-bottom: 15px; border-left: 4px solid var(--primary); }
        .student-card { display: flex; flex-direction: column; gap: 12px; }
        .student-info h3 { color: var(--primary-dark); margin-bottom: 6px; font-size: 1.2em; }
        .student-info p { color: var(--gray); margin: 2px 0; font-size: 0.9em; }
        .student-stats { display: flex; justify-content: space-between; align-items: center; }
        .average-grade { font-size: 1.5em; font-weight: bold; color: var(--primary); }
        .grade { display: inline-flex; align-items: center; justify-content: center; width: 35px; height: 35px; color: white; border-radius: 8px; font-weight: bold; margin: 2px; font-size: 0.9em; border: 2px solid transparent; }
        .grade-1, .grade-2, .grade-3 { background: #ef4444; }
        .grade-4, .grade-5, .grade-6 { background: #f59e0b; }
        .grade-7, .grade-8, .grade-9, .grade-10 { background: #10b981; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: var(--dark); font-size: 0.9em; }
        .input, .select { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; }
        .input:focus, .select:focus { border-color: var(--primary); outline: none; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; width: 100%; margin-top: 10px; }
        .btn:hover { background: var(--primary-dark); }
        .btn-success { background: var(--secondary); }
        .btn-success:hover { background: #0da271; }
        .btn-danger { background: var(--danger); }
        .btn-danger:hover { background: #dc2626; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        .stat-card { background: white; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.08); border-top: 4px solid var(--primary); }
        .stat-number { font-size: 1.8em; font-weight: bold; color: var(--primary); margin: 5px 0; }
        .stat-label { color: var(--gray); font-size: 0.8em; }
        .empty-state { text-align: center; padding: 40px 15px; color: var(--gray); }
        h2 { margin-bottom: 15px; color: var(--primary-dark); font-size: 1.3em; }
        h3 { margin-bottom: 10px; color: var(--dark); font-size: 1.1em; }
        .student-grades-list { margin-top: 20px; }
        .grade-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #e2e8f0; }
        .grade-item:last-child { border-bottom: none; }
        .login-info { background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 10px; padding: 15px; margin: 10px 0; }
        .grade-type-tabs { display: flex; margin-bottom: 15px; border-radius: 8px; overflow: hidden; background: #f1f5f9; }
        .grade-type-tab { flex: 1; padding: 10px; border: none; background: none; cursor: pointer; font-weight: 600; font-size: 12px; }
        .grade-type-tab.active { background: var(--primary); color: white; }
        .save-btn { background: var(--secondary); margin-top: 5px; }
        .save-btn:hover { background: #0da271; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—Ü–µ–Ω–æ–∫ */
        .grade-type-badge { 
            display: inline-block; 
            padding: 4px 8px; 
            border-radius: 6px; 
            font-size: 0.7em; 
            font-weight: bold; 
            margin-left: 8px; 
        }
        .type-regular { background: #dbeafe; color: #1e40af; }
        .type-test { background: #f3e8ff; color: #7e22ce; }
        .type-homework { background: #dcfce7; color: #166534; }
        .type-activity { background: #fef3c7; color: #92400e; }
        .type-project { background: #ffe4e6; color: #be123c; }
        .type-oral { background: #e0e7ff; color: #3730a3; }
        .type-attendance { background: #f1f5f9; color: #475569; }
        
        .grade-display { 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            min-width: 60px; 
            height: 35px; 
            color: white; 
            border-radius: 8px; 
            font-weight: bold; 
            margin: 2px; 
            font-size: 0.9em; 
            padding: 0 10px; 
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
        .calendar { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .calendar-day { text-align: center; padding: 10px; border-radius: 8px; cursor: pointer; }
        .calendar-day:hover { background: #f1f5f9; }
        .calendar-day.today { background: var(--primary); color: white; }
        .calendar-day.has-event { background: #f0f9ff; border: 2px solid #0ea5e9; }
        .calendar-day.weekend { color: var(--danger); }
        .calendar-event { background: var(--secondary); color: white; padding: 4px 8px; border-radius: 6px; font-size: 0.8em; margin-top: 4px; }
        
        /* –£–õ–£–ß–®–ï–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –†–ê–°–ü–ò–°–ê–ù–ò–Ø */
        .schedule-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 15px; }
        .schedule-item { 
            background: white; 
            padding: 18px; 
            border-radius: 10px; 
            border-left: 6px solid var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
            position: relative;
        }
        .schedule-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .schedule-item.ongoing { 
            border-left-color: var(--secondary);
            background: linear-gradient(135deg, #f0fdf4, #ffffff);
        }
        .schedule-item.upcoming { 
            border-left-color: var(--warning);
            background: linear-gradient(135deg, #fffbeb, #ffffff);
        }
        .schedule-item.completed { 
            border-left-color: var(--gray);
            background: linear-gradient(135deg, #f8fafc, #ffffff);
            opacity: 0.7;
        }
        .schedule-time { 
            font-weight: bold; 
            color: var(--primary); 
            margin-bottom: 8px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .schedule-subject { 
            font-size: 1.2em; 
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        .schedule-teacher { 
            color: var(--gray); 
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .schedule-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.7em;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-ongoing { background: var(--secondary); color: white; }
        .status-upcoming { background: var(--warning); color: white; }
        .status-completed { background: var(--gray); color: white; }
        
        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ì–†–£–ü–ü–ò–†–û–í–ö–ò –†–ê–°–ü–ò–°–ê–ù–ò–Ø –ü–û –î–ê–¢–ê–ú */
        .schedule-date-group {
            margin-bottom: 25px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .schedule-date-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .schedule-date-title {
            font-size: 1.1em;
        }
        
        .schedule-day-info {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .schedule-date-content {
            padding: 15px;
        }
        
        .schedule-items-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .no-lessons {
            text-align: center;
            padding: 30px;
            color: var(--gray);
            font-style: italic;
        }
        
        .date-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        /* –§–∏–ª—å—Ç—Ä—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è */
        .schedule-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .filter-btn.active {
            background: var(--primary);
            color: white;
        }
        .filter-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        .notification { background: #fef3c7; border: 2px solid #f59e0b; border-radius: 10px; padding: 15px; margin-bottom: 10px; }
        .notification.upcoming { background: #f0fdf4; border-color: var(--secondary); }
        .notification.important { background: #fee2e2; border-color: var(--danger); }
        
        /* –¶–í–ï–¢–ê –î–õ–Ø –í–°–ï–• –¢–ò–ü–û–í –û–¶–ï–ù–û–ö */
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (1-5) */
        .activity-grade-1, .activity-grade-2 { background: #ef4444; }
        .activity-grade-3 { background: #f59e0b; }
        .activity-grade-4, .activity-grade-5 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è —É—Å—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (1-5) */
        .oral-grade-1, .oral-grade-2 { background: #ef4444; }
        .oral-grade-3 { background: #f59e0b; }
        .oral-grade-4, .oral-grade-5 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π (1-10) */
        .homework-grade-1, .homework-grade-2, .homework-grade-3 { background: #ef4444; }
        .homework-grade-4, .homework-grade-5, .homework-grade-6 { background: #f59e0b; }
        .homework-grade-7, .homework-grade-8, .homework-grade-9, .homework-grade-10 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (1-25) */
        .test-grade-1, .test-grade-2, .test-grade-3, .test-grade-4, .test-grade-5, 
        .test-grade-6, .test-grade-7, .test-grade-8, .test-grade-9, .test-grade-10 { background: #ef4444; }
        .test-grade-11, .test-grade-12, .test-grade-13, .test-grade-14, .test-grade-15 { background: #f59e0b; }
        .test-grade-16, .test-grade-17, .test-grade-18, .test-grade-19, .test-grade-20,
        .test-grade-21, .test-grade-22, .test-grade-23, .test-grade-24, .test-grade-25 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤ (1-20) */
        .project-grade-1, .project-grade-2, .project-grade-3, .project-grade-4, .project-grade-5,
        .project-grade-6, .project-grade-7, .project-grade-8, .project-grade-9, .project-grade-10 { background: #ef4444; }
        .project-grade-11, .project-grade-12, .project-grade-13, .project-grade-14, .project-grade-15 { background: #f59e0b; }
        .project-grade-16, .project-grade-17, .project-grade-18, .project-grade-19, .project-grade-20 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ (0-2) */
        .attendance-grade-0 { background: #ef4444; }
        .attendance-grade-1 { background: #ef4444; }
        .attendance-grade-2 { background: #10b981; }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è —Ç–µ—Å—Ç–æ–≤ */
        .test-grade-progress { background: #e2e8f0; border-radius: 10px; height: 8px; margin: 5px 0; overflow: hidden; }
        .test-grade-progress-bar { background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981); height: 100%; transition: width 0.3s; }
        .test-grade-info { font-size: 0.8em; color: var(--gray); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π –∫—É—Ä—Å–æ–≤ */
        .course-badge { 
            display: inline-block; 
            padding: 4px 12px; 
            border-radius: 20px; 
            font-size: 0.8em; 
            font-weight: bold; 
            margin: 2px;
        }
        .course-beginner { background: #dbeafe; color: #1e40af; border: 2px solid #3b82f6; }
        .course-elementary { background: #dcfce7; color: #166534; border: 2px solid #10b981; }
        .course-intermediate { background: #fef3c7; color: #92400e; border: 2px solid #f59e0b; }
        .course-advanced { background: #f3e8ff; color: #7e22ce; border: 2px solid #8b5cf6; }
        .course-fluent { background: #fce7f3; color: #be185d; border: 2px solid #ec4899; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏–π –∫—É—Ä—Å–æ–≤ */
        .course-tooltip {
            position: relative;
            cursor: help;
        }
        .course-tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            white-space: nowrap;
            z-index: 1000;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–Ω–µ–ª–∏ –∑–∞–≤—É—á–∞ */
        .academic-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .academic-card { 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            text-align: center; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-top: 4px solid var(--primary);
        }
        .academic-number { font-size: 2em; font-weight: bold; color: var(--primary); margin: 10px 0; }
        .performance-chart { background: white; padding: 20px; border-radius: 12px; margin: 15px 0; }

        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê –ò –†–ï–ô–¢–ò–ù–ì–û–í */
        .admin-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .admin-card { 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            text-align: center; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-top: 4px solid var(--primary);
        }
        .admin-number { font-size: 2em; font-weight: bold; color: var(--primary); margin: 10px 0; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–≤–µ–∑–¥–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ */
        .star-rating { 
            display: inline-flex; 
            gap: 5px; 
            margin: 5px 0;
        }
        .star { 
            font-size: 1.2em; 
            cursor: pointer; 
            transition: color 0.2s;
        }
        .star.active { color: #f59e0b; }
        .star.inactive { color: #d1d5db; }
        .teacher-rating { 
            background: #fffbeb; 
            padding: 10px; 
            border-radius: 8px; 
            margin: 5px 0;
            border-left: 4px solid #f59e0b;
        }
        .rating-value { 
            font-size: 1.5em; 
            font-weight: bold; 
            color: #f59e0b; 
            margin-right: 10px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü */
        .data-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 15px 0;
        }
        .data-table th, .data-table td { 
            padding: 12px 15px; 
            text-align: left; 
            border-bottom: 1px solid #e2e8f0;
        }
        .data-table th { 
            background: #f8fafc; 
            font-weight: 600; 
            color: var(--dark);
        }
        .data-table tr:hover { 
            background: #f8fafc;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —É—á–∏—Ç–µ–ª–µ–π */
        .teacher-card { 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            margin-bottom: 15px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border-left: 4px solid var(--primary);
        }
        .teacher-info { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        .teacher-details { 
            flex: 1;
        }
        .teacher-actions { 
            display: flex; 
            gap: 10px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø–∞–º–∏ */
        .group-card { 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            margin-bottom: 15px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border-left: 4px solid var(--secondary);
        }
        .group-stats { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
            gap: 10px; 
            margin: 10px 0;
        }
        .group-stat { 
            background: #f8fafc; 
            padding: 10px; 
            border-radius: 8px; 
            text-align: center;
        }
        .group-students {
            margin-top: 15px;
        }
        .student-in-group {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #f8fafc;
            border-radius: 6px;
            margin: 5px 0;
        }
        
        /* –°–¢–ò–õ–ò –î–õ–Ø –ß–ê–¢–ê –ü–û–î–î–ï–†–ñ–ö–ò */
        #supportChat {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: none;
        }

        #chatWindow {
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            border: 2px solid var(--primary);
        }

        #chatButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 999;
            border: 3px solid white;
        }

        #chatNotification {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 0.7em;
            display: none;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }

        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 15px;
            margin: 5px 0;
            animation: fadeIn 0.3s ease-in;
        }

        .user-message {
            align-self: flex-end;
            background: var(--primary);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .support-message {
            align-self: flex-start;
            background: white;
            color: var(--dark);
            border: 1px solid #e2e8f0;
            border-bottom-left-radius: 5px;
        }

        .message-content {
            font-size: 0.9em;
            line-height: 1.4;
        }

        .message-time {
            font-size: 0.7em;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }

        .support-message .message-time {
            text-align: left;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –°–¢–ò–õ–ò –î–õ–Ø –ü–†–û–¶–ï–ù–¢–û–í –£–ß–ï–ù–ò–ö–û–í */
        .today-progress {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }

        .progress-percentage {
            font-size: 1.8em;
            font-weight: bold;
            margin: 5px 0;
        }

        .progress-bar {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
            height: 8px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: white;
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ */
        @media (max-width: 768px) {
            .nav-btn { min-width: 70px; font-size: 10px; padding: 12px 5px; }
            .stats-grid { grid-template-columns: 1fr; }
            .schedule-filters { justify-content: center; }
            .schedule-grid { grid-template-columns: 1fr; }
            .schedule-date-header { flex-direction: column; gap: 8px; text-align: center; }
            .schedule-date-title { font-size: 1em; }
            .teacher-info { flex-direction: column; align-items: flex-start; }
            .teacher-actions { margin-top: 15px; width: 100%; }
            .teacher-actions .btn { width: 100%; }
            #chatWindow {
                width: 90vw;
                height: 70vh;
                right: 5vw;
                bottom: 80px;
            }
            .message {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <div class="login-container" id="loginScreen">
        <h1>üìö PrimeSpeak Academy</h1>
        <p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>
        
        <div class="login-tabs">
            <button class="login-tab active" onclick="showLoginTab('teacher')">üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å</button>
            <button class="login-tab" onclick="showLoginTab('student')">üë®‚Äçüéì –£—á–µ–Ω–∏–∫</button>
            <button class="login-tab" onclick="showLoginTab('head_teacher')">üéì –ó–∞–≤—É—á</button>
            <button class="login-tab" onclick="showLoginTab('admin')">üëë –ê–¥–º–∏–Ω</button>
        </div>

        <div id="teacherLogin">
            <input type="text" class="login-input" id="teacherEmail" placeholder="Email —É—á–∏—Ç–µ–ª—è">
            <input type="password" class="login-input" id="teacherPassword" placeholder="–ü–∞—Ä–æ–ª—å —É—á–∏—Ç–µ–ª—è">
            
            <label class="remember-me">
                <input type="checkbox" id="rememberTeacher">
                –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è
            </label>
            
            <button class="login-btn" onclick="loginTeacher()">–í–æ–π—Ç–∏ –∫–∞–∫ —É—á–∏—Ç–µ–ª—å</button>
        </div>

        <div id="studentLogin" style="display: none;">
            <input type="text" class="login-input" id="studentLoginInput" placeholder="–õ–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞">
            <input type="password" class="login-input" id="studentPassword" placeholder="–ü–∞—Ä–æ–ª—å —É—á–µ–Ω–∏–∫–∞">
            
            <label class="remember-me">
                <input type="checkbox" id="rememberStudent">
                –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è
            </label>
            
            <button class="login-btn" onclick="loginStudent()">–í–æ–π—Ç–∏ –∫–∞–∫ —É—á–µ–Ω–∏–∫</button>
        </div>

        <div id="headTeacherLogin" style="display: none;">
            <input type="text" class="login-input" id="headTeacherEmail" placeholder="Email –∑–∞–≤—É—á–∞">
            <input type="password" class="login-input" id="headTeacherPassword" placeholder="–ü–∞—Ä–æ–ª—å –∑–∞–≤—É—á–∞">
            
            <label class="remember-me">
                <input type="checkbox" id="rememberHeadTeacher">
                –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è
            </label>
            
            <button class="login-btn" onclick="loginHeadTeacher()">–í–æ–π—Ç–∏ –∫–∞–∫ –∑–∞–≤—É—á</button>
        </div>

        <div id="adminLogin" style="display: none;">
            <input type="text" class="login-input" id="adminEmail" placeholder="Email –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
            <input type="password" class="login-input" id="adminPassword" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
            
            <label class="remember-me">
                <input type="checkbox" id="rememberAdmin">
                –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è
            </label>
            
            <button class="login-btn" onclick="loginAdmin()">–í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
        </div>

        <button onclick="testConnection()" style="margin-top: 20px; padding: 10px; background: #10b981; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
            üß™ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        </button>
    </div>

    <div class="container" id="mainApp">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –£—á–∏—Ç–µ–ª—è -->
        <div class="header" id="teacherHeader">
            <div class="user-info">
                üë®‚Äçüè´ <span id="userName">–£—á–∏—Ç–µ–ª—å</span>
                <button class="logout-btn" onclick="logout()">üö™</button>
            </div>
            <h1>üìö PrimeSpeak Academy</h1>
            <div class="company-name">–ü–∞–Ω–µ–ª—å —É—á–∏—Ç–µ–ª—è</div>
            <p>–û—Ü–µ–Ω–∫–∏ ‚Ä¢ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚Ä¢ –ö–∞–ª–µ–Ω–¥–∞—Ä—å ‚Ä¢ –£—á–µ–Ω–∏–∫–∏</p>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –£—á–µ–Ω–∏–∫–∞ -->
        <div class="header" id="studentHeader" style="display: none;">
            <div class="user-info">
                üë®‚Äçüéì <span id="studentNameDisplay">–£—á–µ–Ω–∏–∫</span>
                <button class="logout-btn" onclick="logout()">üö™</button>
            </div>
            <h1>üìö PrimeSpeak Academy</h1>
            <div class="company-name">–ú–æ–π —É—á–µ–±–Ω—ã–π –ø–æ—Ä—Ç–∞–ª</div>
            <p>–û—Ü–µ–Ω–∫–∏ ‚Ä¢ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚Ä¢ –ö–∞–ª–µ–Ω–¥–∞—Ä—å ‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å—Å</p>
            <p style="margin-top: 10px;"><strong>üë®‚Äçüè´ –í–∞—à —É—á–∏—Ç–µ–ª—å: Radmir Nurislamov</strong></p>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ó–∞–≤—É—á–∞ -->
        <div class="header" id="headTeacherHeader" style="display: none;">
            <div class="user-info">
                üéì <span id="headTeacherNameDisplay">–ó–∞–≤—É—á</span>
                <button class="logout-btn" onclick="logout()">üö™</button>
            </div>
            <h1>üìö PrimeSpeak Academy</h1>
            <div class="company-name">–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è –ø–∞–Ω–µ–ª—å –∑–∞–≤—É—á–∞</div>
            <p>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Ä¢ –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ ‚Ä¢ –û—Ç—á–µ—Ç—ã ‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</p>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
        <div class="header" id="adminHeader" style="display: none;">
            <div class="user-info">
                üëë <span id="adminNameDisplay">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                <button class="logout-btn" onclick="logout()">üö™</button>
            </div>
            <h1>üìö PrimeSpeak Academy</h1>
            <div class="company-name">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</div>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Ä¢ –ì—Ä—É–ø–ø—ã ‚Ä¢ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</p>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –£—á–∏—Ç–µ–ª—è -->
        <div class="nav" id="teacherNav">
            <button class="nav-btn active" onclick="showSection('dashboard')">üìä<span>–î–∞—à–±–æ—Ä–¥</span></button>
            <button class="nav-btn" onclick="showSection('students')">üë®‚Äçüéì<span>–£—á–µ–Ω–∏–∫–∏</span></button>
            <button class="nav-btn" onclick="showSection('addStudent')">‚ûï<span>–î–æ–±–∞–≤–∏—Ç—å</span></button>
            <button class="nav-btn" onclick="showSection('grades')">üìù<span>–û—Ü–µ–Ω–∫–∏</span></button>
            <button class="nav-btn" onclick="showSection('reports')">‚ö†Ô∏è<span>–ñ–∞–ª–æ–±—ã</span></button>
            <button class="nav-btn" onclick="showSection('schedule')">üìÖ<span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span></button>
            <button class="nav-btn" onclick="showSection('calendar')">üóìÔ∏è<span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span></button>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –ó–∞–≤—É—á–∞ -->
        <div class="nav" id="headTeacherNav" style="display: none;">
            <button class="nav-btn active" onclick="showSection('headTeacherDashboard')">üéì<span>–î–∞—à–±–æ—Ä–¥</span></button>
            <button class="nav-btn" onclick="showSection('academicAnalytics')">üìä<span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span></button>
            <button class="nav-btn" onclick="showSection('teacherManagement')">üë®‚Äçüè´<span>–£—á–∏—Ç–µ–ª—è</span></button>
            <button class="nav-btn" onclick="showSection('students')">üë®‚Äçüéì<span>–£—á–µ–Ω–∏–∫–∏</span></button>
            <button class="nav-btn" onclick="showSection('reports')">‚ö†Ô∏è<span>–ñ–∞–ª–æ–±—ã</span></button>
            <button class="nav-btn" onclick="showSection('schedule')">üìÖ<span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span></button>
            <button class="nav-btn" onclick="showSection('qualityControl')">üéØ<span>–ö–æ–Ω—Ç—Ä–æ–ª—å</span></button>
            <button class="nav-btn" onclick="showSection('reports')">üìã<span>–û—Ç—á–µ—Ç—ã</span></button>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
        <div class="nav" id="adminNav" style="display: none;">
            <button class="nav-btn active" onclick="showSection('adminDashboard')">üëë<span>–î–∞—à–±–æ—Ä–¥</span></button>
            <button class="nav-btn" onclick="showSection('userManagement')">üë•<span>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</span></button>
            <button class="nav-btn" onclick="showSection('groupManagement')">üè∑Ô∏è<span>–ì—Ä—É–ø–ø—ã</span></button>
            <button class="nav-btn" onclick="showSection('teacherRatings')">‚≠ê<span>–†–µ–π—Ç–∏–Ω–≥–∏</span></button>
            <button class="nav-btn" onclick="showSection('reports')">‚ö†Ô∏è<span>–ñ–∞–ª–æ–±—ã</span></button>
            <button class="nav-btn" onclick="showSection('systemSettings')">‚öôÔ∏è<span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span></button>
            <button class="nav-btn" onclick="showSection('systemAnalytics')">üìà<span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span></button>
            <button class="nav-btn" onclick="showSection('security')">üîí<span>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</span></button>
        </div>

        <div class="content">
            <!-- –î–ê–®–ë–û–†–î –£–ß–ò–¢–ï–õ–Ø -->
            <div id="dashboard" class="section active">
                <h2>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="stats-grid">
                    <div class="stat-card"><div>üë®‚Äçüéì</div><div class="stat-number" id="totalStudents">0</div><div class="stat-label">–£—á–µ–Ω–∏–∫–æ–≤</div></div>
                    <div class="stat-card"><div>‚≠ê</div><div class="stat-number" id="averageGrade">0.0</div><div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div></div>
                    <div class="stat-card"><div>üìù</div><div class="stat-number" id="totalGrades">0</div><div class="stat-label">–û—Ü–µ–Ω–æ–∫</div></div>
                    <div class="stat-card"><div>‚ö†Ô∏è</div><div class="stat-number" id="totalReports">0</div><div class="stat-label">–ñ–∞–ª–æ–±</div></div>
                </div>
                
                <div class="card">
                    <h3>üîî –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                    <div id="upcomingEvents"></div>
                </div>
                
                <div class="card"><h3>üìà –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏</h3><div id="recentGrades"></div></div>
                <div class="card"><h3>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º</h3><div id="courseLevelsStats"></div></div>
            </div>

            <!-- –°–ò–°–¢–ï–ú–ê –ñ–ê–õ–û–ë –ò –†–ï–ü–û–†–¢–û–í -->
            <div id="reports" class="section">
                <h2>‚ö†Ô∏è –°–∏—Å—Ç–µ–º–∞ –∂–∞–ª–æ–± –∏ –æ—Ç—á–µ—Ç–æ–≤</h2>
                
                <!-- –î–ª—è —É—á–∏—Ç–µ–ª–µ–π: —Ñ–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∂–∞–ª–æ–±—ã -->
                <div id="teacherReportsSection" style="display: none;">
                    <div class="card">
                        <h3>üìù –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É –Ω–∞ —É—á–µ–Ω–∏–∫–∞</h3>
                        <div class="form-group">
                            <label>üë®‚Äçüéì –í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞</label>
                            <select class="select" id="reportStudent">
                                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞ --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>‚ö†Ô∏è –ü—Ä–∏—á–∏–Ω–∞ –∂–∞–ª–æ–±—ã</label>
                            <select class="select" id="reportReason">
                                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É --</option>
                                <option value="behavior">–ü–ª–æ—Ö–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ</option>
                                <option value="homework">–ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π</option>
                                <option value="attendance">–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å—é</option>
                                <option value="disrespect">–ù–µ—É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ</option>
                                <option value="cheating">–°–ø–∏—Å—ã–≤–∞–Ω–∏–µ</option>
                                <option value="other">–î—Ä—É–≥–æ–µ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>üìù –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea class="input" id="reportDescription" placeholder="–û–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é –ø–æ–¥—Ä–æ–±–Ω–æ..." rows="4"></textarea>
                        </div>
                        <div class="form-group">
                            <label>üéØ –°–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å —Å–∏—Ç—É–∞—Ü–∏–∏</label>
                            <select class="select" id="reportSeverity">
                                <option value="low">–ù–∏–∑–∫–∞—è</option>
                                <option value="medium" selected>–°—Ä–µ–¥–Ω—è—è</option>
                                <option value="high">–í—ã—Å–æ–∫–∞—è</option>
                                <option value="urgent">–°—Ä–æ—á–Ω–æ</option>
                            </select>
                        </div>
                        <button class="btn btn-danger" onclick="submitReport()">‚ö†Ô∏è –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É</button>
                    </div>

                    <div class="card">
                        <h3>üìã –ú–æ–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∂–∞–ª–æ–±—ã</h3>
                        <div id="teacherReportsList"></div>
                    </div>
                </div>

                <!-- –î–ª—è —É—á–µ–Ω–∏–∫–æ–≤: –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∂–∞–ª–æ–± -->
                <div id="studentReportsSection" style="display: none;">
                    <div class="card">
                        <h3>üìã –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ –∂–∞–ª–æ–±—ã</h3>
                        <div id="studentReportsList"></div>
                    </div>
                </div>

                <!-- –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –∂–∞–ª–æ–±–∞–º–∏ -->
                <div id="adminReportsSection" style="display: none;">
                    <div class="card">
                        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∂–∞–ª–æ–±</h3>
                        <div class="stats-grid">
                            <div class="stat-card"><div>‚ö†Ô∏è</div><div class="stat-number" id="totalReportsCount">0</div><div class="stat-label">–í—Å–µ–≥–æ –∂–∞–ª–æ–±</div></div>
                            <div class="stat-card"><div>‚è≥</div><div class="stat-number" id="pendingReportsCount">0</div><div class="stat-label">–û–∂–∏–¥–∞—é—Ç</div></div>
                            <div class="stat-card"><div>‚úÖ</div><div class="stat-number" id="resolvedReportsCount">0</div><div class="stat-label">–†–µ—à–µ–Ω–æ</div></div>
                            <div class="stat-card"><div>üö®</div><div class="stat-number" id="urgentReportsCount">0</div><div class="stat-label">–°—Ä–æ—á–Ω—ã–µ</div></div>
                        </div>
                    </div>

                    <div class="card">
                        <h3>üìã –í—Å–µ –∂–∞–ª–æ–±—ã</h3>
                        <div class="form-group">
                            <input type="text" class="input" id="searchReports" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ —É—á–µ–Ω–∏–∫—É –∏–ª–∏ —É—á–∏—Ç–µ–ª—é..." onkeyup="searchReports()">
                        </div>
                        <div class="form-group">
                            <select class="select" id="filterReportsStatus" onchange="filterReports()">
                                <option value="all">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                                <option value="pending">–û–∂–∏–¥–∞—é—Ç —Ä–µ—à–µ–Ω–∏—è</option>
                                <option value="resolved">–†–µ—à–µ–Ω–æ</option>
                                <option value="urgent">–°—Ä–æ—á–Ω—ã–µ</option>
                            </select>
                        </div>
                        <div id="adminReportsList"></div>
                    </div>
                </div>
            </div>

            <!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
            <!-- ... -->

        </div>
    </div>

    <!-- –ß–ê–¢ –ü–û–î–î–ï–†–ñ–ö–ò -->
    <div id="supportChat" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000; display: none;">
        <div id="chatWindow" style="width: 350px; height: 500px; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: flex; flex-direction: column; border: 2px solid var(--primary);">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞ -->
            <div style="background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 15px; border-radius: 13px 13px 0 0; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <strong>üí¨ –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏</strong>
                    <div style="font-size: 0.8em; opacity: 0.9;">–û–Ω–ª–∞–π–Ω</div>
                </div>
                <button onclick="toggleChat()" style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2em;">‚úï</button>
            </div>
            
            <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
            <div id="chatMessages" style="flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #f8fafc;">
                <div class="message support-message">
                    <div class="message-content">
                        <strong>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</strong> –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?
                    </div>
                    <div class="message-time">—Ç–æ–ª—å–∫–æ —á—Ç–æ</div>
                </div>
            </div>
            
            <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
            <div style="padding: 15px; border-top: 1px solid #e2e8f0; background: white; border-radius: 0 0 13px 13px;">
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="chatInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." style="flex: 1; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px;">
                    <button onclick="sendMessage()" style="background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold;">‚û§</button>
                </div>
                <div style="font-size: 0.8em; color: var(--gray); margin-top: 8px; text-align: center;">
                    –û—Ç–≤–µ—Ç–∏–º –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–ù–û–ü–ö–ê –û–¢–ö–†–´–¢–ò–Ø –ß–ê–¢–ê -->
    <div id="chatButton" style="position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 999; border: 3px solid white;">
        üí¨
        <div id="chatNotification" style="position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; width: 20px; height: 20px; border-radius: 50%; font-size: 0.7em; display: none; justify-content: center; align-items: center; font-weight: bold;">
            1
        </div>
    </div>

    <script>
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SUPABASE
        const supabaseUrl = 'https://kgkkdjujxruiakbglnop.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtna2tkanVqeHJ1aWFrYmdsbm9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyNzI0MDMsImV4cCI6MjA3ODg0ODQwM30.R8vESEB3T-wqPlsykf4YnKm3wawuu70Xeph4GUCigsM';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        let currentUser = null;
        let currentGradeType = 'regular';
        let currentDate = new Date();
        let currentScheduleFilter = 'all';

        // –°–ò–°–¢–ï–ú–ê –†–û–õ–ï–ô
        const userRoles = {
            'teacher': {
                name: 'üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å',
                permissions: ['view_students', 'add_grades', 'view_schedule', 'add_schedule', 'submit_reports'],
                dashboard: 'teacher_dashboard'
            },
            'student': {
                name: 'üë®‚Äçüéì –£—á–µ–Ω–∏–∫',
                permissions: ['view_own_grades', 'view_schedule', 'view_own_reports'],
                dashboard: 'student_dashboard'
            },
            'head_teacher': {
                name: 'üéì –ó–∞–≤—É—á',
                permissions: [
                    'view_all_students', 'view_all_grades', 'view_all_teachers',
                    'manage_schedule', 'manage_curriculum', 'quality_control',
                    'progress_monitoring', 'generate_reports', 'teacher_performance',
                    'student_analytics', 'academic_planning', 'manage_reports'
                ],
                dashboard: 'head_teacher_dashboard'
            },
            'admin': {
                name: 'üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                permissions: [
                    'manage_all_users', 'system_settings', 'security_management',
                    'view_system_analytics', 'teacher_ratings', 'full_control',
                    'manage_groups', 'assign_students', 'manage_all_reports'
                ],
                dashboard: 'admin_dashboard'
            }
        };

        // –ü–†–ò–ß–ò–ù–´ –ñ–ê–õ–û–ë
        const reportReasons = {
            'behavior': '–ü–ª–æ—Ö–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ',
            'homework': '–ù–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π',
            'attendance': '–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å—é',
            'disrespect': '–ù–µ—É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ',
            'cheating': '–°–ø–∏—Å—ã–≤–∞–Ω–∏–µ',
            'other': '–î—Ä—É–≥–æ–µ'
        };

        // –°–ï–†–¨–ï–ó–ù–û–°–¢–¨ –ñ–ê–õ–û–ë
        const reportSeverities = {
            'low': { name: '–ù–∏–∑–∫–∞—è', color: '#10b981' },
            'medium': { name: '–°—Ä–µ–¥–Ω—è—è', color: '#f59e0b' },
            'high': { name: '–í—ã—Å–æ–∫–∞—è', color: '#ef4444' },
            'urgent': { name: '–°—Ä–æ—á–Ω–æ', color: '#dc2626' }
        };

        // –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –°–ò–°–¢–ï–ú–´
        async function testConnection() {
            try {
                const { data, error } = await supabase.from('teacher').select('*').limit(1);
                if (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
                    return false;
                }
                alert('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ!');
                return true;
            } catch (err) {
                alert('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + err.message);
                return false;
            }
        }

        function showLoginTab(tab) {
            document.querySelectorAll('.login-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('teacherLogin').style.display = tab === 'teacher' ? 'block' : 'none';
            document.getElementById('studentLogin').style.display = tab === 'student' ? 'block' : 'none';
            document.getElementById('headTeacherLogin').style.display = tab === 'head_teacher' ? 'block' : 'none';
            document.getElementById('adminLogin').style.display = tab === 'admin' ? 'block' : 'none';
        }

        // –§–£–ù–ö–¶–ò–ò –í–•–û–î–ê
        async function loginTeacher() {
            const email = document.getElementById('teacherEmail').value;
            const password = document.getElementById('teacherPassword').value;
            
            if (!email || !password) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            try {
                if (email === 'nurislamovradmir9@gmail.com' && password === 'teacher123') {
                    currentUser = { 
                        name: 'Radmir Nurislamov', 
                        email: 'nurislamovradmir9@gmail.com',
                        role: 'teacher' 
                    };
                    
                    showMainApp('teacher');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                } else {
                    const { data, error } = await supabase
                        .from('teacher')
                        .select('*')
                        .eq('email', email)
                        .eq('password', password)
                        .single();

                    if (error) throw error;

                    currentUser = { ...data, role: 'teacher' };
                    showMainApp('teacher');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                }
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + err.message);
            }
        }

        async function loginStudent() {
            const username = document.getElementById('studentLoginInput').value;
            const password = document.getElementById('studentPassword').value;
            
            if (!username || !password) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('students')
                    .select('*')
                    .eq('username', username)
                    .eq('password', password)
                    .single();

                if (error) throw error;

                currentUser = { ...data, role: 'student' };
                showMainApp('student');
                alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + err.message);
            }
        }

        async function loginHeadTeacher() {
            const email = document.getElementById('headTeacherEmail').value;
            const password = document.getElementById('headTeacherPassword').value;
            
            if (!email || !password) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            try {
                if (email === 'nurislamovradmir9@gmail.com' && password === 'headteacher123') {
                    currentUser = { 
                        name: 'Radmir Nurislamov', 
                        email: 'nurislamovradmir9@gmail.com',
                        role: 'head_teacher' 
                    };
                    
                    showMainApp('head_teacher');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                } else {
                    const { data, error } = await supabase
                        .from('teacher')
                        .select('*')
                        .eq('email', email)
                        .eq('password', password)
                        .single();

                    if (error) throw error;

                    currentUser = { ...data, role: 'head_teacher' };
                    showMainApp('head_teacher');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                }
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + err.message);
            }
        }

        async function loginAdmin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            
            if (!email || !password) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            try {
                if (email === 'admin@primespeak.com' && password === 'admin123') {
                    currentUser = { 
                        name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã', 
                        email: 'admin@primespeak.com',
                        role: 'admin' 
                    };
                    
                    showMainApp('admin');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                } else {
                    const { data, error } = await supabase
                        .from('admin')
                        .select('*')
                        .eq('email', email)
                        .eq('password', password)
                        .single();

                    if (error) throw error;

                    currentUser = { ...data, role: 'admin' };
                    showMainApp('admin');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                }
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + err.message);
            }
        }

        function showMainApp(role) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            document.getElementById('teacherHeader').style.display = 'none';
            document.getElementById('studentHeader').style.display = 'none';
            document.getElementById('headTeacherHeader').style.display = 'none';
            document.getElementById('adminHeader').style.display = 'none';
            
            document.getElementById('teacherNav').style.display = 'none';
            document.getElementById('headTeacherNav').style.display = 'none';
            document.getElementById('adminNav').style.display = 'none';

            if (role === 'teacher') {
                document.getElementById('teacherHeader').style.display = 'block';
                document.getElementById('teacherNav').style.display = 'flex';
                document.getElementById('userName').textContent = currentUser.name;
                showSection('dashboard');
                loadTeacherData();
            } else if (role === 'student') {
                document.getElementById('studentHeader').style.display = 'block';
                document.getElementById('studentNameDisplay').textContent = currentUser.name;
                document.getElementById('welcomeStudentName').textContent = currentUser.name;
                showStudentGrades();
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É —á–∞—Ç–∞ –¥–ª—è —É—á–µ–Ω–∏–∫–æ–≤
                document.getElementById('chatButton').style.display = 'flex';
            } else if (role === 'head_teacher') {
                document.getElementById('headTeacherHeader').style.display = 'block';
                document.getElementById('headTeacherNav').style.display = 'flex';
                document.getElementById('headTeacherNameDisplay').textContent = currentUser.name;
                showSection('headTeacherDashboard');
                loadHeadTeacherData();
            } else if (role === 'admin') {
                document.getElementById('adminHeader').style.display = 'block';
                document.getElementById('adminNav').style.display = 'flex';
                document.getElementById('adminNameDisplay').textContent = currentUser.name;
                showSection('adminDashboard');
                loadAdminData();
            }
            
            loadSchedule();
            loadCalendarEvents();
            generateCalendar();
        }

        function logout() {
            currentUser = null;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('chatButton').style.display = 'none';
            document.getElementById('supportChat').style.display = 'none';
            alert('üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!');
        }

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(sectionName).classList.add('active');
            if (event) event.currentTarget.classList.add('active');
            
            // –ü—Ä–∏ –ø–æ–∫–∞–∑–µ —Ä–∞–∑–¥–µ–ª–∞ —Å –∂–∞–ª–æ–±–∞–º–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
            if (sectionName === 'reports') {
                loadReportsSection();
            }
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–ò–°–¢–ï–ú–´ –ñ–ê–õ–û–ë
        async function loadReportsSection() {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã
            document.getElementById('teacherReportsSection').style.display = 'none';
            document.getElementById('studentReportsSection').style.display = 'none';
            document.getElementById('adminReportsSection').style.display = 'none';
            
            if (currentUser.role === 'teacher') {
                document.getElementById('teacherReportsSection').style.display = 'block';
                await loadReportStudentSelect();
                await loadTeacherReports();
            } else if (currentUser.role === 'student') {
                document.getElementById('studentReportsSection').style.display = 'block';
                await loadStudentReports();
            } else if (currentUser.role === 'head_teacher' || currentUser.role === 'admin') {
                document.getElementById('adminReportsSection').style.display = 'block';
                await loadAdminReports();
                await loadReportsStatistics();
            }
        }

        async function loadReportStudentSelect() {
            const { data: students, error } = await supabase
                .from('students')
                .select('id, name, username')
                .order('name');

            if (error) return;

            const select = document.getElementById('reportStudent');
            select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞ --</option>';
            students.forEach(student => {
                select.innerHTML += `<option value="${student.id}">${student.name} (${student.username})</option>`;
            });
        }

        async function submitReport() {
            const studentId = parseInt(document.getElementById('reportStudent').value);
            const reason = document.getElementById('reportReason').value;
            const description = document.getElementById('reportDescription').value.trim();
            const severity = document.getElementById('reportSeverity').value;

            if (!studentId || !reason || !description) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            try {
                // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—á–µ–Ω–∏–∫–µ
                const { data: student, error: studentError } = await supabase
                    .from('students')
                    .select('name, username')
                    .eq('id', studentId)
                    .single();

                if (studentError) throw studentError;

                const { data, error } = await supabase
                    .from('reports')
                    .insert([{
                        student_id: studentId,
                        student_name: student.name,
                        student_username: student.username,
                        teacher_id: currentUser.id,
                        teacher_name: currentUser.name,
                        reason: reason,
                        description: description,
                        severity: severity,
                        status: 'pending',
                        created_at: new Date().toISOString()
                    }])
                    .select();

                if (error) throw error;

                // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
                document.getElementById('reportStudent').value = '';
                document.getElementById('reportReason').value = '';
                document.getElementById('reportDescription').value = '';
                document.getElementById('reportSeverity').value = 'medium';

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∂–∞–ª–æ–±
                await loadTeacherReports();
                
                alert(`‚úÖ –ñ–∞–ª–æ–±–∞ –Ω–∞ —É—á–µ–Ω–∏–∫–∞ ${student.name} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!`);
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
            }
        }

        async function loadTeacherReports() {
            const { data: reports, error } = await supabase
                .from('reports')
                .select('*')
                .eq('teacher_id', currentUser.id)
                .order('created_at', { ascending: false });

            if (error) {
                console.error('Error loading teacher reports:', error);
                return;
            }

            const reportsList = document.getElementById('teacherReportsList');
            
            if (!reports || reports.length === 0) {
                reportsList.innerHTML = '<div class="empty-state"><div>‚ö†Ô∏è</div><p>–í—ã –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏ –∂–∞–ª–æ–±</p></div>';
                return;
            }

            reportsList.innerHTML = '';
            reports.forEach(report => {
                const severityInfo = reportSeverities[report.severity];
                const reasonText = reportReasons[report.reason] || report.reason;
                
                reportsList.innerHTML += `
                    <div class="report-card ${report.severity === 'urgent' ? 'urgent' : ''} ${report.status === 'resolved' ? 'resolved' : ''}">
                        <div class="report-header">
                            <div>
                                <div class="report-student">${report.student_name}</div>
                                <div class="report-teacher">–ü—Ä–∏—á–∏–Ω–∞: ${reasonText}</div>
                            </div>
                            <div class="report-date">${formatDate(report.created_at)}</div>
                        </div>
                        
                        <div class="report-reason">
                            ${report.description}
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="report-status status-${report.status}">
                                ${report.status === 'pending' ? '‚è≥ –û–∂–∏–¥–∞–µ—Ç' : report.status === 'resolved' ? '‚úÖ –†–µ—à–µ–Ω–æ' : 'üö® –°—Ä–æ—á–Ω–æ'}
                            </span>
                            <span style="color: ${severityInfo.color}; font-weight: bold;">
                                ${severityInfo.name}
                            </span>
                        </div>
                        
                        ${report.admin_comment ? `
                            <div style="background: #eff6ff; padding: 10px; border-radius: 6px; margin-top: 10px;">
                                <strong>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong><br>
                                ${report.admin_comment}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
        }

        async function loadStudentReports() {
            const { data: reports, error } = await supabase
                .from('reports')
                .select('*')
                .eq('student_id', currentUser.id)
                .order('created_at', { ascending: false });

            if (error) {
                console.error('Error loading student reports:', error);
                return;
            }

            const reportsList = document.getElementById('studentReportsList');
            
            if (!reports || reports.length === 0) {
                reportsList.innerHTML = '<div class="empty-state"><div>‚úÖ</div><p>–£ –≤–∞—Å –Ω–µ—Ç –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∂–∞–ª–æ–±</p></div>';
                return;
            }

            reportsList.innerHTML = '';
            reports.forEach(report => {
                const severityInfo = reportSeverities[report.severity];
                const reasonText = reportReasons[report.reason] || report.reason;
                
                reportsList.innerHTML += `
                    <div class="report-card ${report.severity === 'urgent' ? 'urgent' : ''} ${report.status === 'resolved' ? 'resolved' : ''}">
                        <div class="report-header">
                            <div>
                                <div class="report-student">–û—Ç: ${report.teacher_name}</div>
                                <div class="report-teacher">–ü—Ä–∏—á–∏–Ω–∞: ${reasonText}</div>
                            </div>
                            <div class="report-date">${formatDate(report.created_at)}</div>
                        </div>
                        
                        <div class="report-reason">
                            ${report.description}
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="report-status status-${report.status}">
                                ${report.status === 'pending' ? '‚è≥ –û–∂–∏–¥–∞–µ—Ç' : report.status === 'resolved' ? '‚úÖ –†–µ—à–µ–Ω–æ' : 'üö® –°—Ä–æ—á–Ω–æ'}
                            </span>
                            <span style="color: ${severityInfo.color}; font-weight: bold;">
                                ${severityInfo.name}
                            </span>
                        </div>
                        
                        ${report.admin_comment ? `
                            <div style="background: #eff6ff; padding: 10px; border-radius: 6px; margin-top: 10px;">
                                <strong>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong><br>
                                ${report.admin_comment}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
        }

        async function loadAdminReports() {
            const { data: reports, error } = await supabase
                .from('reports')
                .select('*')
                .order('created_at', { ascending: false });

            if (error) {
                console.error('Error loading admin reports:', error);
                return;
            }

            const reportsList = document.getElementById('adminReportsList');
            
            if (!reports || reports.length === 0) {
                reportsList.innerHTML = '<div class="empty-state"><div>‚ö†Ô∏è</div><p>–ù–µ—Ç –∂–∞–ª–æ–± –≤ —Å–∏—Å—Ç–µ–º–µ</p></div>';
                return;
            }

            reportsList.innerHTML = '';
            reports.forEach(report => {
                const severityInfo = reportSeverities[report.severity];
                const reasonText = reportReasons[report.reason] || report.reason;
                
                reportsList.innerHTML += `
                    <div class="report-card ${report.severity === 'urgent' ? 'urgent' : ''} ${report.status === 'resolved' ? 'resolved' : ''}">
                        <div class="report-header">
                            <div>
                                <div class="report-student">üë®‚Äçüéì ${report.student_name} (${report.student_username})</div>
                                <div class="report-teacher">üë®‚Äçüè´ –û—Ç: ${report.teacher_name}</div>
                                <div style="color: var(--gray); font-size: 0.8em;">–ü—Ä–∏—á–∏–Ω–∞: ${reasonText}</div>
                            </div>
                            <div class="report-date">${formatDate(report.created_at)}</div>
                        </div>
                        
                        <div class="report-reason">
                            ${report.description}
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                            <span class="report-status status-${report.status}">
                                ${report.status === 'pending' ? '‚è≥ –û–∂–∏–¥–∞–µ—Ç' : report.status === 'resolved' ? '‚úÖ –†–µ—à–µ–Ω–æ' : 'üö® –°—Ä–æ—á–Ω–æ'}
                            </span>
                            <span style="color: ${severityInfo.color}; font-weight: bold;">
                                ${severityInfo.name}
                            </span>
                        </div>
                        
                        <div class="report-actions">
                            <button class="btn btn-success" onclick="resolveReport(${report.id})" style="width: auto; padding: 8px 12px;">
                                ‚úÖ –†–µ—à–∏—Ç—å
                            </button>
                            <button class="btn" onclick="addAdminComment(${report.id})" style="width: auto; padding: 8px 12px;">
                                üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
                            </button>
                            <button class="btn btn-danger" onclick="deleteReport(${report.id})" style="width: auto; padding: 8px 12px;">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                        
                        ${report.admin_comment ? `
                            <div style="background: #eff6ff; padding: 10px; border-radius: 6px; margin-top: 10px;">
                                <strong>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏:</strong><br>
                                ${report.admin_comment}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
        }

        async function loadReportsStatistics() {
            const { data: reports, error } = await supabase
                .from('reports')
                .select('*');

            if (error) return;

            const total = reports ? reports.length : 0;
            const pending = reports ? reports.filter(r => r.status === 'pending').length : 0;
            const resolved = reports ? reports.filter(r => r.status === 'resolved').length : 0;
            const urgent = reports ? reports.filter(r => r.severity === 'urgent').length : 0;

            document.getElementById('totalReportsCount').textContent = total;
            document.getElementById('pendingReportsCount').textContent = pending;
            document.getElementById('resolvedReportsCount').textContent = resolved;
            document.getElementById('urgentReportsCount').textContent = urgent;
        }

        async function resolveReport(reportId) {
            if (!confirm('–ü–æ–º–µ—Ç–∏—Ç—å –∂–∞–ª–æ–±—É –∫–∞–∫ —Ä–µ—à–µ–Ω–Ω—É—é?')) return;

            try {
                const { error } = await supabase
                    .from('reports')
                    .update({ 
                        status: 'resolved',
                        resolved_at: new Date().toISOString(),
                        resolved_by: currentUser.name
                    })
                    .eq('id', reportId);

                if (error) throw error;

                await loadAdminReports();
                await loadReportsStatistics();
                alert('‚úÖ –ñ–∞–ª–æ–±–∞ –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ —Ä–µ—à–µ–Ω–Ω–∞—è!');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
            }
        }

        async function addAdminComment(reportId) {
            const comment = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è —ç—Ç–æ–π –∂–∞–ª–æ–±—ã:');
            
            if (!comment) return;

            try {
                const { error } = await supabase
                    .from('reports')
                    .update({ 
                        admin_comment: comment,
                        commented_at: new Date().toISOString(),
                        commented_by: currentUser.name
                    })
                    .eq('id', reportId);

                if (error) throw error;

                await loadAdminReports();
                alert('üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω!');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
            }
        }

        async function deleteReport(reportId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∂–∞–ª–æ–±—É?')) return;

            try {
                const { error } = await supabase
                    .from('reports')
                    .delete()
                    .eq('id', reportId);

                if (error) throw error;

                await loadAdminReports();
                await loadReportsStatistics();
                alert('üóëÔ∏è –ñ–∞–ª–æ–±–∞ —É–¥–∞–ª–µ–Ω–∞!');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
            }
        }

        function searchReports() {
            const searchTerm = document.getElementById('searchReports').value.toLowerCase();
            const reportCards = document.querySelectorAll('#adminReportsList .report-card');
            
            reportCards.forEach(card => {
                const studentName = card.querySelector('.report-student').textContent.toLowerCase();
                const teacherName = card.querySelector('.report-teacher').textContent.toLowerCase();
                
                if (studentName.includes(searchTerm) || teacherName.includes(searchTerm)) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function filterReports() {
            const status = document.getElementById('filterReportsStatus').value;
            const reportCards = document.querySelectorAll('#adminReportsList .report-card');
            
            reportCards.forEach(card => {
                if (status === 'all') {
                    card.style.display = 'block';
                } else if (status === 'pending' && card.querySelector('.status-pending')) {
                    card.style.display = 'block';
                } else if (status === 'resolved' && card.querySelector('.status-resolved')) {
                    card.style.display = 'block';
                } else if (status === 'urgent' && card.classList.contains('urgent')) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–ß–ò–¢–ï–õ–Ø
        async function loadTeacherData() {
            await loadStudents();
            await loadGradeStudentSelect();
            await loadGradesHistory();
            await updateDashboard();
        }

        async function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            const username = document.getElementById('studentUsername').value.trim();
            const password = document.getElementById('studentPasswordInput').value.trim();
            const email = document.getElementById('studentEmail').value.trim();
            const course = document.getElementById('studentCourse').value;
            const groupId = document.getElementById('studentGroup').value;

            if (!name || !username || !password) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            const studentData = {
                name: name,
                username: username,
                password: password,
                email: email,
                course: course,
                join_date: new Date().toISOString().split('T')[0],
                teacher_name: 'Radmir Nurislamov'
            };

            if (groupId) {
                studentData.group_id = parseInt(groupId);
            }

            const { data, error } = await supabase
                .from('students')
                .insert([studentData])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            // –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –≥—Ä—É–ø–ø–∞, –¥–æ–±–∞–≤–ª—è–µ–º —Å–≤—è–∑—å
            if (groupId) {
                await addStudentToGroup(data[0].id, parseInt(groupId));
            }

            document.getElementById('studentName').value = '';
            document.getElementById('studentUsername').value = '';
            document.getElementById('studentPasswordInput').value = '';
            document.getElementById('studentEmail').value = '';
            
            loadStudents();
            updateDashboard();
            loadGradeStudentSelect();
            
            alert(`‚úÖ –£—á–µ–Ω–∏–∫ ${name} –¥–æ–±–∞–≤–ª–µ–Ω!\n\nüìã –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:\nüë§ –õ–æ–≥–∏–Ω: ${username}\nüîë –ü–∞—Ä–æ–ª—å: ${password}`);
        }

        async function addGrade() {
            const studentId = parseInt(document.getElementById('gradeStudent').value);
            const assignment = document.getElementById('gradeAssignment').value.trim();
            
            let gradeValue;
            if (currentGradeType === 'regular') {
                gradeValue = document.getElementById('gradeValue').value;
            } else if (currentGradeType === 'test') {
                gradeValue = document.getElementById('testGradeValue').value;
            } else if (currentGradeType === 'homework') {
                gradeValue = document.getElementById('homeworkGradeValue').value;
            } else if (currentGradeType === 'activity') {
                gradeValue = document.getElementById('activityGradeValue').value;
            } else if (currentGradeType === 'project') {
                gradeValue = document.getElementById('projectGradeValue').value;
            } else if (currentGradeType === 'oral') {
                gradeValue = document.getElementById('oralGradeValue').value;
            } else if (currentGradeType === 'attendance') {
                gradeValue = document.getElementById('attendanceGradeValue').value;
            }

            if (!studentId || !gradeValue || !assignment) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('grades')
                .insert([{
                    student_id: studentId,
                    grade: parseInt(gradeValue),
                    assignment: assignment,
                    type: currentGradeType,
                    grade_date: new Date().toISOString().split('T')[0],
                    teacher_name: 'Radmir Nurislamov'
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            document.getElementById('gradeAssignment').value = '';
            document.getElementById('gradeComment').value = '';
            loadGradesHistory();
            updateDashboard();
            
            const student = await getStudentById(studentId);
            alert(`‚úÖ –û—Ü–µ–Ω–∫–∞ ${gradeValue}${currentGradeType === 'test' ? '/25' : ''} –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —É—á–µ–Ω–∏–∫—É ${student.name}!`);
        }

        async function loadStudents() {
            const { data: students, error } = await supabase
                .from('students')
                .select(`
                    *,
                    student_groups!left (
                        name,
                        teacher:teacher_id (name)
                    )
                `)
                .order('name');

            if (error) {
                console.error('Error loading students:', error);
                return;
            }

            const list = document.getElementById('studentsList');
            
            if (!students || students.length === 0) {
                list.innerHTML = '<div class="empty-state"><div>üë®‚Äçüéì</div><h3>–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</h3><p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞</p></div>';
                return;
            }

            list.innerHTML = '';
            for (let student of students) {
                const { data: grades } = await supabase
                    .from('grades')
                    .select('grade, type')
                    .eq('student_id', student.id);

                const avgGrade = grades && grades.length > 0 
                    ? (grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0) / grades.length).toFixed(1)
                    : '‚Äî';

                const recentGrades = grades ? grades.slice(-3) : [];

                const groupInfo = student.student_groups ? 
                    `<p>üè∑Ô∏è –ì—Ä—É–ø–ø–∞: <strong>${student.student_groups.name}</strong> (${student.student_groups.teacher?.name || '–ë–µ–∑ —É—á–∏—Ç–µ–ª—è'})</p>` : 
                    '<p>üè∑Ô∏è –ì—Ä—É–ø–ø–∞: <em>–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞</em></p>';

                // –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –õ–û–ì–ò–ù–ê –ò –ü–ê–†–û–õ–Ø –î–õ–Ø –£–ß–ò–¢–ï–õ–Ø, –ó–ê–í–£–ß–ê –ò –ê–î–ú–ò–ù–ê
                const loginInfo = `
                    <div class="login-info">
                        <strong>üîê –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ —É—á–µ–Ω–∏–∫–∞:</strong><br>
                        üë§ –õ–æ–≥–∏–Ω: <strong style="color: var(--primary);">${student.username}</strong><br>
                        üîë –ü–∞—Ä–æ–ª—å: <strong style="color: var(--secondary);">${student.password}</strong>
                    </div>
                `;

                list.innerHTML += `
                    <div class="card student-card">
                        <div class="student-info">
                            <h3>${student.name}</h3>
                            ${loginInfo}
                            <p>üìß ${student.email || 'Email –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                            ${groupInfo}
                            <p>üìö –£—Ä–æ–≤–µ–Ω—å: ${renderCourseLevel(student.course)}</p>
                            <p>üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å: ${student.teacher_name || 'Radmir Nurislamov'}</p>
                            <p>üìÖ –ó–∞—á–∏—Å–ª–µ–Ω: ${student.join_date}</p>
                        </div>
                        <div class="student-stats">
                            <div class="average-grade">${avgGrade}</div>
                            <div>${recentGrades.map(grade => 
                                renderGrade(grade.grade, grade.type)
                            ).join('')}</div>
                            <button class="btn btn-danger" onclick="deleteStudent(${student.id})" style="width: auto; padding: 8px 12px;">üóëÔ∏è</button>
                        </div>
                    </div>`;
            }
        }

        function searchStudents() {
            const searchTerm = document.getElementById('searchStudent').value.toLowerCase();
            const studentCards = document.querySelectorAll('.student-card');
            
            studentCards.forEach(card => {
                const studentName = card.querySelector('h3').textContent.toLowerCase();
                if (studentName.includes(searchTerm)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        async function loadGradeStudentSelect() {
            const { data: students, error } = await supabase
                .from('students')
                .select('id, name, username')
                .order('name');

            if (error) return;

            const select = document.getElementById('gradeStudent');
            select.innerHTML = '';
            students.forEach(student => {
                select.innerHTML += `<option value="${student.id}">${student.name} (${student.username})</option>`;
            });
        }

        async function loadGradesHistory() {
            const { data: grades, error } = await supabase
                .from('grades')
                .select(`
                    *,
                    students (name)
                `)
                .order('created_at', { ascending: false })
                .limit(50);

            if (error) {
                console.error('Error loading grades:', error);
                return;
            }

            const history = document.getElementById('gradesHistory');
            
            if (!grades || grades.length === 0) {
                history.innerHTML = '<div class="empty-state"><div>üìù</div><p>–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</p></div>';
                return;
            }

            history.innerHTML = '';
            grades.forEach(grade => {
                const typeLabel = gradeTypes[grade.type]?.name || grade.type;
                
                history.innerHTML += `
                    <div style="padding: 12px; border-bottom: 1px solid #e2e8f0; display: flex; align-items: center; gap: 10px;">
                        ${renderGrade(grade.grade, grade.type)}
                        <div style="flex: 1;">
                            <strong>${grade.students.name}</strong><br>
                            <small style="color: var(--gray);">${typeLabel} ‚Ä¢ ${grade.assignment} ‚Ä¢ ${grade.grade_date}</small>
                        </div>
                    </div>`;
            });
        }

        async function updateDashboard() {
            const { data: students } = await supabase.from('students').select('id, course');
            const { data: grades } = await supabase.from('grades').select('grade, type');
            const { data: reports } = await supabase.from('reports').select('*');

            document.getElementById('totalStudents').textContent = students ? students.length : 0;
            
            const totalGrades = grades ? grades.length : 0;
            const totalGradeSum = grades ? grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0) : 0;
            const average = totalGrades > 0 ? (totalGradeSum / totalGrades).toFixed(1) : '0.0';
            
            document.getElementById('averageGrade').textContent = average;
            document.getElementById('totalGrades').textContent = totalGrades;
            document.getElementById('totalReports').textContent = reports ? reports.length : 0;
            
            await updateRecentGrades();
            await updateCourseLevelsStats(students);
        }

        async function updateRecentGrades() {
            const { data: grades, error } = await supabase
                .from('grades')
                .select(`
                    *,
                    students (name)
                `)
                .order('created_at', { ascending: false })
                .limit(5);

            if (error) return;

            const recent = document.getElementById('recentGrades');
            
            if (!grades || grades.length === 0) {
                recent.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 20px;">–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫</p>';
                return;
            }
            
            recent.innerHTML = '';
            grades.forEach(grade => {
                recent.innerHTML += `
                    <div style="display: flex; align-items: center; gap: 12px; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        ${renderGrade(grade.grade, grade.type)}
                        <div style="flex: 1;">
                            <strong>${grade.students.name}</strong>
                            <div style="color: var(--gray); font-size: 0.8em;">${grade.assignment}</div>
                        </div>
                        <small style="color: var(--gray); font-size: 0.8em;">${grade.grade_date}</small>
                    </div>`;
            });
        }

        async function updateCourseLevelsStats(students) {
            if (!students) return;

            const levelCounts = {};
            students.forEach(student => {
                levelCounts[student.course] = (levelCounts[student.course] || 0) + 1;
            });

            const stats = document.getElementById('courseLevelsStats');
            stats.innerHTML = '';
            
            Object.entries(levelCounts).forEach(([course, count]) => {
                const courseInfo = courseLevels[course] || { name: course, color: 'course-beginner' };
                stats.innerHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        <span class="course-badge ${courseInfo.color}">${courseInfo.name}</span>
                        <span style="font-weight: bold; color: var(--primary);">${count} —É—á.</span>
                    </div>
                `;
            });
        }

        async function deleteStudent(studentId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —É—á–µ–Ω–∏–∫–∞? –í—Å–µ –µ–≥–æ –æ—Ü–µ–Ω–∫–∏ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) return;

            try {
                const { error: gradesError } = await supabase
                    .from('grades')
                    .delete()
                    .eq('student_id', studentId);

                if (gradesError) throw gradesError;

                const { error: studentError } = await supabase
                    .from('students')
                    .delete()
                    .eq('id', studentId);

                if (studentError) throw studentError;

                loadStudents();
                loadGradeStudentSelect();
                updateDashboard();
                alert('üóëÔ∏è –£—á–µ–Ω–∏–∫ —É–¥–∞–ª–µ–Ω');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + err.message);
            }
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ó–ê–í–£–ß–ê
        async function loadHeadTeacherData() {
            await loadAcademicStatistics();
            await loadTeacherPerformance();
            await loadQualityMetrics();
        }

        async function loadAcademicStatistics() {
            const { data: students } = await supabase.from('students').select('*');
            const { data: grades } = await supabase.from('grades').select('*');
            const { data: teachers } = await supabase.from('teacher').select('*');
            
            document.getElementById('htTotalTeachers').textContent = teachers ? teachers.length : 0;
            document.getElementById('htTotalStudents').textContent = students ? students.length : 0;
            
            const totalGrades = grades ? grades.length : 0;
            const totalGradeSum = grades ? grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0) : 0;
            const schoolAverage = totalGrades > 0 ? (totalGradeSum / totalGrades).toFixed(1) : '0.0';
            document.getElementById('htSchoolAverage').textContent = schoolAverage;
            
            const goodGrades = grades ? grades.filter(g => g.grade >= 6).length : 0;
            const successRate = totalGrades > 0 ? Math.round((goodGrades / totalGrades) * 100) : 0;
            document.getElementById('htSuccessRate').textContent = successRate + '%';

            await loadLevelPerformance(students, grades);
        }

        async function loadLevelPerformance(students, grades) {
            if (!students || !grades) return;

            const levelPerformance = {};
            students.forEach(student => {
                if (!levelPerformance[student.course]) {
                    levelPerformance[student.course] = { total: 0, sum: 0, count: 0 };
                }
            });

            grades.forEach(grade => {
                const student = students.find(s => s.id === grade.student_id);
                if (student && levelPerformance[student.course]) {
                    levelPerformance[student.course].total++;
                    levelPerformance[student.course].sum += grade.type === 'test' ? grade.grade/2.5 : grade.grade;
                    levelPerformance[student.course].count++;
                }
            });

            let performanceHTML = '';
            Object.entries(levelPerformance).forEach(([course, data]) => {
                const courseInfo = courseLevels[course] || { name: course };
                const average = data.count > 0 ? (data.sum / data.count).toFixed(1) : '0.0';
                
                performanceHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        <span class="course-badge ${courseInfo.color}">${courseInfo.name}</span>
                        <div>
                            <span style="font-weight: bold; color: var(--primary);">${average}</span>
                            <small style="color: var(--gray); margin-left: 10px;">${data.count} –æ—Ü–µ–Ω.</small>
                        </div>
                    </div>
                `;
            });

            document.getElementById('levelPerformance').innerHTML = performanceHTML;
        }

        async function loadTeacherPerformance() {
            const { data: teachers } = await supabase.from('teacher').select('*');
            
            let activityHTML = '';
            if (teachers && teachers.length > 0) {
                teachers.forEach(teacher => {
                    activityHTML += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                            <span>${teacher.name}</span>
                            <span style="color: var(--secondary); font-weight: bold;">–ê–∫—Ç–∏–≤–µ–Ω</span>
                        </div>
                    `;
                });
            } else {
                activityHTML = '<p style="color: var(--gray); text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è—Ö</p>';
            }

            document.getElementById('teacherActivity').innerHTML = activityHTML;
        }

        async function loadQualityMetrics() {
            const metricsHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                        <div style="font-weight: bold;">–ö–∞—á–µ—Å—Ç–≤–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</div>
                        <div style="font-size: 1.5em; color: var(--secondary);">92%</div>
                    </div>
                    <div style="background: #fffbeb; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                        <div style="font-weight: bold;">–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å</div>
                        <div style="font-size: 1.5em; color: var(--warning);">88%</div>
                    </div>
                    <div style="background: #fef2f2; padding: 15px; border-radius: 8px; border-left: 4px solid var(--danger);">
                        <div style="font-weight: bold;">–í–Ω–∏–º–∞–Ω–∏–µ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º</div>
                        <div style="font-size: 1.5em; color: var(--danger);">95%</div>
                    </div>
                    <div style="background: #eff6ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                        <div style="font-weight: bold;">–ü—Ä–æ–≥—Ä–µ—Å—Å —É—á–µ–Ω–∏–∫–æ–≤</div>
                        <div style="font-size: 1.5em; color: var(--primary);">85%</div>
                    </div>
                </div>
            `;

            document.getElementById('qualityMetrics').innerHTML = metricsHTML;
        }

        function generateAcademicReport() {
            alert('üìÑ –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        function generateTeacherReport() {
            alert('üë®‚Äçüè´ –û—Ç—á–µ—Ç –ø–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        function generateProgressReport() {
            alert('üìà –û—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        function generateQualityReport() {
            alert('üéØ –û—Ç—á–µ—Ç –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –æ–±—É—á–µ–Ω–∏—è –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê
        async function loadAdminData() {
            await loadUserManagement();
            await loadGroupManagement();
            await loadTeacherRatings();
            await loadSystemAnalytics();
            await loadSecurityData();
        }

        async function loadUserManagement() {
            const { data: teachers } = await supabase.from('teacher').select('*');
            const { data: students } = await supabase.from('students').select('*');
            
            document.getElementById('adminTotalUsers').textContent = (teachers ? teachers.length : 0) + (students ? students.length : 0);
            document.getElementById('adminTotalTeachers').textContent = teachers ? teachers.length : 0;
            document.getElementById('adminTotalStudents').textContent = students ? students.length : 0;
            
            await loadUsersList();
            await loadRatingTeacherSelect();
        }

        async function loadUsersList() {
            const { data: teachers } = await supabase.from('teacher').select('*');
            const { data: students } = await supabase.from('students').select('*');
            
            let usersHTML = '';
            
            if (teachers && teachers.length > 0) {
                teachers.forEach(teacher => {
                    usersHTML += `
                        <div class="teacher-card">
                            <div class="teacher-info">
                                <div class="teacher-details">
                                    <h3>${teacher.name}</h3>
                                    <p>üìß ${teacher.email}</p>
                                    <p>üé≠ –£—á–∏—Ç–µ–ª—å</p>
                                    <p>üìÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${teacher.created_at ? teacher.created_at.split('T')[0] : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                                </div>
                                <div class="teacher-actions">
                                    <button class="btn btn-danger" onclick="deleteUser('teacher', ${teacher.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            if (students && students.length > 0) {
                students.forEach(student => {
                    usersHTML += `
                        <div class="teacher-card">
                            <div class="teacher-info">
                                <div class="teacher-details">
                                    <h3>${student.name}</h3>
                                    <p>üë§ –õ–æ–≥–∏–Ω: <strong style="color: var(--primary);">${student.username}</strong></p>
                                    <p>üîë –ü–∞—Ä–æ–ª—å: <strong style="color: var(--secondary);">${student.password}</strong></p>
                                    <p>üé≠ –£—á–µ–Ω–∏–∫</p>
                                    <p>üìÖ –ó–∞—á–∏—Å–ª–µ–Ω: ${student.join_date}</p>
                                </div>
                                <div class="teacher-actions">
                                    <button class="btn btn-danger" onclick="deleteUser('student', ${student.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            document.getElementById('usersList').innerHTML = usersHTML || '<div class="empty-state"><div>üë•</div><p>–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p></div>';
        }

        async function addUser() {
            const name = document.getElementById('newUserName').value.trim();
            const email = document.getElementById('newUserEmail').value.trim();
            const password = document.getElementById('newUserPassword').value.trim();
            const role = document.getElementById('newUserRole').value;

            if (!name || !email || !password) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            try {
                let tableName = '';
                let data = {};

                if (role === 'teacher') {
                    tableName = 'teacher';
                    data = { name, email, password };
                } else if (role === 'head_teacher') {
                    tableName = 'teacher';
                    data = { name, email, password, is_head_teacher: true };
                } else if (role === 'admin') {
                    tableName = 'admin';
                    data = { name, email, password };
                }

                const { data: result, error } = await supabase
                    .from(tableName)
                    .insert([data])
                    .select();

                if (error) throw error;

                document.getElementById('newUserName').value = '';
                document.getElementById('newUserEmail').value = '';
                document.getElementById('newUserPassword').value = '';
                
                loadUserManagement();
                alert(`‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${name} –¥–æ–±–∞–≤–ª–µ–Ω –∫–∞–∫ ${userRoles[role].name}!`);
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
            }
        }

        async function deleteUser(type, id) {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?`)) return;

            try {
                const tableName = type === 'student' ? 'students' : type;
                const { error } = await supabase
                    .from(tableName)
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                loadUserManagement();
                alert('üóëÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + err.message);
            }
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ì–†–£–ü–ü–ê–ú–ò
        async function loadGroupManagement() {
            await loadTeacherStats();
            await loadGroupsList();
            await loadGroupSelects();
        }

        async function loadTeacherStats() {
            const { data: teachers } = await supabase.from('teacher').select('*');
            const { data: groups } = await supabase.from('student_groups').select('*');
            const { data: students } = await supabase.from('students').select('*');
            
            if (!teachers) return;

            let statsHTML = '<div class="stats-grid">';
            
            teachers.forEach(teacher => {
                const teacherGroups = groups ? groups.filter(g => g.teacher_id === teacher.id) : [];
                const teacherStudents = students ? students.filter(s => {
                    const studentGroup = groups ? groups.find(g => g.id === s.group_id) : null;
                    return studentGroup && studentGroup.teacher_id === teacher.id;
                }) : [];
                
                statsHTML += `
                    <div class="stat-card">
                        <div>üë®‚Äçüè´</div>
                        <div class="stat-number">${teacherGroups.length}</div>
                        <div class="stat-label">–ì—Ä—É–ø–ø —É ${teacher.name}</div>
                        <div class="stat-number">${teacherStudents.length}</div>
                        <div class="stat-label">–°—Ç—É–¥–µ–Ω—Ç–æ–≤</div>
                    </div>
                `;
            });
            
            statsHTML += '</div>';
            document.getElementById('teacherStats').innerHTML = statsHTML;

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –¥–∞—à–±–æ—Ä–¥–µ
            document.getElementById('adminTotalGroups').textContent = groups ? groups.length : 0;
        }

        async function loadGroupsList() {
            const { data: groups, error } = await supabase
                .from('student_groups')
                .select(`
                    *,
                    teacher:teacher_id (name),
                    students:students (id, name)
                `)
                .order('name');

            if (error) {
                console.error('Error loading groups:', error);
                return;
            }

            let groupsHTML = '';
            
            if (groups && groups.length > 0) {
                groups.forEach(group => {
                    const studentCount = group.students ? group.students.length : 0;
                    const percentage = Math.round((studentCount / group.max_students) * 100);
                    
                    groupsHTML += `
                        <div class="group-card">
                            <div class="teacher-info">
                                <div class="teacher-details">
                                    <h3>${group.name}</h3>
                                    <p>üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: <strong>${group.teacher?.name || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω'}</strong></p>
                                    <p>üìö –£—Ä–æ–≤–µ–Ω—å: <strong>${getCourseName(group.course_level)}</strong></p>
                                    
                                    <div class="group-stats">
                                        <div class="group-stat">
                                            <div style="font-size: 1.2em; font-weight: bold; color: var(--primary);">${studentCount}</div>
                                            <div style="font-size: 0.8em; color: var(--gray);">–°—Ç—É–¥–µ–Ω—Ç–æ–≤</div>
                                        </div>
                                        <div class="group-stat">
                                            <div style="font-size: 1.2em; font-weight: bold; color: var(--secondary);">${group.max_students}</div>
                                            <div style="font-size: 0.8em; color: var(--gray);">–ú–∞–∫—Å–∏–º—É–º</div>
                                        </div>
                                        <div class="group-stat">
                                            <div style="font-size: 1.2em; font-weight: bold; color: ${percentage >= 80 ? 'var(--danger)' : percentage >= 50 ? 'var(--warning)' : 'var(--secondary)'};">${percentage}%</div>
                                            <div style="font-size: 0.8em; color: var(--gray);">–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
                                        </div>
                                    </div>

                                    <div class="test-grade-progress">
                                        <div class="test-grade-progress-bar" style="width: ${percentage}%; background: ${percentage >= 80 ? 'var(--danger)' : percentage >= 50 ? 'var(--warning)' : 'var(--secondary)'};"></div>
                                    </div>
                                </div>
                                <div class="teacher-actions">
                                    <button class="btn btn-danger" onclick="deleteGroup(${group.id})">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                                </div>
                            </div>
                            
                            ${studentCount > 0 ? `
                                <div class="group-students">
                                    <h4>üë®‚Äçüéì –°—Ç—É–¥–µ–Ω—Ç—ã –≤ –≥—Ä—É–ø–ø–µ:</h4>
                                    ${group.students.map(student => `
                                        <div class="student-in-group">
                                            <span>${student.name}</span>
                                            <button class="btn btn-danger" onclick="removeStudentFromGroup(${student.id}, ${group.id})" style="width: auto; padding: 4px 8px; font-size: 0.7em;">üóëÔ∏è</button>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : '<p style="color: var(--gray); text-align: center; padding: 10px;">–í –≥—Ä—É–ø–ø–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p>'}
                        </div>
                    `;
                });
            } else {
                groupsHTML = '<div class="empty-state"><div>üè∑Ô∏è</div><p>–ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –≥—Ä—É–ø–ø</p></div>';
            }
            
            document.getElementById('groupsList').innerHTML = groupsHTML;
        }

        async function loadGroupSelects() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã
            const { data: teachers, error: teachersError } = await supabase
                .from('teacher')
                .select('id, name')
                .order('name');

            if (!teachersError && teachers) {
                const teacherSelect = document.getElementById('groupTeacher');
                teacherSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è --</option>';
                teachers.forEach(teacher => {
                    teacherSelect.innerHTML += `<option value="${teacher.id}">${teacher.name}</option>`;
                });
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É
            const { data: students, error: studentsError } = await supabase
                .from('students')
                .select('id, name, username')
                .order('name');

            if (!studentsError && students) {
                const studentSelect = document.getElementById('assignStudent');
                studentSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ --</option>';
                students.forEach(student => {
                    studentSelect.innerHTML += `<option value="${student.id}">${student.name} (${student.username})</option>`;
                });

                // –¢–∞–∫–∂–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–ª—è —Ñ–æ—Ä–º—ã –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞
                const addStudentGroupSelect = document.getElementById('studentGroup');
                addStudentGroupSelect.innerHTML = '<option value="">-- –ë–µ–∑ –≥—Ä—É–ø–ø—ã --</option>';
                const { data: groups } = await supabase.from('student_groups').select('id, name').order('name');
                if (groups) {
                    groups.forEach(group => {
                        addStudentGroupSelect.innerHTML += `<option value="${group.id}">${group.name}</option>`;
                    });
                }
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä—É–ø–ø –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞
            const { data: groups, error: groupsError } = await supabase
                .from('student_groups')
                .select('id, name')
                .order('name');

            if (!groupsError && groups) {
                const groupSelect = document.getElementById('assignGroup');
                groupSelect.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É --</option>';
                groups.forEach(group => {
                    groupSelect.innerHTML += `<option value="${group.id}">${group.name}</option>`;
                });
            }
        }

        async function createGroup() {
            const name = document.getElementById('groupName').value.trim();
            const teacherId = document.getElementById('groupTeacher').value;
            const level = document.getElementById('groupLevel').value;
            const maxStudents = parseInt(document.getElementById('groupMaxStudents').value);

            if (!name || !teacherId || !level) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            if (maxStudents < 1 || maxStudents > 30) {
                alert('‚ö†Ô∏è –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 30!');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('student_groups')
                    .insert([{
                        name: name,
                        teacher_id: parseInt(teacherId),
                        course_level: level,
                        max_students: maxStudents,
                        created_at: new Date().toISOString()
                    }])
                    .select();

                if (error) throw error;

                document.getElementById('groupName').value = '';
                document.getElementById('groupTeacher').value = '';
                document.getElementById('groupMaxStudents').value = '12';
                
                loadGroupManagement();
                alert(`‚úÖ –ì—Ä—É–ø–ø–∞ "${name}" —Å–æ–∑–¥–∞–Ω–∞!`);
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
            }
        }

        async function assignStudentToGroup() {
            const studentId = parseInt(document.getElementById('assignStudent').value);
            const groupId = parseInt(document.getElementById('assignGroup').value);

            if (!studentId || !groupId) {
                alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ –∏ –≥—Ä—É–ø–ø—É!');
                return;
            }

            try {
                // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç –ª–∏ —Å—Ç—É–¥–µ–Ω—Ç —É–∂–µ –≤ –≥—Ä—É–ø–ø–µ
                const { data: existing, error: checkError } = await supabase
                    .from('students')
                    .select('group_id')
                    .eq('id', studentId)
                    .single();

                if (checkError) throw checkError;

                if (existing.group_id) {
                    if (!confirm('–°—Ç—É–¥–µ–Ω—Ç —É–∂–µ —Å–æ—Å—Ç–æ–∏—Ç –≤ –≥—Ä—É–ø–ø–µ. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –µ–≥–æ –≤ –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É?')) {
                        return;
                    }
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä—É–ø–ø—É —Å—Ç—É–¥–µ–Ω—Ç–∞
                const { error } = await supabase
                    .from('students')
                    .update({ group_id: groupId })
                    .eq('id', studentId);

                if (error) throw error;

                document.getElementById('assignStudent').value = '';
                document.getElementById('assignGroup').value = '';
                
                loadGroupManagement();
                loadStudents();
                alert('‚úÖ –°—Ç—É–¥–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω –≤ –≥—Ä—É–ø–ø—É!');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
            }
        }

        async function addStudentToGroup(studentId, groupId) {
            try {
                const { error } = await supabase
                    .from('students')
                    .update({ group_id: groupId })
                    .eq('id', studentId);

                if (error) throw error;
                
            } catch (err) {
                console.error('Error adding student to group:', err);
            }
        }

        async function removeStudentFromGroup(studentId, groupId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞ –∏–∑ –≥—Ä—É–ø–ø—ã?')) return;

            try {
                const { error } = await supabase
                    .from('students')
                    .update({ group_id: null })
                    .eq('id', studentId);

                if (error) throw error;

                loadGroupManagement();
                loadStudents();
                alert('‚úÖ –°—Ç—É–¥–µ–Ω—Ç —É–¥–∞–ª–µ–Ω –∏–∑ –≥—Ä—É–ø–ø—ã!');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
            }
        }

        async function deleteGroup(groupId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –≥—Ä—É–ø–ø—É? –°—Ç—É–¥–µ–Ω—Ç—ã –±—É–¥—É—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ —Å—Ç–∞—Ç—É—Å "–±–µ–∑ –≥—Ä—É–ø–ø—ã".')) return;

            try {
                // –°–Ω–∞—á–∞–ª–∞ –æ–±–Ω—É–ª—è–µ–º group_id —É —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ —ç—Ç–æ–π –≥—Ä—É–ø–ø—ã
                const { error: updateError } = await supabase
                    .from('students')
                    .update({ group_id: null })
                    .eq('group_id', groupId);

                if (updateError) throw updateError;

                // –ó–∞—Ç–µ–º —É–¥–∞–ª—è–µ–º —Å–∞–º—É –≥—Ä—É–ø–ø—É
                const { error: deleteError } = await supabase
                    .from('student_groups')
                    .delete()
                    .eq('id', groupId);

                if (deleteError) throw deleteError;

                loadGroupManagement();
                loadStudents();
                alert('üóëÔ∏è –ì—Ä—É–ø–ø–∞ —É–¥–∞–ª–µ–Ω–∞!');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + err.message);
            }
        }

        // –°–ò–°–¢–ï–ú–ê –†–ï–ô–¢–ò–ù–ì–û–í –£–ß–ò–¢–ï–õ–ï–ô
        async function loadTeacherRatings() {
            const { data: teachers } = await supabase.from('teacher').select('*');
            const { data: ratings } = await supabase.from('teacher_ratings').select('*');
            
            if (!teachers) return;
            
            let ratingsHTML = '';
            let totalRating = 0;
            let ratingCount = 0;
            
            teachers.forEach(teacher => {
                const teacherRatings = ratings ? ratings.filter(r => r.teacher_id === teacher.id) : [];
                const avgRating = teacherRatings.length > 0 
                    ? (teacherRatings.reduce((sum, r) => sum + r.rating, 0) / teacherRatings.length).toFixed(1)
                    : '0.0';
                
                totalRating += parseFloat(avgRating);
                ratingCount += teacherRatings.length;
                
                ratingsHTML += `
                    <div class="teacher-card">
                        <div class="teacher-info">
                            <div class="teacher-details">
                                <h3>${teacher.name}</h3>
                                <p>üìß ${teacher.email}</p>
                                <div class="teacher-rating">
                                    <span class="rating-value">${avgRating}</span>
                                    ${renderStars(avgRating)}
                                    <span style="color: var(--gray);">(${teacherRatings.length} –æ—Ü–µ–Ω–æ–∫)</span>
                                </div>
                            </div>
                            <div class="teacher-actions">
                                <button class="btn" onclick="viewTeacherDetails(${teacher.id})">üëÅÔ∏è –ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            const avgOverallRating = teachers.length > 0 ? (totalRating / teachers.length).toFixed(1) : '0.0';
            
            document.getElementById('teachersRatingsList').innerHTML = ratingsHTML || '<div class="empty-state"><div>üë®‚Äçüè´</div><p>–ù–µ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</p></div>';
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
            const ratingsStatsHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                        <div style="font-weight: bold;">–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥</div>
                        <div style="font-size: 1.5em; color: var(--secondary);">${avgOverallRating}</div>
                    </div>
                    <div style="background: #fffbeb; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                        <div style="font-weight: bold;">–í—Å–µ–≥–æ –æ—Ü–µ–Ω–æ–∫</div>
                        <div style="font-size: 1.5em; color: var(--warning);">${ratingCount}</div>
                    </div>
                    <div style="background: #eff6ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                        <div style="font-weight: bold;">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</div>
                        <div style="font-size: 1.5em; color: var(--primary);">${teachers.length}</div>
                    </div>
                    <div style="background: #fef2f2; padding: 15px; border-radius: 8px; border-left: 4px solid var(--danger);">
                        <div style="font-weight: bold;">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                        <div style="font-size: 1.5em; color: var(--danger);">${teachers.length}</div>
                    </div>
                </div>
            `;
            
            document.getElementById('ratingsStats').innerHTML = ratingsStatsHTML;
        }

        function renderStars(rating) {
            rating = parseFloat(rating);
            let starsHTML = '';
            for (let i = 1; i <= 5; i++) {
                starsHTML += `<span class="star ${i <= rating ? 'active' : 'inactive'}">‚òÖ</span>`;
            }
            return starsHTML;
        }

        async function loadRatingTeacherSelect() {
            const { data: teachers, error } = await supabase
                .from('teacher')
                .select('id, name')
                .order('name');

            if (error) return;

            const select = document.getElementById('ratingTeacher');
            select.innerHTML = '';
            teachers.forEach(teacher => {
                select.innerHTML += `<option value="${teacher.id}">${teacher.name}</option>`;
            });
        }

        function initStarRating() {
            const stars = document.querySelectorAll('#starRating .star');
            stars.forEach(star => {
                star.addEventListener('click', function() {
                    const value = parseInt(this.getAttribute('data-value'));
                    document.getElementById('ratingValue').value = value;
                    
                    stars.forEach(s => {
                        const starValue = parseInt(s.getAttribute('data-value'));
                        if (starValue <= value) {
                            s.classList.add('active');
                            s.classList.remove('inactive');
                        } else {
                            s.classList.add('inactive');
                            s.classList.remove('active');
                        }
                    });
                });
            });
        }

        async function addTeacherRating() {
            const teacherId = parseInt(document.getElementById('ratingTeacher').value);
            const rating = parseInt(document.getElementById('ratingValue').value);
            const comment = document.getElementById('ratingComment').value.trim();

            if (!teacherId || rating === 0) {
                alert('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –∏ –ø–æ—Å—Ç–∞–≤—å—Ç–µ –æ—Ü–µ–Ω–∫—É!');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('teacher_ratings')
                    .insert([{
                        teacher_id: teacherId,
                        rating: rating,
                        comment: comment,
                        created_by: currentUser.name,
                        created_at: new Date().toISOString()
                    }])
                    .select();

                if (error) throw error;

                document.getElementById('ratingComment').value = '';
                document.getElementById('ratingValue').value = 0;
                
                // –°–±—Ä–æ—Å –∑–≤–µ–∑–¥
                const stars = document.querySelectorAll('#starRating .star');
                stars.forEach(star => {
                    star.classList.add('inactive');
                    star.classList.remove('active');
                });
                
                loadTeacherRatings();
                alert('‚≠ê –†–µ–π—Ç–∏–Ω–≥ –¥–æ–±–∞–≤–ª–µ–Ω!');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + err.message);
            }
        }

        function viewTeacherDetails(teacherId) {
            alert('–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è —Å ID: ' + teacherId);
            // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
        }

        // –°–ò–°–¢–ï–ú–ù–ê–Ø –ê–ù–ê–õ–ò–¢–ò–ö–ê
        async function loadSystemAnalytics() {
            const { data: teachers } = await supabase.from('teacher').select('*');
            const { data: students } = await supabase.from('students').select('*');
            const { data: grades } = await supabase.from('grades').select('*');
            const { data: schedule } = await supabase.from('schedule').select('*');
            const { data: groups } = await supabase.from('student_groups').select('*');
            
            const systemUsageHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                        <div style="font-weight: bold;">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                        <div style="font-size: 1.5em; color: var(--secondary);">${(teachers ? teachers.length : 0) + (students ? students.length : 0)}</div>
                    </div>
                    <div style="background: #fffbeb; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                        <div style="font-weight: bold;">–í—Å–µ–≥–æ –∑–∞–Ω—è—Ç–∏–π</div>
                        <div style="font-size: 1.5em; color: var(--warning);">${schedule ? schedule.length : 0}</div>
                    </div>
                    <div style="background: #eff6ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                        <div style="font-weight: bold;">–í—Å–µ–≥–æ –æ—Ü–µ–Ω–æ–∫</div>
                        <div style="font-size: 1.5em; color: var(--primary);">${grades ? grades.length : 0}</div>
                    </div>
                    <div style="background: #fef2f2; padding: 15px; border-radius: 8px; border-left: 4px solid var(--danger);">
                        <div style="font-weight: bold;">–°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞</div>
                        <div style="font-size: 1.5em; color: var(--danger);">
                            ${grades && grades.length > 0 ? 
                                (grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0) / grades.length).toFixed(1) 
                                : '0.0'}
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('systemUsage').innerHTML = systemUsageHTML;
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º –∏ –≥—Ä—É–ø–ø–∞–º –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞
            const teacherGroupStatsHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: bold;">üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</div>
                        <div style="font-size: 1.5em; color: var(--primary); margin: 10px 0;">${teachers ? teachers.length : 0}</div>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: bold;">üè∑Ô∏è –ì—Ä—É–ø–ø</div>
                        <div style="font-size: 1.5em; color: var(--secondary); margin: 10px 0;">${groups ? groups.length : 0}</div>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: bold;">üë®‚Äçüéì –°—Ç—É–¥–µ–Ω—Ç–æ–≤ –≤ –≥—Ä—É–ø–ø–∞—Ö</div>
                        <div style="font-size: 1.5em; color: var(--warning); margin: 10px 0;">
                            ${students ? students.filter(s => s.group_id).length : 0} / ${students ? students.length : 0}
                        </div>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: bold;">üìä –°—Ä–µ–¥–Ω—è—è –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –≥—Ä—É–ø–ø</div>
                        <div style="font-size: 1.5em; color: var(--danger); margin: 10px 0;">
                            ${groups && groups.length > 0 ? 
                                Math.round(groups.reduce((sum, g) => {
                                    const groupStudents = students ? students.filter(s => s.group_id === g.id).length : 0;
                                    return sum + (groupStudents / g.max_students) * 100;
                                }, 0) / groups.length) : 0}%
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('teacherGroupStats').innerHTML = teacherGroupStatsHTML;
            
            const activityStatsHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å</th>
                            <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                            <th>–¢–µ–Ω–¥–µ–Ω—Ü–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>üë• –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–º–µ—Å.)</td>
                            <td>${Math.floor((students ? students.length : 0) * 0.1)}</td>
                            <td>üìà +5%</td>
                        </tr>
                        <tr>
                            <td>üìù –ù–æ–≤—ã–µ –æ—Ü–µ–Ω–∫–∏ (–Ω–µ–¥.)</td>
                            <td>${Math.floor((grades ? grades.length : 0) * 0.2)}</td>
                            <td>üìà +12%</td>
                        </tr>
                        <tr>
                            <td>üìÖ –ó–∞–Ω—è—Ç–∏–π –ø—Ä–æ–≤–µ–¥–µ–Ω–æ</td>
                            <td>${schedule ? schedule.filter(s => new Date(s.date) < new Date()).length : 0}</td>
                            <td>üìà +8%</td>
                        </tr>
                        <tr>
                            <td>üè∑Ô∏è –ù–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã (–º–µ—Å.)</td>
                            <td>${Math.floor((groups ? groups.length : 0) * 0.15)}</td>
                            <td>üìà +10%</td>
                        </tr>
                    </tbody>
                </table>
            `;
            
            document.getElementById('activityStats').innerHTML = activityStatsHTML;
            
            const systemStatsHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: bold;">üíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ë–î</div>
                        <div style="font-size: 1.2em; color: var(--primary); margin: 10px 0;">42%</div>
                        <div class="test-grade-progress">
                            <div class="test-grade-progress-bar" style="width: 42%"></div>
                        </div>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: bold;">‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
                        <div style="font-size: 1.2em; color: var(--secondary); margin: 10px 0;">92%</div>
                        <div class="test-grade-progress">
                            <div class="test-grade-progress-bar" style="width: 92%; background: var(--secondary);"></div>
                        </div>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: bold;">üîÑ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å API</div>
                        <div style="font-size: 1.2em; color: var(--warning); margin: 10px 0;">156 –∑–∞–ø—Ä./–º–∏–Ω</div>
                        <div class="test-grade-progress">
                            <div class="test-grade-progress-bar" style="width: 65%; background: var(--warning);"></div>
                        </div>
                    </div>
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                        <div style="font-weight: bold;">‚úÖ –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</div>
                        <div style="font-size: 1.2em; color: var(--secondary); margin: 10px 0;">–°—Ç–∞–±–∏–ª–µ–Ω</div>
                        <div style="color: var(--secondary);">üü¢ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç</div>
                    </div>
                </div>
            `;
            
            document.getElementById('systemStats').innerHTML = systemStatsHTML;
        }

        // –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨
        async function loadSecurityData() {
            const securityMonitoringHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                        <div style="font-weight: bold;">üõ°Ô∏è –ó–∞—â–∏—Ç–∞</div>
                        <div style="font-size: 1.2em; color: var(--secondary); margin: 10px 0;">–ê–∫—Ç–∏–≤–Ω–∞</div>
                    </div>
                    <div style="background: #fffbeb; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                        <div style="font-weight: bold;">üîê –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                        <div style="font-size: 1.2em; color: var(--warning); margin: 10px 0;">–°–µ–≥–æ–¥–Ω—è</div>
                    </div>
                    <div style="background: #fef2f2; padding: 15px; border-radius: 8px; border-left: 4px solid var(--danger);">
                        <div style="font-weight: bold;">‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è</div>
                        <div style="font-size: 1.2em; color: var(--danger); margin: 10px 0;">0</div>
                    </div>
                    <div style="background: #eff6ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                        <div style="font-weight: bold;">üìä –£—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</div>
                        <div style="font-size: 1.2em; color: var(--primary); margin: 10px 0;">–í—ã—Å–æ–∫–∏–π</div>
                    </div>
                </div>
            `;
            
            document.getElementById('securityMonitoring').innerHTML = securityMonitoringHTML;
            
            const securityLogHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>–î–∞—Ç–∞</th>
                            <th>–°–æ–±—ã—Ç–∏–µ</th>
                            <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>${new Date().toLocaleDateString()}</td>
                            <td>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</td>
                            <td>${currentUser.name}</td>
                            <td>‚úÖ –£—Å–ø–µ—à–Ω–æ</td>
                        </tr>
                        <tr>
                            <td>${new Date(Date.now() - 86400000).toLocaleDateString()}</td>
                            <td>–°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è</td>
                            <td>–£—á–∏—Ç–µ–ª—å 1</td>
                            <td>‚úÖ –£—Å–ø–µ—à–Ω–æ</td>
                        </tr>
                        <tr>
                            <td>${new Date(Date.now() - 172800000).toLocaleDateString()}</td>
                            <td>–ü–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞</td>
                            <td>–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π</td>
                            <td>‚ùå –ù–µ—É–¥–∞—á–Ω–æ</td>
                        </tr>
                        <tr>
                            <td>${new Date(Date.now() - 259200000).toLocaleDateString()}</td>
                            <td>–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã</td>
                            <td>–°–∏—Å—Ç–µ–º–∞</td>
                            <td>‚úÖ –£—Å–ø–µ—à–Ω–æ</td>
                        </tr>
                    </tbody>
                </table>
            `;
            
            document.getElementById('securityLog').innerHTML = securityLogHTML;
        }

        function changeAdminPassword() {
            const currentPassword = document.getElementById('currentAdminPassword').value;
            const newPassword = document.getElementById('newAdminPassword').value;
            const confirmPassword = document.getElementById('confirmAdminPassword').value;

            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            if (newPassword !== confirmPassword) {
                alert('‚ùå –ù–æ–≤—ã–µ –ø–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!');
                return;
            }

            if (currentPassword !== 'admin123') {
                alert('‚ùå –¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–µ–Ω!');
                return;
            }

            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ API –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
            document.getElementById('currentAdminPassword').value = '';
            document.getElementById('newAdminPassword').value = '';
            document.getElementById('confirmAdminPassword').value = '';
            
            alert('‚úÖ –ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!');
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –û–¢–ß–ï–¢–û–í
        function generateSystemReport() {
            alert('üìÑ –°–∏—Å—Ç–µ–º–Ω—ã–π –æ—Ç—á–µ—Ç –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        function generateUserReport() {
            alert('üë• –û—Ç—á–µ—Ç –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        function generateSecurityReport() {
            alert('üîí –û—Ç—á–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        function generatePerformanceReport() {
            alert('‚ö° –û—Ç—á–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ù–ê–°–¢–†–û–ï–ö
        function saveSystemSettings() {
            alert('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        function saveSecuritySettings() {
            alert('üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã');
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–ß–ï–ù–ò–ö–ê
        async function showStudentGrades() {
            const { data: grades, error } = await supabase
                .from('grades')
                .select('*')
                .eq('student_id', currentUser.id)
                .order('created_at', { ascending: false });

            if (error) {
                console.error('Error loading student grades:', error);
                return;
            }

            let avgGrade = '0.0';
            if (grades && grades.length > 0) {
                const total = grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0);
                avgGrade = (total / grades.length).toFixed(1);
            }
            
            document.getElementById('studentAverageGrade').textContent = avgGrade;
            document.getElementById('studentCourseDisplay').textContent = getCourseName(currentUser.course);
            document.getElementById('studentJoinDate').textContent = currentUser.join_date;
            
            // –†–ê–°–ß–ï–¢ –ü–†–û–ì–†–ï–°–°–ê –ó–ê –°–ï–ì–û–î–ù–Ø
            await updateTodayProgress(grades);
            await updateStudentGradeStats(grades);
            
            const gradesList = document.getElementById('studentGradesList');
            if (!grades || grades.length === 0) {
                gradesList.innerHTML = '<div class="empty-state"><div>üìù</div><p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫</p></div>';
                return;
            }
            
            gradesList.innerHTML = '';
            grades.forEach(grade => {
                const typeLabel = gradeTypes[grade.type]?.name || grade.type;
                const percentage = grade.type === 'test' ? Math.round((grade.grade / 25) * 100) : null;
                
                gradesList.innerHTML += `
                    <div class="grade-item">
                        <div style="flex: 1;">
                            <strong>${grade.assignment}</strong>
                            <div style="color: var(--gray); font-size: 0.9em;">${typeLabel} ‚Ä¢ ${grade.grade_date}</div>
                            ${grade.type === 'test' ? `
                                <div class="test-grade-progress">
                                    <div class="test-grade-progress-bar" style="width: ${percentage}%"></div>
                                </div>
                                <div class="test-grade-info">${percentage}% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (${grade.grade}/25 –±–∞–ª–ª–æ–≤)</div>
                            ` : ''}
                        </div>
                        ${renderGrade(grade.grade, grade.type)}
                    </div>
                `;
            });
            
            await loadStudentSchedule();
            showSection('studentGrades');
        }

        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –†–ê–°–ß–ï–¢–ê –ü–†–û–ì–†–ï–°–°–ê –ó–ê –°–ï–ì–û–î–ù–Ø
        async function updateTodayProgress(grades) {
            const today = new Date().toISOString().split('T')[0];
            const todayGrades = grades ? grades.filter(grade => grade.grade_date === today) : [];
            
            const progressContainer = document.getElementById('todayProgress');
            const progressPercentage = document.getElementById('todayProgressPercentage');
            const progressBar = document.getElementById('todayProgressBar');
            const progressText = document.getElementById('todayProgressText');
            
            if (todayGrades.length === 0) {
                progressContainer.style.display = 'block';
                progressPercentage.textContent = '0%';
                progressBar.style.width = '0%';
                progressText.textContent = '–°–µ–≥–æ–¥–Ω—è –µ—â–µ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫';
                return;
            }
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞ —Å–µ–≥–æ–¥–Ω—è
            let totalPossible = 0;
            let totalEarned = 0;
            
            todayGrades.forEach(grade => {
                const typeInfo = gradeTypes[grade.type];
                if (typeInfo) {
                    totalPossible += typeInfo.max;
                    totalEarned += grade.grade;
                }
            });
            
            const percentage = totalPossible > 0 ? Math.round((totalEarned / totalPossible) * 100) : 0;
            
            progressContainer.style.display = 'block';
            progressPercentage.textContent = `${percentage}%`;
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `–°–µ–≥–æ–¥–Ω—è –ø–æ–ª—É—á–µ–Ω–æ ${todayGrades.length} –æ—Ü–µ–Ω–æ–∫: ${totalEarned}/${totalPossible} –±–∞–ª–ª–æ–≤`;
        }

        async function updateStudentGradeStats(grades) {
            if (!grades) return;
            
            const typeCounts = {};
            const typeSums = {};
            
            grades.forEach(grade => {
                typeCounts[grade.type] = (typeCounts[grade.type] || 0) + 1;
                typeSums[grade.type] = (typeSums[grade.type] || 0) + grade.grade;
            });

            const stats = document.getElementById('studentGradeStats');
            stats.innerHTML = '';
            
            Object.entries(typeCounts).forEach(([type, count]) => {
                const typeInfo = gradeTypes[type] || { name: type, color: '#6b7280' };
                const average = (typeSums[type] / count).toFixed(1);
                
                stats.innerHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        <span>${typeInfo.name}</span>
                        <div>
                            <span style="font-weight: bold; color: var(--primary);">${average}</span>
                            <small style="color: var(--gray); margin-left: 10px;">${count} –æ—Ü–µ–Ω.</small>
                        </div>
                    </div>
                `;
            });
        }

        // –£–õ–£–ß–®–ï–ù–ù–û–ï –†–ê–°–ü–ò–°–ê–ù–ò–ï –° –ì–†–£–ü–ü–ò–†–û–í–ö–û–ô –ü–û –î–ê–¢–ê–ú
        async function addScheduleItem() {
            const subject = document.getElementById('scheduleSubject').value;
            const teacher = document.getElementById('scheduleTeacher').value;
            const level = document.getElementById('scheduleLevel').value;
            const date = document.getElementById('scheduleDate').value;
            const startTime = document.getElementById('scheduleStartTime').value;
            const endTime = document.getElementById('scheduleEndTime').value;
            const type = document.getElementById('scheduleType').value;
            const description = document.getElementById('scheduleDescription').value;

            if (!subject || !teacher || !date || !startTime || !endTime) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('schedule')
                .insert([{
                    subject: subject,
                    teacher: teacher,
                    level: level,
                    date: date,
                    start_time: startTime,
                    end_time: endTime,
                    type: type,
                    description: description,
                    created_at: new Date().toISOString()
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            document.getElementById('scheduleSubject').value = '';
            document.getElementById('scheduleDate').value = '';
            document.getElementById('scheduleStartTime').value = '';
            document.getElementById('scheduleEndTime').value = '';
            document.getElementById('scheduleDescription').value = '';

            loadSchedule();
            alert('‚úÖ –ó–∞–Ω—è—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ!');
        }

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –°–¢–ê–¢–£–°–ê –î–ù–Ø
        function getDayStatus(dateString) {
            const today = new Date().toISOString().split('T')[0];
            const date = new Date(dateString);
            const now = new Date();
            
            if (dateString === today) {
                return 'üéØ –°–µ–≥–æ–¥–Ω—è';
            } else if (date > now) {
                const diffTime = date - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return `üìÖ –ß–µ—Ä–µ–∑ ${diffDays} ${getRussianDays(diffDays)}`;
            } else {
                return 'üìã –ü—Ä–æ—à–µ–¥—à–∏–π –¥–µ–Ω—å';
            }
        }

        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–†–ê–í–ò–õ–¨–ù–û–ì–û –°–ö–õ–û–ù–ï–ù–ò–Ø –î–ù–ï–ô
        function getRussianDays(days) {
            if (days === 1) return '–¥–µ–Ω—å';
            if (days >= 2 && days <= 4) return '–¥–Ω—è';
            return '–¥–Ω–µ–π';
        }

        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –£–î–ê–õ–ï–ù–ò–Ø –ó–ê–ù–Ø–¢–ò–Ø –ò–ó –†–ê–°–ü–ò–°–ê–ù–ò–Ø
        async function deleteScheduleItem(scheduleId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∑–∞–Ω—è—Ç–∏–µ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è?')) return;

            try {
                const { error } = await supabase
                    .from('schedule')
                    .delete()
                    .eq('id', scheduleId);

                if (error) throw error;

                loadSchedule();
                alert('üóëÔ∏è –ó–∞–Ω—è—Ç–∏–µ —É–¥–∞–ª–µ–Ω–æ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + err.message);
            }
        }

        async function loadSchedule() {
            const { data: schedule, error } = await supabase
                .from('schedule')
                .select('*')
                .order('date', { ascending: true })
                .order('start_time', { ascending: true });

            if (error) {
                console.error('Error loading schedule:', error);
                return;
            }

            const scheduleList = document.getElementById('scheduleList');
            const upcomingLessons = document.getElementById('upcomingLessons');
            const studentTodaySchedule = document.getElementById('studentTodaySchedule');
            
            if (!schedule || schedule.length === 0) {
                scheduleList.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏</p></div>';
                upcomingLessons.innerHTML = '<div class="no-lessons">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–Ω—è—Ç–∏–π</div>';
                if (studentTodaySchedule) {
                    studentTodaySchedule.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç</p></div>';
                }
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const now = new Date();
            
            // –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –†–ê–°–ü–ò–°–ê–ù–ò–Ø
            let filteredSchedule = schedule;
            if (currentScheduleFilter === 'today') {
                filteredSchedule = schedule.filter(item => item.date === today);
            } else if (currentScheduleFilter === 'week') {
                const weekStart = new Date(now);
                weekStart.setDate(now.getDate() - now.getDay());
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                
                filteredSchedule = schedule.filter(item => {
                    const itemDate = new Date(item.date);
                    return itemDate >= weekStart && itemDate <= weekEnd;
                });
            } else if (currentScheduleFilter === 'upcoming') {
                filteredSchedule = schedule.filter(item => item.date >= today);
            } else if (currentScheduleFilter === 'past') {
                filteredSchedule = schedule.filter(item => item.date < today);
            }

            // –ì–†–£–ü–ü–ò–†–û–í–ö–ê –ü–û –î–ê–¢–ê–ú
            const scheduleByDate = {};
            filteredSchedule.forEach(item => {
                if (!scheduleByDate[item.date]) {
                    scheduleByDate[item.date] = [];
                }
                scheduleByDate[item.date].push(item);
            });

            // –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –†–ê–°–ü–ò–°–ê–ù–ò–Ø –° –ì–†–£–ü–ü–ò–†–û–í–ö–û–ô
            scheduleList.innerHTML = '';
            
            if (Object.keys(scheduleByDate).length === 0) {
                scheduleList.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É</p></div>';
            } else {
                Object.keys(scheduleByDate).forEach(date => {
                    const dateItems = scheduleByDate[date];
                    const dateObj = new Date(date);
                    const dayNames = ['–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞'];
                    const monthNames = ['—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è', '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'];
                    
                    const dayName = dayNames[dateObj.getDay()];
                    const dateString = `${dateObj.getDate()} ${monthNames[dateObj.getMonth()]} ${dateObj.getFullYear()}`;
                    
                    let dateHeaderHTML = `
                        <div class="schedule-date-header">
                            <div class="schedule-date-title">
                                ${date === today ? 'üéØ –°–ï–ì–û–î–ù–Ø - ' : ''}${dayName}, ${dateString}
                                <span class="date-badge">${dateItems.length} –∑–∞–Ω—è—Ç–∏–π</span>
                            </div>
                            <div class="schedule-day-info">
                                ${getDayStatus(date)}
                            </div>
                        </div>
                        <div class="schedule-date-content">
                            <div class="schedule-items-container">
                    `;
                    
                    dateItems.forEach(item => {
                        const status = getScheduleStatus(item);
                        const typeIcon = getScheduleTypeIcon(item.type);
                        
                        dateHeaderHTML += `
                            <div class="schedule-item ${status.status}">
                                <div class="schedule-status status-${status.status}">${status.text}</div>
                                <div class="schedule-time">‚è∞ ${formatTime(item.start_time)} - ${formatTime(item.end_time)}</div>
                                <div class="schedule-subject">${typeIcon} ${item.subject}</div>
                                <div class="schedule-teacher">üë®‚Äçüè´ ${item.teacher}</div>
                                <div style="color: var(--gray); font-size: 0.8em; margin-top: 5px;">
                                    ${item.level !== 'all' ? `üéØ ${getCourseName(item.level)} ‚Ä¢ ` : ''}
                                    üè∑Ô∏è ${getScheduleTypeName(item.type)}
                                </div>
                                ${item.description ? `
                                    <div style="color: var(--gray); font-size: 0.9em; margin-top: 8px; padding: 8px; background: #f8fafc; border-radius: 6px;">
                                        üìù ${item.description}
                                    </div>
                                ` : ''}
                                <button class="btn btn-danger" onclick="deleteScheduleItem(${item.id})" style="width: auto; padding: 6px 12px; margin-top: 10px; font-size: 0.8em;">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        `;
                    });
                    
                    dateHeaderHTML += `
                            </div>
                        </div>
                    `;
                    
                    scheduleList.innerHTML += `<div class="schedule-date-group">${dateHeaderHTML}</div>`;
                });
            }

            // –ë–õ–ò–ñ–ê–ô–®–ò–ï –ó–ê–ù–Ø–¢–ò–Ø (—Ç–æ–ø 5)
            const upcoming = schedule
                .filter(item => item.date >= today)
                .slice(0, 5);

            upcomingLessons.innerHTML = '';
            if (upcoming.length === 0) {
                upcomingLessons.innerHTML = '<div class="no-lessons">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–Ω—è—Ç–∏–π</div>';
            } else {
                upcoming.forEach(item => {
                    const status = getScheduleStatus(item);
                    const typeIcon = getScheduleTypeIcon(item.type);
                    const dateObj = new Date(item.date);
                    const dateString = `${dateObj.getDate()}.${dateObj.getMonth() + 1}.${dateObj.getFullYear()}`;
                    
                    upcomingLessons.innerHTML += `
                        <div class="schedule-item ${status.status}">
                            <div class="schedule-status status-${status.status}">${status.text}</div>
                            <div class="schedule-time">üìÖ ${dateString} ‚è∞ ${formatTime(item.start_time)} - ${formatTime(item.end_time)}</div>
                            <div class="schedule-subject">${typeIcon} ${item.subject}</div>
                            <div class="schedule-teacher">üë®‚Äçüè´ ${item.teacher}</div>
                            <div style="color: var(--gray); font-size: 0.8em;">
                                ${item.level !== 'all' ? `üéØ ${getCourseName(item.level)} ‚Ä¢ ` : ''}üè∑Ô∏è ${getScheduleTypeName(item.type)}
                            </div>
                        </div>
                    `;
                });
            }

            // –†–ê–°–ü–ò–°–ê–ù–ò–ï –î–õ–Ø –£–ß–ï–ù–ò–ö–ê –ù–ê –°–ï–ì–û–î–ù–Ø
            if (currentUser && currentUser.role === 'student' && studentTodaySchedule) {
                const todayLessons = schedule.filter(item => item.date === today);
                
                studentTodaySchedule.innerHTML = '';
                if (todayLessons.length === 0) {
                    studentTodaySchedule.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç</p></div>';
                } else {
                    todayLessons.forEach(item => {
                        const status = getScheduleStatus(item);
                        const typeIcon = getScheduleTypeIcon(item.type);
                        
                        studentTodaySchedule.innerHTML += `
                            <div class="schedule-item ${status.status}">
                                <div class="schedule-status status-${status.status}">${status.text}</div>
                                <div class="schedule-time">‚è∞ ${formatTime(item.start_time)} - ${formatTime(item.end_time)}</div>
                                <div class="schedule-subject">${typeIcon} ${item.subject}</div>
                                <div class="schedule-teacher">üë®‚Äçüè´ ${item.teacher}</div>
                                ${item.description ? `
                                    <div style="color: var(--gray); font-size: 0.9em; margin-top: 8px;">
                                        ${item.description}
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    });
                }
            }
        }

        function getScheduleTypeIcon(type) {
            const icons = {
                'regular': 'üìö',
                'test': 'üéì',
                'conversation': 'üó£Ô∏è',
                'grammar': 'üìñ',
                'project': 'üìÅ'
            };
            return icons[type] || 'üìö';
        }

        function getScheduleTypeName(type) {
            const names = {
                'regular': '–û–±—ã—á–Ω—ã–π —É—Ä–æ–∫',
                'test': '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
                'conversation': '–†–∞–∑–≥–æ–≤–æ—Ä–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞',
                'grammar': '–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞',
                'project': '–ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞'
            };
            return names[type] || '–£—Ä–æ–∫';
        }

        async function loadStudentSchedule() {
            await loadSchedule();
        }

        // –§–£–ù–ö–¶–ò–ò –ö–ê–õ–ï–ù–î–ê–†–Ø
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const currentMonth = document.getElementById('currentMonth');
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const monthNames = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];
            currentMonth.textContent = `${monthNames[month]} ${year}`;
            
            calendarGrid.innerHTML = '';
            
            const days = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            days.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.style.fontWeight = 'bold';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            });
            
            const firstDay = new Date(year, month, 1);
            const startingDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                emptyDay.style.visibility = 'hidden';
                calendarGrid.appendChild(emptyDay);
            }
            
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                const dayOfWeek = new Date(year, month, day).getDay();
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    dayElement.classList.add('weekend');
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar();
            loadCalendarEvents();
        }

        // –§–£–ù–ö–¶–ò–ò –°–û–ë–´–¢–ò–ô –ö–ê–õ–ï–ù–î–ê–†–Ø
        async function addCalendarEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value;
            const type = document.getElementById('eventType').value;

            if (!title || !date) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('calendar_events')
                .insert([{
                    title: title,
                    date: date,
                    time: time,
                    description: description,
                    type: type,
                    created_at: new Date().toISOString()
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';

            loadCalendarEvents();
            alert('‚úÖ –°–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å!');
        }

        async function loadCalendarEvents() {
            const { data: events, error } = await supabase
                .from('calendar_events')
                .select('*')
                .order('date', { ascending: true })
                .order('time', { ascending: true });

            if (error) {
                console.error('Error loading events:', error);
                return;
            }

            const calendarEventsList = document.getElementById('calendarEventsList');
            const upcomingEvents = document.getElementById('upcomingEvents');
            const studentUpcomingEvents = document.getElementById('studentUpcomingEvents');
            
            if (!events || events.length === 0) {
                calendarEventsList.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ</p></div>';
                upcomingEvents.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                if (studentUpcomingEvents) {
                    studentUpcomingEvents.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                }
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const upcoming = events.filter(event => event.date >= today).slice(0, 5);

            calendarEventsList.innerHTML = '';
            events.forEach(event => {
                const eventTypes = {
                    'lesson': 'üìö',
                    'test': 'üéì', 
                    'meeting': 'üë•',
                    'holiday': 'üéâ',
                    'deadline': '‚è∞'
                };
                
                calendarEventsList.innerHTML += `
                    <div class="notification ${event.date === today ? 'upcoming' : ''}">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2em;">${eventTypes[event.type]}</span>
                            <div style="flex: 1;">
                                <strong>${event.title}</strong>
                                <div style="color: var(--gray); font-size: 0.9em;">
                                    üìÖ ${formatDate(event.date)}${event.time ? ` ‚è∞ ${event.time}` : ''}
                                </div>
                                ${event.description ? `<div style="margin-top: 5px;">${event.description}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });

            upcomingEvents.innerHTML = '';
            upcoming.forEach(event => {
                const eventTypes = {
                    'lesson': 'üìö',
                    'test': 'üéì',
                    'meeting': 'üë•', 
                    'holiday': 'üéâ',
                    'deadline': '‚è∞'
                };
                
                upcomingEvents.innerHTML += `
                    <div class="notification upcoming">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2em;">${eventTypes[event.type]}</span>
                            <div style="flex: 1;">
                                <strong>${event.title}</strong>
                                <div style="color: var(--gray); font-size: 0.9em;">
                                    üìÖ ${formatDate(event.date)}${event.time ? ` ‚è∞ ${event.time}` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            if (currentUser && currentUser.role === 'student' && studentUpcomingEvents) {
                studentUpcomingEvents.innerHTML = '';
                if (upcoming.length === 0) {
                    studentUpcomingEvents.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                } else {
                    upcoming.forEach(event => {
                        studentUpcomingEvents.innerHTML += `
                            <div class="notification upcoming">
                                <strong>${eventTypes[event.type]} ${event.title}</strong>
                                <div style="color: var(--gray); font-size: 0.9em;">
                                    üìÖ ${formatDate(event.date)}${event.time ? ` ‚è∞ ${event.time}` : ''}
                                </div>
                            </div>
                        `;
                    });
                }
            }
        }

        // –§–£–ù–ö–¶–ò–ò –ß–ê–¢–ê –ü–û–î–î–ï–†–ñ–ö–ò
        function toggleChat() {
            const chatWindow = document.getElementById('supportChat');
            if (chatWindow.style.display === 'none') {
                chatWindow.style.display = 'block';
                document.getElementById('chatNotification').style.display = 'none';
            } else {
                chatWindow.style.display = 'none';
            }
        }

        function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            
            if (!message) return;
            
            const chatMessages = document.getElementById('chatMessages');
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            const userMessage = document.createElement('div');
            userMessage.className = 'message user-message';
            userMessage.innerHTML = `
                <div class="message-content">
                    <strong>–í—ã:</strong> ${message}
                </div>
                <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
            `;
            chatMessages.appendChild(userMessage);
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
            chatInput.value = '';
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // –ò–º–∏—Ç–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã WebSocket)
            setTimeout(() => {
                const responses = [
                    "–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –≤–æ–ø—Ä–æ—Å! –ú—ã —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –Ω–∏–º.",
                    "–ü–æ–Ω–∏–º–∞—é –≤–∞—à—É –ø—Ä–æ–±–ª–µ–º—É. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º—Å—è –≤–º–µ—Å—Ç–µ!",
                    "–≠—Ç–æ —Ö–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –ù–∞—à —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç —Å–∫–æ—Ä–æ —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏.",
                    "–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ! –ú—ã —É–∂–µ –∏—â–µ–º —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –≤–∞—Å.",
                    "–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π—Ç–µ —è –ø–æ–º–æ–≥—É –≤–∞–º —Å —ç—Ç–∏–º."
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                
                const supportMessage = document.createElement('div');
                supportMessage.className = 'message support-message';
                supportMessage.innerHTML = `
                    <div class="message-content">
                        <strong>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</strong> ${randomResponse}
                    </div>
                    <div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                `;
                chatMessages.appendChild(supportMessage);
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000 + Math.random() * 2000);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ —á–∞—Ç–µ
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
        });

        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function getCourseName(course) {
            const courseInfo = courseLevels[course] || { name: course, level: '' };
            return `${courseInfo.name} (${courseInfo.level})`;
        }

        async function getStudentById(studentId) {
            const { data, error } = await supabase
                .from('students')
                .select('*')
                .eq('id', studentId)
                .single();
            return data;
        }

        function formatTime(timeString) {
            if (!timeString) return '';
            return timeString.substring(0, 5);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        function renderGrade(grade, type) {
            const colorClass = getGradeColorClass(grade, type);
            if (type === 'test') {
                return `<span class="grade ${colorClass}">${grade}/25</span>`;
            } else if (type === 'activity') {
                return `<span class="grade ${colorClass}">${grade}/5</span>`;
            } else if (type === 'attendance') {
                const labels = { '0': '‚ùå', '1': '‚è∞', '2': '‚úÖ' };
                return `<span class="grade ${colorClass}">${labels[grade] || grade}/2</span>`;
            } else if (type === 'oral') {
                return `<span class="grade ${colorClass}">${grade}/5</span>`;
            } else if (type === 'project') {
                return `<span class="grade ${colorClass}">${grade}/20</span>`;
            } else if (type === 'homework') {
                return `<span class="grade ${colorClass}">${grade}/10</span>`;
            } else {
                return `<span class="grade ${colorClass}">${grade}</span>`;
            }
        }

        function getGradeColorClass(grade, type) {
            grade = parseInt(grade);
            if (type === 'test') {
                if (grade <= 10) return 'test-grade-1';
                if (grade <= 15) return 'test-grade-11';
                return 'test-grade-16';
            } else if (type === 'activity') {
                if (grade <= 2) return 'activity-grade-1';
                if (grade === 3) return 'activity-grade-3';
                return 'activity-grade-4';
            } else if (type === 'homework') {
                if (grade <= 3) return 'homework-grade-1';
                if (grade <= 6) return 'homework-grade-4';
                return 'homework-grade-7';
            } else if (type === 'project') {
                if (grade <= 10) return 'project-grade-1';
                if (grade <= 15) return 'project-grade-11';
                return 'project-grade-16';
            } else if (type === 'oral') {
                if (grade <= 2) return 'oral-grade-1';
                if (grade === 3) return 'oral-grade-3';
                return 'oral-grade-4';
            } else if (type === 'attendance') {
                return `attendance-grade-${grade}`;
            } else {
                if (grade <= 3) return `grade-${grade}`;
                if (grade <= 6) return `grade-${grade}`;
                return `grade-${grade}`;
            }
        }

        function renderCourseLevel(course) {
            const courseInfo = courseLevels[course] || { name: course, color: 'course-beginner' };
            return `<span class="course-badge ${courseInfo.color} course-tooltip" data-tooltip="${courseInfo.description}">${courseInfo.name} (${courseInfo.level})</span>`;
        }

        function getScheduleStatus(item) {
            const now = new Date();
            const lessonDate = new Date(item.date + 'T' + item.start_time);
            const lessonEnd = new Date(item.date + 'T' + item.end_time);
            
            if (now >= lessonDate && now <= lessonEnd) {
                return { status: 'ongoing', text: '–ò–¥–µ—Ç —Å–µ–π—á–∞—Å' };
            } else if (now < lessonDate) {
                return { status: 'upcoming', text: '–ü—Ä–µ–¥—Å—Ç–æ–∏—Ç' };
            } else {
                return { status: 'completed', text: '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' };
            }
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        window.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ PrimeSpeak Academy –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            generateCalendar();
            
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('scheduleDate')) {
                document.getElementById('scheduleDate').value = today;
            }
            if (document.getElementById('eventDate')) {
                document.getElementById('eventDate').value = today;
            }
        });

    </script>
</body>
                </html>
