<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Kometa.space | –ú–∞–≥–∞–∑–∏–Ω –∏–≥—Ä–æ–≤—ã—Ö –∫–ª—é—á–µ–π</title>
    <style>
        :root{
            --primary:#6366f1;--primary-dark:#4f46e5;--secondary:#10b981;--danger:#ef4444;
            --warning:#f59e0b;--dark:#0f172a;--dark-light:#1e293b;--light:#f8fafc;--border:#334155;--success:#22c55e;
        }
        *{box-sizing:border-box;margin:0;padding:0;font-family:Arial,Helvetica,sans-serif}
        body{background:linear-gradient(135deg,#0f172a 0%,#1e293b 100%);color:var(--light);min-height:100vh;padding-bottom:60px}
        .container{max-width:1200px;margin:0 auto;padding:0 16px}
        .header{background:rgba(15,23,42,0.95);padding:12px 0;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:1000}
        .header-content{display:flex;align-items:center;justify-content:space-between}
        .logo{display:flex;gap:10px;align-items:center;font-weight:700}
        .nav{display:flex;gap:12px;align-items:center}
        .nav-link{color:#cbd5e1;text-decoration:none;padding:6px 10px;border-radius:6px}
        .nav-link.active,.nav-link:hover{background:rgba(99,102,241,0.08);color:#fff}
        .user-menu{display:flex;align-items:center;gap:8px}
        .user-avatar{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--primary);font-weight:700;cursor:pointer}
        .balance{background:var(--primary);padding:6px 10px;border-radius:8px;font-weight:700}
        .hero{text-align:center;padding:40px 0;margin:20px 0}
        .btn{padding:10px 16px;border-radius:8px;border:0;cursor:pointer;font-weight:700}
        .btn-primary{background:var(--primary);color:#fff}
        .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);align-items:center;justify-content:center;z-index:1001}
        .modal.active{display:flex}
        .modal-content{background:var(--dark-light);width:92%;max-width:420px;border-radius:12px;border:1px solid var(--border)}
        .modal-header{padding:14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .modal-body{padding:16px}
        .form-group{margin-bottom:12px}
        .form-group label{display:block;color:#cbd5e1;margin-bottom:6px}
        .form-group input, .form-group select, .form-group textarea{width:100%;padding:10px;border-radius:8px;border:1px solid var(--border);background:rgba(255,255,255,0.03);color:#fff}
        .tabs{display:flex;gap:8px;margin-bottom:12px}
        .tab{padding:8px 12px;border-radius:8px;border:0;background:transparent;color:#94a3b8;cursor:pointer}
        .tab.active{color:var(--primary);background:rgba(99,102,241,0.06)}
        .card{background:rgba(255,255,255,0.04);padding:12px;border-radius:12px;border:1px solid var(--border)}
        .grid{display:grid;gap:12px}
        .grid.cols-3{grid-template-columns:repeat(auto-fill,minmax(120px,1fr))}
        .game-icon{font-size:34px;margin-bottom:8px;text-align:center}
        .notification{position:fixed;top:20px;right:20px;padding:12px 16px;border-radius:8px;background:var(--dark-light);border-left:4px solid var(--primary);z-index:1002}
        footer{position:fixed;left:0;right:0;bottom:0;background:#fff;padding:8px 0;color:#333;border-top-left-radius:12px;border-top-right-radius:12px}
        footer .menu{display:flex;justify-content:space-around;max-width:900px;margin:0 auto}
        footer .menu a{display:flex;flex-direction:column;align-items:center;text-decoration:none;color:#666;font-size:12px}
        .price{color:var(--success);font-weight:800}
        .variant-btn{padding:8px 10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);cursor:pointer;color:#cbd5e1;margin-right:8px}
        .variant-btn.active{border-color:var(--primary);color:#fff;background:rgba(99,102,241,0.06)}
        pre.key{background:rgba(0,0,0,0.3);padding:8px;border-radius:6px;font-family:monospace}
        .small-muted{color:#94a3b8;font-size:13px}
        .deposit-status{display:inline-block;padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600}
        .status-pending{background:rgba(245,158,11,0.12);color:#f59e0b}
        .status-approved{background:rgba(34,197,94,0.12);color:#22c55e}
        .status-rejected{background:rgba(239,68,68,0.12);color:#ef4444}
        .file-link{display:inline-block;margin:4px;padding:6px 12px;background:var(--primary);border-radius:6px;color:white;text-decoration:none}
        .game-avatar{width:80px;height:80px;border-radius:12px;object-fit:cover;border:2px solid var(--primary)}
        .cheat-avatar{width:60px;height:60px;border-radius:8px;object-fit:cover;border:2px solid var(--secondary)}
        @media (min-width:900px){ .grid.cols-3{grid-template-columns:repeat(4,1fr)} }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div style="display:flex;align-items:center;gap:10px">
                    <div class="logo">üöÄ <span style="margin-left:6px">KOMET.SPACE</span></div>
                </div>

                <nav class="nav" id="mainNav">
                    <!-- nav will be rendered by JS -->
                </nav>

                <div class="user-menu" id="userMenu">
                    <!-- rendered by JS -->
                </div>
            </div>
        </div>
    </header>

    <main class="container" id="mainContent">
        <!-- main content rendered by JS -->
    </main>

    <!-- Auth modal -->
    <div class="modal" id="authModal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                <button onclick="closeModal('authModal')" style="background:none;border:0;color:#94a3b8;font-size:20px;cursor:pointer">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <button class="tab active" data-tab="login" onclick="switchTab('login')">–í–æ–π—Ç–∏</button>
                    <button class="tab" data-tab="register" onclick="switchTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </div>

                <div id="loginTab">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="loginEmail" placeholder="–í–∞—à email">
                    </div>
                    <div class="form-group">
                        <label>–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å">
                    </div>
                    <button class="btn btn-primary" style="width:100%" onclick="login()">–í–æ–π—Ç–∏</button>
                </div>

                <div id="registerTab" style="display:none">
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="registerEmail" placeholder="example@gmail.com">
                    </div>
                    <div class="form-group">
                        <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="registerUsername" placeholder="username">
                    </div>
                    <div class="form-group">
                        <label>–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="registerPassword" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
                    </div>
                    <button class="btn btn-primary" style="width:100%" onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Deposit modal -->
    <div class="modal" id="depositModal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h3>
                <button onclick="closeModal('depositModal')" style="background:none;border:0;color:#94a3b8;font-size:20px;cursor:pointer">&times;</button>
            </div>
            <div class="modal-body">
                <div class="card" style="margin-bottom:12px">
                    <strong>–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã:</strong>
                    <div class="small-muted" style="margin-top:8px"><strong>–¢-–ë–∞–Ω–∫ (–°–ü–ë)</strong></div>
                    <div class="small-muted">–ù–æ–º–µ—Ä: <strong>+7 (917) 863-04-11</strong></div>
                    <div class="small-muted" style="margin-top:8px"><strong>–¢–∏–Ω—å–∫–æ—Ñ—Ñ</strong></div>
                    <div class="small-muted">–ö–∞—Ä—Ç–∞: <strong>2200 7010 2813 9613</strong></div>
                </div>
                <div class="form-group">
                    <label>–°—É–º–º–∞ (‚ÇΩ)</label>
                    <input type="number" id="depositAmount" value="1000" min="100">
                </div>
                <div class="form-group">
                    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–ª–∞—Ç–µ–∂—É (—É–∫–∞–∂–∏—Ç–µ –≤–∞—à email)</label>
                    <input type="text" id="depositComment" placeholder="test@mail.com" value="${currentUser ? currentUser.email : ''}">
                </div>
                <button class="btn btn-primary" style="width:100%" onclick="submitDeposit()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</button>
            </div>
        </div>
    </div>

    <!-- File upload modal for admin -->
    <div class="modal" id="fileUploadModal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã –∫ —á–∏—Ç—É</h3>
                <button onclick="closeModal('fileUploadModal')" style="background:none;border:0;color:#94a3b8;font-size:20px;cursor:pointer">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</label>
                    <input type="text" id="fileName" placeholder="–ß–∏—Ç.apk">
                </div>
                <div class="form-group">
                    <label>–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª</label>
                    <input type="text" id="fileUrl" placeholder="https://example.com/—Ñ–∞–π–ª.apk">
                </div>
                <div class="form-group">
                    <label>–¢–∏–ø —Ñ–∞–π–ª–∞</label>
                    <select id="fileType">
                        <option value="apk">APK</option>
                        <option value="zip">ZIP</option>
                        <option value="exe">EXE</option>
                        <option value="rar">RAR</option>
                        <option value="other">–î—Ä—É–≥–æ–π</option>
                    </select>
                </div>
                <button class="btn btn-primary" style="width:100%" onclick="addFileToCheat()">–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª</button>
            </div>
        </div>
    </div>

    <!-- Avatar upload modal for admin -->
    <div class="modal" id="avatarUploadModal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</h3>
                <button onclick="closeModal('avatarUploadModal')" style="background:none;border:0;color:#94a3b8;font-size:20px;cursor:pointer">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>–¢–∏–ø</label>
                    <select id="avatarType" onchange="updateAvatarFields()">
                        <option value="game">–î–ª—è –∏–≥—Ä—ã</option>
                        <option value="cheat">–î–ª—è —á–∏—Ç–∞</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                    <input type="text" id="avatarUrl" placeholder="https://example.com/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.jpg">
                </div>
                <div class="form-group" id="gameSelectGroup" style="display:block">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É</label>
                    <select id="selectGameForAvatar">
                        ${games ? games.map(g=>`<option value="${g.id}">${g.name}</option>`).join('') : ''}
                    </select>
                </div>
                <div class="form-group" id="cheatSelectGroup" style="display:none">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ —á–∏—Ç</label>
                    <select id="selectCheatForAvatar">
                        <!-- populated dynamically -->
                    </select>
                </div>
                <button class="btn btn-primary" style="width:100%" onclick="addAvatar()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
            </div>
        </div>
    </div>

    <div id="notifications"></div>

    <footer>
        <div class="menu container">
            <a href="#" onclick="showPage('home')"><span>üè†</span><span>–ì–ª–∞–≤–Ω–∞—è</span></a>
            <a href="#" onclick="showPage('catalog')"><span>üîç</span><span>–ö–∞—Ç–∞–ª–æ–≥</span></a>
            <a href="#" onclick="showPage('keys')"><span>üîë</span><span>–ö–ª—é—á–∏</span></a>
            <a href="#" onclick="showPage('profile')"><span>üë§</span><span>–ü—Ä–æ—Ñ–∏–ª—å</span></a>
            <a href="#" onclick="showPage('about')"><span>‚≠ê</span><span>–ö–æ–º–µ—Ç–∞</span></a>
        </div>
    </footer>

<script>
/* ------------ state ------------ */
let currentUser = null;
let currentPage = 'home';
let games = [];
let purchases = [];
let depositRequests = [];
let currentCheatForFiles = null;
let currentGameForAvatar = null;
let currentCheatForAvatar = null;

/* ------------ init ------------ */
document.addEventListener('DOMContentLoaded',()=>{
    loadFromStorage();
    createTestAdmin();
    renderNav();
    updateUserMenu();
    showPage('home');
});

/* ---------- storage helpers ---------- */
function loadFromStorage(){
    const g = localStorage.getItem('kometa_games');
    const p = localStorage.getItem('kometa_purchases');
    const u = localStorage.getItem('kometa_user');
    const d = localStorage.getItem('kometa_deposit_requests');
    const savedGames = g ? JSON.parse(g) : [];
    const savedPurchases = p ? JSON.parse(p) : [];
    const savedUser = u ? JSON.parse(u) : null;
    const savedDeposits = d ? JSON.parse(d) : [];
    games = savedGames;
    purchases = savedPurchases;
    currentUser = savedUser;
    depositRequests = savedDeposits;
}

function saveGames(){ localStorage.setItem('kometa_games', JSON.stringify(games)); }
function savePurchases(){ localStorage.setItem('kometa_purchases', JSON.stringify(purchases)); }
function saveDepositRequests(){ localStorage.setItem('kometa_deposit_requests', JSON.stringify(depositRequests)); }
function saveCurrentUserInUsersList(){
    if(!currentUser) return;
    let users = JSON.parse(localStorage.getItem('kometa_users')||'[]');
    const idx = users.findIndex(u=>u.id===currentUser.id);
    if(idx!==-1){ users[idx].balance = currentUser.balance; localStorage.setItem('kometa_users', JSON.stringify(users)); }
    localStorage.setItem('kometa_user', JSON.stringify(currentUser));
}

/* ---------- create test admin ---------- */
function createTestAdmin(){
    let users = JSON.parse(localStorage.getItem('kometa_users') || '[]');
    const adminExists = users.some(u => u.email === 'nurislamovradmir9@gmail.com');
    if(!adminExists){
        users.push({id:1,email:'nurislamovradmir9@gmail.com',username:'Admin',password:'makson555777',balance:0,isAdmin:true});
        localStorage.setItem('kometa_users', JSON.stringify(users));
    }
    
    if(!localStorage.getItem('kometa_games') || games.length === 0){
        games = [
            {id:1,name:'Standoff 2',icon:'üõ°Ô∏è',description:'–®—É—Ç–µ—Ä –æ–Ω–ª–∞–π–Ω',avatar:'',cheats:[
                {id:1,name:'Plutonium',version:'0.36.1',avatar:'',variants:[
                    {label:'7 –¥–Ω–µ–π',price:99},{label:'30 –¥–Ω–µ–π',price:249},{label:'–ù–∞–≤—Å–µ–≥–¥–∞',price:99500}
                ], files: []}
            ]},
            {id:2,name:'PUBG Mobile',icon:'üî´',description:'–ú–æ–±–∏–ª—å–Ω—ã–π –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è –±–∏—Ç–≤–∞',avatar:'',cheats:[]},
            {id:3,name:'Roblox',icon:'üß©',description:'–ü–µ—Å–æ—á–Ω–∏—Ü–∞',avatar:'',cheats:[]}
        ];
        saveGames();
    }
}

/* ---------- rendering: nav & user menu ---------- */
function renderNav(){
    const nav = document.getElementById('mainNav');
    nav.innerHTML = `
        <a href="#" class="nav-link ${currentPage==='home'?'active':''}" onclick="showPage('home')">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="#" class="nav-link ${currentPage==='catalog'?'active':''}" onclick="showPage('catalog')">–ö–∞—Ç–∞–ª–æ–≥</a>
        <a href="#" class="nav-link ${currentPage==='keys'?'active':''}" onclick="showPage('keys')">–ö–ª—é—á–∏</a>
        <a href="#" class="nav-link ${currentPage==='profile'?'active':''}" onclick="showPage('profile')">–ü—Ä–æ—Ñ–∏–ª—å</a>
    `;
}

function updateUserMenu(){
    const menu = document.getElementById('userMenu');
    if(currentUser){
        menu.innerHTML = `
            <div class="balance">${currentUser.balance} ‚ÇΩ</div>
            <button class="btn btn-primary" onclick="openDepositModal()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
            <div class="user-avatar" title="–ü—Ä–æ—Ñ–∏–ª—å" onclick="showPage('profile')">${(currentUser.username||'U').charAt(0).toUpperCase()}</div>
            <button class="btn" onclick="logout()" style="background:rgba(255,255,255,0.06);color:#fff">–í—ã–π—Ç–∏</button>
        `;
    } else {
        menu.innerHTML = `<button class="btn btn-primary" onclick="openAuthModal()">–í–æ–π—Ç–∏</button>`;
    }
    renderNav();
}

/* ---------- page router ---------- */
function showPage(page){
    currentPage = page;
    const main = document.getElementById('mainContent');
    renderNav();
    
    if(page==='home'){
        main.innerHTML = `
            <div class="hero">
                <h1 style="color:var(--primary)">–ú–∞–≥–∞–∑–∏–Ω –∏–≥—Ä–æ–≤—ã—Ö –∫–ª—é—á–µ–π</h1>
                <p class="small-muted" style="margin:10px 0 18px">–ü–æ–∫—É–ø–∞–π DLC, —á–∏—Ç—ã –∏ –∫–ª—é—á–∏ ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ —á–µ—Ä–µ–∑ –±–∞–ª–∞–Ω—Å</p>
                ${currentUser ? `<button class="btn btn-primary" onclick="showPage('catalog')">–í –∫–∞—Ç–∞–ª–æ–≥</button>` : `<button class="btn btn-primary" onclick="openAuthModal()">–ù–∞—á–∞—Ç—å –ø–æ–∫—É–ø–∫–∏</button>`}
            </div>
            <h2 style="margin:10px 0 14px">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã</h2>
            <div class="grid cols-3">
                ${games.map(g=>`
                    <div class="card" style="cursor:pointer;text-align:center" onclick="openGame(${g.id})">
                        ${g.avatar ? `<img src="${g.avatar}" class="game-avatar" style="margin:0 auto 12px" alt="${g.name}">` : `<div class="game-icon">${g.icon}</div>`}
                        <div style="font-weight:800">${g.name}</div>
                        <div class="small-muted" style="margin-top:6px">${g.description}</div>
                    </div>
                `).join('')}
            </div>
        `;
    } else if(page==='catalog'){
        main.innerHTML = `
            <h1 style="margin:14px 0">–ö–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä</h1>
            <div class="grid cols-3">
                ${games.map(g=>`
                    <div class="card" style="cursor:pointer;text-align:center" onclick="openGame(${g.id})">
                        ${g.avatar ? `<img src="${g.avatar}" class="game-avatar" style="margin:0 auto 12px" alt="${g.name}">` : `<div class="game-icon">${g.icon}</div>`}
                        <div style="font-weight:800">${g.name}</div>
                        <div class="small-muted" style="margin-top:6px">${g.description}</div>
                    </div>
                `).join('')}
            </div>
        `;
    } else if(page==='profile'){
        if(!currentUser){ openAuthModal(); return; }
        const userPurchases = purchases.filter(p=>p.userId===currentUser.id);
        const userDeposits = depositRequests.filter(d=>d.userId===currentUser.id);
        main.innerHTML = `
            <div style="max-width:720px;margin:16px auto">
                <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
                <div class="card" style="margin:12px 0;padding:16px">
                    <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
                        <div class="user-avatar">${(currentUser.username||'U').charAt(0).toUpperCase()}</div>
                        <div>
                            <div style="font-weight:800">${currentUser.username||'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>
                            <div class="small-muted">${currentUser.email}</div>
                        </div>
                    </div>
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <div>
                            <div class="small-muted">–ë–∞–ª–∞–Ω—Å</div>
                            <div style="font-size:20px;font-weight:800;color:var(--success)">${currentUser.balance} ‚ÇΩ</div>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="openDepositModal()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                            ${currentUser.isAdmin?` <button class="btn" onclick="showAdminPanel()" style="background:rgba(245,158,11,0.12);margin-left:8px">–ê–¥–º–∏–Ω</button>`:''}
                        </div>
                    </div>
                </div>

                <h2>–ú–æ–∏ –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h2>
                <div id="depositRequestsList">
                    ${userDeposits.length===0?`<p class="small-muted">–£ –≤–∞—Å –Ω–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</p>`: userDeposits.map(d=>{
                        let statusClass = 'status-pending';
                        let statusText = '–û–∂–∏–¥–∞–Ω–∏–µ';
                        if(d.status === 'approved') { statusClass = 'status-approved'; statusText = '–û–¥–æ–±—Ä–µ–Ω–æ'; }
                        if(d.status === 'rejected') { statusClass = 'status-rejected'; statusText = '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ'; }
                        return `
                        <div class="card" style="margin:8px 0">
                            <div style="display:flex;justify-content:space-between;align-items:center">
                                <div>
                                    <div style="font-weight:800">${d.amount} ‚ÇΩ</div>
                                    <div class="small-muted">${new Date(d.date).toLocaleString('ru-RU')}</div>
                                </div>
                                <div style="text-align:right">
                                    <div class="deposit-status ${statusClass}">${statusText}</div>
                                    ${d.status === 'pending' ? `<div class="small-muted" style="margin-top:4px">–û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏</div>` : ''}
                                    ${d.adminComment ? `<div class="small-muted" style="margin-top:4px">${d.adminComment}</div>` : ''}
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>

                <h2>–ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</h2>
                <div id="purchasesList">
                    ${userPurchases.length===0?`<p class="small-muted">–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç –ø–æ–∫—É–ø–æ–∫</p>`: userPurchases.map(p=>{
                        const game = games.find(g=>g.id===p.gameId);
                        const cheat = game ? game.cheats.find(c=>c.id===p.cheatId) : null;
                        const files = cheat ? cheat.files || [] : [];
                        return `
                        <div class="card" style="margin:8px 0">
                            <div style="display:flex;justify-content:space-between;align-items:center">
                                <div>
                                    <div style="display:flex;align-items:center;gap:8px">
                                        ${game && game.avatar ? `<img src="${game.avatar}" class="cheat-avatar">` : ''}
                                        <div>
                                            <div style="font-weight:800">${p.gameName} ‚Äî ${p.cheatName}</div>
                                            <div class="small-muted">${p.variantLabel} ‚Äî ${new Date(p.date).toLocaleString('ru-RU')}</div>
                                        </div>
                                    </div>
                                </div>
                                <div style="text-align:right">
                                    <div class="price">${p.price} ‚ÇΩ</div>
                                    <button class="btn" onclick="copyKey('${p.key}')" style="margin-top:6px">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á</button>
                                </div>
                            </div>
                            <div style="margin-top:8px"><pre class="key">${p.key}</pre></div>
                            ${files.length > 0 ? `
                            <div style="margin-top:12px">
                                <div class="small-muted" style="margin-bottom:6px">–§–∞–π–ª—ã –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</div>
                                ${files.map(f=>`
                                    <a href="${f.url}" target="_blank" class="file-link">${f.name}</a>
                                `).join('')}
                            </div>
                            ` : ''}
                        </div>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
    } else if(page==='keys'){
        if(!currentUser){ openAuthModal(); return; }
        const userPurchases = purchases.filter(p=>p.userId===currentUser.id);
        main.innerHTML = `
            <h1 style="margin:12px 0">–ú–æ–∏ –∫–ª—é—á–∏</h1>
            <div style="max-width:720px;margin:0 auto">
                ${userPurchases.length===0?`<p class="small-muted">–ü–æ–∫—É–ø–æ–∫ –Ω–µ—Ç</p>`: userPurchases.map(p=>{
                    const game = games.find(g=>g.id===p.gameId);
                    const cheat = game ? game.cheats.find(c=>c.id===p.cheatId) : null;
                    const files = cheat ? cheat.files || [] : [];
                    return `
                    <div class="card" style="margin:8px 0">
                        <div style="display:flex;justify-content:space-between;align-items:center">
                            <div style="display:flex;align-items:center;gap:8px">
                                ${game && game.avatar ? `<img src="${game.avatar}" class="cheat-avatar">` : ''}
                                <div>
                                    <strong>${p.gameName}</strong>
                                    <div class="small-muted">${p.cheatName} ‚Äî ${p.variantLabel}</div>
                                </div>
                            </div>
                            <div class="price">${p.price} ‚ÇΩ</div>
                        </div>
                        <div style="margin-top:8px"><pre class="key">${p.key}</pre></div>
                        ${files.length > 0 ? `
                        <div style="margin-top:12px">
                            <div class="small-muted" style="margin-bottom:6px">–§–∞–π–ª—ã –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</div>
                            ${files.map(f=>`
                                <a href="${f.url}" target="_blank" class="file-link">${f.name}</a>
                            `).join('')}
                        </div>
                        ` : ''}
                    </div>
                `}).join('')}
            </div>
        `;
    } else if(page==='about'){
        main.innerHTML = `
            <h1 style="margin:12px 0">–û –ø—Ä–æ–µ–∫—Ç–µ</h1>
            <div class="card" style="padding:16px;max-width:720px;margin:0 auto">
                <p class="small-muted">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞–≥–∞–∑–∏–Ω–µ Kometa.space. –ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –≤–æ–∑–≤—Ä–∞—Ç–æ–≤: <a href="https://t.me/kometspace" style="color:var(--primary)">t.me/kometspace</a></p>
            </div>
        `;
    }
}

/* ---------- open a game's page ---------- */
function openGame(gameId){
    const game = games.find(g=>g.id===gameId);
    if(!game) return;
    currentPage = 'game';
    const main = document.getElementById('mainContent');
    main.innerHTML = `
        <div style="max-width:900px;margin:12px auto">
            <button onclick="showPage('catalog')" class="btn" style="margin-bottom:12px;background:transparent;border:1px solid rgba(255,255,255,0.05)">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è</button>
            <div style="display:flex;gap:16px;align-items:center">
                ${game.avatar ? `<img src="${game.avatar}" class="game-avatar" style="width:100px;height:100px">` : `<div class="game-icon" style="font-size:48px">${game.icon}</div>`}
                <div>
                    <h1 style="margin-bottom:6px">${game.name}</h1>
                    <div class="small-muted">${game.description}</div>
                </div>
            </div>

            <div style="margin-top:16px">
                <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ —á–∏—Ç—ã / DLC</h3>
                <div id="cheatsList">
                    ${game.cheats.length===0?`<p class="small-muted">–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —á–∏—Ç–æ–≤/–¥–ªc –¥–ª—è —ç—Ç–æ–π –∏–≥—Ä—ã</p>`: game.cheats.map(c=>`
                        <div class="card" style="margin:10px 0">
                            <div style="display:flex;justify-content:space-between;align-items:center">
                                <div style="display:flex;align-items:center;gap:12px">
                                    ${c.avatar ? `<img src="${c.avatar}" class="cheat-avatar">` : ''}
                                    <div>
                                        <div style="font-weight:800">${c.name} ${c.version?(' v'+c.version):''}</div>
                                        <div class="small-muted" style="margin-top:6px">–î–æ–±–∞–≤–∏–ª –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                                    </div>
                                </div>
                                <div style="text-align:right">
                                    <div class="price">${c.variants[0].price} ‚ÇΩ</div>
                                    <button class="btn btn-primary" onclick="openCheat(${game.id},${c.id})" style="margin-top:8px">–ö—É–ø–∏—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
    `;
}

/* ---------- open cheat purchase page ---------- */
function openCheat(gameId, cheatId){
    const game = games.find(g=>g.id===gameId);
    const cheat = game.cheats.find(cc=>cc.id===cheatId);
    if(!game || !cheat) return;
    const main = document.getElementById('mainContent');
    main.innerHTML = `
        <div style="max-width:720px;margin:12px auto">
            <button onclick="openGame(${gameId})" class="btn" style="margin-bottom:12px;background:transparent;border:1px solid rgba(255,255,255,0.05)">‚Üê –ù–∞–∑–∞–¥</button>
            <div class="card">
                <div style="display:flex;justify-content:space-between;align-items:center">
                    <div style="display:flex;align-items:center;gap:12px">
                        ${cheat.avatar ? `<img src="${cheat.avatar}" class="cheat-avatar" style="width:80px;height:80px">` : game.avatar ? `<img src="${game.avatar}" class="game-avatar" style="width:80px;height:80px">` : ''}
                        <div>
                            <div style="font-weight:800">${game.name} ‚Äî ${cheat.name} ${cheat.version?(' v'+cheat.version):''}</div>
                            <div class="small-muted" style="margin-top:6px">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</div>
                        </div>
                    </div>
                    <div style="text-align:right">
                        <div class="small-muted">–ö –æ–ø–ª–∞—Ç–µ</div>
                        <div id="purchasePrice" class="price">${cheat.variants[0].price} ‚ÇΩ</div>
                    </div>
                </div>

                <div style="margin-top:12px">
                    <div id="variantsContainer"></div>
                </div>

                <div style="margin-top:12px;display:flex;gap:8px">
                    <button class="btn btn-primary" id="buyBtn">–û–ø–ª–∞—Ç–∏—Ç—å</button>
                    <button class="btn" id="contactBtn" style="background:rgba(255,255,255,0.04)">–ù–∞–ø–∏—Å–∞—Ç—å</button>
                </div>
            </div>
        </div>
    `;
    const variantsContainer = document.getElementById('variantsContainer');
    variantsContainer.innerHTML = cheat.variants.map((v,i)=>`
        <button class="variant-btn ${i===0?'active':''}" data-idx="${i}" onclick="selectVariant(${gameId},${cheatId},${i})">${v.label} ‚Äî ${v.price} ‚ÇΩ</button>
    `).join('');

    window._currentSelection = {gameId,cheatId,variantIndex:0};
    document.getElementById('buyBtn').onclick = ()=> {
        buyCheat(gameId, cheatId, window._currentSelection.variantIndex);
    };
    document.getElementById('contactBtn').onclick = ()=> {
        showNotification('info','–ù–∞–ø–∏—à–∏—Ç–µ –≤ Telegram: t.me/kometspace');
    };
}

function selectVariant(gameId,cheatId,variantIndex){
    const game = games.find(g=>g.id===gameId);
    const cheat = game.cheats.find(c=>c.id===cheatId);
    if(!cheat) return;
    document.querySelectorAll('#variantsContainer .variant-btn').forEach(btn=>btn.classList.remove('active'));
    const btn = document.querySelector(`#variantsContainer .variant-btn[data-idx="${variantIndex}"]`);
    if(btn) btn.classList.add('active');
    const price = cheat.variants[variantIndex].price;
    document.getElementById('purchasePrice').innerText = `${price} ‚ÇΩ`;
    window._currentSelection = {gameId,cheatId,variantIndex};
}

/* ---------- purchase logic ---------- */
function buyCheat(gameId,cheatId,variantIndex){
    if(!currentUser){ openAuthModal(); return; }
    const game = games.find(g=>g.id===gameId);
    const cheat = game.cheats.find(c=>c.id===cheatId);
    if(!cheat) return;
    const variant = cheat.variants[variantIndex];
    if(currentUser.balance < variant.price){
        showNotification('error','–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
        openDepositModal();
        return;
    }
    currentUser.balance -= variant.price;
    saveCurrentUserInUsersList();
    const key = generateKey();
    const purchase = {
        id: Date.now(),
        userId: currentUser.id,
        gameId: game.id,
        gameName: game.name,
        cheatId: cheat.id,
        cheatName: cheat.name,
        variantLabel: variant.label,
        price: variant.price,
        key: key,
        date: new Date().toISOString()
    };
    purchases.push(purchase);
    savePurchases();
    showNotification('success', `–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞! –ö–ª—é—á: ${key}`);
    updateUserMenu();
    showPage('profile');
}

/* ---------- deposit system ---------- */
function submitDeposit(){
    if(!currentUser){ openAuthModal(); return; }
    const amount = parseInt(document.getElementById('depositAmount').value);
    const comment = document.getElementById('depositComment').value.trim() || currentUser.email;
    
    if(!amount || amount < 100){ showNotification('error','–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ 100 ‚ÇΩ'); return; }
    if(!comment){ showNotification('error','–£–∫–∞–∂–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–ª–∞—Ç–µ–∂—É'); return; }
    
    const depositRequest = {
        id: Date.now(),
        userId: currentUser.id,
        userEmail: currentUser.email,
        username: currentUser.username,
        amount: amount,
        comment: comment,
        status: 'pending',
        date: new Date().toISOString(),
        adminComment: ''
    };
    
    depositRequests.push(depositRequest);
    saveDepositRequests();
    
    showNotification('success', `–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ${amount} ‚ÇΩ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É. –û–∂–∏–¥–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.`);
    closeModal('depositModal');
    showPage('profile');
}

/* ---------- file management ---------- */
function openFileUploadModal(gameId, cheatId){
    currentCheatForFiles = {gameId, cheatId};
    document.getElementById('fileUploadModal').classList.add('active');
}

function addFileToCheat(){
    if(!currentCheatForFiles) return;
    
    const name = document.getElementById('fileName').value.trim();
    const url = document.getElementById('fileUrl').value.trim();
    const type = document.getElementById('fileType').value;
    
    if(!name || !url){ 
        showNotification('error','–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); 
        return; 
    }
    
    const game = games.find(g=>g.id===currentCheatForFiles.gameId);
    const cheat = game ? game.cheats.find(c=>c.id===currentCheatForFiles.cheatId) : null;
    
    if(!cheat){
        showNotification('error','–ß–∏—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    if(!cheat.files) cheat.files = [];
    
    cheat.files.push({
        name: name,
        url: url,
        type: type
    });
    
    saveGames();
    showNotification('success', `–§–∞–π–ª "${name}" –¥–æ–±–∞–≤–ª–µ–Ω –∫ —á–∏—Ç—É`);
    closeModal('fileUploadModal');
    showAdminPanel();
}

function removeFile(gameId, cheatId, fileIndex){
    const game = games.find(g=>g.id===gameId);
    const cheat = game ? game.cheats.find(c=>c.id===cheatId) : null;
    
    if(!cheat || !cheat.files || cheat.files.length <= fileIndex){
        showNotification('error','–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    const fileName = cheat.files[fileIndex].name;
    cheat.files.splice(fileIndex, 1);
    saveGames();
    showNotification('success', `–§–∞–π–ª "${fileName}" —É–¥–∞–ª–µ–Ω`);
    showAdminPanel();
}

/* ---------- avatar management ---------- */
function openAvatarUploadModal(gameId = null, cheatId = null){
    currentGameForAvatar = gameId;
    currentCheatForAvatar = cheatId;
    
    // Update game select options
    const gameSelect = document.getElementById('selectGameForAvatar');
    if(gameSelect) {
        gameSelect.innerHTML = games.map(g=>`<option value="${g.id}" ${currentGameForAvatar === g.id ? 'selected' : ''}>${g.name}</option>`).join('');
    }
    
    // Update cheat select options based on selected game
    updateCheatSelectOptions();
    
    document.getElementById('avatarUploadModal').classList.add('active');
}

function updateAvatarFields(){
    const type = document.getElementById('avatarType').value;
    if(type === 'game'){
        document.getElementById('gameSelectGroup').style.display = 'block';
        document.getElementById('cheatSelectGroup').style.display = 'none';
    } else {
        document.getElementById('gameSelectGroup').style.display = 'none';
        document.getElementById('cheatSelectGroup').style.display = 'block';
        updateCheatSelectOptions();
    }
}

function updateCheatSelectOptions(){
    const gameId = parseInt(document.getElementById('selectGameForAvatar').value);
    const game = games.find(g=>g.id===gameId);
    const cheatSelect = document.getElementById('selectCheatForAvatar');
    
    if(game && cheatSelect){
        cheatSelect.innerHTML = game.cheats.map(c=>`<option value="${c.id}">${c.name}</option>`).join('');
    }
}

function addAvatar(){
    const avatarUrl = document.getElementById('avatarUrl').value.trim();
    const avatarType = document.getElementById('avatarType').value;
    
    if(!avatarUrl){ 
        showNotification('error','–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'); 
        return; 
    }
    
    if(avatarType === 'game'){
        const gameId = parseInt(document.getElementById('selectGameForAvatar').value);
        const game = games.find(g=>g.id===gameId);
        
        if(game){
            game.avatar = avatarUrl;
            saveGames();
            showNotification('success', `–ê–≤–∞—Ç–∞—Ä –¥–ª—è –∏–≥—Ä—ã "${game.name}" –¥–æ–±–∞–≤–ª–µ–Ω`);
        } else {
            showNotification('error','–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            return;
        }
    } else {
        const gameId = parseInt(document.getElementById('selectGameForAvatar').value);
        const cheatId = parseInt(document.getElementById('selectCheatForAvatar').value);
        const game = games.find(g=>g.id===gameId);
        
        if(game){
            const cheat = game.cheats.find(c=>c.id===cheatId);
            if(cheat){
                cheat.avatar = avatarUrl;
                saveGames();
                showNotification('success', `–ê–≤–∞—Ç–∞—Ä –¥–ª—è —á–∏—Ç–∞ "${cheat.name}" –¥–æ–±–∞–≤–ª–µ–Ω`);
            } else {
                showNotification('error','–ß–∏—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
        } else {
            showNotification('error','–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            return;
        }
    }
    
    closeModal('avatarUploadModal');
    showAdminPanel();
}

function removeAvatar(gameId, cheatId = null){
    const game = games.find(g=>g.id===gameId);
    
    if(cheatId){
        const cheat = game ? game.cheats.find(c=>c.id===cheatId) : null;
        if(cheat){
            cheat.avatar = '';
            saveGames();
            showNotification('success', '–ê–≤–∞—Ç–∞—Ä —á–∏—Ç–∞ —É–¥–∞–ª–µ–Ω');
        }
    } else {
        if(game){
            game.avatar = '';
            saveGames();
            showNotification('success', `–ê–≤–∞—Ç–∞—Ä –∏–≥—Ä—ã "${game.name}" —É–¥–∞–ª–µ–Ω`);
        }
    }
    showAdminPanel();
}

/* ---------- utilities ---------- */
function generateKey(){
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    let key = '';
    for(let i=0;i<16;i++){
        if(i>0 && i%4===0) key += '-';
        key += chars.charAt(Math.floor(Math.random()*chars.length));
    }
    return key;
}

function copyKey(k){
    navigator.clipboard.writeText(k).then(()=>showNotification('success','–ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!')).catch(()=>showNotification('error','–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'));
}

/* ---------- auth ---------- */
function openAuthModal(){ document.getElementById('authModal').classList.add('active'); }
function closeModal(id){ document.getElementById(id).classList.remove('active'); }
function switchTab(tab){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('#authModal .modal-body > div').forEach(d=>d.style.display='none');
    if(tab==='login'){ document.querySelector('.tab[data-tab="login"]').classList.add('active'); document.getElementById('loginTab').style.display='block'; }
    else { document.querySelector('.tab[data-tab="register"]').classList.add('active'); document.getElementById('registerTab').style.display='block'; }
}
function login(){
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    if(!email||!password){ showNotification('error','–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
    const users = JSON.parse(localStorage.getItem('kometa_users')||'[]');
    const user = users.find(u=>u.email===email&&u.password===password);
    if(user){
        currentUser = { id:user.id, email:user.email, username:user.username, balance:user.balance||0, isAdmin:user.isAdmin||false };
        localStorage.setItem('kometa_user', JSON.stringify(currentUser));
        updateUserMenu();
        closeModal('authModal');
        showNotification('success','–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!');
        showPage('home');
    } else showNotification('error','–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
}
function register(){
    const email = document.getElementById('registerEmail').value.trim();
    const username = document.getElementById('registerUsername').value.trim();
    const password = document.getElementById('registerPassword').value;
    if(!email||!username||!password){ showNotification('error','–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
    if(password.length<6){ showNotification('error','–ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤'); return; }
    let users = JSON.parse(localStorage.getItem('kometa_users')||'[]');
    if(users.some(u=>u.email===email)){ showNotification('error','–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return; }
    const newUser = { id:Date.now(), email, username, password, balance:0, isAdmin:false };
    users.push(newUser);
    localStorage.setItem('kometa_users', JSON.stringify(users));
    currentUser = { id:newUser.id, email:newUser.email, username:newUser.username, balance:0, isAdmin:false };
    localStorage.setItem('kometa_user', JSON.stringify(currentUser));
    updateUserMenu();
    closeModal('authModal');
    showNotification('success','–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
    showPage('home');
}
function logout(){ currentUser = null; localStorage.removeItem('kometa_user'); updateUserMenu(); showPage('home'); showNotification('success','–í—ã –≤—ã—à–ª–∏'); }

function openDepositModal(){ 
    if(!currentUser){ openAuthModal(); return; } 
    document.getElementById('depositModal').classList.add('active');
    if(currentUser && document.getElementById('depositComment')) {
        document.getElementById('depositComment').value = currentUser.email;
    }
}

/* ---------- admin panel ---------- */
function showAdminPanel(){
    if(!currentUser || !currentUser.isAdmin){ showNotification('error','–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω'); return; }
    currentPage = 'admin';
    const users = JSON.parse(localStorage.getItem('kometa_users')||'[]');
    const main = document.getElementById('mainContent');
    main.innerHTML = `
        <div style="max-width:1000px;margin:12px auto">
            <button class="btn" onclick="showPage('profile')" style="margin-bottom:12px;background:transparent;border:1px solid rgba(255,255,255,0.05)">‚Üê –ù–∞–∑–∞–¥</button>
            <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin:12px 0">
                <div class="card"><div style="font-size:24px;font-weight:800">${users.length}</div><div class="small-muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div></div>
                <div class="card"><div style="font-size:24px;font-weight:800">${purchases.length}</div><div class="small-muted">–ü—Ä–æ–¥–∞–∂</div></div>
                <div class="card"><div style="font-size:24px;font-weight:800">${purchases.reduce((s,p)=>s+p.price,0)} ‚ÇΩ</div><div class="small-muted">–í—ã—Ä—É—á–∫–∞</div></div>
                <div class="card"><div style="font-size:24px;font-weight:800">${depositRequests.filter(d=>d.status==='pending').length}</div><div class="small-muted">–ó–∞—è–≤–æ–∫ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</div></div>
            </div>

            <div style="margin-top:10px">
                <h3>–ó–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
                <div class="card" id="adminDepositRequests">
                    ${depositRequests.length===0?'<p class="small-muted">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</p>': depositRequests.map(d=>{
                        const user = users.find(u=>u.id===d.userId);
                        let statusClass = 'status-pending';
                        let statusText = '–û–∂–∏–¥–∞–Ω–∏–µ';
                        if(d.status === 'approved') { statusClass = 'status-approved'; statusText = '–û–¥–æ–±—Ä–µ–Ω–æ'; }
                        if(d.status === 'rejected') { statusClass = 'status-rejected'; statusText = '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ'; }
                        return `
                        <div style="padding:10px;border-bottom:1px solid var(--border)">
                            <div style="display:flex;justify-content:space-between;align-items:center">
                                <div>
                                    <div><strong>${d.amount} ‚ÇΩ</strong></div>
                                    <div class="small-muted">${user ? user.email : d.userEmail} (${d.username})</div>
                                    <div class="small-muted">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${d.comment}</div>
                                </div>
                                <div>
                                    <div class="deposit-status ${statusClass}" style="margin-bottom:8px">${statusText}</div>
                                    ${d.status === 'pending' ? `
                                        <div style="display:flex;gap:6px">
                                            <button class="btn" style="padding:6px 10px;background:var(--success)" onclick="approveDeposit(${d.id})">‚úì –û–¥–æ–±—Ä–∏—Ç—å</button>
                                            <button class="btn" style="padding:6px 10px;background:var(--danger)" onclick="rejectDeposit(${d.id})">‚úó –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                            <div class="small-muted" style="margin-top:6px">${new Date(d.date).toLocaleString('ru-RU')}</div>
                            ${d.adminComment ? `<div class="small-muted" style="margin-top:6px">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∞–¥–º–∏–Ω–∞: ${d.adminComment}</div>` : ''}
                        </div>
                        `;
                    }).join('')}
                </div>
            </div>

            <div style="margin-top:18px">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞–º–∏</h3>
                <div class="card">
                    <button class="btn btn-primary" onclick="openAvatarUploadModal()" style="width:100%">üñºÔ∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä –¥–ª—è –∏–≥—Ä—ã –∏–ª–∏ —á–∏—Ç–∞</button>
                </div>
            </div>

            <div style="margin-top:18px">
                <h3>–í—Å–µ –∏–≥—Ä—ã –∏ —á–∏—Ç—ã</h3>
                <div id="gamesList">
                    ${games.map(g=>`
                        <div class="card" style="margin-bottom:12px">
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                                <div style="display:flex;align-items:center;gap:12px">
                                    ${g.avatar ? `<img src="${g.avatar}" class="game-avatar">` : `<div class="game-icon">${g.icon}</div>`}
                                    <div>
                                        <div style="font-weight:800">${g.name}</div>
                                        <div class="small-muted">${g.description}</div>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn" style="background:var(--warning);color:white;margin-right:8px" onclick="openAvatarUploadModal(${g.id})">üñºÔ∏è</button>
                                    <button class="btn" style="background:var(--primary);color:white;margin-right:8px" onclick="addNewCheatToGame(${g.id})">+ –ß–∏—Ç</button>
                                    ${g.avatar ? `<button class="btn" style="background:var(--danger);color:white" onclick="removeAvatar(${g.id})">üóëÔ∏è</button>` : ''}
                                </div>
                            </div>
                            <div>
                                ${g.cheats.length===0?'<p class="small-muted">–ù–µ—Ç —á–∏—Ç–æ–≤</p>': g.cheats.map(c=>{
                                    const minPrice = Math.min(...c.variants.map(v=>v.price));
                                    const maxPrice = Math.max(...c.variants.map(v=>v.price));
                                    return `
                                    <div style="padding:10px;background:rgba(255,255,255,0.02);border-radius:8px;margin:6px 0">
                                        <div style="display:flex;justify-content:space-between;align-items:center">
                                            <div style="display:flex;align-items:center;gap:12px">
                                                ${c.avatar ? `<img src="${c.avatar}" class="cheat-avatar">` : ''}
                                                <div>
                                                    <strong>${c.name} ${c.version?'v'+c.version:''}</strong>
                                                    <div class="small-muted">–¶–µ–Ω–∞: ${minPrice} ‚ÇΩ - ${maxPrice} ‚ÇΩ</div>
                                                </div>
                                            </div>
                                            <div style="display:flex;gap:4px">
                                                <button class="btn" style="padding:6px 10px;background:var(--warning);color:white" onclick="openAvatarUploadModal(${g.id}, ${c.id})">üñºÔ∏è</button>
                                                <button class="btn" style="padding:6px 10px;background:var(--primary);color:white" onclick="openFileUploadModal(${g.id},${c.id})">üìÅ</button>
                                                ${c.avatar ? `<button class="btn" style="padding:6px 10px;background:var(--danger);color:white" onclick="removeAvatar(${g.id}, ${c.id})">üóëÔ∏è</button>` : ''}
                                            </div>
                                        </div>
                                        <div style="margin-top:8px">
                                            <div class="small-muted" style="margin-bottom:4px">–í–∞—Ä–∏–∞–Ω—Ç—ã:</div>
                                            <div style="display:flex;flex-wrap:wrap;gap:4px">
                                                ${c.variants.map(v=>`<span style="padding:4px 8px;background:rgba(99,102,241,0.1);border-radius:4px;color:var(--primary)">${v.label} - ${v.price}‚ÇΩ</span>`).join('')}
                                            </div>
                                        </div>
                                        ${c.files && c.files.length > 0 ? `
                                        <div style="margin-top:8px">
                                            <div class="small-muted">–§–∞–π–ª—ã:</div>
                                            ${c.files.map((f,idx)=>`
                                                <div style="display:flex;justify-content:space-between;align-items:center;margin-top:4px">
                                                    <a href="${f.url}" target="_blank" style="color:var(--primary)">${f.name}</a>
                                                    <button class="btn" style="padding:2px 6px;background:var(--danger);color:white;font-size:12px" onclick="removeFile(${g.id},${c.id},${idx})">‚úï</button>
                                                </div>
                                            `).join('')}
                                        </div>
                                        ` : '<div class="small-muted">–ù–µ—Ç —Ñ–∞–π–ª–æ–≤</div>'}
                                    </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>

            <div style="margin-top:18px">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É</h3>
                <div class="card">
                    <div class="form-group"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input id="newGameName" placeholder="Standoff 2"></div>
                    <div class="form-group"><label>–ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏)</label><input id="newGameIcon" placeholder="üéÆ"></div>
                    <div class="form-group"><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><input id="newGameDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></div>
                    <button class="btn btn-primary" onclick="addNewGame()">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—É</button>
                </div>
            </div>

            <div style="margin-top:18px">
                <h3>–í—Å–µ –ø–æ–∫—É–ø–∫–∏</h3>
                <div class="card" id="adminPurchases">
                    ${purchases.length===0?'<p class="small-muted">–ü–æ–∫—É–ø–æ–∫ –Ω–µ—Ç</p>': purchases.map(p=>{
                        const u = users.find(x=>x.id===p.userId);
                        const game = games.find(g=>g.id===p.gameId);
                        const cheat = game ? game.cheats.find(c=>c.id===p.cheatId) : null;
                        const files = cheat ? cheat.files || [] : [];
                        return `<div style="padding:10px;border-bottom:1px solid var(--border)">
                            <div style="display:flex;justify-content:space-between">
                                <div>
                                    <div style="font-weight:800">${p.gameName}</div>
                                    <div class="small-muted">${p.cheatName} ‚Äî ${u?u.email:'-'}</div>
                                    <div class="small-muted">${p.variantLabel} ‚Äî ${new Date(p.date).toLocaleString('ru-RU')}</div>
                                </div>
                                <div class="price">${p.price} ‚ÇΩ</div>
                            </div>
                            <div style="margin-top:8px"><pre class="key">${p.key}</pre></div>
                            ${files.length > 0 ? `
                            <div style="margin-top:8px">
                                <div class="small-muted">–§–∞–π–ª—ã:</div>
                                ${files.map(f=>`<a href="${f.url}" target="_blank" class="file-link" style="margin-right:4px">${f.name}</a>`).join('')}
                            </div>
                            ` : ''}
                        </div>`
                    }).join('')}
                </div>
            </div>
        </div>
    `;
}

function addNewCheatToGame(gameId){
    const game = games.find(g=>g.id===gameId);
    if(!game) return;
    
    const name = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∏—Ç–∞:', 'Plutonium');
    if(!name) return;
    
    const version = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–µ—Ä—Å–∏—é —á–∏—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):', '0.36.1');
    
    const variantsInput = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ —Ü–µ–Ω—ã (—Ñ–æ—Ä–º–∞—Ç: –Ω–∞–∑–≤–∞–Ω–∏–µ:—Ü–µ–Ω–∞, —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):', '7 –¥–Ω–µ–π:99,30 –¥–Ω–µ–π:249,–ù–∞–≤—Å–µ–≥–¥–∞:99500');
    if(!variantsInput) return;
    
    const variants = variantsInput.split(',').map(s=>{
        const [label, price] = s.split(':').map(x=>x && x.trim());
        return { label: label || '–í–∞—Ä–∏–∞–Ω—Ç', price: parseInt(price||'0') || 0 };
    });
    
    const cheat = { id: Date.now(), name, version, avatar:'', variants, files: [] };
    game.cheats.push(cheat);
    saveGames();
    showNotification('success', `–ß–∏—Ç "${name}" –¥–æ–±–∞–≤–ª–µ–Ω –∫ "${game.name}"`);
    showAdminPanel();
}

function approveDeposit(depositId){
    const deposit = depositRequests.find(d=>d.id===depositId);
    if(!deposit) return;
    
    deposit.status = 'approved';
    deposit.adminComment = '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º';
    
    let users = JSON.parse(localStorage.getItem('kometa_users')||'[]');
    const user = users.find(u=>u.id===deposit.userId);
    if(user){
        user.balance += deposit.amount;
        localStorage.setItem('kometa_users', JSON.stringify(users));
        
        if(currentUser && currentUser.id === deposit.userId){
            currentUser.balance = user.balance;
            localStorage.setItem('kometa_user', JSON.stringify(currentUser));
            updateUserMenu();
        }
    }
    
    saveDepositRequests();
    showNotification('success', `–ó–∞—è–≤–∫–∞ –Ω–∞ ${deposit.amount} ‚ÇΩ –æ–¥–æ–±—Ä–µ–Ω–∞!`);
    showAdminPanel();
}

function rejectDeposit(depositId){
    const deposit = depositRequests.find(d=>d.id===depositId);
    if(!deposit) return;
    
    const reason = prompt('–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–∞–∑–∞:', '–ü–ª–∞—Ç–µ–∂ –Ω–µ –ø–æ—Å—Ç—É–ø–∏–ª');
    if(reason === null) return;
    
    deposit.status = 'rejected';
    deposit.adminComment = reason || '–ü–ª–∞—Ç–µ–∂ –Ω–µ –ø–æ—Å—Ç—É–ø–∏–ª';
    
    saveDepositRequests();
    showNotification('info', `–ó–∞—è–≤–∫–∞ –Ω–∞ ${deposit.amount} ‚ÇΩ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞.`);
    showAdminPanel();
}

function addNewGame(){
    const name = document.getElementById('newGameName').value.trim();
    const icon = document.getElementById('newGameIcon').value.trim() || 'üéÆ';
    const desc = document.getElementById('newGameDesc').value.trim() || '';
    if(!name){ showNotification('error','–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã'); return; }
    const newGame = { id: Date.now(), name, icon, avatar:'', description:desc, cheats: [] };
    games.push(newGame);
    saveGames();
    showNotification('success', `–ò–≥—Ä–∞ "${name}" –¥–æ–±–∞–≤–ª–µ–Ω–∞`);
    document.getElementById('newGameName').value = '';
    document.getElementById('newGameIcon').value = '';
    document.getElementById('newGameDesc').value = '';
    showAdminPanel();
}

/* ---------- notifications ---------- */
function showNotification(type, message){
    const notifications = document.getElementById('notifications');
    const el = document.createElement('div');
    el.className = 'notification';
    el.innerText = message;
    el.style.borderLeftColor = type==='success' ? 'var(--success)' : type==='error' ? 'var(--danger)' : 'var(--primary)';
    notifications.appendChild(el);
    setTimeout(()=>{ el.remove(); }, 3000);
}
</script>
</body>
    </html>
