<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrimeSpeak Academy</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root { --primary: #4f46e5; --primary-dark: #3730a3; --secondary: #10b981; --danger: #ef4444; --warning: #f59e0b; --light: #f8fafc; --dark: #1e293b; --gray: #64748b; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 15px; color: var(--dark); }
        .login-container { max-width: 400px; margin: 50px auto; background: white; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); padding: 30px; text-align: center; }
        .login-container h1 { color: var(--primary-dark); margin-bottom: 10px; }
        .login-container p { color: var(--gray); margin-bottom: 25px; }
        .login-tabs { display: flex; margin-bottom: 20px; border-radius: 10px; overflow: hidden; background: #f1f5f9; }
        .login-tab { flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 600; }
        .login-tab.active { background: var(--primary); color: white; }
        .login-input { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; }
        .login-input:focus { border-color: var(--primary); outline: none; }
        .login-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .login-btn:hover { background: var(--primary-dark); }
        .container { max-width: 100%; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; margin: 0 auto; display: none; }
        .header { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 25px 15px; text-align: center; position: relative; }
        .user-info { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; font-size: 0.9em; }
        .logout-btn { background: rgba(255,255,255,0.3); border: none; color: white; padding: 5px 10px; border-radius: 10px; cursor: pointer; margin-left: 10px; }
        .nav { display: flex; background: var(--primary-dark); flex-wrap: wrap; }
        .nav-btn { flex: 1; min-width: 80px; background: none; border: none; color: white; padding: 15px 10px; cursor: pointer; font-size: 12px; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .nav-btn.active { background: var(--primary); }
        .content { padding: 20px 15px; min-height: 500px; }
        .section { display: none; }
        .section.active { display: block; }
        .card { background: var(--light); border-radius: 12px; padding: 20px; margin-bottom: 15px; border-left: 4px solid var(--primary); }
        .student-card { display: flex; flex-direction: column; gap: 12px; }
        .student-info h3 { color: var(--primary-dark); margin-bottom: 6px; font-size: 1.2em; }
        .student-info p { color: var(--gray); margin: 2px 0; font-size: 0.9em; }
        .student-stats { display: flex; justify-content: space-between; align-items: center; }
        .average-grade { font-size: 1.5em; font-weight: bold; color: var(--primary); }
        .grade { display: inline-flex; align-items: center; justify-content: center; width: 35px; height: 35px; color: white; border-radius: 8px; font-weight: bold; margin: 2px; font-size: 0.9em; border: 2px solid transparent; }
        .grade-1, .grade-2, .grade-3 { background: #ef4444; }
        .grade-4, .grade-5, .grade-6 { background: #f59e0b; }
        .grade-7, .grade-8, .grade-9, .grade-10 { background: #10b981; }
        .grade-11, .grade-12, .grade-13, .grade-14, .grade-15 { background: #10b981; }
        .grade-16, .grade-17, .grade-18, .grade-19, .grade-20 { background: #10b981; }
        .grade-21, .grade-22, .grade-23, .grade-24, .grade-25 { background: #10b981; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: var(--dark); font-size: 0.9em; }
        .input, .select { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; }
        .input:focus, .select:focus { border-color: var(--primary); outline: none; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; width: 100%; margin-top: 10px; }
        .btn:hover { background: var(--primary-dark); }
        .btn-success { background: var(--secondary); }
        .btn-success:hover { background: #0da271; }
        .btn-danger { background: var(--danger); }
        .btn-danger:hover { background: #dc2626; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        .stat-card { background: white; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.08); border-top: 4px solid var(--primary); }
        .stat-number { font-size: 1.8em; font-weight: bold; color: var(--primary); margin: 5px 0; }
        .stat-label { color: var(--gray); font-size: 0.8em; }
        .empty-state { text-align: center; padding: 40px 15px; color: var(--gray); }
        h2 { margin-bottom: 15px; color: var(--primary-dark); font-size: 1.3em; }
        h3 { margin-bottom: 10px; color: var(--dark); font-size: 1.1em; }
        .student-grades-list { margin-top: 20px; }
        .grade-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #e2e8f0; }
        .grade-item:last-child { border-bottom: none; }
        .login-info { background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 10px; padding: 15px; margin: 10px 0; }
        .grade-type-tabs { display: flex; margin-bottom: 15px; border-radius: 8px; overflow: hidden; background: #f1f5f9; }
        .grade-type-tab { flex: 1; padding: 10px; border: none; background: none; cursor: pointer; font-weight: 600; font-size: 12px; }
        .grade-type-tab.active { background: var(--primary); color: white; }
        .save-btn { background: var(--secondary); margin-top: 5px; }
        .save-btn:hover { background: #0da271; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—Ü–µ–Ω–æ–∫ */
        .grade-type-badge { 
            display: inline-block; 
            padding: 4px 8px; 
            border-radius: 6px; 
            font-size: 0.7em; 
            font-weight: bold; 
            margin-left: 8px; 
        }
        .type-regular { background: #dbeafe; color: #1e40af; }
        .type-test { background: #f3e8ff; color: #7e22ce; }
        .type-homework { background: #dcfce7; color: #166534; }
        .type-activity { background: #fef3c7; color: #92400e; }
        .type-project { background: #ffe4e6; color: #be123c; }
        .type-oral { background: #e0e7ff; color: #3730a3; }
        .type-attendance { background: #f1f5f9; color: #475569; }
        
        .grade-display { 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            min-width: 60px; 
            height: 35px; 
            color: white; 
            border-radius: 8px; 
            font-weight: bold; 
            margin: 2px; 
            font-size: 0.9em; 
            padding: 0 10px; 
        }
        .test-grade { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .project-grade { background: linear-gradient(135deg, #ec4899, #be185d); }
        .attendance-grade { background: linear-gradient(135deg, #6b7280, #4b5563); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
        .calendar { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .calendar-day { text-align: center; padding: 10px; border-radius: 8px; cursor: pointer; }
        .calendar-day:hover { background: #f1f5f9; }
        .calendar-day.today { background: var(--primary); color: white; }
        .calendar-day.has-event { background: #f0f9ff; border: 2px solid #0ea5e9; }
        .calendar-day.weekend { color: var(--danger); }
        .calendar-event { background: var(--secondary); color: white; padding: 4px 8px; border-radius: 6px; font-size: 0.8em; margin-top: 4px; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è */
        .schedule-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .schedule-item { background: white; padding: 15px; border-radius: 10px; border-left: 4px solid var(--primary); }
        .schedule-time { font-weight: bold; color: var(--primary); margin-bottom: 5px; }
        .schedule-subject { font-size: 1.1em; margin-bottom: 5px; }
        .schedule-teacher { color: var(--gray); font-size: 0.9em; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        .notification { background: #fef3c7; border: 2px solid #f59e0b; border-radius: 10px; padding: 15px; margin-bottom: 10px; }
        .notification.upcoming { background: #f0f9ff; border-color: #0ea5e9; }
        .notification.important { background: #fee2e2; border-color: #ef4444; }
    </style>
</head>
<body>
    <div class="login-container" id="loginScreen">
        <h1>üìö PrimeSpeak Academy</h1>
        <p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>
        
        <div class="login-tabs">
            <button class="login-tab active" onclick="showLoginTab('teacher')">üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å</button>
            <button class="login-tab" onclick="showLoginTab('student')">üë®‚Äçüéì –£—á–µ–Ω–∏–∫</button>
        </div>

        <div id="teacherLogin">
            <input type="text" class="login-input" id="teacherEmail" placeholder="Email —É—á–∏—Ç–µ–ª—è">
            <input type="password" class="login-input" id="teacherPassword" placeholder="–ü–∞—Ä–æ–ª—å —É—á–∏—Ç–µ–ª—è">
            <button class="login-btn" onclick="loginTeacher()">–í–æ–π—Ç–∏ –∫–∞–∫ —É—á–∏—Ç–µ–ª—å</button>
            <button class="login-btn save-btn" onclick="saveLoginData('teacher')">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—Ö–æ–¥–∞</button>
        </div>

        <div id="studentLogin" style="display: none;">
            <input type="text" class="login-input" id="studentLoginInput" placeholder="–õ–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞">
            <input type="password" class="login-input" id="studentPassword" placeholder="–ü–∞—Ä–æ–ª—å —É—á–µ–Ω–∏–∫–∞">
            <button class="login-btn" onclick="loginStudent()">–í–æ–π—Ç–∏ –∫–∞–∫ —É—á–µ–Ω–∏–∫</button>
            <button class="login-btn save-btn" onclick="saveLoginData('student')">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—Ö–æ–¥–∞</button>
        </div>

        <button onclick="testConnection()" style="margin-top: 20px; padding: 10px; background: #10b981; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
            üß™ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        </button>
    </div>

    <div class="container" id="mainApp">
        <div class="header" id="teacherHeader">
            <div class="user-info">
                üë®‚Äçüè´ <span id="userName">Jasur Sheraliev</span>
                <button class="logout-btn" onclick="logout()">üö™</button>
            </div>
            <h1>üìö PrimeSpeak Academy</h1>
            <div class="company-name">–ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏–µ–º</div>
            <p>–û—Ü–µ–Ω–∫–∏ ‚Ä¢ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚Ä¢ –ö–∞–ª–µ–Ω–¥–∞—Ä—å ‚Ä¢ Teacher Portal</p>
        </div>

        <div class="header" id="studentHeader" style="display: none;">
            <div class="user-info">
                üë®‚Äçüéì <span id="studentNameDisplay">–£—á–µ–Ω–∏–∫</span>
                <button class="logout-btn" onclick="logout()">üö™</button>
            </div>
            <h1>üìö PrimeSpeak Academy</h1>
            <div class="company-name">–ú–æ–π —É—á–µ–±–Ω—ã–π –ø–æ—Ä—Ç–∞–ª</div>
            <p>–û—Ü–µ–Ω–∫–∏ ‚Ä¢ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚Ä¢ –ö–∞–ª–µ–Ω–¥–∞—Ä—å ‚Ä¢ Student Portal</p>
        </div>

        <div class="nav" id="teacherNav">
            <button class="nav-btn active" onclick="showSection('dashboard')">üìä<span>–î–∞—à–±–æ—Ä–¥</span></button>
            <button class="nav-btn" onclick="showSection('students')">üë®‚Äçüéì<span>–£—á–µ–Ω–∏–∫–∏</span></button>
            <button class="nav-btn" onclick="showSection('addStudent')">‚ûï<span>–î–æ–±–∞–≤–∏—Ç—å</span></button>
            <button class="nav-btn" onclick="showSection('grades')">üìù<span>–û—Ü–µ–Ω–∫–∏</span></button>
            <button class="nav-btn" onclick="showSection('schedule')">üìÖ<span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span></button>
            <button class="nav-btn" onclick="showSection('calendar')">üóìÔ∏è<span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span></button>
        </div>

        <div class="content">
            <!-- –î–ê–®–ë–û–†–î -->
            <div id="dashboard" class="section active">
                <h2>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="stats-grid">
                    <div class="stat-card"><div>üë®‚Äçüéì</div><div class="stat-number" id="totalStudents">0</div><div class="stat-label">–£—á–µ–Ω–∏–∫–æ–≤</div></div>
                    <div class="stat-card"><div>‚≠ê</div><div class="stat-number" id="averageGrade">0.0</div><div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div></div>
                    <div class="stat-card"><div>üìù</div><div class="stat-number" id="totalGrades">0</div><div class="stat-label">–û—Ü–µ–Ω–æ–∫</div></div>
                    <div class="stat-card"><div>üéØ</div><div class="stat-number" id="gradeTypesCount">7</div><div class="stat-label">–¢–∏–ø–æ–≤ –æ—Ü–µ–Ω–æ–∫</div></div>
                </div>
                
                <div class="card">
                    <h3>üîî –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                    <div id="upcomingEvents"></div>
                </div>
                
                <div class="card"><h3>üìà –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏</h3><div id="recentGrades"></div></div>
                <div class="card"><h3>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ç–∏–ø–∞–º –æ—Ü–µ–Ω–æ–∫</h3><div id="gradeTypesStats"></div></div>
            </div>

            <!-- –£–ß–ï–ù–ò–ö–ò -->
            <div id="students" class="section">
                <h2>üë®‚Äçüéì –°–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤</h2>
                <div class="card">
                    <div class="form-group">
                        <input type="text" class="input" id="searchStudent" placeholder="üîç –ü–æ–∏—Å–∫ —É—á–µ–Ω–∏–∫–∞ –ø–æ –∏–º–µ–Ω–∏..." onkeyup="searchStudents()">
                    </div>
                </div>
                <div id="studentsList"></div>
            </div>

            <!-- –î–û–ë–ê–í–õ–ï–ù–ò–ï –£–ß–ï–ù–ò–ö–ê -->
            <div id="addStudent" class="section">
                <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</h2>
                <div class="card">
                    <div class="form-group">
                        <label>üë§ –ü–æ–ª–Ω–æ–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞</label>
                        <input type="text" class="input" id="studentName" placeholder="–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è">
                    </div>
                    <div class="form-group">
                        <label>üë§ –õ–æ–≥–∏–Ω –¥–ª—è –≤—Ö–æ–¥–∞</label>
                        <input type="text" class="input" id="studentUsername" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω">
                    </div>
                    <div class="form-group">
                        <label>üîë –ü–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞</label>
                        <input type="text" class="input" id="studentPasswordInput" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                    <div class="form-group">
                        <label>üìß Email —É—á–µ–Ω–∏–∫–∞</label>
                        <input type="email" class="input" id="studentEmail" placeholder="example@gmail.com">
                    </div>
                    <div class="form-group">
                        <label>üìö –ö—É—Ä—Å</label>
                        <select class="select" id="studentCourse">
                            <option value="basic">–ù–∞—á–∞–ª—å–Ω—ã–π –∞–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
                            <option value="advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–Ω–≥–ª–∏–π—Å–∫–∏–π</option>
                        </select>
                    </div>
                    <button class="btn" onclick="addStudent()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</button>
                    <button class="btn save-btn" onclick="saveStudentForm()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ä–º—É</button>
                </div>
            </div>

            <!-- –û–¶–ï–ù–ö–ò -->
            <div id="grades" class="section">
                <h2>üìù –í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h2>
                <div class="card">
                    <div class="form-group">
                        <label>üë®‚Äçüéì –í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞</label>
                        <select class="select" id="gradeStudent"></select>
                    </div>
                    
                    <div class="grade-type-tabs">
                        <button class="grade-type-tab active" onclick="showGradeType('regular')">üìö –û–±—ã—á–Ω—ã–µ</button>
                        <button class="grade-type-tab" onclick="showGradeType('test')">üéì –¢–µ—Å—Ç—ã</button>
                        <button class="grade-type-tab" onclick="showGradeType('homework')">üè† –î–æ–º–∞—à–Ω–∏–µ</button>
                        <button class="grade-type-tab" onclick="showGradeType('activity')">üí™ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                        <button class="grade-type-tab" onclick="showGradeType('project')">üìÅ –ü—Ä–æ–µ–∫—Ç—ã</button>
                        <button class="grade-type-tab" onclick="showGradeType('oral')">üé§ –£—Å—Ç–Ω—ã–µ</button>
                        <button class="grade-type-tab" onclick="showGradeType('attendance')">üìÖ –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</button>
                    </div>

                    <!-- –û–±—ã—á–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏ (10 –±–∞–ª–ª–æ–≤) -->
                    <div id="regularGrades" class="grade-type-content">
                        <div class="form-group">
                            <label>‚≠ê –û—Ü–µ–Ω–∫–∞ (10-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="gradeValue">
                                <option value="1">1 - –û—á–µ–Ω—å –ø–ª–æ—Ö–æ</option>
                                <option value="2">2 - –ü–ª–æ—Ö–æ</option>
                                <option value="3">3 - –ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="4">4 - –ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ</option>
                                <option value="5">5 - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="6">6 - –•–æ—Ä–æ—à–æ</option>
                                <option value="7">7 - –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ</option>
                                <option value="8">8 - –û—Ç–ª–∏—á–Ω–æ</option>
                                <option value="9">9 - –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ</option>
                                <option value="10">10 - –ë–ª–µ—Å—Ç—è—â–µ</option>
                            </select>
                        </div>
                    </div>

                    <!-- –¢–µ—Å—Ç—ã (25 –±–∞–ª–ª–æ–≤) -->
                    <div id="testGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üéì –û—Ü–µ–Ω–∫–∞ –∑–∞ —Ç–µ—Å—Ç (25-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞) 
                                <span id="testGradeDisplay" style="color: var(--primary); font-weight: bold; margin-left: 10px;">15/25</span>
                            </label>
                            <select class="select" id="testGradeValue" onchange="updateTestGradeDisplay()">
                                <option value="1">1 –±–∞–ª–ª</option>
                                <option value="2">2 –±–∞–ª–ª–∞</option>
                                <option value="3">3 –±–∞–ª–ª–∞</option>
                                <option value="4">4 –±–∞–ª–ª–∞</option>
                                <option value="5">5 –±–∞–ª–ª–æ–≤</option>
                                <option value="6">6 –±–∞–ª–ª–æ–≤</option>
                                <option value="7">7 –±–∞–ª–ª–æ–≤</option>
                                <option value="8">8 –±–∞–ª–ª–æ–≤</option>
                                <option value="9">9 –±–∞–ª–ª–æ–≤</option>
                                <option value="10">10 –±–∞–ª–ª–æ–≤</option>
                                <option value="11">11 –±–∞–ª–ª–æ–≤</option>
                                <option value="12">12 –±–∞–ª–ª–æ–≤</option>
                                <option value="13">13 –±–∞–ª–ª–æ–≤</option>
                                <option value="14">14 –±–∞–ª–ª–æ–≤</option>
                                <option value="15" selected>15 –±–∞–ª–ª–æ–≤</option>
                                <option value="16">16 –±–∞–ª–ª–æ–≤</option>
                                <option value="17">17 –±–∞–ª–ª–æ–≤</option>
                                <option value="18">18 –±–∞–ª–ª–æ–≤</option>
                                <option value="19">19 –±–∞–ª–ª–æ–≤</option>
                                <option value="20">20 –±–∞–ª–ª–æ–≤</option>
                                <option value="21">21 –±–∞–ª–ª</option>
                                <option value="22">22 –±–∞–ª–ª–∞</option>
                                <option value="23">23 –±–∞–ª–ª–∞</option>
                                <option value="24">24 –±–∞–ª–ª–∞</option>
                                <option value="25">25 –±–∞–ª–ª–æ–≤</option>
                            </select>
                        </div>
                    </div>

                    <!-- –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è (10 –±–∞–ª–ª–æ–≤) -->
                    <div id="homeworkGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üè† –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ (10-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="homeworkGradeValue">
                                <option value="1">1 - –ù–µ —Å–¥–∞–Ω–æ</option>
                                <option value="2">2 - –û—á–µ–Ω—å –ø–ª–æ—Ö–æ</option>
                                <option value="3">3 - –ü–ª–æ—Ö–æ</option>
                                <option value="4">4 - –ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ</option>
                                <option value="5">5 - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="6">6 - –•–æ—Ä–æ—à–æ</option>
                                <option value="7">7 - –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ</option>
                                <option value="8">8 - –û—Ç–ª–∏—á–Ω–æ</option>
                                <option value="9">9 - –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ</option>
                                <option value="10">10 - –ò–¥–µ–∞–ª—å–Ω–æ</option>
                            </select>
                        </div>
                    </div>

                    <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–∫–µ (5 –±–∞–ª–ª–æ–≤) -->
                    <div id="activityGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üí™ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–∫–µ (5-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="activityGradeValue">
                                <option value="1">1 - –ü–∞—Å—Å–∏–≤–Ω—ã–π</option>
                                <option value="2">2 - –†–µ–¥–∫–æ —É—á–∞—Å—Ç–≤—É–µ—Ç</option>
                                <option value="3">3 - –°—Ä–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</option>
                                <option value="4">4 - –ê–∫—Ç–∏–≤–Ω—ã–π</option>
                                <option value="5">5 - –û—á–µ–Ω—å –∞–∫—Ç–∏–≤–Ω—ã–π</option>
                            </select>
                        </div>
                    </div>

                    <!-- –ü—Ä–æ–µ–∫—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã (20 –±–∞–ª–ª–æ–≤) -->
                    <div id="projectGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üìÅ –ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (20-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="projectGradeValue">
                                <option value="1">1 –±–∞–ª–ª</option>
                                <option value="2">2 –±–∞–ª–ª–∞</option>
                                <option value="3">3 –±–∞–ª–ª–∞</option>
                                <option value="4">4 –±–∞–ª–ª–∞</option>
                                <option value="5">5 –±–∞–ª–ª–æ–≤</option>
                                <option value="6">6 –±–∞–ª–ª–æ–≤</option>
                                <option value="7">7 –±–∞–ª–ª–æ–≤</option>
                                <option value="8">8 –±–∞–ª–ª–æ–≤</option>
                                <option value="9">9 –±–∞–ª–ª–æ–≤</option>
                                <option value="10">10 –±–∞–ª–ª–æ–≤</option>
                                <option value="11">11 –±–∞–ª–ª–æ–≤</option>
                                <option value="12">12 –±–∞–ª–ª–æ–≤</option>
                                <option value="13">13 –±–∞–ª–ª–æ–≤</option>
                                <option value="14">14 –±–∞–ª–ª–æ–≤</option>
                                <option value="15">15 –±–∞–ª–ª–æ–≤</option>
                                <option value="16">16 –±–∞–ª–ª–æ–≤</option>
                                <option value="17">17 –±–∞–ª–ª–æ–≤</option>
                                <option value="18">18 –±–∞–ª–ª–æ–≤</option>
                                <option value="19">19 –±–∞–ª–ª–æ–≤</option>
                                <option value="20">20 –±–∞–ª–ª–æ–≤</option>
                            </select>
                        </div>
                    </div>

                    <!-- –£—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (5 –±–∞–ª–ª–æ–≤) -->
                    <div id="oralGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üé§ –£—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç (5-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="oralGradeValue">
                                <option value="1">1 - –ù–µ –æ—Ç–≤–µ—Ç–∏–ª</option>
                                <option value="2">2 - –° –æ—à–∏–±–∫–∞–º–∏</option>
                                <option value="3">3 - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="4">4 - –•–æ—Ä–æ—à–æ</option>
                                <option value="5">5 - –û—Ç–ª–∏—á–Ω–æ</option>
                            </select>
                        </div>
                    </div>

                    <!-- –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å (2 –±–∞–ª–ª–∞) -->
                    <div id="attendanceGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üìÖ –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</label>
                            <select class="select" id="attendanceGradeValue">
                                <option value="2">‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</option>
                                <option value="1">‚è∞ –û–ø–æ–∑–¥–∞–ª</option>
                                <option value="0">‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üìÑ –ó–∞–¥–∞–Ω–∏–µ/–¢–µ–º–∞ —É—Ä–æ–∫–∞</label>
                        <input type="text" class="input" id="gradeAssignment" placeholder="Present Simple, Homework #5, Project Work">
                    </div>
                    <div class="form-group">
                        <label>üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <textarea class="input" id="gradeComment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏..." rows="2"></textarea>
                    </div>
                    <button class="btn" onclick="addGrade()">üìù –ü–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
                    <button class="btn save-btn" onclick="saveGradeForm()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–æ—Ä–º—É</button>
                </div>
                <div class="card"><h3>üìã –ò—Å—Ç–æ—Ä–∏—è –æ—Ü–µ–Ω–æ–∫</h3><div id="gradesHistory"></div></div>
            </div>

            <!-- –†–ê–°–ü–ò–°–ê–ù–ò–ï -->
            <div id="schedule" class="section">
                <h2>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π</h2>
                
                <div class="card">
                    <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
                    <div class="form-group">
                        <label>üìö –ü—Ä–µ–¥–º–µ—Ç</label>
                        <input type="text" class="input" id="scheduleSubject" placeholder="–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫, Grammar">
                    </div>
                    <div class="form-group">
                        <label>üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</label>
                        <input type="text" class="input" id="scheduleTeacher" placeholder="Jasur Sheraliev">
                    </div>
                    <div class="form-group">
                        <label>üìÖ –î–∞—Ç–∞</label>
                        <input type="date" class="input" id="scheduleDate">
                    </div>
                    <div class="form-group">
                        <label>‚è∞ –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</label>
                        <input type="time" class="input" id="scheduleStartTime">
                    </div>
                    <div class="form-group">
                        <label>‚è∞ –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                        <input type="time" class="input" id="scheduleEndTime">
                    </div>
                    <div class="form-group">
                        <label>üìù –û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <textarea class="input" id="scheduleDescription" placeholder="–¢–µ–º–∞ —É—Ä–æ–∫–∞, –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ..." rows="3"></textarea>
                    </div>
                    <button class="btn" onclick="addScheduleItem()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
                </div>

                <div class="card">
                    <h3>üóìÔ∏è –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∑–∞–Ω—è—Ç–∏—è</h3>
                    <div id="upcomingLessons"></div>
                </div>

                <div class="card">
                    <h3>üìã –í—Å–µ –∑–∞–Ω—è—Ç–∏—è</h3>
                    <div id="scheduleList"></div>
                </div>
            </div>

            <!-- –ö–ê–õ–ï–ù–î–ê–†–¨ -->
            <div id="calendar" class="section">
                <h2>üóìÔ∏è –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π</h2>
                
                <div class="card">
                    <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</h3>
                    <div class="form-group">
                        <label>üéØ –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</label>
                        <input type="text" class="input" id="eventTitle" placeholder="–¢–µ—Å—Ç, –°–æ–±—Ä–∞–Ω–∏–µ, –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ">
                    </div>
                    <div class="form-group">
                        <label>üìÖ –î–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è</label>
                        <input type="date" class="input" id="eventDate">
                    </div>
                    <div class="form-group">
                        <label>‚è∞ –í—Ä–µ–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="time" class="input" id="eventTime">
                    </div>
                    <div class="form-group">
                        <label>üìù –û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="input" id="eventDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è..." rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>üé® –¢–∏–ø —Å–æ–±—ã—Ç–∏—è</label>
                        <select class="select" id="eventType">
                            <option value="lesson">üìö –£—Ä–æ–∫</option>
                            <option value="test">üéì –¢–µ—Å—Ç</option>
                            <option value="meeting">üë• –°–æ–±—Ä–∞–Ω–∏–µ</option>
                            <option value="holiday">üéâ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</option>
                            <option value="deadline">‚è∞ –î–µ–¥–ª–∞–π–Ω</option>
                        </select>
                    </div>
                    <button class="btn" onclick="addCalendarEvent()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
                </div>

                <div class="card">
                    <div class="calendar-header">
                        <button class="btn" onclick="changeMonth(-1)" style="width: auto;">‚¨ÖÔ∏è</button>
                        <h3 id="currentMonth">–ú–∞–π 2024</h3>
                        <button class="btn" onclick="changeMonth(1)" style="width: auto;">‚û°Ô∏è</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è JavaScript -->
                    </div>
                </div>

                <div class="card">
                    <h3>üìÖ –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                    <div id="calendarEventsList"></div>
                </div>
            </div>

            <!-- –°–¢–†–ê–ù–ò–¶–ê –£–ß–ï–ù–ò–ö–ê -->
            <div id="studentGrades" class="section">
                <h2>üìä –ú–æ–π —É—á–µ–±–Ω—ã–π –ø–æ—Ä—Ç–∞–ª</h2>
                <div class="card">
                    <h3>üëã –ü—Ä–∏–≤–µ—Ç, <span id="welcomeStudentName">–£—á–µ–Ω–∏–∫</span>!</h3>
                    <p><strong>–¢–≤–æ–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª:</strong> <span id="studentAverageGrade" style="font-size: 1.5em; color: var(--primary);">0.0</span></p>
                    <p><strong>–ö—É—Ä—Å:</strong> <span id="studentCourseDisplay">-</span></p>
                    <p><strong>–ó–∞—á–∏—Å–ª–µ–Ω:</strong> <span id="studentJoinDate">-</span></p>
                </div>

                <div class="card">
                    <h3>üìÖ –ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
                    <div id="studentTodaySchedule"></div>
                </div>

                <div class="card">
                    <h3>üîî –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                    <div id="studentUpcomingEvents"></div>
                </div>

                <div class="card">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –æ—Ü–µ–Ω–æ–∫</h3>
                    <div id="studentGradeStats"></div>
                </div>

                <div class="card">
                    <h3>üìù –ò—Å—Ç–æ—Ä–∏—è –º–æ–∏—Ö –æ—Ü–µ–Ω–æ–∫</h3>
                    <div class="student-grades-list" id="studentGradesList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SUPABASE
        const supabaseUrl = 'https://kgkkdjujxruiakbglnop.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtna2tkanVqeHJ1aWFrYmdsbm9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyNzI0MDMsImV4cCI6MjA3ODg0ODQwM30.R8vESEB3T-wqPlsykf4YnKm3wawuu70Xeph4GUCigsM';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        let currentUser = null;
        let currentGradeType = 'regular';
        let currentDate = new Date();

        // –¢–ò–ü–´ –û–¶–ï–ù–û–ö
        const gradeTypes = {
            'regular': { name: 'üìö –û–±—ã—á–Ω–∞—è', max: 10, color: '#3b82f6' },
            'test': { name: 'üéì –¢–µ—Å—Ç', max: 25, color: '#8b5cf6' },
            'homework': { name: 'üè† –î–æ–º–∞—à–Ω—è—è', max: 10, color: '#10b981' },
            'activity': { name: 'üí™ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', max: 5, color: '#f59e0b' },
            'project': { name: 'üìÅ –ü—Ä–æ–µ–∫—Ç', max: 20, color: '#ec4899' },
            'oral': { name: 'üé§ –£—Å—Ç–Ω–∞—è', max: 5, color: '#06b6d4' },
            'attendance': { name: 'üìÖ –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å', max: 2, color: '#6b7280' }
        };

        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø "–û–¶–ï–ù–ö–ê/25"
        function updateTestGradeDisplay() {
            const gradeValue = document.getElementById('testGradeValue').value;
            document.getElementById('testGradeDisplay').textContent = `${gradeValue}/25`;
        }

        // –§–£–ù–ö–¶–ò–ò –°–û–•–†–ê–ù–ï–ù–ò–Ø
        function saveLoginData(type) {
            if (type === 'teacher') {
                const email = document.getElementById('teacherEmail').value;
                const password = document.getElementById('teacherPassword').value;
                if (email && password) {
                    localStorage.setItem('teacherLogin', JSON.stringify({ email, password }));
                    alert('‚úÖ –î–∞–Ω–Ω—ã–µ —É—á–∏—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                }
            } else {
                const username = document.getElementById('studentLoginInput').value;
                const password = document.getElementById('studentPassword').value;
                if (username && password) {
                    localStorage.setItem('studentLogin', JSON.stringify({ username, password }));
                    alert('‚úÖ –î–∞–Ω–Ω—ã–µ —É—á–µ–Ω–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
                }
            }
        }

        function saveStudentForm() {
            const formData = {
                name: document.getElementById('studentName').value,
                username: document.getElementById('studentUsername').value,
                password: document.getElementById('studentPasswordInput').value,
                email: document.getElementById('studentEmail').value,
                course: document.getElementById('studentCourse').value
            };
            localStorage.setItem('studentForm', JSON.stringify(formData));
            alert('‚úÖ –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
        }

        function saveGradeForm() {
            const formData = {
                studentId: document.getElementById('gradeStudent').value,
                assignment: document.getElementById('gradeAssignment').value,
                gradeType: currentGradeType,
                gradeValue: currentGradeType === 'regular' ? 
                    document.getElementById('gradeValue').value : 
                    document.getElementById('testGradeValue').value
            };
            localStorage.setItem('gradeForm', JSON.stringify(formData));
            alert('‚úÖ –§–æ—Ä–º–∞ –æ—Ü–µ–Ω–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
        }

        // –ó–ê–ì–†–£–ó–ö–ê –°–û–•–†–ê–ù–ï–ù–ù–´–• –î–ê–ù–ù–´–•
        function loadSavedLogins() {
            const teacherData = localStorage.getItem('teacherLogin');
            if (teacherData) {
                const { email, password } = JSON.parse(teacherData);
                document.getElementById('teacherEmail').value = email;
                document.getElementById('teacherPassword').value = password;
            }
            const studentData = localStorage.getItem('studentLogin');
            if (studentData) {
                const { username, password } = JSON.parse(studentData);
                document.getElementById('studentLoginInput').value = username;
                document.getElementById('studentPassword').value = password;
            }
            loadSavedForms();
        }

        function loadSavedForms() {
            const studentForm = localStorage.getItem('studentForm');
            if (studentForm) {
                const data = JSON.parse(studentForm);
                document.getElementById('studentName').value = data.name || '';
                document.getElementById('studentUsername').value = data.username || '';
                document.getElementById('studentPasswordInput').value = data.password || '';
                document.getElementById('studentEmail').value = data.email || '';
                if (data.course) document.getElementById('studentCourse').value = data.course;
            }

            const gradeForm = localStorage.getItem('gradeForm');
            if (gradeForm) {
                const data = JSON.parse(gradeForm);
                if (data.studentId) document.getElementById('gradeStudent').value = data.studentId;
                document.getElementById('gradeAssignment').value = data.assignment || '';
                
                if (data.gradeType) {
                    showGradeType(data.gradeType);
                    if (data.gradeType === 'regular') {
                        document.getElementById('gradeValue').value = data.gradeValue || '5';
                    } else {
                        document.getElementById('testGradeValue').value = data.gradeValue || '15';
                    }
                }
            }
        }

        // –§–£–ù–ö–¶–ò–Ø –ü–†–û–í–ï–†–ö–ò –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø
        async function testConnection() {
            try {
                console.log('üîç –ü—Ä–æ–≤–µ—Ä—è—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase...');
                const { data, error } = await supabase
                    .from('teacher')
                    .select('*')
                    .limit(1);
                    
                if (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ: ' + error.message);
                    return false;
                }
                
                console.log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Supabase —É—Å–ø–µ—à–Ω–æ! –î–∞–Ω–Ω—ã–µ:', data);
                alert('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ!');
                return true;
            } catch (err) {
                console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', err);
                alert('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + err.message);
                return false;
            }
        }

        // –§–£–ù–ö–¶–ò–ò –í–•–û–î–ê (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï)
        function showLoginTab(tab) {
            document.querySelectorAll('.login-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('teacherLogin').style.display = tab === 'teacher' ? 'block' : 'none';
            document.getElementById('studentLogin').style.display = tab === 'student' ? 'block' : 'none';
        }

        async function loginTeacher() {
            const email = document.getElementById('teacherEmail').value;
            const password = document.getElementById('teacherPassword').value;
            
            if (!email || !password) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            console.log('üîê –ü—ã—Ç–∞—é—Å—å –≤–æ–π—Ç–∏ –∫–∞–∫ —É—á–∏—Ç–µ–ª—å:', email);
            
            try {
                const { data, error } = await supabase
                    .from('teacher')
                    .select('*')
                    .eq('email', email)
                    .eq('password', password)
                    .single();

                console.log('üì® –û—Ç–≤–µ—Ç –æ—Ç Supabase:', { data, error });

                if (error) {
                    if (error.code === 'PGRST116') {
                        alert('‚ùå –£—á–∏—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                    } else {
                        alert('‚ùå –û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
                    }
                    return;
                }

                if (!data) {
                    alert('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
                    return;
                }

                currentUser = data;
                console.log('‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ —É—á–∏—Ç–µ–ª—è:', currentUser);
                showMainApp('teacher');
                
            } catch (err) {
                console.error('üí• –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ:', err);
                alert('‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ: ' + err.message);
            }
        }

        async function loginStudent() {
            const username = document.getElementById('studentLoginInput').value;
            const password = document.getElementById('studentPassword').value;
            
            if (!username || !password) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            console.log('üîê –ü—ã—Ç–∞—é—Å—å –≤–æ–π—Ç–∏ –∫–∞–∫ —É—á–µ–Ω–∏–∫:', username);
            
            try {
                const { data, error } = await supabase
                    .from('students')
                    .select('*')
                    .eq('username', username)
                    .eq('password', password)
                    .single();

                console.log('üì® –û—Ç–≤–µ—Ç –æ—Ç Supabase:', { data, error });

                if (error) {
                    if (error.code === 'PGRST116') {
                        alert('‚ùå –£—á–µ–Ω–∏–∫ —Å —Ç–∞–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                    } else {
                        alert('‚ùå –û—à–∏–±–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
                    }
                    return;
                }

                if (!data) {
                    alert('‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
                    return;
                }

                currentUser = data;
                console.log('‚úÖ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ —É—á–µ–Ω–∏–∫–∞:', currentUser);
                showMainApp('student');
                
            } catch (err) {
                console.error('üí• –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ:', err);
                alert('‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ: ' + err.message);
            }
        }

        function showMainApp(role) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            if (role === 'teacher') {
                document.getElementById('teacherHeader').style.display = 'block';
                document.getElementById('studentHeader').style.display = 'none';
                document.getElementById('teacherNav').style.display = 'flex';
                document.getElementById('userName').textContent = currentUser.name;
                showSection('dashboard');
                loadTeacherData();
                alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
            } else {
                document.getElementById('teacherHeader').style.display = 'none';
                document.getElementById('studentHeader').style.display = 'block';
                document.getElementById('teacherNav').style.display = 'none';
                document.getElementById('studentNameDisplay').textContent = currentUser.name;
                document.getElementById('welcomeStudentName').textContent = currentUser.name;
                showStudentGrades();
                alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ —Å–æ–±—ã—Ç–∏–π
            loadSchedule();
            loadCalendarEvents();
            generateCalendar();
        }

        function logout() {
            currentUser = null;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            alert('üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!');
        }

        // –£–ß–ò–¢–ï–õ–¨–°–ö–ò–ï –§–£–ù–ö–¶–ò–ò
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(sectionName).classList.add('active');
            if (event) event.currentTarget.classList.add('active');
        }

        function showGradeType(type) {
            currentGradeType = type;
            document.querySelectorAll('.grade-type-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.grade-type-content').forEach(content => content.style.display = 'none');
            
            event.target.classList.add('active');
            document.getElementById(type + 'Grades').style.display = 'block';
            if (type === 'test') updateTestGradeDisplay();
        }

        async function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            const username = document.getElementById('studentUsername').value.trim();
            const password = document.getElementById('studentPasswordInput').value.trim();
            const email = document.getElementById('studentEmail').value.trim();
            const course = document.getElementById('studentCourse').value;

            if (!name || !username || !password) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('students')
                .insert([{
                    name: name,
                    username: username,
                    password: password,
                    email: email,
                    course: course,
                    join_date: new Date().toISOString().split('T')[0]
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('studentName').value = '';
            document.getElementById('studentUsername').value = '';
            document.getElementById('studentPasswordInput').value = '';
            document.getElementById('studentEmail').value = '';
            
            loadStudents();
            updateDashboard();
            loadGradeStudentSelect();
            
            alert(`‚úÖ –£—á–µ–Ω–∏–∫ ${name} –¥–æ–±–∞–≤–ª–µ–Ω!\n\nüìã –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:\nüë§ –õ–æ–≥–∏–Ω: ${username}\nüîë –ü–∞—Ä–æ–ª—å: ${password}`);
        }

        async function addGrade() {
            const studentId = parseInt(document.getElementById('gradeStudent').value);
            const assignment = document.getElementById('gradeAssignment').value.trim();
            
            let gradeValue;
            if (currentGradeType === 'regular') {
                gradeValue = document.getElementById('gradeValue').value;
            } else if (currentGradeType === 'test') {
                gradeValue = document.getElementById('testGradeValue').value;
            } else if (currentGradeType === 'homework') {
                gradeValue = document.getElementById('homeworkGradeValue').value;
            } else if (currentGradeType === 'activity') {
                gradeValue = document.getElementById('activityGradeValue').value;
            } else if (currentGradeType === 'project') {
                gradeValue = document.getElementById('projectGradeValue').value;
            } else if (currentGradeType === 'oral') {
                gradeValue = document.getElementById('oralGradeValue').value;
            } else if (currentGradeType === 'attendance') {
                gradeValue = document.getElementById('attendanceGradeValue').value;
            }

            if (!studentId || !gradeValue || !assignment) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('grades')
                .insert([{
                    student_id: studentId,
                    grade: parseInt(gradeValue),
                    assignment: assignment,
                    type: currentGradeType,
                    grade_date: new Date().toISOString().split('T')[0]
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            document.getElementById('gradeAssignment').value = '';
            document.getElementById('gradeComment').value = '';
            loadGradesHistory();
            updateDashboard();
            
            const student = await getStudentById(studentId);
            alert(`‚úÖ –û—Ü–µ–Ω–∫–∞ ${gradeValue}${currentGradeType === 'test' ? '/25' : ''} –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —É—á–µ–Ω–∏–∫—É ${student.name}!`);
        }

        async function loadTeacherData() {
            await loadStudents();
            await loadGradeStudentSelect();
            await loadGradesHistory();
            await updateDashboard();
        }

        async function loadStudents() {
            const { data: students, error } = await supabase
                .from('students')
                .select('*')
                .order('name');

            if (error) {
                console.error('Error loading students:', error);
                return;
            }

            const list = document.getElementById('studentsList');
            
            if (!students || students.length === 0) {
                list.innerHTML = '<div class="empty-state"><div>üë®‚Äçüéì</div><h3>–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</h3><p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞</p></div>';
                return;
            }

            list.innerHTML = '';
            for (let student of students) {
                const { data: grades } = await supabase
                    .from('grades')
                    .select('grade, type')
                    .eq('student_id', student.id);

                const avgGrade = grades && grades.length > 0 
                    ? (grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0) / grades.length).toFixed(1)
                    : '‚Äî';

                const recentGrades = grades ? grades.slice(-3) : [];

                list.innerHTML += `
                    <div class="card student-card">
                        <div class="student-info">
                            <h3>${student.name}</h3>
                            <div class="login-info">
                                <strong>–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:</strong><br>
                                üë§ –õ–æ–≥–∏–Ω: <strong>${student.username}</strong><br>
                                üîë –ü–∞—Ä–æ–ª—å: <strong>${student.password}</strong>
                            </div>
                            <p>üìß ${student.email || 'Email –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                            <p>üìö ${getCourseName(student.course)}</p>
                            <p>üìÖ –ó–∞—á–∏—Å–ª–µ–Ω: ${student.join_date}</p>
                        </div>
                        <div class="student-stats">
                            <div class="average-grade">${avgGrade}</div>
                            <div>${recentGrades.map(grade => 
                                grade.type === 'test' 
                                    ? `<span class="test-grade-display">${grade.grade}/25</span>`
                                    : `<span class="grade grade-${grade.grade}">${grade.grade}</span>`
                            ).join('')}</div>
                            <button class="btn btn-danger" onclick="deleteStudent(${student.id})" style="width: auto; padding: 8px 12px;">üóëÔ∏è</button>
                        </div>
                    </div>`;
            }
        }

        // –ü–û–ò–°–ö –£–ß–ï–ù–ò–ö–û–í
        function searchStudents() {
            const searchTerm = document.getElementById('searchStudent').value.toLowerCase();
            const studentCards = document.querySelectorAll('.student-card');
            
            studentCards.forEach(card => {
                const studentName = card.querySelector('h3').textContent.toLowerCase();
                if (studentName.includes(searchTerm)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        async function loadGradeStudentSelect() {
            const { data: students, error } = await supabase
                .from('students')
                .select('id, name, username')
                .order('name');

            if (error) return;

            const select = document.getElementById('gradeStudent');
            select.innerHTML = '';
            students.forEach(student => {
                select.innerHTML += `<option value="${student.id}">${student.name} (${student.username})</option>`;
            });
        }

        async function loadGradesHistory() {
            const { data: grades, error } = await supabase
                .from('grades')
                .select(`
                    *,
                    students (name)
                `)
                .order('created_at', { ascending: false })
                .limit(50);

            if (error) {
                console.error('Error loading grades:', error);
                return;
            }

            const history = document.getElementById('gradesHistory');
            
            if (!grades || grades.length === 0) {
                history.innerHTML = '<div class="empty-state"><div>üìù</div><p>–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</p></div>';
                return;
            }

            history.innerHTML = '';
            grades.forEach(grade => {
                const typeLabel = gradeTypes[grade.type]?.name || grade.type;
                const gradeDisplay = grade.type === 'test' 
                    ? `<span class="test-grade-display">${grade.grade}/25</span>` 
                    : `<span class="grade grade-${grade.grade}">${grade.grade}</span>`;
                
                history.innerHTML += `
                    <div style="padding: 12px; border-bottom: 1px solid #e2e8f0; display: flex; align-items: center; gap: 10px;">
                        ${gradeDisplay}
                        <div style="flex: 1;">
                            <strong>${grade.students.name}</strong><br>
                            <small style="color: var(--gray);">${typeLabel} ‚Ä¢ ${grade.assignment} ‚Ä¢ ${grade.grade_date}</small>
                        </div>
                    </div>`;
            });
        }

        async function updateDashboard() {
            const { data: students } = await supabase.from('students').select('id');
            const { data: grades } = await supabase.from('grades').select('grade, type');

            document.getElementById('totalStudents').textContent = students ? students.length : 0;
            
            const totalGrades = grades ? grades.length : 0;
            const totalGradeSum = grades ? grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0) : 0;
            const average = totalGrades > 0 ? (totalGradeSum / totalGrades).toFixed(1) : '0.0';
            
            document.getElementById('averageGrade').textContent = average;
            document.getElementById('totalGrades').textContent = totalGrades;
            
            await updateRecentGrades();
            await updateGradeTypesStats();
        }

        async function updateRecentGrades() {
            const { data: grades, error } = await supabase
                .from('grades')
                .select(`
                    *,
                    students (name)
                `)
                .order('created_at', { ascending: false })
                .limit(5);

            if (error) return;

            const recent = document.getElementById('recentGrades');
            
            if (!grades || grades.length === 0) {
                recent.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 20px;">–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫</p>';
                return;
            }
            
            recent.innerHTML = '';
            grades.forEach(grade => {
                const gradeDisplay = grade.type === 'test' 
                    ? `<span class="test-grade-display">${grade.grade}/25</span>` 
                    : `<span class="grade grade-${grade.grade}">${grade.grade}</span>`;
                
                recent.innerHTML += `
                    <div style="display: flex; align-items: center; gap: 12px; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        ${gradeDisplay}
                        <div style="flex: 1;">
                            <strong>${grade.students.name}</strong>
                            <div style="color: var(--gray); font-size: 0.8em;">${grade.assignment}</div>
                        </div>
                        <small style="color: var(--gray); font-size: 0.8em;">${grade.grade_date}</small>
                    </div>`;
            });
        }

        async function updateGradeTypesStats() {
            const { data: grades, error } = await supabase.from('grades').select('type');
            
            if (error || !grades) return;

            const typeCounts = {};
            grades.forEach(grade => {
                typeCounts[grade.type] = (typeCounts[grade.type] || 0) + 1;
            });

            const stats = document.getElementById('gradeTypesStats');
            stats.innerHTML = '';
            
            Object.entries(typeCounts).forEach(([type, count]) => {
                const typeInfo = gradeTypes[type] || { name: type, color: '#6b7280' };
                stats.innerHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        <span>${typeInfo.name}</span>
                        <span style="font-weight: bold; color: var(--primary);">${count}</span>
                    </div>
                `;
            });
        }

        // –§–£–ù–ö–¶–ò–ò –£–î–ê–õ–ï–ù–ò–Ø –£–ß–ï–ù–ò–ö–ê
        async function deleteStudent(studentId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —É—á–µ–Ω–∏–∫–∞? –í—Å–µ –µ–≥–æ –æ—Ü–µ–Ω–∫–∏ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) return;

            try {
                // –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª—è–µ–º –æ—Ü–µ–Ω–∫–∏ —É—á–µ–Ω–∏–∫–∞
                const { error: gradesError } = await supabase
                    .from('grades')
                    .delete()
                    .eq('student_id', studentId);

                if (gradesError) {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ü–µ–Ω–æ–∫: ' + gradesError.message);
                    return;
                }

                // –ó–∞—Ç–µ–º —É–¥–∞–ª—è–µ–º —É—á–µ–Ω–∏–∫–∞
                const { error: studentError } = await supabase
                    .from('students')
                    .delete()
                    .eq('id', studentId);

                if (studentError) {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—á–µ–Ω–∏–∫–∞: ' + studentError.message);
                    return;
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                loadStudents();
                loadGradeStudentSelect();
                updateDashboard();
                alert('üóëÔ∏è –£—á–µ–Ω–∏–∫ —É–¥–∞–ª–µ–Ω');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + err.message);
            }
        }

        // –§–£–ù–ö–¶–ò–ò –£–ß–ï–ù–ò–ö–ê
        async function showStudentGrades() {
            const { data: grades, error } = await supabase
                .from('grades')
                .select('*')
                .eq('student_id', currentUser.id)
                .order('created_at', { ascending: false });

            if (error) {
                console.error('Error loading student grades:', error);
                return;
            }

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª —Å —É—á–µ—Ç–æ–º —Ç–µ—Å—Ç–æ–≤ (—Ç–µ—Å—Ç—ã –¥–µ–ª–∏–º –Ω–∞ 2.5 –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –∫ 10-–±–∞–ª–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ)
            let avgGrade = '0.0';
            if (grades && grades.length > 0) {
                const total = grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0);
                avgGrade = (total / grades.length).toFixed(1);
            }
            
            document.getElementById('studentAverageGrade').textContent = avgGrade;
            document.getElementById('studentCourseDisplay').textContent = getCourseName(currentUser.course);
            document.getElementById('studentJoinDate').textContent = currentUser.join_date;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–∏–ø–∞–º –æ—Ü–µ–Ω–æ–∫ –¥–ª—è —É—á–µ–Ω–∏–∫–∞
            await updateStudentGradeStats(grades);
            
            const gradesList = document.getElementById('studentGradesList');
            if (!grades || grades.length === 0) {
                gradesList.innerHTML = '<div class="empty-state"><div>üìù</div><p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫</p></div>';
                return;
            }
            
            gradesList.innerHTML = '';
            grades.forEach(grade => {
                const typeLabel = gradeTypes[grade.type]?.name || grade.type;
                const percentage = grade.type === 'test' ? Math.round((grade.grade / 25) * 100) : null;
                
                gradesList.innerHTML += `
                    <div class="grade-item">
                        <div style="flex: 1;">
                            <strong>${grade.assignment}</strong>
                            <div style="color: var(--gray); font-size: 0.9em;">${typeLabel} ‚Ä¢ ${grade.grade_date}</div>
                            ${grade.type === 'test' ? `
                                <div class="test-grade-progress">
                                    <div class="test-grade-progress-bar" style="width: ${percentage}%"></div>
                                </div>
                                <div class="test-grade-info">${percentage}% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (${grade.grade}/25 –±–∞–ª–ª–æ–≤)</div>
                            ` : ''}
                        </div>
                        ${grade.type === 'test' 
                            ? `<span class="test-grade-display">${grade.grade}/25</span>`
                            : `<span class="grade grade-${grade.grade}">${grade.grade}</span>`
                        }
                    </div>
                `;
            });
            
            showSection('studentGrades');
        }

        async function updateStudentGradeStats(grades) {
            if (!grades) return;
            
            const typeCounts = {};
            const typeSums = {};
            
            grades.forEach(grade => {
                typeCounts[grade.type] = (typeCounts[grade.type] || 0) + 1;
                typeSums[grade.type] = (typeSums[grade.type] || 0) + grade.grade;
            });

            const stats = document.getElementById('studentGradeStats');
            stats.innerHTML = '';
            
            Object.entries(typeCounts).forEach(([type, count]) => {
                const typeInfo = gradeTypes[type] || { name: type, color: '#6b7280' };
                const average = (typeSums[type] / count).toFixed(1);
                
                stats.innerHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        <span>${typeInfo.name}</span>
                        <div>
                            <span style="font-weight: bold; color: var(--primary);">${average}</span>
                            <small style="color: var(--gray); margin-left: 10px;">${count} –æ—Ü–µ–Ω.</small>
                        </div>
                    </div>
                `;
            });
        }

        // –§–£–ù–ö–¶–ò–ò –ö–ê–õ–ï–ù–î–ê–†–Ø
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const currentMonth = document.getElementById('currentMonth');
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –º–µ—Å—è—Ü–∞
            const monthNames = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];
            currentMonth.textContent = `${monthNames[month]} ${year}`;
            
            // –û—á–∏—Å—Ç–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
            calendarGrid.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–Ω–µ–π –Ω–µ–¥–µ–ª–∏
            const days = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            days.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.style.fontWeight = 'bold';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            });
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è –º–µ—Å—è—Ü–∞
            const firstDay = new Date(year, month, 1);
            const startingDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫ –¥–ª—è –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—Ü–∞
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                emptyDay.style.visibility = 'hidden';
                calendarGrid.appendChild(emptyDay);
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–Ω–µ–π –º–µ—Å—è—Ü–∞
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å
                if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ
                const dayOfWeek = new Date(year, month, day).getDay();
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    dayElement.classList.add('weekend');
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar();
            loadCalendarEvents();
        }

        // –§–£–ù–ö–¶–ò–ò –†–ê–°–ü–ò–°–ê–ù–ò–Ø
        async function addScheduleItem() {
            const subject = document.getElementById('scheduleSubject').value;
            const teacher = document.getElementById('scheduleTeacher').value;
            const date = document.getElementById('scheduleDate').value;
            const startTime = document.getElementById('scheduleStartTime').value;
            const endTime = document.getElementById('scheduleEndTime').value;
            const description = document.getElementById('scheduleDescription').value;

            if (!subject || !teacher || !date || !startTime || !endTime) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('schedule')
                .insert([{
                    subject: subject,
                    teacher: teacher,
                    date: date,
                    start_time: startTime,
                    end_time: endTime,
                    description: description,
                    created_at: new Date().toISOString()
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('scheduleSubject').value = '';
            document.getElementById('scheduleTeacher').value = '';
            document.getElementById('scheduleDate').value = '';
            document.getElementById('scheduleStartTime').value = '';
            document.getElementById('scheduleEndTime').value = '';
            document.getElementById('scheduleDescription').value = '';

            loadSchedule();
            alert('‚úÖ –ó–∞–Ω—è—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ!');
        }

        async function loadSchedule() {
            const { data: schedule, error } = await supabase
                .from('schedule')
                .select('*')
                .order('date', { ascending: true })
                .order('start_time', { ascending: true });

            if (error) {
                console.error('Error loading schedule:', error);
                return;
            }

            const scheduleList = document.getElementById('scheduleList');
            const upcomingLessons = document.getElementById('upcomingLessons');
            const studentTodaySchedule = document.getElementById('studentTodaySchedule');
            
            if (!schedule || schedule.length === 0) {
                scheduleList.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏</p></div>';
                upcomingLessons.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–Ω—è—Ç–∏–π</p></div>';
                if (studentTodaySchedule) {
                    studentTodaySchedule.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç</p></div>';
                }
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const upcoming = schedule.filter(item => item.date >= today).slice(0, 5);
            const todayLessons = schedule.filter(item => item.date === today);

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–Ω—è—Ç–∏–π
            scheduleList.innerHTML = '';
            schedule.forEach(item => {
                scheduleList.innerHTML += `
                    <div class="schedule-item">
                        <div class="schedule-time">${formatTime(item.start_time)} - ${formatTime(item.end_time)}</div>
                        <div class="schedule-subject">${item.subject}</div>
                        <div class="schedule-teacher">üë®‚Äçüè´ ${item.teacher}</div>
                        <div style="color: var(--gray); font-size: 0.8em;">üìÖ ${formatDate(item.date)}</div>
                        ${item.description ? `<div style="color: var(--gray); font-size: 0.9em; margin-top: 5px;">${item.description}</div>` : ''}
                    </div>
                `;
            });

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–Ω—è—Ç–∏–π
            upcomingLessons.innerHTML = '';
            upcoming.forEach(item => {
                upcomingLessons.innerHTML += `
                    <div class="schedule-item">
                        <div class="schedule-time">${formatTime(item.start_time)} - ${formatTime(item.end_time)}</div>
                        <div class="schedule-subject">${item.subject}</div>
                        <div class="schedule-teacher">üë®‚Äçüè´ ${item.teacher}</div>
                        <div style="color: var(--gray); font-size: 0.8em;">üìÖ ${formatDate(item.date)}</div>
                    </div>
                `;
            });

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –¥–ª—è —É—á–µ–Ω–∏–∫–∞
            if (currentUser && currentUser.role === 'student' && studentTodaySchedule) {
                studentTodaySchedule.innerHTML = '';
                if (todayLessons.length === 0) {
                    studentTodaySchedule.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç</p></div>';
                } else {
                    todayLessons.forEach(item => {
                        studentTodaySchedule.innerHTML += `
                            <div class="schedule-item">
                                <div class="schedule-time">${formatTime(item.start_time)} - ${formatTime(item.end_time)}</div>
                                <div class="schedule-subject">${item.subject}</div>
                                <div class="schedule-teacher">üë®‚Äçüè´ ${item.teacher}</div>
                                ${item.description ? `<div style="color: var(--gray); font-size: 0.9em; margin-top: 5px;">${item.description}</div>` : ''}
                            </div>
                        `;
                    });
                }
            }
        }

        // –§–£–ù–ö–¶–ò–ò –°–û–ë–´–¢–ò–ô –ö–ê–õ–ï–ù–î–ê–†–Ø
        async function addCalendarEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value;
            const type = document.getElementById('eventType').value;

            if (!title || !date) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('calendar_events')
                .insert([{
                    title: title,
                    date: date,
                    time: time,
                    description: description,
                    type: type,
                    created_at: new Date().toISOString()
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';

            loadCalendarEvents();
            alert('‚úÖ –°–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å!');
        }

        async function loadCalendarEvents() {
            const { data: events, error } = await supabase
                .from('calendar_events')
                .select('*')
                .order('date', { ascending: true })
                .order('time', { ascending: true });

            if (error) {
                console.error('Error loading events:', error);
                return;
            }

            const calendarEventsList = document.getElementById('calendarEventsList');
            const upcomingEvents = document.getElementById('upcomingEvents');
            const studentUpcomingEvents = document.getElementById('studentUpcomingEvents');
            
            if (!events || events.length === 0) {
                calendarEventsList.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ</p></div>';
                upcomingEvents.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                if (studentUpcomingEvents) {
                    studentUpcomingEvents.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                }
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const upcoming = events.filter(event => event.date >= today).slice(0, 5);

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π
            calendarEventsList.innerHTML = '';
            events.forEach(event => {
                const eventTypes = {
                    'lesson': 'üìö',
                    'test': 'üéì', 
                    'meeting': 'üë•',
                    'holiday': 'üéâ',
                    'deadline': '‚è∞'
                };
                
                calendarEventsList.innerHTML += `
                    <div class="notification ${event.date === today ? 'upcoming' : ''}">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2em;">${eventTypes[event.type]}</span>
                            <div style="flex: 1;">
                                <strong>${event.title}</strong>
                                <div style="color: var(--gray); font-size: 0.9em;">
                                    üìÖ ${formatDate(event.date)}${event.time ? ` ‚è∞ ${event.time}` : ''}
                                </div>
                                ${event.description ? `<div style="margin-top: 5px;">${event.description}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π
            upcomingEvents.innerHTML = '';
            upcoming.forEach(event => {
                const eventTypes = {
                    'lesson': 'üìö',
                    'test': 'üéì',
                    'meeting': 'üë•', 
                    'holiday': 'üéâ',
                    'deadline': '‚è∞'
                };
                
                upcomingEvents.innerHTML += `
                    <div class="notification upcoming">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2em;">${eventTypes[event.type]}</span>
                            <div style="flex: 1;">
                                <strong>${event.title}</strong>
                                <div style="color: var(--gray); font-size: 0.9em;">
                                    üìÖ ${formatDate(event.date)}${event.time ? ` ‚è∞ ${event.time}` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —É—á–µ–Ω–∏–∫–∞
            if (currentUser && currentUser.role === 'student' && studentUpcomingEvents) {
                studentUpcomingEvents.innerHTML = '';
                if (upcoming.length === 0) {
                    studentUpcomingEvents.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                } else {
                    upcoming.forEach(event => {
                        studentUpcomingEvents.innerHTML += `
                            <div class="notification upcoming">
                                <strong>${eventTypes[event.type]} ${event.title}</strong>
                                <div style="color: var(--gray); font-size: 0.9em;">
                                    üìÖ ${formatDate(event.date)}${event.time ? ` ‚è∞ ${event.time}` : ''}
                                </div>
                            </div>
                        `;
                    });
                }
            }
        }

        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function getCourseName(course) {
            return course === 'basic' ? '–ù–∞—á–∞–ª—å–Ω—ã–π –∞–Ω–≥–ª–∏–π—Å–∫–∏–π' : '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–Ω–≥–ª–∏–π—Å–∫–∏–π';
        }

        async function getStudentById(studentId) {
            const { data, error } = await supabase
                .from('students')
                .select('*')
                .eq('id', studentId)
                .single();

            return data;
        }

        function formatTime(timeString) {
            if (!timeString) return '';
            return timeString.substring(0, 5);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        window.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ PrimeSpeak Academy –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            loadSavedLogins();
            generateCalendar();
            updateTestGradeDisplay();
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ö –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('scheduleDate')) {
                document.getElementById('scheduleDate').value = today;
            }
            if (document.getElementById('eventDate')) {
                document.getElementById('eventDate').value = today;
            }
        });

    </script>
</body>
    </html>
