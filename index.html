<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Kometa.space | –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω –∏–≥—Ä–æ–≤—ã—Ö –∫–ª—é—á–µ–π</title>
    <style>
        :root{
            --primary:#dc2626;--primary-dark:#b91c1c;--secondary:#16a34a;--danger:#dc2626;
            --warning:#f59e0b;--dark:#0c0a09;--dark-light:#1c1917;--light:#fafaf9;--border:#44403c;--success:#22c55e;
            --xmas-red:#dc2626;--xmas-green:#16a34a;--xmas-gold:#fbbf24;
        }
        *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Arial,Helvetica,sans-serif}
        body{background:linear-gradient(135deg,#0c0a09 0%,#1c1917 100%);color:var(--light);min-height:100vh;padding-bottom:60px;position:relative;overflow-x:hidden}
        body::before{content:'';position:fixed;top:0;left:0;right:0;bottom:0;background-image:url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="none"/><path d="M20,20 Q50,5 80,20 T100,50 T80,80 T50,95 T20,80 T0,50 T20,20Z" fill="%2316a34a" opacity="0.03"/></svg>');background-size:200px;z-index:-1;opacity:0.3}
        .container{max-width:1200px;margin:0 auto;padding:0 16px}
        .header{background:rgba(12,10,9,0.95);padding:12px 0;border-bottom:2px solid var(--xmas-red);position:sticky;top:0;z-index:1000;backdrop-filter:blur(10px)}
        .header-content{display:flex;align-items:center;justify-content:space-between}
        .logo{display:flex;gap:10px;align-items:center;font-weight:900;font-size:20px;background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .nav{display:flex;gap:12px;align-items:center}
        .nav-link{color:#d6d3d1;text-decoration:none;padding:8px 14px;border-radius:8px;transition:all 0.3s;position:relative}
        .nav-link.active,.nav-link:hover{background:rgba(220,38,38,0.15);color:#fff;transform:translateY(-2px)}
        .nav-link.active::after{content:'üéÑ';position:absolute;right:-8px;top:-8px;font-size:12px}
        .user-menu{display:flex;align-items:center;gap:12px}
        .user-avatar{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));font-weight:900;cursor:pointer;border:2px solid var(--xmas-gold)}
        .balance{background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));padding:8px 16px;border-radius:10px;font-weight:900;color:white;box-shadow:0 4px 12px rgba(220,38,38,0.3)}
        .hero{text-align:center;padding:60px 0;margin:20px 0}
        .btn{padding:12px 24px;border-radius:10px;border:0;cursor:pointer;font-weight:700;transition:all 0.3s;position:relative;overflow:hidden}
        .btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:0.5s}
        .btn:hover::before{left:100%}
        .btn-primary{background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));color:#fff;box-shadow:0 6px 20px rgba(220,38,38,0.4)}
        .btn-primary:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(220,38,38,0.5)}
        .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);align-items:center;justify-content:center;z-index:1001}
        .modal.active{display:flex}
        .modal-content{background:var(--dark-light);width:92%;max-width:500px;border-radius:16px;border:2px solid var(--xmas-red);box-shadow:0 20px 60px rgba(0,0,0,0.5)}
        .modal-header{padding:20px;border-bottom:2px solid var(--border);display:flex;justify-content:space-between;align-items:center;background:linear-gradient(90deg,var(--dark-light),rgba(220,38,38,0.1))}
        .modal-body{padding:20px}
        .form-group{margin-bottom:16px}
        .form-group label{display:block;color:#d6d3d1;margin-bottom:8px;font-weight:600}
        .form-group input, .form-group select, .form-group textarea{width:100%;padding:12px;border-radius:10px;border:2px solid var(--border);background:rgba(255,255,255,0.05);color:#fff;transition:all 0.3s}
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus{outline:none;border-color:var(--xmas-red);box-shadow:0 0 0 3px rgba(220,38,38,0.2)}
        .tabs{display:flex;gap:8px;margin-bottom:16px;background:rgba(255,255,255,0.05);padding:4px;border-radius:10px}
        .tab{padding:10px 16px;border-radius:8px;border:0;background:transparent;color:#a8a29e;cursor:pointer;flex:1;transition:all 0.3s}
        .tab.active{color:#fff;background:var(--xmas-red);box-shadow:0 4px 12px rgba(220,38,38,0.3)}
        .card{background:rgba(255,255,255,0.05);padding:20px;border-radius:16px;border:1px solid var(--border);transition:all 0.3s;position:relative}
        .card:hover{border-color:var(--xmas-red);transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,0.3)}
        .grid{display:grid;gap:20px}
        .grid.cols-3{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}
        .game-icon{font-size:48px;margin-bottom:12px;text-align:center;width:80px;height:80px;border-radius:20px;display:flex;align-items:center;justify-content:center;margin:0 auto 16px;background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));border:3px solid var(--xmas-gold)}
        .notification{position:fixed;top:20px;right:20px;padding:16px 20px;border-radius:12px;background:var(--dark-light);border-left:6px solid var(--primary);z-index:1002;box-shadow:0 10px 30px rgba(0,0,0,0.3);animation:slideIn 0.3s ease}
        @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
        footer{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(90deg,var(--xmas-red),var(--xmas-gold));padding:12px 0;color:white;z-index:999}
        footer .menu{display:flex;justify-content:space-around;max-width:900px;margin:0 auto}
        footer .menu a{display:flex;flex-direction:column;align-items:center;text-decoration:none;color:white;font-size:12px;transition:all 0.3s;padding:8px}
        footer .menu a:hover{transform:translateY(-3px)}
        footer .menu a span:first-child{font-size:20px;margin-bottom:4px}
        .price{color:var(--xmas-gold);font-weight:900;font-size:24px;text-shadow:0 2px 4px rgba(0,0,0,0.3)}
        .variant-btn{padding:10px 16px;border-radius:10px;background:rgba(255,255,255,0.05);border:2px solid transparent;cursor:pointer;color:#a8a29e;margin:0 8px 8px 0;transition:all 0.3s}
        .variant-btn.active{border-color:var(--xmas-red);color:#fff;background:rgba(220,38,38,0.15);box-shadow:0 4px 12px rgba(220,38,38,0.3)}
        pre.key{background:rgba(0,0,0,0.4);padding:12px;border-radius:8px;font-family:'Courier New',monospace;border:2px dashed var(--xmas-gold);font-size:14px;color:var(--xmas-gold)}
        .small-muted{color:#a8a29e;font-size:14px}
        .deposit-status{display:inline-block;padding:6px 12px;border-radius:8px;font-size:12px;font-weight:700}
        .status-pending{background:rgba(245,158,11,0.2);color:#f59e0b;border:1px solid rgba(245,158,11,0.3)}
        .status-approved{background:rgba(34,197,94,0.2);color:#22c55e;border:1px solid rgba(34,197,94,0.3)}
        .status-rejected{background:rgba(220,38,38,0.2);color:#dc2626;border:1px solid rgba(220,38,38,0.3)}
        .file-link{display:inline-block;margin:6px;padding:10px 16px;background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));border-radius:8px;color:white;text-decoration:none;transition:all 0.3s;border:2px solid transparent}
        .file-link:hover{transform:translateY(-3px);box-shadow:0 6px 20px rgba(220,38,38,0.4);border-color:var(--xmas-gold)}
        .game-image{width:100%;height:200px;object-fit:cover;border-radius:12px;margin-bottom:16px;border:3px solid var(--xmas-gold)}
        .xmas-decoration{position:absolute;font-size:24px;animation:float 3s ease-in-out infinite}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
        @media (min-width:900px){ .grid.cols-3{grid-template-columns:repeat(4,1fr)} }
    </style>
</head>
<body>
    <!-- –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ —É–∫—Ä–∞—à–µ–Ω–∏—è -->
    <div class="xmas-decoration" style="top:100px;left:5%;">üéÅ</div>
    <div class="xmas-decoration" style="top:200px;right:5%;">üåü</div>
    <div class="xmas-decoration" style="top:300px;left:10%;">‚ùÑÔ∏è</div>
    <div class="xmas-decoration" style="top:400px;right:10%;">üéÑ</div>
    <div class="xmas-decoration" style="top:500px;left:15%;">‚ú®</div>

    <header class="header">
        <div class="container">
            <div class="header-content">
                <div style="display:flex;align-items:center;gap:15px">
                    <div class="logo">üéÑ KOMET.SPACE üéÅ</div>
                    <div class="small-muted" style="font-size:12px;background:rgba(220,38,38,0.2);padding:4px 8px;border-radius:6px">–ù–û–í–û–ì–û–î–ù–Ø–Ø –†–ê–°–ü–†–û–î–ê–ñ–ê</div>
                </div>

                <nav class="nav" id="mainNav">
                    <!-- nav will be rendered by JS -->
                </nav>

                <div class="user-menu" id="userMenu">
                    <!-- rendered by JS -->
                </div>
            </div>
        </div>
    </header>

    <main class="container" id="mainContent">
        <!-- main content rendered by JS -->
    </main>

    <!-- Auth modal -->
    <div class="modal" id="authModal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent">üéÖ –í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                <button onclick="closeModal('authModal')" style="background:none;border:0;color:#a8a29e;font-size:24px;cursor:pointer">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <button class="tab active" data-tab="login" onclick="switchTab('login')">–í–æ–π—Ç–∏</button>
                    <button class="tab" data-tab="register" onclick="switchTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </div>

                <div id="loginTab">
                    <div class="form-group">
                        <label>üéØ Email</label>
                        <input type="email" id="loginEmail" placeholder="–í–∞—à email">
                    </div>
                    <div class="form-group">
                        <label>üîí –ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="loginPassword" placeholder="–ü–∞—Ä–æ–ª—å">
                    </div>
                    <button class="btn btn-primary" style="width:100%" onclick="login()">–í–æ–π—Ç–∏ –≤ –ø—Ä–∞–∑–¥–Ω–∏–∫ üéÑ</button>
                </div>

                <div id="registerTab" style="display:none">
                    <div class="form-group">
                        <label>üìß Email</label>
                        <input type="email" id="registerEmail" placeholder="example@gmail.com">
                    </div>
                    <div class="form-group">
                        <label>üë§ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
                        <input type="text" id="registerUsername" placeholder="username">
                    </div>
                    <div class="form-group">
                        <label>üîí –ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="registerPassword" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
                    </div>
                    <button class="btn btn-primary" style="width:100%" onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è üéÅ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Deposit modal -->
    <div class="modal" id="depositModal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent">üí∞ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h3>
                <button onclick="closeModal('depositModal')" style="background:none;border:0;color:#a8a29e;font-size:24px;cursor:pointer">&times;</button>
            </div>
            <div class="modal-body">
                <div class="card" style="margin-bottom:16px;border:2px solid var(--xmas-gold)">
                    <strong style="color:var(--xmas-gold)">üéÑ –†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã:</strong>
                    <div class="small-muted" style="margin-top:12px"><strong>üéÖ –¢-–ë–∞–Ω–∫ (–°–ü–ë)</strong></div>
                    <div class="small-muted">üì± –ù–æ–º–µ—Ä: <strong>+7 (917) 863-04-11</strong></div>
                    <div class="small-muted" style="margin-top:12px"><strong>üí≥ –¢–∏–Ω—å–∫–æ—Ñ—Ñ</strong></div>
                    <div class="small-muted">üí≥ –ö–∞—Ä—Ç–∞: <strong>2200 7010 2813 9613</strong></div>
                </div>
                <div class="form-group">
                    <label>üíé –°—É–º–º–∞ (‚ÇΩ)</label>
                    <input type="number" id="depositAmount" value="1000" min="100">
                </div>
                <div class="form-group">
                    <label>üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–ª–∞—Ç–µ–∂—É (—É–∫–∞–∂–∏—Ç–µ –≤–∞—à email)</label>
                    <input type="text" id="depositComment" placeholder="test@mail.com" value="${currentUser ? currentUser.email : ''}">
                </div>
                <button class="btn btn-primary" style="width:100%" onclick="submitDeposit()">üéÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</button>
            </div>
        </div>
    </div>

    <!-- File upload modal for admin -->
    <div class="modal" id="fileUploadModal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent">üìÅ –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã –∫ —á–∏—Ç—É</h3>
                <button onclick="closeModal('fileUploadModal')" style="background:none;border:0;color:#a8a29e;font-size:24px;cursor:pointer">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>üìÑ –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞</label>
                    <input type="text" id="fileName" placeholder="–ß–∏—Ç.apk">
                </div>
                <div class="form-group">
                    <label>üîó –°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª</label>
                    <input type="text" id="fileUrl" placeholder="https://example.com/—Ñ–∞–π–ª.apk">
                </div>
                <div class="form-group">
                    <label>üìÇ –¢–∏–ø —Ñ–∞–π–ª–∞</label>
                    <select id="fileType">
                        <option value="apk">üì± APK</option>
                        <option value="zip">üì¶ ZIP</option>
                        <option value="exe">üíª EXE</option>
                        <option value="rar">üìÅ RAR</option>
                        <option value="other">üìé –î—Ä—É–≥–æ–π</option>
                    </select>
                </div>
                <button class="btn btn-primary" style="width:100%" onclick="addFileToCheat()">üéÅ –î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª</button>
            </div>
        </div>
    </div>

    <!-- Image upload modal for admin -->
    <div class="modal" id="imageUploadModal" aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent">üñºÔ∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</h3>
                <button onclick="closeModal('imageUploadModal')" style="background:none;border:0;color:#a8a29e;font-size:24px;cursor:pointer">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>üìù –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                    <input type="text" id="imageDescription" placeholder="–û–±–ª–æ–∂–∫–∞ –∏–≥—Ä—ã">
                </div>
                <div class="form-group">
                    <label>üîó –°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                    <input type="text" id="imageUrl" placeholder="https://example.com/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.jpg">
                </div>
                <div class="form-group">
                    <label>üéØ –¢–∏–ø –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</label>
                    <select id="imageType">
                        <option value="game">üéÆ –î–ª—è –∏–≥—Ä—ã</option>
                        <option value="cheat">‚ö° –î–ª—è —á–∏—Ç–∞</option>
                    </select>
                </div>
                <button class="btn btn-primary" style="width:100%" onclick="addImage()">üñºÔ∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
            </div>
        </div>
    </div>

    <div id="notifications"></div>

    <footer>
        <div class="menu container">
            <a href="#" onclick="showPage('home')"><span>üè†</span><span>–ì–ª–∞–≤–Ω–∞—è</span></a>
            <a href="#" onclick="showPage('catalog')"><span>üîç</span><span>–ö–∞—Ç–∞–ª–æ–≥</span></a>
            <a href="#" onclick="showPage('keys')"><span>üîë</span><span>–ö–ª—é—á–∏</span></a>
            <a href="#" onclick="showPage('profile')"><span>üë§</span><span>–ü—Ä–æ—Ñ–∏–ª—å</span></a>
            <a href="#" onclick="showPage('about')"><span>üåü</span><span>–ö–æ–º–µ—Ç–∞</span></a>
        </div>
    </footer>

<script>
/* ------------ state ------------ */
let currentUser = null;
let currentPage = 'home';
let games = [];          // {id,name,icon,description,images:[],cheats:[{id,name,version,images:[],variants:[{label,price}],files:[]}]}
let purchases = [];      // saved purchases
let depositRequests = []; // –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
let currentCheatForFiles = null; // —Ç–µ–∫—É—â–∏–π —á–∏—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
let currentGameForImage = null; // —Ç–µ–∫—É—â–∞—è –∏–≥—Ä–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
let currentCheatForImage = null; // —Ç–µ–∫—É—â–∏–π —á–∏—Ç –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
/* ------------ init ------------ */
document.addEventListener('DOMContentLoaded',()=>{
    loadFromStorage();
    createTestAdminAndSample();
    renderNav();
    updateUserMenu();
    showPage('home');
});

/* ---------- storage helpers ---------- */
function loadFromStorage(){
    const g = localStorage.getItem('kometa_games');
    const p = localStorage.getItem('kometa_purchases');
    const u = localStorage.getItem('kometa_user');
    const d = localStorage.getItem('kometa_deposit_requests');
    const savedGames = g ? JSON.parse(g) : null;
    const savedPurchases = p ? JSON.parse(p) : [];
    const savedUser = u ? JSON.parse(u) : null;
    const savedDeposits = d ? JSON.parse(d) : [];
    games = savedGames || [
        // default sample if nothing saved (kept small)
    ];
    purchases = savedPurchases;
    currentUser = savedUser;
    depositRequests = savedDeposits;
}

function saveGames(){ localStorage.setItem('kometa_games', JSON.stringify(games)); }
function savePurchases(){ localStorage.setItem('kometa_purchases', JSON.stringify(purchases)); }
function saveDepositRequests(){ localStorage.setItem('kometa_deposit_requests', JSON.stringify(depositRequests)); }
function saveCurrentUserInUsersList(){ // also update kometa_users balances
    if(!currentUser) return;
    let users = JSON.parse(localStorage.getItem('kometa_users')||'[]');
    const idx = users.findIndex(u=>u.id===currentUser.id);
    if(idx!==-1){ users[idx].balance = currentUser.balance; localStorage.setItem('kometa_users', JSON.stringify(users)); }
    localStorage.setItem('kometa_user', JSON.stringify(currentUser));
}

/* ---------- create test admin + sample data ---------- */
function createTestAdminAndSample(){
    // create admin/users if missing (from original)
    let users = JSON.parse(localStorage.getItem('kometa_users') || '[]');
    const adminExists = users.some(u => u.email === 'nurislamovradmir9@gmail.com');
    if(!adminExists){
        users.push({id:1,email:'nurislamovradmir9@gmail.com',username:'Admin',password:'makson555777',balance:0,isAdmin:true});
    }
    // –ù–µ —Å–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –ø—É—Å—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è —Å–∞–º–∏
    localStorage.setItem('kometa_users', JSON.stringify(users));

    // sample games & cheats (only create when none exist)
    if(!localStorage.getItem('kometa_games')){
        games = [
            {id:1,name:'Standoff 2',icon:'üõ°Ô∏è',description:'–®—É—Ç–µ—Ä –æ–Ω–ª–∞–π–Ω',images:[
                {url:'https://images.unsplash.com/photo-1534423861386-85a16f5d13fd?w=400&h=200&fit=crop',description:'–û–±–ª–æ–∂–∫–∞ Standoff 2'}
            ],cheats:[
                {id:1,name:'Plutonium',version:'0.36.1',images:[
                    {url:'https://images.unsplash.com/photo-1511512578047-dfb367046420?w-400&h=200&fit=crop',description:'–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∏—Ç–∞'}
                ],variants:[
                    {label:'7 –¥–Ω–µ–π',price:99},{label:'30 –¥–Ω–µ–π',price:249},{label:'–ù–∞–≤—Å–µ–≥–¥–∞',price:99500}
                ], files: [
                    {name: '–ß–∏—Ç-–º–æ–¥.apk', url: 'https://example.com/—á–∏—Ç.apk', type: 'apk'},
                    {name: '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è.zip', url: 'https://example.com/–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è.zip', type: 'zip'}
                ]}
            ]},
            {id:2,name:'PUBG Mobile',icon:'üî´',description:'–ú–æ–±–∏–ª—å–Ω—ã–π –∫–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è –±–∏—Ç–≤–∞',images:[],cheats:[]},
            {id:3,name:'Roblox',icon:'üß©',description:'–ü–µ—Å–æ—á–Ω–∏—Ü–∞',images:[],cheats:[]}
        ];
        saveGames();
    } else {
        // keep loaded games
    }
}

/* ---------- rendering: nav & user menu ---------- */
function renderNav(){
    const nav = document.getElementById('mainNav');
    nav.innerHTML = `
        <a href="#" class="nav-link ${currentPage==='home'?'active':''}" onclick="showPage('home')">üéÑ –ì–ª–∞–≤–Ω–∞—è</a>
        <a href="#" class="nav-link ${currentPage==='catalog'?'active':''}" onclick="showPage('catalog')">üéÆ –ö–∞—Ç–∞–ª–æ–≥</a>
        <a href="#" class="nav-link ${currentPage==='keys'?'active':''}" onclick="showPage('keys')">üîë –ö–ª—é—á–∏</a>
        <a href="#" class="nav-link ${currentPage==='profile'?'active':''}" onclick="showPage('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
    `;
}

function updateUserMenu(){
    const menu = document.getElementById('userMenu');
    if(currentUser){
        menu.innerHTML = `
            <div class="balance">${currentUser.balance} ‚ÇΩ</div>
            <button class="btn btn-primary" onclick="openDepositModal()">üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
            <div class="user-avatar" title="–ü—Ä–æ—Ñ–∏–ª—å" onclick="showPage('profile')">${(currentUser.username||'U').charAt(0).toUpperCase()}</div>
            <button class="btn" onclick="logout()" style="background:rgba(255,255,255,0.06);color:#fff">–í—ã–π—Ç–∏</button>
        `;
    } else {
        menu.innerHTML = `<button class="btn btn-primary" onclick="openAuthModal()">üéÖ –í–æ–π—Ç–∏</button>`;
    }
    renderNav();
}

/* ---------- page router ---------- */
function showPage(page, payload){
    currentPage = page;
    const main = document.getElementById('mainContent');
    renderNav();
    if(page==='home'){
        main.innerHTML = `
            <div class="hero">
                <h1 style="background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:20px">üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –º–∞–≥–∞–∑–∏–Ω –∏–≥—Ä–æ–≤—ã—Ö –∫–ª—é—á–µ–π üéÅ</h1>
                <p class="small-muted" style="margin:10px 0 30px;font-size:18px">üéÆ –ü–æ–∫—É–ø–∞–π DLC, —á–∏—Ç—ã –∏ –∫–ª—é—á–∏ ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ —á–µ—Ä–µ–∑ –±–∞–ª–∞–Ω—Å. –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ —Å–∫–∏–¥–∫–∏! ‚õÑ</p>
                ${currentUser ? `<button class="btn btn-primary" onclick="showPage('catalog')">üéÆ –í –∫–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä</button>` : `<button class="btn btn-primary" onclick="openAuthModal()">üéÖ –ù–∞—á–∞—Ç—å –ø–æ–∫—É–ø–∫–∏</button>`}
            </div>
            <h2 style="margin:20px 0;color:var(--xmas-gold)">üéÆ –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã</h2>
            <div class="grid cols-3">
                ${games.map(g=>`
                    <div class="card" style="cursor:pointer;text-align:center" onclick="openGame(${g.id})">
                        ${g.images && g.images.length > 0 ? `<img src="${g.images[0].url}" class="game-image" alt="${g.name}">` : `<div class="game-icon">${g.icon}</div>`}
                        <div style="font-weight:900;font-size:20px;margin-bottom:8px">${g.name}</div>
                        <div class="small-muted" style="margin-top:6px">${g.description}</div>
                        ${g.cheats.length > 0 ? `<div style="margin-top:12px;color:var(--xmas-gold)">üí∞ –æ—Ç ${Math.min(...g.cheats.flatMap(c=>c.variants.map(v=>v.price)))} ‚ÇΩ</div>` : ''}
                    </div>
                `).join('')}
            </div>
        `;
    } else if(page==='catalog'){
        main.innerHTML = `
            <h1 style="margin:20px 0;color:var(--xmas-gold)">üéÆ –ö–∞—Ç–∞–ª–æ–≥ –∏–≥—Ä</h1>
            <div class="grid cols-3">
                ${games.map(g=>`
                    <div class="card" style="cursor:pointer;text-align:center" onclick="openGame(${g.id})">
                        ${g.images && g.images.length > 0 ? `<img src="${g.images[0].url}" class="game-image" alt="${g.name}">` : `<div class="game-icon">${g.icon}</div>`}
                        <div style="font-weight:900;font-size:20px;margin-bottom:8px">${g.name}</div>
                        <div class="small-muted" style="margin-top:6px">${g.description}</div>
                        ${g.cheats.length > 0 ? `<div style="margin-top:12px;color:var(--xmas-gold)">üí∞ –æ—Ç ${Math.min(...g.cheats.flatMap(c=>c.variants.map(v=>v.price)))} ‚ÇΩ</div>` : ''}
                    </div>
                `).join('')}
            </div>
        `;
    } else if(page==='profile'){
        if(!currentUser){ openAuthModal(); return; }
        // render profile and purchases
        const userPurchases = purchases.filter(p=>p.userId===currentUser.id);
        const userDeposits = depositRequests.filter(d=>d.userId===currentUser.id);
        main.innerHTML = `
            <div style="max-width:800px;margin:16px auto">
                <h1 style="color:var(--xmas-gold)">üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
                <div class="card" style="margin:20px 0;padding:24px;border:2px solid var(--xmas-gold)">
                    <div style="display:flex;align-items:center;gap:20px;margin-bottom:16px">
                        <div class="user-avatar" style="width:80px;height:80px;font-size:32px">${(currentUser.username||'U').charAt(0).toUpperCase()}</div>
                        <div>
                            <div style="font-weight:900;font-size:28px">${currentUser.username||'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}</div>
                            <div class="small-muted" style="font-size:16px">${currentUser.email}</div>
                            ${currentUser.isAdmin ? `<div style="margin-top:8px;color:var(--xmas-red);font-weight:700">üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>` : ''}
                        </div>
                    </div>
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <div>
                            <div class="small-muted">üí∞ –ë–∞–ª–∞–Ω—Å</div>
                            <div style="font-size:36px;font-weight:900;color:var(--xmas-gold)">${currentUser.balance} ‚ÇΩ</div>
                        </div>
                        <div>
                            <button class="btn btn-primary" onclick="openDepositModal()">üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                            ${currentUser.isAdmin?` <button class="btn" onclick="showAdminPanel()" style="background:rgba(245,158,11,0.2);color:var(--warning);margin-left:12px;border:2px solid var(--warning)">üëë –ê–¥–º–∏–Ω</button>`:''}
                        </div>
                    </div>
                </div>

                <h2 style="color:var(--xmas-gold);margin-top:40px">üìã –ú–æ–∏ –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h2>
                <div id="depositRequestsList">
                    ${userDeposits.length===0?`
                        <div class="card" style="text-align:center;padding:40px">
                            <div style="font-size:48px;margin-bottom:16px">üì≠</div>
                            <div class="small-muted">–£ –≤–∞—Å –Ω–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
                        </div>
                    `: userDeposits.map(d=>{
                        let statusClass = 'status-pending';
                        let statusText = '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ';
                        if(d.status === 'approved') { statusClass = 'status-approved'; statusText = '‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ'; }
                        if(d.status === 'rejected') { statusClass = 'status-rejected'; statusText = '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ'; }
                        return `
                        <div class="card" style="margin:12px 0">
                            <div style="display:flex;justify-content:space-between;align-items:center">
                                <div>
                                    <div style="font-weight:900;font-size:24px">${d.amount} ‚ÇΩ</div>
                                    <div class="small-muted">üìÖ ${new Date(d.date).toLocaleString('ru-RU')}</div>
                                </div>
                                <div style="text-align:right">
                                    <div class="deposit-status ${statusClass}" style="font-size:14px">${statusText}</div>
                                    ${d.status === 'pending' ? `<div class="small-muted" style="margin-top:8px">‚è∞ –û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º</div>` : ''}
                                    ${d.adminComment ? `<div class="small-muted" style="margin-top:8px;color:var(--xmas-red)">üí¨ ${d.adminComment}</div>` : ''}
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>

                <h2 style="color:var(--xmas-gold);margin-top:40px">üéÅ –ú–æ–∏ –ø–æ–∫—É–ø–∫–∏</h2>
                <div id="purchasesList">
                    ${userPurchases.length===0?`
                        <div class="card" style="text-align:center;padding:40px">
                            <div style="font-size:48px;margin-bottom:16px">üõçÔ∏è</div>
                            <div class="small-muted">–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç –ø–æ–∫—É–ø–æ–∫</div>
                            <button class="btn btn-primary" onclick="showPage('catalog')" style="margin-top:20px">üéÆ –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</button>
                        </div>
                    `: userPurchases.map(p=>{
                        const game = games.find(g=>g.id===p.gameId);
                        const cheat = game ? game.cheats.find(c=>c.id===p.cheatId) : null;
                        const files = cheat ? cheat.files || [] : [];
                        const cheatImage = cheat && cheat.images && cheat.images.length > 0 ? cheat.images[0].url : null;
                        const gameImage = game && game.images && game.images.length > 0 ? game.images[0].url : null;
                        return `
                        <div class="card" style="margin:16px 0">
                            <div style="display:flex;gap:20px;align-items:center;margin-bottom:16px">
                                ${cheatImage ? `<img src="${cheatImage}" style="width:100px;height:100px;border-radius:12px;border:2px solid var(--xmas-gold)">` : gameImage ? `<img src="${gameImage}" style="width:100px;height:100px;border-radius:12px;border:2px solid var(--xmas-gold)">` : ''}
                                <div style="flex:1">
                                    <div style="display:flex;justify-content:space-between;align-items:flex-start">
                                        <div>
                                            <div style="font-weight:900;font-size:20px">${p.gameName} ‚Äî ${p.cheatName}</div>
                                            <div class="small-muted">üì¶ ${p.variantLabel} ‚Äî üìÖ ${new Date(p.date).toLocaleString('ru-RU')}</div>
                                        </div>
                                        <div style="text-align:right">
                                            <div class="price">${p.price} ‚ÇΩ</div>
                                            <button class="btn" onclick="copyKey('${p.key}')" style="margin-top:12px;background:rgba(220,38,38,0.15);color:var(--xmas-red)">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div style="margin-top:12px">
                                <div class="small-muted" style="margin-bottom:8px">üîë –ö–ª—é—á –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:</div>
                                <pre class="key">${p.key}</pre>
                            </div>
                            ${files.length > 0 ? `
                            <div style="margin-top:16px">
                                <div class="small-muted" style="margin-bottom:12px">üìÅ –§–∞–π–ª—ã –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</div>
                                <div>
                                    ${files.map(f=>`
                                        <a href="${f.url}" target="_blank" class="file-link">
                                            ${f.type === 'apk' ? 'üì±' : f.type === 'zip' ? 'üì¶' : f.type === 'exe' ? 'üíª' : 'üìé'} ${f.name}
                                        </a>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}
                        </div>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
    } else if(page==='keys'){
        // show all keys (if logged in)
        if(!currentUser){ openAuthModal(); return; }
        const userPurchases = purchases.filter(p=>p.userId===currentUser.id);
        main.innerHTML = `
            <h1 style="margin:20px 0;color:var(--xmas-gold)">üîë –ú–æ–∏ –∫–ª—é—á–∏</h1>
            <div style="max-width:800px;margin:0 auto">
                ${userPurchases.length===0?`
                    <div class="card" style="text-align:center;padding:60px">
                        <div style="font-size:64px;margin-bottom:20px">üîë</div>
                        <div class="small-muted" style="font-size:18px;margin-bottom:20px">–ü–æ–∫—É–ø–æ–∫ –Ω–µ—Ç</div>
                        <button class="btn btn-primary" onclick="showPage('catalog')">üéÆ –ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</button>
                    </div>
                `: userPurchases.map(p=>{
                    const game = games.find(g=>g.id===p.gameId);
                    const cheat = game ? game.cheats.find(c=>c.id===p.cheatId) : null;
                    const files = cheat ? cheat.files || [] : [];
                    return `
                    <div class="card" style="margin:16px 0">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
                            <div>
                                <strong style="font-size:20px">${p.gameName}</strong>
                                <div class="small-muted">‚ö° ${p.cheatName} ‚Äî üì¶ ${p.variantLabel}</div>
                            </div>
                            <div class="price">${p.price} ‚ÇΩ</div>
                        </div>
                        <div style="margin-top:12px">
                            <div class="small-muted" style="margin-bottom:8px">üîë –ö–ª—é—á:</div>
                            <pre class="key">${p.key}</pre>
                        </div>
                        ${files.length > 0 ? `
                        <div style="margin-top:16px">
                            <div class="small-muted" style="margin-bottom:12px">üìÅ –§–∞–π–ª—ã –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</div>
                            <div>
                                ${files.map(f=>`
                                    <a href="${f.url}" target="_blank" class="file-link">
                                        ${f.type === 'apk' ? 'üì±' : f.type === 'zip' ? 'üì¶' : f.type === 'exe' ? 'üíª' : 'üìé'} ${f.name}
                                    </a>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `}).join('')}
            </div>
        `;
    } else if(page==='about'){
        main.innerHTML = `
            <h1 style="margin:20px 0;color:var(--xmas-gold)">üåü –û –ø—Ä–æ–µ–∫—Ç–µ Kometa.space</h1>
            <div class="card" style="padding:30px;max-width:800px;margin:0 auto;border:2px solid var(--xmas-gold)">
                <div style="text-align:center;margin-bottom:30px">
                    <div style="font-size:64px;margin-bottom:20px">üéÑ</div>
                    <div style="font-weight:900;font-size:28px;margin-bottom:16px;background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent">KOMETA.SPACE</div>
                    <div class="small-muted" style="font-size:18px">üéÆ –ú–∞–≥–∞–∑–∏–Ω –∏–≥—Ä–æ–≤—ã—Ö –∫–ª—é—á–µ–π, —á–∏—Ç–æ–≤ –∏ DLC</div>
                </div>
                
                <div style="margin-bottom:24px">
                    <div style="font-weight:700;color:var(--xmas-gold);margin-bottom:12px">üéÅ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ —Å–∫–∏–¥–∫–∏!</div>
                    <p class="small-muted">–í –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π —Å–µ–∑–æ–Ω –¥–µ–π—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –º–∞–≥–∞–∑–∏–Ω–µ.</p>
                </div>
                
                <div style="margin-bottom:24px">
                    <div style="font-weight:700;color:var(--xmas-gold);margin-bottom:12px">‚ö° –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞</div>
                    <p class="small-muted">–ö–ª—é—á–∏ –∏ —Ñ–∞–π–ª—ã –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã.</p>
                </div>
                
                <div style="margin-bottom:24px">
                    <div style="font-weight:700;color:var(--xmas-gold);margin-bottom:12px">üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</div>
                    <p class="small-muted">–í—Å–µ –ø–ª–∞—Ç–µ–∂–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.</p>
                </div>
                
                <div style="margin-top:30px;padding:20px;background:rgba(220,38,38,0.1);border-radius:12px;border:2px solid var(--xmas-red)">
                    <div style="font-weight:700;color:var(--xmas-red);margin-bottom:12px">üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
                    <p class="small-muted">–ü–æ –≤—Å–µ–º –≤–æ–ø—Ä–æ—Å–∞–º –≤–æ–∑–≤—Ä–∞—Ç–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:</p>
                    <a href="https://t.me/kometspace" style="color:var(--xmas-gold);font-weight:700;text-decoration:none;font-size:18px" target="_blank">üì± t.me/kometspace</a>
                </div>
            </div>
        `;
    }
}

/* ---------- open a game's page (show cheats) ---------- */
function openGame(gameId){
    const game = games.find(g=>g.id===gameId);
    if(!game) return;
    currentPage = 'game';
    const main = document.getElementById('mainContent');
    main.innerHTML = `
        <div style="max-width:900px;margin:12px auto">
            <button onclick="showPage('catalog')" class="btn" style="margin-bottom:20px;background:rgba(255,255,255,0.05);color:#fff">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥</button>
            <div style="display:flex;gap:30px;align-items:center;margin-bottom:30px">
                ${game.images && game.images.length > 0 ? `
                    <img src="${game.images[0].url}" style="width:120px;height:120px;border-radius:20px;border:3px solid var(--xmas-gold);object-fit:cover">
                ` : `<div class="game-icon">${game.icon}</div>`}
                <div>
                    <h1 style="margin-bottom:12px;color:var(--xmas-gold)">${game.name}</h1>
                    <div class="small-muted" style="font-size:16px">${game.description}</div>
                </div>
            </div>

            <div style="margin-top:30px">
                <h2 style="margin-bottom:20px;color:var(--xmas-gold)">‚ö° –î–æ—Å—Ç—É–ø–Ω—ã–µ —á–∏—Ç—ã / DLC</h2>
                <div id="cheatsList">
                    ${game.cheats.length===0?`
                        <div class="card" style="text-align:center;padding:40px">
                            <div style="font-size:48px;margin-bottom:16px">‚ö°</div>
                            <div class="small-muted">–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —á–∏—Ç–æ–≤/DLC –¥–ª—è —ç—Ç–æ–π –∏–≥—Ä—ã</div>
                            ${currentUser && currentUser.isAdmin ? `<button class="btn btn-primary" onclick="showAdminPanel()" style="margin-top:20px">üëë –î–æ–±–∞–≤–∏—Ç—å —á–∏—Ç</button>` : ''}
                        </div>
                    `: game.cheats.map(c=>{
                        const cheatImage = c.images && c.images.length > 0 ? c.images[0].url : null;
                        return `
                        <div class="card" style="margin:16px 0">
                            <div style="display:flex;gap:20px;align-items:center">
                                ${cheatImage ? `<img src="${cheatImage}" style="width:100px;height:100px;border-radius:12px;border:2px solid var(--xmas-gold);object-fit:cover">` : ''}
                                <div style="flex:1">
                                    <div style="display:flex;justify-content:space-between;align-items:center">
                                        <div>
                                            <div style="font-weight:900;font-size:20px">${c.name} ${c.version?(' v'+c.version):''}</div>
                                            <div class="small-muted" style="margin-top:8px">üéÆ –î–ª—è ${game.name} | ‚ö° –î–æ–±–∞–≤–∏–ª –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
                                        </div>
                                        <div style="text-align:right">
                                            <div class="price">${c.variants[0].price} ‚ÇΩ</div>
                                            <button class="btn btn-primary" onclick="openCheat(${game.id},${c.id})" style="margin-top:12px">üéÆ –ö—É–ø–∏—Ç—å</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>
            </div>
        </div>
    `;
}

/* ---------- open cheat purchase modal / page ---------- */
function openCheat(gameId, cheatId){
    const game = games.find(g=>g.id===gameId);
    const cheat = game.cheats.find(cc=>cc.id===cheatId);
    if(!game || !cheat) return;
    // render interactive purchase area (single page)
    const main = document.getElementById('mainContent');
    main.innerHTML = `
        <div style="max-width:800px;margin:12px auto">
            <button onclick="openGame(${gameId})" class="btn" style="margin-bottom:20px;background:rgba(255,255,255,0.05);color:#fff">‚Üê –ù–∞–∑–∞–¥ –∫ –∏–≥—Ä–µ</button>
            <div class="card" style="border:2px solid var(--xmas-gold)">
                <div style="display:flex;gap:20px;align-items:center;margin-bottom:20px">
                    ${cheat.images && cheat.images.length > 0 ? `
                        <img src="${cheat.images[0].url}" style="width:120px;height:120px;border-radius:16px;border:3px solid var(--xmas-gold);object-fit:cover">
                    ` : game.images && game.images.length > 0 ? `
                        <img src="${game.images[0].url}" style="width:120px;height:120px;border-radius:16px;border:3px solid var(--xmas-gold);object-fit:cover">
                    ` : `<div class="game-icon">${game.icon}</div>`}
                    <div style="flex:1">
                        <div style="font-weight:900;font-size:24px">${game.name} ‚Äî ${cheat.name} ${cheat.version?(' v'+cheat.version):''}</div>
                        <div class="small-muted" style="margin-top:8px;font-size:16px">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç –ø–æ–¥–ø–∏—Å–∫–∏</div>
                    </div>
                    <div style="text-align:right">
                        <div class="small-muted">üí∞ –ö –æ–ø–ª–∞—Ç–µ</div>
                        <div id="purchasePrice" class="price">${cheat.variants[0].price} ‚ÇΩ</div>
                    </div>
                </div>

                <div style="margin-top:20px">
                    <div class="small-muted" style="margin-bottom:12px">üì¶ –í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥:</div>
                    <div id="variantsContainer"></div>
                </div>

                <div style="margin-top:30px;display:flex;gap:16px">
                    <button class="btn btn-primary" id="buyBtn" style="flex:1;font-size:18px;padding:16px">üíé –ö—É–ø–∏—Ç—å —Å–µ–π—á–∞—Å</button>
                    <button class="btn" id="contactBtn" style="background:rgba(255,255,255,0.05);flex:1;font-size:18px;padding:16px" onclick="showNotification('info','–ù–∞–ø–∏—à–∏—Ç–µ –≤ Telegram: t.me/kometspace')">üìû –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É</button>
                </div>
                
                <div style="margin-top:30px;padding:20px;background:rgba(220,38,38,0.1);border-radius:12px;border:2px solid var(--xmas-red)">
                    <div style="font-weight:700;color:var(--xmas-red);margin-bottom:12px">‚ö†Ô∏è –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</div>
                    <p class="small-muted" style="font-size:14px">–ü—Ä–∏–æ–±—Ä–µ—Ç–∞—è –¥–∞–Ω–Ω—ã–π –∫–ª—é—á –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å —Ä–∏—Å–∫–∞–º–∏ –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ. –ê –∏–º–µ–Ω–Ω–æ –Ω–µ –∏–º–µ–µ—Ç–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π –≤ —Å–ª—É—á–∞–µ —Å –Ω–µ—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å—é –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω—ã –∏–∑-–∑–∞ –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏–ª–∏ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –≤–∞—à–∏–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º.</p>
                </div>
            </div>
        </div>
    `;
    // render buttons for variants
    const variantsContainer = document.getElementById('variantsContainer');
    variantsContainer.innerHTML = cheat.variants.map((v,i)=>`
        <button class="variant-btn ${i===0?'active':''}" data-idx="${i}" onclick="selectVariant(${gameId},${cheatId},${i})">
            ${v.label} ‚Äî <strong style="color:var(--xmas-gold)">${v.price} ‚ÇΩ</strong>
        </button>
    `).join('');

    // attach buy handler to global function using closure
    window._currentSelection = {gameId,cheatId,variantIndex:0};
    document.getElementById('buyBtn').onclick = ()=> {
        buyCheat(gameId, cheatId, window._currentSelection.variantIndex);
    };
}

function selectVariant(gameId,cheatId,variantIndex){
    const game = games.find(g=>g.id===gameId);
    const cheat = game.cheats.find(c=>c.id===cheatId);
    if(!cheat) return;
    // update active classes
    document.querySelectorAll('#variantsContainer .variant-btn').forEach(btn=>btn.classList.remove('active'));
    const btn = document.querySelector(`#variantsContainer .variant-btn[data-idx="${variantIndex}"]`);
    if(btn) btn.classList.add('active');
    // update price display
    const price = cheat.variants[variantIndex].price;
    document.getElementById('purchasePrice').innerText = `${price} ‚ÇΩ`;
    // save selection
    window._currentSelection = {gameId,cheatId,variantIndex};
}

/* ---------- purchase logic ---------- */
function buyCheat(gameId,cheatId,variantIndex){
    if(!currentUser){ openAuthModal(); return; }
    const game = games.find(g=>g.id===gameId);
    const cheat = game.cheats.find(c=>c.id===cheatId);
    if(!cheat) return;
    const variant = cheat.variants[variantIndex];
    if(currentUser.balance < variant.price){
        showNotification('error','‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ');
        openDepositModal();
        return;
    }
    // charge
    currentUser.balance -= variant.price;
    saveCurrentUserInUsersList();
    // create key
    const key = generateKey();
    const purchase = {
        id: Date.now(),
        userId: currentUser.id,
        gameId: game.id,
        gameName: game.name,
        cheatId: cheat.id,
        cheatName: cheat.name,
        variantLabel: variant.label,
        price: variant.price,
        key: key,
        date: new Date().toISOString()
    };
    purchases.push(purchase);
    savePurchases();
    showNotification('success', `üéâ –ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞! –ö–ª—é—á: ${key}`);
    updateUserMenu();
    // go to profile to show purchase
    showPage('profile');
}

/* ---------- deposit system ---------- */
function submitDeposit(){
    if(!currentUser){ openAuthModal(); return; }
    const amount = parseInt(document.getElementById('depositAmount').value);
    const comment = document.getElementById('depositComment').value.trim() || currentUser.email;
    
    if(!amount || amount < 100){ showNotification('error','‚ùå –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ 100 ‚ÇΩ'); return; }
    if(!comment){ showNotification('error','‚ùå –£–∫–∞–∂–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–ª–∞—Ç–µ–∂—É'); return; }
    
    // –°–æ–∑–¥–∞–µ–º –∑–∞—è–≤–∫—É –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
    const depositRequest = {
        id: Date.now(),
        userId: currentUser.id,
        userEmail: currentUser.email,
        username: currentUser.username,
        amount: amount,
        comment: comment,
        status: 'pending', // pending, approved, rejected
        date: new Date().toISOString(),
        adminComment: ''
    };
    
    depositRequests.push(depositRequest);
    saveDepositRequests();
    
    showNotification('success', `‚úÖ –ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ${amount} ‚ÇΩ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É. –û–∂–∏–¥–∞–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏.`);
    closeModal('depositModal');
    showPage('profile');
}

/* ---------- file management ---------- */
function openFileUploadModal(gameId, cheatId){
    currentCheatForFiles = {gameId, cheatId};
    document.getElementById('fileUploadModal').classList.add('active');
}

function addFileToCheat(){
    if(!currentCheatForFiles) return;
    
    const name = document.getElementById('fileName').value.trim();
    const url = document.getElementById('fileUrl').value.trim();
    const type = document.getElementById('fileType').value;
    
    if(!name || !url){ 
        showNotification('error','‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); 
        return; 
    }
    
    const game = games.find(g=>g.id===currentCheatForFiles.gameId);
    const cheat = game ? game.cheats.find(c=>c.id===currentCheatForFiles.cheatId) : null;
    
    if(!cheat){
        showNotification('error','‚ùå –ß–∏—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ —Ñ–∞–π–ª–æ–≤, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
    if(!cheat.files) cheat.files = [];
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª
    cheat.files.push({
        name: name,
        url: url,
        type: type
    });
    
    saveGames();
    showNotification('success', `‚úÖ –§–∞–π–ª "${name}" –¥–æ–±–∞–≤–ª–µ–Ω –∫ —á–∏—Ç—É`);
    closeModal('fileUploadModal');
    showAdminPanel();
}

function removeFile(gameId, cheatId, fileIndex){
    const game = games.find(g=>g.id===gameId);
    const cheat = game ? game.cheats.find(c=>c.id===cheatId) : null;
    
    if(!cheat || !cheat.files || cheat.files.length <= fileIndex){
        showNotification('error','‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    const fileName = cheat.files[fileIndex].name;
    cheat.files.splice(fileIndex, 1);
    saveGames();
    showNotification('success', `‚úÖ –§–∞–π–ª "${fileName}" —É–¥–∞–ª–µ–Ω`);
    showAdminPanel();
}

/* ---------- image management ---------- */
function openImageUploadModal(gameId, cheatId = null){
    currentGameForImage = gameId;
    currentCheatForImage = cheatId;
    document.getElementById('imageUploadModal').classList.add('active');
}

function addImage(){
    if(!currentGameForImage) return;
    
    const description = document.getElementById('imageDescription').value.trim();
    const url = document.getElementById('imageUrl').value.trim();
    const type = document.getElementById('imageType').value;
    
    if(!description || !url){ 
        showNotification('error','‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); 
        return; 
    }
    
    const game = games.find(g=>g.id===currentGameForImage);
    if(!game){
        showNotification('error','‚ùå –ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        return;
    }
    
    if(type === 'game'){
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∏–≥—Ä—ã
        if(!game.images) game.images = [];
        game.images.push({
            url: url,
            description: description
        });
    } else if(type === 'cheat' && currentCheatForImage){
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —á–∏—Ç–∞
        const cheat = game.cheats.find(c=>c.id===currentCheatForImage);
        if(!cheat){
            showNotification('error','‚ùå –ß–∏—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
            return;
        }
        if(!cheat.images) cheat.images = [];
        cheat.images.push({
            url: url,
            description: description
        });
    } else {
        showNotification('error','‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è');
        return;
    }
    
    saveGames();
    showNotification('success', `‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ "${description}" –¥–æ–±–∞–≤–ª–µ–Ω–æ`);
    closeModal('imageUploadModal');
    showAdminPanel();
}

function removeImage(gameId, imageIndex, cheatId = null){
    const game = games.find(g=>g.id===gameId);
    if(!game){
        showNotification('error','‚ùå –ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        return;
    }
    
    if(cheatId){
        // –£–¥–∞–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–∏—Ç–∞
        const cheat = game.cheats.find(c=>c.id===cheatId);
        if(!cheat || !cheat.images || cheat.images.length <= imageIndex){
            showNotification('error','‚ùå –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            return;
        }
        const imageDesc = cheat.images[imageIndex].description;
        cheat.images.splice(imageIndex, 1);
        showNotification('success', `‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ "${imageDesc}" —É–¥–∞–ª–µ–Ω–æ`);
    } else {
        // –£–¥–∞–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–≥—Ä—ã
        if(!game.images || game.images.length <= imageIndex){
            showNotification('error','‚ùå –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ');
            return;
        }
        const imageDesc = game.images[imageIndex].description;
        game.images.splice(imageIndex, 1);
        showNotification('success', `‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ "${imageDesc}" —É–¥–∞–ª–µ–Ω–æ`);
    }
    
    saveGames();
    showAdminPanel();
}

/* ---------- utilities ---------- */
function generateKey(){
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    let key = '';
    for(let i=0;i<16;i++){
        if(i>0 && i%4===0) key += '-';
        key += chars.charAt(Math.floor(Math.random()*chars.length));
    }
    return key;
}

function copyKey(k){
    navigator.clipboard.writeText(k).then(()=>showNotification('success','üìã –ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä!')).catch(()=>showNotification('error','‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á'));
}

/* ---------- auth ---------- */
function openAuthModal(){ document.getElementById('authModal').classList.add('active'); }
function closeModal(id){ document.getElementById(id).classList.remove('active'); }
function switchTab(tab){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('#authModal .modal-body > div').forEach(d=>d.style.display='none');
    if(tab==='login'){ document.querySelector('.tab[data-tab="login"]').classList.add('active'); document.getElementById('loginTab').style.display='block'; }
    else { document.querySelector('.tab[data-tab="register"]').classList.add('active'); document.getElementById('registerTab').style.display='block'; }
}
function login(){
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    if(!email||!password){ showNotification('error','‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
    const users = JSON.parse(localStorage.getItem('kometa_users')||'[]');
    const user = users.find(u=>u.email===email&&u.password===password);
    if(user){
        currentUser = { id:user.id, email:user.email, username:user.username, balance:user.balance||0, isAdmin:user.isAdmin||false };
        localStorage.setItem('kometa_user', JSON.stringify(currentUser));
        updateUserMenu();
        closeModal('authModal');
        showNotification('success','üéâ –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!');
        showPage('home');
    } else showNotification('error','‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
}
function register(){
    const email = document.getElementById('registerEmail').value.trim();
    const username = document.getElementById('registerUsername').value.trim();
    const password = document.getElementById('registerPassword').value;
    if(!email||!username||!password){ showNotification('error','‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'); return; }
    if(password.length<6){ showNotification('error','‚ùå –ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤'); return; }
    let users = JSON.parse(localStorage.getItem('kometa_users')||'[]');
    if(users.some(u=>u.email===email)){ showNotification('error','‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç'); return; }
    const newUser = { id:Date.now(), email, username, password, balance:0, isAdmin:false }; // –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å 0
    users.push(newUser);
    localStorage.setItem('kometa_users', JSON.stringify(users));
    currentUser = { id:newUser.id, email:newUser.email, username:newUser.username, balance:0, isAdmin:false };
    localStorage.setItem('kometa_user', JSON.stringify(currentUser));
    updateUserMenu();
    closeModal('authModal');
    showNotification('success','üéâ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!');
    showPage('home');
}
function logout(){ currentUser = null; localStorage.removeItem('kometa_user'); updateUserMenu(); showPage('home'); showNotification('success','üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã'); }

function openDepositModal(){ 
    if(!currentUser){ openAuthModal(); return; } 
    document.getElementById('depositModal').classList.add('active');
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø–æ–ª–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
    if(currentUser && document.getElementById('depositComment')) {
        document.getElementById('depositComment').value = currentUser.email;
    }
}

/* ---------- admin panel ---------- */
function showAdminPanel(){
    if(!currentUser || !currentUser.isAdmin){ showNotification('error','‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω'); return; }
    currentPage = 'admin';
    const users = JSON.parse(localStorage.getItem('kometa_users')||'[]');
    const main = document.getElementById('mainContent');
    main.innerHTML = `
        <div style="max-width:1200px;margin:12px auto">
            <button class="btn" onclick="showPage('profile')" style="margin-bottom:20px;background:rgba(255,255,255,0.05);color:#fff">‚Üê –ù–∞–∑–∞–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å</button>
            <h1 style="background:linear-gradient(45deg,var(--xmas-red),var(--xmas-gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:30px">üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;margin:20px 0">
                <div class="card" style="text-align:center">
                    <div style="font-size:48px;margin-bottom:12px">üë•</div>
                    <div style="font-size:36px;font-weight:900;color:var(--xmas-gold)">${users.length}</div>
                    <div class="small-muted">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
                <div class="card" style="text-align:center">
                    <div style="font-size:48px;margin-bottom:12px">üí∞</div>
                    <div style="font-size:36px;font-weight:900;color:var(--xmas-gold)">${purchases.length}</div>
                    <div class="small-muted">–ü—Ä–æ–¥–∞–∂</div>
                </div>
                <div class="card" style="text-align:center">
                    <div style="font-size:48px;margin-bottom:12px">üíé</div>
                    <div style="font-size:36px;font-weight:900;color:var(--xmas-gold)">${purchases.reduce((s,p)=>s+p.price,0)} ‚ÇΩ</div>
                    <div class="small-muted">–í—ã—Ä—É—á–∫–∞</div>
                </div>
                <div class="card" style="text-align:center">
                    <div style="font-size:48px;margin-bottom:12px">‚è≥</div>
                    <div style="font-size:36px;font-weight:900;color:var(--xmas-gold)">${depositRequests.filter(d=>d.status==='pending').length}</div>
                    <div class="small-muted">–ó–∞—è–≤–æ–∫ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
                </div>
            </div>

            <div style="margin-top:30px">
                <h2 style="color:var(--xmas-gold);margin-bottom:20px">üìã –ó–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h2>
                <div class="card" id="adminDepositRequests">
                    ${depositRequests.length===0?`
                        <div style="text-align:center;padding:40px">
                            <div style="font-size:48px;margin-bottom:16px">üì≠</div>
                            <div class="small-muted">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
                        </div>
                    `: depositRequests.map(d=>{
                        const user = users.find(u=>u.id===d.userId);
                        let statusClass = 'status-pending';
                        let statusText = '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ';
                        if(d.status === 'approved') { statusClass = 'status-approved'; statusText = '‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ'; }
                        if(d.status === 'rejected') { statusClass = 'status-rejected'; statusText = '‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ'; }
                        return `
                        <div style="padding:16px;border-bottom:2px solid var(--border)">
                            <div style="display:flex;justify-content:space-between;align-items:center">
                                <div>
                                    <div style="font-weight:900;font-size:24px;color:var(--xmas-gold)">${d.amount} ‚ÇΩ</div>
                                    <div class="small-muted">üë§ ${user ? user.email : d.userEmail} (${d.username})</div>
                                    <div class="small-muted">üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${d.comment}</div>
                                    <div class="small-muted">üìÖ ${new Date(d.date).toLocaleString('ru-RU')}</div>
                                </div>
                                <div style="text-align:right">
                                    <div class="deposit-status ${statusClass}" style="font-size:16px;margin-bottom:12px">${statusText}</div>
                                    ${d.status === 'pending' ? `
                                        <div style="display:flex;gap:12px">
                                            <button class="btn" style="padding:10px 16px;background:var(--xmas-green);color:white;font-weight:700" onclick="approveDeposit(${d.id})">‚úÖ –û–¥–æ–±—Ä–∏—Ç—å</button>
                                            <button class="btn" style="padding:10px 16px;background:var(--xmas-red);color:white;font-weight:700" onclick="rejectDeposit(${d.id})">‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                                        </div>
                                    ` : ''}
                                    ${d.adminComment ? `<div class="small-muted" style="margin-top:12px;color:var(--xmas-red)">üí¨ ${d.adminComment}</div>` : ''}
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>
            </div>

            <div style="margin-top:40px">
                <h2 style="color:var(--xmas-gold);margin-bottom:20px">üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–∞–º–∏ –∏ —á–∏—Ç–∞–º–∏</h2>
                <div id="gamesList">
                    ${games.map(g=>`
                        <div class="card" style="margin-bottom:30px">
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                                <div>
                                    <div style="font-weight:900;font-size:24px">${g.name}</div>
                                    <div class="small-muted">${g.description}</div>
                                </div>
                                <div>
                                    <button class="btn" style="background:var(--xmas-gold);color:#000;margin-right:8px" onclick="openImageUploadModal(${g.id})">üñºÔ∏è –î–æ–±–∞–≤–∏—Ç—å –æ–±–ª–æ–∂–∫—É</button>
                                    <button class="btn" style="background:var(--xmas-red);color:white" onclick="addCheatToExistingGame(${g.id})">‚ö° –î–æ–±–∞–≤–∏—Ç—å —á–∏—Ç</button>
                                </div>
                            </div>
                            
                            ${g.images && g.images.length > 0 ? `
                            <div style="margin-bottom:20px">
                                <div class="small-muted" style="margin-bottom:12px">üñºÔ∏è –û–±–ª–æ–∂–∫–∏ –∏–≥—Ä—ã:</div>
                                <div style="display:flex;flex-wrap:wrap;gap:12px">
                                    ${g.images.map((img,idx)=>`
                                        <div style="position:relative">
                                            <img src="${img.url}" style="width:120px;height:120px;border-radius:12px;border:2px solid var(--xmas-gold);object-fit:cover">
                                            <button class="btn" style="position:absolute;top:5px;right:5px;padding:4px 8px;background:var(--xmas-red);color:white;font-size:12px" onclick="removeImage(${g.id}, ${idx})">‚úï</button>
                                            <div class="small-muted" style="font-size:12px;text-align:center;margin-top:4px">${img.description}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}
                            
                            <div>
                                <div class="small-muted" style="margin-bottom:12px">‚ö° –ß–∏—Ç—ã –¥–ª—è —ç—Ç–æ–π –∏–≥—Ä—ã:</div>
                                ${g.cheats.length===0?`
                                    <div style="padding:20px;background:rgba(255,255,255,0.02);border-radius:12px;text-align:center">
                                        <div class="small-muted">–ù–µ—Ç —á–∏—Ç–æ–≤</div>
                                    </div>
                                `: g.cheats.map(c=>{
                                    const minPrice = Math.min(...c.variants.map(v=>v.price));
                                    const maxPrice = Math.max(...c.variants.map(v=>v.price));
                                    return `
                                    <div style="padding:20px;background:rgba(255,255,255,0.02);border-radius:12px;margin:12px 0">
                                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
                                            <div>
                                                <strong style="font-size:18px">${c.name} ${c.version?'v'+c.version:''}</strong>
                                                <div class="small-muted">üí∞ –¶–µ–Ω–∞: ${minPrice} ‚ÇΩ - ${maxPrice} ‚ÇΩ</div>
                                            </div>
                                            <div style="display:flex;gap:8px">
                                                <button class="btn" style="padding:8px 12px;background:var(--xmas-gold);color:#000" onclick="openImageUploadModal(${g.id}, ${c.id})">üñºÔ∏è</button>
                                                <button class="btn" style="padding:8px 12px;background:var(--primary);color:white" onclick="openFileUploadModal(${g.id},${c.id})">üìÅ</button>
                                                <button class="btn" style="padding:8px 12px;background:var(--xmas-green);color:white" onclick="editCheat(${g.id},${c.id})">‚úèÔ∏è</button>
                                            </div>
                                        </div>
                                        
                                        ${c.images && c.images.length > 0 ? `
                                        <div style="margin-bottom:16px">
                                            <div class="small-muted" style="margin-bottom:8px">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–∏—Ç–∞:</div>
                                            <div style="display:flex;flex-wrap:wrap;gap:8px">
                                                ${c.images.map((img,idx)=>`
                                                    <div style="position:relative">
                                                        <img src="${img.url}" style="width:80px;height:80px;border-radius:8px;border:2px solid var(--xmas-gold);object-fit:cover">
                                                        <button class="btn" style="position:absolute;top:2px;right:2px;padding:2px 6px;background:var(--xmas-red);color:white;font-size:10px" onclick="removeImage(${g.id}, ${idx}, ${c.id})">‚úï</button>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                        ` : ''}
                                        
                                        <div style="margin-bottom:16px">
                                            <div class="small-muted" style="margin-bottom:8px">–í–∞—Ä–∏–∞–Ω—Ç—ã:</div>
                                            <div style="display:flex;flex-wrap:wrap;gap:8px">
                                                ${c.variants.map(v=>`<span style="padding:6px 12px;background:rgba(220,38,38,0.1);border-radius:6px;color:var(--xmas-gold)">${v.label} - ${v.price}‚ÇΩ</span>`).join('')}
                                            </div>
                                        </div>
                                        
                                        ${c.files && c.files.length > 0 ? `
                                        <div>
                                            <div class="small-muted" style="margin-bottom:8px">–§–∞–π–ª—ã:</div>
                                            <div style="display:flex;flex-wrap:wrap;gap:8px">
                                                ${c.files.map((f,idx)=>`
                                                    <div style="position:relative">
                                                        <div style="padding:8px 12px;background:rgba(255,255,255,0.05);border-radius:6px;display:flex;align-items:center;gap:6px">
                                                            ${f.type === 'apk' ? 'üì±' : f.type === 'zip' ? 'üì¶' : f.type === 'exe' ? 'üíª' : 'üìé'} ${f.name}
                                                            <button class="btn" style="padding:2px 6px;background:var(--xmas-red);color:white;font-size:10px;margin-left:8px" onclick="removeFile(${g.id},${c.id},${idx})">‚úï</button>
                                                        </div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                        ` : '<div class="small-muted">–ù–µ—Ç —Ñ–∞–π–ª–æ–≤</div>'}
                                    </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>

            <div style="margin-top:40px">
                <h2 style="color:var(--xmas-gold);margin-bottom:20px">üéÆ –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É</h2>
                <div class="card">
                    <div class="form-group"><label>üéØ –ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã</label><input id="newGameName" placeholder="Standoff 2"></div>
                    <div class="form-group"><label>üé® –ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏)</label><input id="newGameIcon" placeholder="üõ°Ô∏è"></div>
                    <div class="form-group"><label>üìù –û–ø–∏—Å–∞–Ω–∏–µ</label><textarea id="newGameDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∏–≥—Ä—ã" rows="3"></textarea></div>
                    <button class="btn btn-primary" onclick="addNewGame()">üéÆ –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—É</button>
                </div>
            </div>

            <div style="margin-top:40px">
                <h2 style="color:var(--xmas-gold);margin-bottom:20px">üí∞ –í—Å–µ –ø–æ–∫—É–ø–∫–∏</h2>
                <div class="card" id="adminPurchases">
                    ${purchases.length===0?`
                        <div style="text-align:center;padding:40px">
                            <div style="font-size:48px;margin-bottom:16px">üõçÔ∏è</div>
                            <div class="small-muted">–ü–æ–∫—É–ø–æ–∫ –Ω–µ—Ç</div>
                        </div>
                    `: purchases.map(p=>{
                        const u = users.find(x=>x.id===p.userId);
                        const game = games.find(g=>g.id===p.gameId);
                        const cheat = game ? game.cheats.find(c=>c.id===p.cheatId) : null;
                        const files = cheat ? cheat.files || [] : [];
                        return `<div style="padding:16px;border-bottom:2px solid var(--border)">
                            <div style="display:flex;justify-content:space-between">
                                <div>
                                    <div style="font-weight:900;font-size:18px">üéÆ ${p.gameName}</div>
                                    <div class="small-muted">‚ö° ${p.cheatName} ‚Äî üë§ ${u?u.email:'-'}</div>
                                    <div class="small-muted">üì¶ ${p.variantLabel} ‚Äî üìÖ ${new Date(p.date).toLocaleString('ru-RU')}</div>
                                </div>
                                <div class="price">${p.price} ‚ÇΩ</div>
                            </div>
                            <div style="margin-top:12px"><pre class="key">${p.key}</pre></div>
                            ${files.length > 0 ? `
                            <div style="margin-top:12px">
                                <div class="small-muted">üìÅ –§–∞–π–ª—ã:</div>
                                ${files.map(f=>`<a href="${f.url}" target="_blank" class="file-link" style="margin-right:8px">${f.type === 'apk' ? 'üì±' : f.type === 'zip' ? 'üì¶' : f.type === 'exe' ? 'üíª' : 'üìé'} ${f.name}</a>`).join('')}
                            </div>
                            ` : ''}
                        </div>`
                    }).join('')}
                </div>
            </div>
        </div>
    `;
}

function addCheatToExistingGame(gameId){
    const game = games.find(g=>g.id===gameId);
    if(!game) return;
    
    const name = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —á–∏—Ç–∞:', 'Plutonium');
    if(!name) return;
    
    const version = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–µ—Ä—Å–∏—é —á–∏—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):', '0.36.1');
    
    const variantsInput = prompt('–í–≤–µ–¥–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ —Ü–µ–Ω—ã (—Ñ–æ—Ä–º–∞—Ç: –Ω–∞–∑–≤–∞–Ω–∏–µ:—Ü–µ–Ω–∞, —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):', '7 –¥–Ω–µ–π:99,30 –¥–Ω–µ–π:249,–ù–∞–≤—Å–µ–≥–¥–∞:99500');
    if(!variantsInput) return;
    
    const variants = variantsInput.split(',').map(s=>{
        const [label, price] = s.split(':').map(x=>x && x.trim());
        return { label: label || '–í–∞—Ä–∏–∞–Ω—Ç', price: parseInt(price||'0') || 0 };
    });
    
    const cheat = { id: Date.now(), name, version, variants, files: [], images: [] };
    game.cheats.push(cheat);
    saveGames();
    showNotification('success', `‚úÖ –ß–∏—Ç "${name}" –¥–æ–±–∞–≤–ª–µ–Ω –∫ "${game.name}"`);
    showAdminPanel();
}

function editCheat(gameId, cheatId){
    const game = games.find(g=>g.id===gameId);
    const cheat = game ? game.cheats.find(c=>c.id===cheatId) : null;
    if(!cheat) return;
    
    const newPrice = prompt('–ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–∞ (–≤–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é —Ü–µ–Ω—É):', cheat.variants[0].price);
    if(newPrice && !isNaN(newPrice)){
        const price = parseInt(newPrice);
        cheat.variants.forEach(v => v.price = price);
        saveGames();
        showNotification('success', `‚úÖ –¶–µ–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ ${price} ‚ÇΩ`);
        showAdminPanel();
    }
}

function approveDeposit(depositId){
    const deposit = depositRequests.find(d=>d.id===depositId);
    if(!deposit) return;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    deposit.status = 'approved';
    deposit.adminComment = '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º';
    
    // –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–ø–æ–ª–Ω—è–µ–º –±–∞–ª–∞–Ω—Å
    let users = JSON.parse(localStorage.getItem('kometa_users')||'[]');
    const user = users.find(u=>u.id===deposit.userId);
    if(user){
        user.balance += deposit.amount;
        localStorage.setItem('kometa_users', JSON.stringify(users));
        
        // –ï—Å–ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —ç—Ç–æ —Ç–æ—Ç –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ –±–∞–ª–∞–Ω—Å
        if(currentUser && currentUser.id === deposit.userId){
            currentUser.balance = user.balance;
            localStorage.setItem('kometa_user', JSON.stringify(currentUser));
            updateUserMenu();
        }
    }
    
    saveDepositRequests();
    showNotification('success', `‚úÖ –ó–∞—è–≤–∫–∞ –Ω–∞ ${deposit.amount} ‚ÇΩ –æ–¥–æ–±—Ä–µ–Ω–∞!`);
    showAdminPanel();
}

function rejectDeposit(depositId){
    const deposit = depositRequests.find(d=>d.id===depositId);
    if(!deposit) return;
    
    const reason = prompt('–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–∞–∑–∞:', '–ü–ª–∞—Ç–µ–∂ –Ω–µ –ø–æ—Å—Ç—É–ø–∏–ª');
    if(reason === null) return; // –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª
    
    deposit.status = 'rejected';
    deposit.adminComment = reason || '–ü–ª–∞—Ç–µ–∂ –Ω–µ –ø–æ—Å—Ç—É–ø–∏–ª';
    
    saveDepositRequests();
    showNotification('info', `‚ÑπÔ∏è –ó–∞—è–≤–∫–∞ –Ω–∞ ${deposit.amount} ‚ÇΩ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞.`);
    showAdminPanel();
}

function addNewGame(){
    const name = document.getElementById('newGameName').value.trim();
    const icon = document.getElementById('newGameIcon').value.trim() || 'üéÆ';
    const desc = document.getElementById('newGameDesc').value.trim() || '';
    if(!name){ showNotification('error','‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã'); return; }
    const newGame = { id: Date.now(), name, icon, description:desc, images: [], cheats: [] };
    games.push(newGame);
    saveGames();
    showNotification('success', `‚úÖ –ò–≥—Ä–∞ "${name}" –¥–æ–±–∞–≤–ª–µ–Ω–∞`);
    document.getElementById('newGameName').value = '';
    document.getElementById('newGameIcon').value = '';
    document.getElementById('newGameDesc').value = '';
    showAdminPanel();
}

/* ---------- notifications ---------- */
function showNotification(type, message){
    const notifications = document.getElementById('notifications');
    const el = document.createElement('div');
    el.className = 'notification';
    el.innerText = message;
    el.style.borderLeftColor = type==='success' ? 'var(--success)' : type==='error' ? 'var(--danger)' : 'var(--primary)';
    notifications.appendChild(el);
    setTimeout(()=>{ el.remove(); }, 4000);
}
</script>
</body>
</html>
