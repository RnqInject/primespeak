<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrimeSpeak Academy</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root { --primary: #4f46e5; --primary-dark: #3730a3; --secondary: #10b981; --danger: #ef4444; --warning: #f59e0b; --light: #f8fafc; --dark: #1e293b; --gray: #64748b; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 15px; color: var(--dark); }
        .login-container { max-width: 400px; margin: 50px auto; background: white; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); padding: 30px; text-align: center; }
        .login-container h1 { color: var(--primary-dark); margin-bottom: 10px; }
        .login-container p { color: var(--gray); margin-bottom: 25px; }
        .login-tabs { display: flex; margin-bottom: 20px; border-radius: 10px; overflow: hidden; background: #f1f5f9; }
        .login-tab { flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 600; }
        .login-tab.active { background: var(--primary); color: white; }
        .login-input { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; }
        .login-input:focus { border-color: var(--primary); outline: none; }
        .login-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .login-btn:hover { background: var(--primary-dark); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ "–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è" */
        .remember-me { 
            display: flex; 
            align-items: center; 
            margin: 15px 0; 
            cursor: pointer;
            font-size: 14px;
            color: var(--gray);
        }
        .remember-me input { 
            margin-right: 8px; 
            width: 16px; 
            height: 16px;
            cursor: pointer;
        }
        
        .container { max-width: 100%; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; margin: 0 auto; display: none; }
        .header { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 25px 15px; text-align: center; position: relative; }
        .user-info { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; font-size: 0.9em; }
        .logout-btn { background: rgba(255,255,255,0.3); border: none; color: white; padding: 5px 10px; border-radius: 10px; cursor: pointer; margin-left: 10px; }
        .nav { display: flex; background: var(--primary-dark); flex-wrap: wrap; }
        .nav-btn { flex: 1; min-width: 80px; background: none; border: none; color: white; padding: 15px 10px; cursor: pointer; font-size: 12px; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .nav-btn.active { background: var(--primary); }
        .content { padding: 20px 15px; min-height: 500px; }
        .section { display: none; }
        .section.active { display: block; }
        .card { background: var(--light); border-radius: 12px; padding: 20px; margin-bottom: 15px; border-left: 4px solid var(--primary); }
        .student-card { display: flex; flex-direction: column; gap: 12px; }
        .student-info h3 { color: var(--primary-dark); margin-bottom: 6px; font-size: 1.2em; }
        .student-info p { color: var(--gray); margin: 2px 0; font-size: 0.9em; }
        .student-stats { display: flex; justify-content: space-between; align-items: center; }
        .average-grade { font-size: 1.5em; font-weight: bold; color: var(--primary); }
        .grade { display: inline-flex; align-items: center; justify-content: center; width: 35px; height: 35px; color: white; border-radius: 8px; font-weight: bold; margin: 2px; font-size: 0.9em; border: 2px solid transparent; }
        .grade-1, .grade-2, .grade-3 { background: #ef4444; }
        .grade-4, .grade-5, .grade-6 { background: #f59e0b; }
        .grade-7, .grade-8, .grade-9, .grade-10 { background: #10b981; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: var(--dark); font-size: 0.9em; }
        .input, .select { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; }
        .input:focus, .select:focus { border-color: var(--primary); outline: none; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; width: 100%; margin-top: 10px; }
        .btn:hover { background: var(--primary-dark); }
        .btn-success { background: var(--secondary); }
        .btn-success:hover { background: #0da271; }
        .btn-danger { background: var(--danger); }
        .btn-danger:hover { background: #dc2626; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        .stat-card { background: white; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.08); border-top: 4px solid var(--primary); }
        .stat-number { font-size: 1.8em; font-weight: bold; color: var(--primary); margin: 5px 0; }
        .stat-label { color: var(--gray); font-size: 0.8em; }
        .empty-state { text-align: center; padding: 40px 15px; color: var(--gray); }
        h2 { margin-bottom: 15px; color: var(--primary-dark); font-size: 1.3em; }
        h3 { margin-bottom: 10px; color: var(--dark); font-size: 1.1em; }
        .student-grades-list { margin-top: 20px; }
        .grade-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #e2e8f0; }
        .grade-item:last-child { border-bottom: none; }
        .login-info { background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 10px; padding: 15px; margin: 10px 0; }
        .grade-type-tabs { display: flex; margin-bottom: 15px; border-radius: 8px; overflow: hidden; background: #f1f5f9; }
        .grade-type-tab { flex: 1; padding: 10px; border: none; background: none; cursor: pointer; font-weight: 600; font-size: 12px; }
        .grade-type-tab.active { background: var(--primary); color: white; }
        .save-btn { background: var(--secondary); margin-top: 5px; }
        .save-btn:hover { background: #0da271; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—Ü–µ–Ω–æ–∫ */
        .grade-type-badge { 
            display: inline-block; 
            padding: 4px 8px; 
            border-radius: 6px; 
            font-size: 0.7em; 
            font-weight: bold; 
            margin-left: 8px; 
        }
        .type-regular { background: #dbeafe; color: #1e40af; }
        .type-test { background: #f3e8ff; color: #7e22ce; }
        .type-homework { background: #dcfce7; color: #166534; }
        .type-activity { background: #fef3c7; color: #92400e; }
        .type-project { background: #ffe4e6; color: #be123c; }
        .type-oral { background: #e0e7ff; color: #3730a3; }
        .type-attendance { background: #f1f5f9; color: #475569; }
        
        .grade-display { 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            min-width: 60px; 
            height: 35px; 
            color: white; 
            border-radius: 8px; 
            font-weight: bold; 
            margin: 2px; 
            font-size: 0.9em; 
            padding: 0 10px; 
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
        .calendar { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .calendar-day { text-align: center; padding: 10px; border-radius: 8px; cursor: pointer; }
        .calendar-day:hover { background: #f1f5f9; }
        .calendar-day.today { background: var(--primary); color: white; }
        .calendar-day.has-event { background: #f0f9ff; border: 2px solid #0ea5e9; }
        .calendar-day.weekend { color: var(--danger); }
        .calendar-event { background: var(--secondary); color: white; padding: 4px 8px; border-radius: 6px; font-size: 0.8em; margin-top: 4px; }
        
        /* –£–õ–£–ß–®–ï–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –†–ê–°–ü–ò–°–ê–ù–ò–Ø */
        .schedule-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 15px; }
        .schedule-item { 
            background: white; 
            padding: 18px; 
            border-radius: 10px; 
            border-left: 6px solid var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
            position: relative;
        }
        .schedule-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .schedule-item.ongoing { 
            border-left-color: var(--secondary);
            background: linear-gradient(135deg, #f0fdf4, #ffffff);
        }
        .schedule-item.upcoming { 
            border-left-color: var(--warning);
            background: linear-gradient(135deg, #fffbeb, #ffffff);
        }
        .schedule-item.completed { 
            border-left-color: var(--gray);
            background: linear-gradient(135deg, #f8fafc, #ffffff);
            opacity: 0.7;
        }
        .schedule-time { 
            font-weight: bold; 
            color: var(--primary); 
            margin-bottom: 8px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .schedule-subject { 
            font-size: 1.2em; 
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        .schedule-teacher { 
            color: var(--gray); 
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .schedule-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.7em;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-ongoing { background: var(--secondary); color: white; }
        .status-upcoming { background: var(--warning); color: white; }
        .status-completed { background: var(--gray); color: white; }
        
        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ì–†–£–ü–ü–ò–†–û–í–ö–ò –†–ê–°–ü–ò–°–ê–ù–ò–Ø –ü–û –î–ê–¢–ê–ú */
        .schedule-date-group {
            margin-bottom: 25px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .schedule-date-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .schedule-date-title {
            font-size: 1.1em;
        }
        
        .schedule-day-info {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .schedule-date-content {
            padding: 15px;
        }
        
        .schedule-items-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .no-lessons {
            text-align: center;
            padding: 30px;
            color: var(--gray);
            font-style: italic;
        }
        
        .date-badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        /* –§–∏–ª—å—Ç—Ä—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è */
        .schedule-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .filter-btn.active {
            background: var(--primary);
            color: white;
        }
        .filter-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        .notification { background: #fef3c7; border: 2px solid #f59e0b; border-radius: 10px; padding: 15px; margin-bottom: 10px; }
        .notification.upcoming { background: #f0fdf4; border-color: var(--secondary); }
        .notification.important { background: #fee2e2; border-color: var(--danger); }
        
        /* –¶–í–ï–¢–ê –î–õ–Ø –í–°–ï–• –¢–ò–ü–û–í –û–¶–ï–ù–û–ö */
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (1-5) */
        .activity-grade-1, .activity-grade-2 { background: #ef4444; }
        .activity-grade-3 { background: #f59e0b; }
        .activity-grade-4, .activity-grade-5 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è —É—Å—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (1-5) */
        .oral-grade-1, .oral-grade-2 { background: #ef4444; }
        .oral-grade-3 { background: #f59e0b; }
        .oral-grade-4, .oral-grade-5 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π (1-10) */
        .homework-grade-1, .homework-grade-2, .homework-grade-3 { background: #ef4444; }
        .homework-grade-4, .homework-grade-5, .homework-grade-6 { background: #f59e0b; }
        .homework-grade-7, .homework-grade-8, .homework-grade-9, .homework-grade-10 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (1-25) */
        .test-grade-1, .test-grade-2, .test-grade-3, .test-grade-4, .test-grade-5, 
        .test-grade-6, .test-grade-7, .test-grade-8, .test-grade-9, .test-grade-10 { background: #ef4444; }
        .test-grade-11, .test-grade-12, .test-grade-13, .test-grade-14, .test-grade-15 { background: #f59e0b; }
        .test-grade-16, .test-grade-17, .test-grade-18, .test-grade-19, .test-grade-20,
        .test-grade-21, .test-grade-22, .test-grade-23, .test-grade-24, .test-grade-25 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤ (1-20) */
        .project-grade-1, .project-grade-2, .project-grade-3, .project-grade-4, .project-grade-5,
        .project-grade-6, .project-grade-7, .project-grade-8, .project-grade-9, .project-grade-10 { background: #ef4444; }
        .project-grade-11, .project-grade-12, .project-grade-13, .project-grade-14, .project-grade-15 { background: #f59e0b; }
        .project-grade-16, .project-grade-17, .project-grade-18, .project-grade-19, .project-grade-20 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ (0-2) */
        .attendance-grade-0 { background: #ef4444; }
        .attendance-grade-1 { background: #ef4444; }
        .attendance-grade-2 { background: #10b981; }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è —Ç–µ—Å—Ç–æ–≤ */
        .test-grade-progress { background: #e2e8f0; border-radius: 10px; height: 8px; margin: 5px 0; overflow: hidden; }
        .test-grade-progress-bar { background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981); height: 100%; transition: width 0.3s; }
        .test-grade-info { font-size: 0.8em; color: var(--gray); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π –∫—É—Ä—Å–æ–≤ */
        .course-badge { 
            display: inline-block; 
            padding: 4px 12px; 
            border-radius: 20px; 
            font-size: 0.8em; 
            font-weight: bold; 
            margin: 2px;
        }
        .course-beginner { background: #dbeafe; color: #1e40af; border: 2px solid #3b82f6; }
        .course-elementary { background: #dcfce7; color: #166534; border: 2px solid #10b981; }
        .course-intermediate { background: #fef3c7; color: #92400e; border: 2px solid #f59e0b; }
        .course-advanced { background: #f3e8ff; color: #7e22ce; border: 2px solid #8b5cf6; }
        .course-fluent { background: #fce7f3; color: #be185d; border: 2px solid #ec4899; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏–π –∫—É—Ä—Å–æ–≤ */
        .course-tooltip {
            position: relative;
            cursor: help;
        }
        .course-tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            white-space: nowrap;
            z-index: 1000;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–Ω–µ–ª–∏ –∑–∞–≤—É—á–∞ */
        .academic-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .academic-card { 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            text-align: center; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-top: 4px solid var(--primary);
        }
        .academic-number { font-size: 2em; font-weight: bold; color: var(--primary); margin: 10px 0; }
        .performance-chart { background: white; padding: 20px; border-radius: 12px; margin: 15px 0; }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .nav-btn { min-width: 70px; font-size: 10px; padding: 12px 5px; }
            .stats-grid { grid-template-columns: 1fr; }
            .schedule-filters { justify-content: center; }
            .schedule-grid { grid-template-columns: 1fr; }
            .schedule-date-header { flex-direction: column; gap: 8px; text-align: center; }
            .schedule-date-title { font-size: 1em; }
        }
    </style>
</head>
<body>
    <div class="login-container" id="loginScreen">
        <h1>üìö PrimeSpeak Academy</h1>
        <p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>
        
        <div class="login-tabs">
            <button class="login-tab active" onclick="showLoginTab('teacher')">üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å</button>
            <button class="login-tab" onclick="showLoginTab('student')">üë®‚Äçüéì –£—á–µ–Ω–∏–∫</button>
            <button class="login-tab" onclick="showLoginTab('head_teacher')">üéì –ó–∞–≤—É—á</button>
        </div>

        <div id="teacherLogin">
            <input type="text" class="login-input" id="teacherEmail" placeholder="Email —É—á–∏—Ç–µ–ª—è">
            <input type="password" class="login-input" id="teacherPassword" placeholder="–ü–∞—Ä–æ–ª—å —É—á–∏—Ç–µ–ª—è">
            
            <!-- –î–û–ë–ê–í–õ–ï–ù –ß–ï–ö–ë–û–ö–° "–ó–ê–ü–û–ú–ù–ò–¢–¨ –ú–ï–ù–Ø" -->
            <label class="remember-me">
                <input type="checkbox" id="rememberTeacher">
                –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è
            </label>
            
            <button class="login-btn" onclick="loginTeacher()">–í–æ–π—Ç–∏ –∫–∞–∫ —É—á–∏—Ç–µ–ª—å</button>
        </div>

        <div id="studentLogin" style="display: none;">
            <input type="text" class="login-input" id="studentLoginInput" placeholder="–õ–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞">
            <input type="password" class="login-input" id="studentPassword" placeholder="–ü–∞—Ä–æ–ª—å —É—á–µ–Ω–∏–∫–∞">
            
            <!-- –î–û–ë–ê–í–õ–ï–ù –ß–ï–ö–ë–û–ö–° "–ó–ê–ü–û–ú–ù–ò–¢–¨ –ú–ï–ù–Ø" -->
            <label class="remember-me">
                <input type="checkbox" id="rememberStudent">
                –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è
            </label>
            
            <button class="login-btn" onclick="loginStudent()">–í–æ–π—Ç–∏ –∫–∞–∫ —É—á–µ–Ω–∏–∫</button>
        </div>

        <div id="headTeacherLogin" style="display: none;">
            <input type="text" class="login-input" id="headTeacherEmail" placeholder="Email –∑–∞–≤—É—á–∞">
            <input type="password" class="login-input" id="headTeacherPassword" placeholder="–ü–∞—Ä–æ–ª—å –∑–∞–≤—É—á–∞">
            
            <!-- –î–û–ë–ê–í–õ–ï–ù –ß–ï–ö–ë–û–ö–° "–ó–ê–ü–û–ú–ù–ò–¢–¨ –ú–ï–ù–Ø" -->
            <label class="remember-me">
                <input type="checkbox" id="rememberHeadTeacher">
                –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è
            </label>
            
            <button class="login-btn" onclick="loginHeadTeacher()">–í–æ–π—Ç–∏ –∫–∞–∫ –∑–∞–≤—É—á</button>
        </div>

        <button onclick="testConnection()" style="margin-top: 20px; padding: 10px; background: #10b981; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
            üß™ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        </button>
    </div>

    <div class="container" id="mainApp">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –£—á–∏—Ç–µ–ª—è -->
        <div class="header" id="teacherHeader">
            <div class="user-info">
                üë®‚Äçüè´ <span id="userName">–£—á–∏—Ç–µ–ª—å</span>
                <button class="logout-btn" onclick="logout()">üö™</button>
            </div>
            <h1>üìö PrimeSpeak Academy</h1>
            <div class="company-name">–ü–∞–Ω–µ–ª—å —É—á–∏—Ç–µ–ª—è</div>
            <p>–û—Ü–µ–Ω–∫–∏ ‚Ä¢ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚Ä¢ –ö–∞–ª–µ–Ω–¥–∞—Ä—å ‚Ä¢ –£—á–µ–Ω–∏–∫–∏</p>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –£—á–µ–Ω–∏–∫–∞ -->
        <div class="header" id="studentHeader" style="display: none;">
            <div class="user-info">
                üë®‚Äçüéì <span id="studentNameDisplay">–£—á–µ–Ω–∏–∫</span>
                <button class="logout-btn" onclick="logout()">üö™</button>
            </div>
            <h1>üìö PrimeSpeak Academy</h1>
            <div class="company-name">–ú–æ–π —É—á–µ–±–Ω—ã–π –ø–æ—Ä—Ç–∞–ª</div>
            <p>–û—Ü–µ–Ω–∫–∏ ‚Ä¢ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚Ä¢ –ö–∞–ª–µ–Ω–¥–∞—Ä—å ‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å—Å</p>
            <p style="margin-top: 10px;"><strong>üë®‚Äçüè´ –í–∞—à —É—á–∏—Ç–µ–ª—å: Radmir Nurislamov</strong></p>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ó–∞–≤—É—á–∞ -->
        <div class="header" id="headTeacherHeader" style="display: none;">
            <div class="user-info">
                üéì <span id="headTeacherNameDisplay">–ó–∞–≤—É—á</span>
                <button class="logout-btn" onclick="logout()">üö™</button>
            </div>
            <h1>üìö PrimeSpeak Academy</h1>
            <div class="company-name">–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è –ø–∞–Ω–µ–ª—å –∑–∞–≤—É—á–∞</div>
            <p>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Ä¢ –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ ‚Ä¢ –û—Ç—á–µ—Ç—ã ‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</p>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –£—á–∏—Ç–µ–ª—è -->
        <div class="nav" id="teacherNav">
            <button class="nav-btn active" onclick="showSection('dashboard')">üìä<span>–î–∞—à–±–æ—Ä–¥</span></button>
            <button class="nav-btn" onclick="showSection('students')">üë®‚Äçüéì<span>–£—á–µ–Ω–∏–∫–∏</span></button>
            <button class="nav-btn" onclick="showSection('addStudent')">‚ûï<span>–î–æ–±–∞–≤–∏—Ç—å</span></button>
            <button class="nav-btn" onclick="showSection('grades')">üìù<span>–û—Ü–µ–Ω–∫–∏</span></button>
            <button class="nav-btn" onclick="showSection('schedule')">üìÖ<span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span></button>
            <button class="nav-btn" onclick="showSection('calendar')">üóìÔ∏è<span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span></button>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –ó–∞–≤—É—á–∞ -->
        <div class="nav" id="headTeacherNav" style="display: none;">
            <button class="nav-btn active" onclick="showSection('headTeacherDashboard')">üéì<span>–î–∞—à–±–æ—Ä–¥</span></button>
            <button class="nav-btn" onclick="showSection('academicAnalytics')">üìä<span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span></button>
            <button class="nav-btn" onclick="showSection('teacherManagement')">üë®‚Äçüè´<span>–£—á–∏—Ç–µ–ª—è</span></button>
            <button class="nav-btn" onclick="showSection('students')">üë®‚Äçüéì<span>–£—á–µ–Ω–∏–∫–∏</span></button>
            <button class="nav-btn" onclick="showSection('schedule')">üìÖ<span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span></button>
            <button class="nav-btn" onclick="showSection('qualityControl')">üéØ<span>–ö–æ–Ω—Ç—Ä–æ–ª—å</span></button>
            <button class="nav-btn" onclick="showSection('reports')">üìã<span>–û—Ç—á–µ—Ç—ã</span></button>
        </div>

        <div class="content">
            <!-- –î–ê–®–ë–û–†–î –£–ß–ò–¢–ï–õ–Ø -->
            <div id="dashboard" class="section active">
                <h2>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="stats-grid">
                    <div class="stat-card"><div>üë®‚Äçüéì</div><div class="stat-number" id="totalStudents">0</div><div class="stat-label">–£—á–µ–Ω–∏–∫–æ–≤</div></div>
                    <div class="stat-card"><div>‚≠ê</div><div class="stat-number" id="averageGrade">0.0</div><div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div></div>
                    <div class="stat-card"><div>üìù</div><div class="stat-number" id="totalGrades">0</div><div class="stat-label">–û—Ü–µ–Ω–æ–∫</div></div>
                    <div class="stat-card"><div>üéØ</div><div class="stat-number" id="gradeTypesCount">7</div><div class="stat-label">–¢–∏–ø–æ–≤ –æ—Ü–µ–Ω–æ–∫</div></div>
                </div>
                
                <div class="card">
                    <h3>üîî –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                    <div id="upcomingEvents"></div>
                </div>
                
                <div class="card"><h3>üìà –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏</h3><div id="recentGrades"></div></div>
                <div class="card"><h3>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º</h3><div id="courseLevelsStats"></div></div>
            </div>

            <!-- –î–ê–®–ë–û–†–î –ó–ê–í–£–ß–ê -->
            <div id="headTeacherDashboard" class="section">
                <h2>üéì –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è –ø–∞–Ω–µ–ª—å –∑–∞–≤—É—á–∞</h2>
                
                <div class="academic-stats">
                    <div class="academic-card">
                        <div>üë®‚Äçüè´</div>
                        <div class="academic-number" id="htTotalTeachers">0</div>
                        <div class="stat-label">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="academic-card">
                        <div>üë®‚Äçüéì</div>
                        <div class="academic-number" id="htTotalStudents">0</div>
                        <div class="stat-label">–£—á–µ–Ω–∏–∫–æ–≤</div>
                    </div>
                    <div class="academic-card">
                        <div>üìä</div>
                        <div class="academic-number" id="htSchoolAverage">0.0</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –ø–æ —à–∫–æ–ª–µ</div>
                    </div>
                    <div class="academic-card">
                        <div>üéØ</div>
                        <div class="academic-number" id="htSuccessRate">0%</div>
                        <div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
                    </div>
                </div>

                <div class="card">
                    <h3>üìà –£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å –ø–æ —É—Ä–æ–≤–Ω—è–º</h3>
                    <div id="levelPerformance"></div>
                </div>

                <div class="card">
                    <h3>üë®‚Äçüè´ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</h3>
                    <div id="teacherActivity"></div>
                </div>

                <div class="card">
                    <h3>üìä –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—É—á–µ–Ω–∏—è</h3>
                    <div id="qualityMetrics"></div>
                </div>

                <div class="card">
                    <h3>üìã –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç—á–µ—Ç—ã</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button class="btn" onclick="generateAcademicReport()">üìÑ –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç</button>
                        <button class="btn" onclick="generateTeacherReport()">üë®‚Äçüè´ –û—Ç—á–µ—Ç –ø–æ —É—á–∏—Ç–µ–ª—è–º</button>
                        <button class="btn" onclick="generateProgressReport()">üìà –û—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É</button>
                        <button class="btn" onclick="generateQualityReport()">üéØ –û—Ç—á–µ—Ç –∫–∞—á–µ—Å—Ç–≤–∞</button>
                    </div>
                </div>
            </div>

            <!-- –ê–ù–ê–õ–ò–¢–ò–ö–ê –î–õ–Ø –ó–ê–í–£–ß–ê -->
            <div id="academicAnalytics" class="section">
                <h2>üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                <div class="card">
                    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏</h3>
                    <div id="detailedAnalytics"></div>
                </div>
            </div>

            <!-- –£–ü–†–ê–í–õ–ï–ù–ò–ï –£–ß–ò–¢–ï–õ–Ø–ú–ò -->
            <div id="teacherManagement" class="section">
                <h2>üë®‚Äçüè´ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º–∏</h2>
                <div class="card">
                    <h3>–°–ø–∏—Å–æ–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</h3>
                    <div id="teachersList"></div>
                </div>
            </div>

            <!-- –ö–û–ù–¢–†–û–õ–¨ –ö–ê–ß–ï–°–¢–í–ê -->
            <div id="qualityControl" class="section">
                <h2>üéØ –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—É—á–µ–Ω–∏—è</h2>
                <div class="card">
                    <h3>–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞</h3>
                    <div id="qualityControlMetrics"></div>
                </div>
            </div>

            <!-- –û–¢–ß–ï–¢–´ -->
            <div id="reports" class="section">
                <h2>üìã –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã</h2>
                <div class="card">
                    <h3>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤</h3>
                    <div id="reportsSection"></div>
                </div>
            </div>

            <!-- –£–ß–ï–ù–ò–ö–ò -->
            <div id="students" class="section">
                <h2>üë®‚Äçüéì –°–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤</h2>
                <div class="card">
                    <div class="form-group">
                        <input type="text" class="input" id="searchStudent" placeholder="üîç –ü–æ–∏—Å–∫ —É—á–µ–Ω–∏–∫–∞ –ø–æ –∏–º–µ–Ω–∏..." onkeyup="searchStudents()">
                    </div>
                </div>
                <div id="studentsList"></div>
            </div>

            <!-- –î–û–ë–ê–í–õ–ï–ù–ò–ï –£–ß–ï–ù–ò–ö–ê -->
            <div id="addStudent" class="section">
                <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</h2>
                <div class="card">
                    <div class="form-group">
                        <label>üë§ –ü–æ–ª–Ω–æ–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞</label>
                        <input type="text" class="input" id="studentName" placeholder="–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è">
                    </div>
                    <div class="form-group">
                        <label>üë§ –õ–æ–≥–∏–Ω –¥–ª—è –≤—Ö–æ–¥–∞</label>
                        <input type="text" class="input" id="studentUsername" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω">
                    </div>
                    <div class="form-group">
                        <label>üîë –ü–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞</label>
                        <input type="text" class="input" id="studentPasswordInput" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                    <div class="form-group">
                        <label>üìß Email —É—á–µ–Ω–∏–∫–∞</label>
                        <input type="email" class="input" id="studentEmail" placeholder="example@gmail.com">
                    </div>
                    <div class="form-group">
                        <label>üìö –£—Ä–æ–≤–µ–Ω—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ</label>
                        <select class="select" id="studentCourse">
                            <option value="beginner">BEGINNER (A1) - –ù–∞—á–∏–Ω–∞—é—â–∏–π</option>
                            <option value="elementary">ELEMENTARY (A2) - –≠–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã–π</option>
                            <option value="intermediate">INTERMEDIATE (B1) - –°—Ä–µ–¥–Ω–∏–π</option>
                            <option value="advanced">ADVANCED (B2) - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</option>
                            <option value="fluent">FLUENT (C1-C2) - –°–≤–æ–±–æ–¥–Ω—ã–π</option>
                        </select>
                    </div>
                    <button class="btn" onclick="addStudent()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</button>
                </div>
            </div>

            <!-- –û–¶–ï–ù–ö–ò -->
            <div id="grades" class="section">
                <h2>üìù –í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h2>
                <div class="card">
                    <div class="form-group">
                        <label>üë®‚Äçüéì –í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞</label>
                        <select class="select" id="gradeStudent"></select>
                    </div>
                    
                    <div class="grade-type-tabs">
                        <button class="grade-type-tab active" onclick="showGradeType('regular')">üìö –û–±—ã—á–Ω—ã–µ</button>
                        <button class="grade-type-tab" onclick="showGradeType('test')">üéì –¢–µ—Å—Ç—ã</button>
                        <button class="grade-type-tab" onclick="showGradeType('homework')">üè† –î–æ–º–∞—à–Ω–∏–µ</button>
                        <button class="grade-type-tab" onclick="showGradeType('activity')">üí™ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                        <button class="grade-type-tab" onclick="showGradeType('project')">üìÅ –ü—Ä–æ–µ–∫—Ç—ã</button>
                        <button class="grade-type-tab" onclick="showGradeType('oral')">üé§ –£—Å—Ç–Ω—ã–µ</button>
                        <button class="grade-type-tab" onclick="showGradeType('attendance')">üìÖ –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</button>
                    </div>

                    <!-- –û–±—ã—á–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏ (10 –±–∞–ª–ª–æ–≤) -->
                    <div id="regularGrades" class="grade-type-content">
                        <div class="form-group">
                            <label>‚≠ê –û—Ü–µ–Ω–∫–∞ (10-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="gradeValue">
                                <option value="1">1 - –û—á–µ–Ω—å –ø–ª–æ—Ö–æ</option>
                                <option value="2">2 - –ü–ª–æ—Ö–æ</option>
                                <option value="3">3 - –ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="4">4 - –ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ</option>
                                <option value="5">5 - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="6">6 - –•–æ—Ä–æ—à–æ</option>
                                <option value="7">7 - –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ</option>
                                <option value="8">8 - –û—Ç–ª–∏—á–Ω–æ</option>
                                <option value="9">9 - –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ</option>
                                <option value="10">10 - –ë–ª–µ—Å—Ç—è—â–µ</option>
                            </select>
                        </div>
                    </div>

                    <!-- –¢–µ—Å—Ç—ã (25 –±–∞–ª–ª–æ–≤) -->
                    <div id="testGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üéì –û—Ü–µ–Ω–∫–∞ –∑–∞ —Ç–µ—Å—Ç (25-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞) 
                                <span id="testGradeDisplay" style="color: var(--primary); font-weight: bold; margin-left: 10px;">15/25</span>
                            </label>
                            <select class="select" id="testGradeValue" onchange="updateTestGradeDisplay()">
                                <option value="1">1 –±–∞–ª–ª</option>
                                <option value="2">2 –±–∞–ª–ª–∞</option>
                                <option value="3">3 –±–∞–ª–ª–∞</option>
                                <option value="4">4 –±–∞–ª–ª–∞</option>
                                <option value="5">5 –±–∞–ª–ª–æ–≤</option>
                                <option value="6">6 –±–∞–ª–ª–æ–≤</option>
                                <option value="7">7 –±–∞–ª–ª–æ–≤</option>
                                <option value="8">8 –±–∞–ª–ª–æ–≤</option>
                                <option value="9">9 –±–∞–ª–ª–æ–≤</option>
                                <option value="10">10 –±–∞–ª–ª–æ–≤</option>
                                <option value="11">11 –±–∞–ª–ª–æ–≤</option>
                                <option value="12">12 –±–∞–ª–ª–æ–≤</option>
                                <option value="13">13 –±–∞–ª–ª–æ–≤</option>
                                <option value="14">14 –±–∞–ª–ª–æ–≤</option>
                                <option value="15" selected>15 –±–∞–ª–ª–æ–≤</option>
                                <option value="16">16 –±–∞–ª–ª–æ–≤</option>
                                <option value="17">17 –±–∞–ª–ª–æ–≤</option>
                                <option value="18">18 –±–∞–ª–ª–æ–≤</option>
                                <option value="19">19 –±–∞–ª–ª–æ–≤</option>
                                <option value="20">20 –±–∞–ª–ª–æ–≤</option>
                                <option value="21">21 –±–∞–ª–ª</option>
                                <option value="22">22 –±–∞–ª–ª–∞</option>
                                <option value="23">23 –±–∞–ª–ª–∞</option>
                                <option value="24">24 –±–∞–ª–ª–∞</option>
                                <option value="25">25 –±–∞–ª–ª–æ–≤</option>
                            </select>
                        </div>
                    </div>

                    <!-- –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è (10 –±–∞–ª–ª–æ–≤) -->
                    <div id="homeworkGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üè† –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ (10-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="homeworkGradeValue">
                                <option value="1">1 - –ù–µ —Å–¥–∞–Ω–æ</option>
                                <option value="2">2 - –û—á–µ–Ω—å –ø–ª–æ—Ö–æ</option>
                                <option value="3">3 - –ü–ª–æ—Ö–æ</option>
                                <option value="4">4 - –ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ</option>
                                <option value="5">5 - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="6">6 - –•–æ—Ä–æ—à–æ</option>
                                <option value="7">7 - –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ</option>
                                <option value="8">8 - –û—Ç–ª–∏—á–Ω–æ</option>
                                <option value="9">9 - –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ</option>
                                <option value="10">10 - –ò–¥–µ–∞–ª—å–Ω–æ</option>
                            </select>
                        </div>
                    </div>

                    <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–∫–µ (5 –±–∞–ª–ª–æ–≤) -->
                    <div id="activityGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üí™ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–∫–µ (5-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="activityGradeValue">
                                <option value="1">1 - –ü–∞—Å—Å–∏–≤–Ω—ã–π</option>
                                <option value="2">2 - –†–µ–¥–∫–æ —É—á–∞—Å—Ç–≤—É–µ—Ç</option>
                                <option value="3">3 - –°—Ä–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</option>
                                <option value="4">4 - –ê–∫—Ç–∏–≤–Ω—ã–π</option>
                                <option value="5">5 - –û—á–µ–Ω—å –∞–∫—Ç–∏–≤–Ω—ã–π</option>
                            </select>
                        </div>
                    </div>

                    <!-- –ü—Ä–æ–µ–∫—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã (20 –±–∞–ª–ª–æ–≤) -->
                    <div id="projectGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üìÅ –ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (20-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="projectGradeValue">
                                <option value="1">1 –±–∞–ª–ª</option>
                                <option value="2">2 –±–∞–ª–ª–∞</option>
                                <option value="3">3 –±–∞–ª–ª–∞</option>
                                <option value="4">4 –±–∞–ª–ª–∞</option>
                                <option value="5">5 –±–∞–ª–ª–æ–≤</option>
                                <option value="6">6 –±–∞–ª–ª–æ–≤</option>
                                <option value="7">7 –±–∞–ª–ª–æ–≤</option>
                                <option value="8">8 –±–∞–ª–ª–æ–≤</option>
                                <option value="9">9 –±–∞–ª–ª–æ–≤</option>
                                <option value="10">10 –±–∞–ª–ª–æ–≤</option>
                                <option value="11">11 –±–∞–ª–ª–æ–≤</option>
                                <option value="12">12 –±–∞–ª–ª–æ–≤</option>
                                <option value="13">13 –±–∞–ª–ª–æ–≤</option>
                                <option value="14">14 –±–∞–ª–ª–æ–≤</option>
                                <option value="15">15 –±–∞–ª–ª–æ–≤</option>
                                <option value="16">16 –±–∞–ª–ª–æ–≤</option>
                                <option value="17">17 –±–∞–ª–ª–æ–≤</option>
                                <option value="18">18 –±–∞–ª–ª–æ–≤</option>
                                <option value="19">19 –±–∞–ª–ª–æ–≤</option>
                                <option value="20">20 –±–∞–ª–ª–æ–≤</option>
                            </select>
                        </div>
                    </div>

                    <!-- –£—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (5 –±–∞–ª–ª–æ–≤) -->
                    <div id="oralGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üé§ –£—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç (5-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="oralGradeValue">
                                <option value="1">1 - –ù–µ –æ—Ç–≤–µ—Ç–∏–ª</option>
                                <option value="2">2 - –° –æ—à–∏–±–∫–∞–º–∏</option>
                                <option value="3">3 - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="4">4 - –•–æ—Ä–æ—à–æ</option>
                                <option value="5">5 - –û—Ç–ª–∏—á–Ω–æ</option>
                            </select>
                        </div>
                    </div>

                    <!-- –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å (2 –±–∞–ª–ª–∞) -->
                    <div id="attendanceGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üìÖ –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</label>
                            <select class="select" id="attendanceGradeValue">
                                <option value="2">‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</option>
                                <option value="1">‚è∞ –û–ø–æ–∑–¥–∞–ª</option>
                                <option value="0">‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üìÑ –ó–∞–¥–∞–Ω–∏–µ/–¢–µ–º–∞ —É—Ä–æ–∫–∞</label>
                        <input type="text" class="input" id="gradeAssignment" placeholder="Present Simple, Homework #5, Project Work">
                    </div>
                    <div class="form-group">
                        <label>üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <textarea class="input" id="gradeComment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏..." rows="2"></textarea>
                    </div>
                    <button class="btn" onclick="addGrade()">üìù –ü–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
                </div>
                <div class="card"><h3>üìã –ò—Å—Ç–æ—Ä–∏—è –æ—Ü–µ–Ω–æ–∫</h3><div id="gradesHistory"></div></div>
            </div>

            <!-- –£–õ–£–ß–®–ï–ù–ù–û–ï –†–ê–°–ü–ò–°–ê–ù–ò–ï –° –ì–†–£–ü–ü–ò–†–û–í–ö–û–ô –ü–û –î–ê–¢–ê–ú -->
            <div id="schedule" class="section">
                <h2>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π</h2>
                
                <!-- –§–∏–ª—å—Ç—Ä—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è -->
                <div class="schedule-filters">
                    <button class="filter-btn active" onclick="filterSchedule('all')">üìÖ –í—Å–µ –∑–∞–Ω—è—Ç–∏—è</button>
                    <button class="filter-btn" onclick="filterSchedule('today')">üéØ –°–µ–≥–æ–¥–Ω—è</button>
                    <button class="filter-btn" onclick="filterSchedule('week')">üìÜ –≠—Ç–∞ –Ω–µ–¥–µ–ª—è</button>
                    <button class="filter-btn" onclick="filterSchedule('upcoming')">‚è∞ –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ</button>
                    <button class="filter-btn" onclick="filterSchedule('past')">üìã –ü—Ä–æ—à–µ–¥—à–∏–µ</button>
                </div>
                
                <div class="card">
                    <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
                    <div class="form-group">
                        <label>üìö –ü—Ä–µ–¥–º–µ—Ç</label>
                        <input type="text" class="input" id="scheduleSubject" placeholder="–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫, Grammar">
                    </div>
                    <div class="form-group">
                        <label>üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</label>
                        <input type="text" class="input" id="scheduleTeacher" placeholder="Radmir Nurislamov" value="Radmir Nurislamov">
                    </div>
                    <div class="form-group">
                        <label>üë®‚Äçüéì –£—Ä–æ–≤–µ–Ω—å/–ì—Ä—É–ø–ø–∞</label>
                        <select class="select" id="scheduleLevel">
                            <option value="all">–í—Å–µ —É—Ä–æ–≤–Ω–∏</option>
                            <option value="beginner">BEGINNER</option>
                            <option value="elementary">ELEMENTARY</option>
                            <option value="intermediate">INTERMEDIATE</option>
                            <option value="advanced">ADVANCED</option>
                            <option value="fluent">FLUENT</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üìÖ –î–∞—Ç–∞</label>
                        <input type="date" class="input" id="scheduleDate">
                    </div>
                    <div class="form-group">
                        <label>‚è∞ –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</label>
                        <input type="time" class="input" id="scheduleStartTime">
                    </div>
                    <div class="form-group">
                        <label>‚è∞ –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                        <input type="time" class="input" id="scheduleEndTime">
                    </div>
                    <div class="form-group">
                        <label>üéØ –¢–∏–ø –∑–∞–Ω—è—Ç–∏—è</label>
                        <select class="select" id="scheduleType">
                            <option value="regular">üìö –û–±—ã—á–Ω—ã–π —É—Ä–æ–∫</option>
                            <option value="test">üéì –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                            <option value="conversation">üó£Ô∏è –†–∞–∑–≥–æ–≤–æ—Ä–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞</option>
                            <option value="grammar">üìñ –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</option>
                            <option value="project">üìÅ –ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üìù –û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <textarea class="input" id="scheduleDescription" placeholder="–¢–µ–º–∞ —É—Ä–æ–∫–∞, –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ..." rows="3"></textarea>
                    </div>
                    <button class="btn" onclick="addScheduleItem()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
                </div>

                <!-- –ë–õ–ò–ñ–ê–ô–®–ò–ï –ó–ê–ù–Ø–¢–ò–Ø (—Ç–æ–ø 5) -->
                <div class="card">
                    <h3>‚è∞ –ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–Ω—è—Ç–∏—è</h3>
                    <div id="upcomingLessons" class="schedule-items-container"></div>
                </div>

                <!-- –û–°–ù–û–í–ù–û–ï –†–ê–°–ü–ò–°–ê–ù–ò–ï –° –ì–†–£–ü–ü–ò–†–û–í–ö–û–ô –ü–û –î–ê–¢–ê–ú -->
                <div class="card">
                    <h3>üóìÔ∏è –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ –¥–∞—Ç–∞–º</h3>
                    <div id="scheduleList"></div>
                </div>
            </div>

            <!-- –ö–ê–õ–ï–ù–î–ê–†–¨ -->
            <div id="calendar" class="section">
                <h2>üóìÔ∏è –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π</h2>
                
                <div class="card">
                    <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</h3>
                    <div class="form-group">
                        <label>üéØ –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</label>
                        <input type="text" class="input" id="eventTitle" placeholder="–¢–µ—Å—Ç, –°–æ–±—Ä–∞–Ω–∏–µ, –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ">
                    </div>
                    <div class="form-group">
                        <label>üìÖ –î–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è</label>
                        <input type="date" class="input" id="eventDate">
                    </div>
                    <div class="form-group">
                        <label>‚è∞ –í—Ä–µ–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="time" class="input" id="eventTime">
                    </div>
                    <div class="form-group">
                        <label>üìù –û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="input" id="eventDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è..." rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>üé® –¢–∏–ø —Å–æ–±—ã—Ç–∏—è</label>
                        <select class="select" id="eventType">
                            <option value="lesson">üìö –£—Ä–æ–∫</option>
                            <option value="test">üéì –¢–µ—Å—Ç</option>
                            <option value="meeting">üë• –°–æ–±—Ä–∞–Ω–∏–µ</option>
                            <option value="holiday">üéâ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</option>
                            <option value="deadline">‚è∞ –î–µ–¥–ª–∞–π–Ω</option>
                        </select>
                    </div>
                    <button class="btn" onclick="addCalendarEvent()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
                </div>

                <div class="card">
                    <div class="calendar-header">
                        <button class="btn" onclick="changeMonth(-1)" style="width: auto;">‚¨ÖÔ∏è</button>
                        <h3 id="currentMonth">–ú–∞–π 2024</h3>
                        <button class="btn" onclick="changeMonth(1)" style="width: auto;">‚û°Ô∏è</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>

                <div class="card">
                    <h3>üìÖ –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                    <div id="calendarEventsList"></div>
                </div>
            </div>

            <!-- –°–¢–†–ê–ù–ò–¶–ê –£–ß–ï–ù–ò–ö–ê -->
            <div id="studentGrades" class="section">
                <h2>üìä –ú–æ–π —É—á–µ–±–Ω—ã–π –ø–æ—Ä—Ç–∞–ª</h2>
                <div class="card">
                    <h3>üëã –ü—Ä–∏–≤–µ—Ç, <span id="welcomeStudentName">–£—á–µ–Ω–∏–∫</span>!</h3>
                    <p><strong>–¢–≤–æ–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª:</strong> <span id="studentAverageGrade" style="font-size: 1.5em; color: var(--primary);">0.0</span></p>
                    <p><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> <span id="studentCourseDisplay">-</span></p>
                    <p><strong>–ó–∞—á–∏—Å–ª–µ–Ω:</strong> <span id="studentJoinDate">-</span></p>
                    <p><strong>üë®‚Äçüè´ –í–∞—à —É—á–∏—Ç–µ–ª—å:</strong> <span style="color: var(--primary); font-weight: bold;">Radmir Nurislamov</span></p>
                </div>

                <div class="card">
                    <h3>üìÖ –ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
                    <div id="studentTodaySchedule" class="schedule-items-container"></div>
                </div>

                <div class="card">
                    <h3>üîî –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                    <div id="studentUpcomingEvents"></div>
                </div>

                <div class="card">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –æ—Ü–µ–Ω–æ–∫</h3>
                    <div id="studentGradeStats"></div>
                </div>

                <div class="card">
                    <h3>üìù –ò—Å—Ç–æ—Ä–∏—è –º–æ–∏—Ö –æ—Ü–µ–Ω–æ–∫</h3>
                    <div class="student-grades-list" id="studentGradesList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SUPABASE
        const supabaseUrl = 'https://kgkkdjujxruiakbglnop.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtna2tkanVqeHJ1aWFrYmdsbm9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyNzI0MDMsImV4cCI6MjA3ODg0ODQwM30.R8vESEB3T-wqPlsykf4YnKm3wawuu70Xeph4GUCigsM';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        let currentUser = null;
        let currentGradeType = 'regular';
        let currentDate = new Date();
        let currentScheduleFilter = 'all';

        // –°–ò–°–¢–ï–ú–ê –†–û–õ–ï–ô
        const userRoles = {
            'teacher': {
                name: 'üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å',
                permissions: ['view_students', 'add_grades', 'view_schedule', 'add_schedule'],
                dashboard: 'teacher_dashboard'
            },
            'student': {
                name: 'üë®‚Äçüéì –£—á–µ–Ω–∏–∫',
                permissions: ['view_own_grades', 'view_schedule'],
                dashboard: 'student_dashboard'
            },
            'head_teacher': {
                name: 'üéì –ó–∞–≤—É—á',
                permissions: [
                    'view_all_students', 'view_all_grades', 'view_all_teachers',
                    'manage_schedule', 'manage_curriculum', 'quality_control',
                    'progress_monitoring', 'generate_reports', 'teacher_performance',
                    'student_analytics', 'academic_planning'
                ],
                dashboard: 'head_teacher_dashboard'
            }
        };

        // –¢–ò–ü–´ –û–¶–ï–ù–û–ö
        const gradeTypes = {
            'regular': { name: 'üìö –û–±—ã—á–Ω–∞—è', max: 10, color: '#3b82f6' },
            'test': { name: 'üéì –¢–µ—Å—Ç', max: 25, color: '#8b5cf6' },
            'homework': { name: 'üè† –î–æ–º–∞—à–Ω—è—è', max: 10, color: '#10b981' },
            'activity': { name: 'üí™ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', max: 5, color: '#f59e0b' },
            'project': { name: 'üìÅ –ü—Ä–æ–µ–∫—Ç', max: 20, color: '#ec4899' },
            'oral': { name: 'üé§ –£—Å—Ç–Ω–∞—è', max: 5, color: '#06b6d4' },
            'attendance': { name: 'üìÖ –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å', max: 2, color: '#6b7280' }
        };

        // –£–†–û–í–ù–ò –ö–£–†–°–û–í
        const courseLevels = {
            'beginner': { name: 'BEGINNER', level: 'A1', description: 'Basic vocabulary, simple sentences', color: 'course-beginner' },
            'elementary': { name: 'ELEMENTARY', level: 'A2', description: 'Everyday conversations, basic grammar', color: 'course-elementary' },
            'intermediate': { name: 'INTERMEDIATE', level: 'B1', description: 'Confident communication, complex sentences', color: 'course-intermediate' },
            'advanced': { name: 'ADVANCED', level: 'B2', description: 'Fluent speech, business English', color: 'course-advanced' },
            'fluent': { name: 'FLUENT', level: 'C1-C2', description: 'Native-like proficiency', color: 'course-fluent' }
        };

        // –î–ê–ù–ù–´–ï –î–õ–Ø –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
        const teacherCredentials = {
            email: 'nurislamovradmir9@gmail.com',
            password: 'teacher123',
            name: 'Radmir Nurislamov'
        };

        const headTeacherCredentials = {
            email: 'nurislamovradmir9@gmail.com',
            password: 'headteacher123',
            name: 'Radmir Nurislamov'
        };

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –û–¶–ï–ù–ö–ê–ú–ò
        function getGradeColorClass(grade, type) {
            grade = parseInt(grade);
            if (type === 'test') {
                if (grade <= 10) return 'test-grade-1';
                if (grade <= 15) return 'test-grade-11';
                return 'test-grade-16';
            } else if (type === 'activity') {
                if (grade <= 2) return 'activity-grade-1';
                if (grade === 3) return 'activity-grade-3';
                return 'activity-grade-4';
            } else if (type === 'homework') {
                if (grade <= 3) return 'homework-grade-1';
                if (grade <= 6) return 'homework-grade-4';
                return 'homework-grade-7';
            } else if (type === 'project') {
                if (grade <= 10) return 'project-grade-1';
                if (grade <= 15) return 'project-grade-11';
                return 'project-grade-16';
            } else if (type === 'oral') {
                if (grade <= 2) return 'oral-grade-1';
                if (grade === 3) return 'oral-grade-3';
                return 'oral-grade-4';
            } else if (type === 'attendance') {
                return `attendance-grade-${grade}`;
            } else {
                if (grade <= 3) return `grade-${grade}`;
                if (grade <= 6) return `grade-${grade}`;
                return `grade-${grade}`;
            }
        }

        function renderGrade(grade, type) {
            const colorClass = getGradeColorClass(grade, type);
            if (type === 'test') {
                return `<span class="grade ${colorClass}">${grade}/25</span>`;
            } else if (type === 'activity') {
                return `<span class="grade ${colorClass}">${grade}/5</span>`;
            } else if (type === 'attendance') {
                const labels = { '0': '‚ùå', '1': '‚è∞', '2': '‚úÖ' };
                return `<span class="grade ${colorClass}">${labels[grade] || grade}/2</span>`;
            } else if (type === 'oral') {
                return `<span class="grade ${colorClass}">${grade}/5</span>`;
            } else if (type === 'project') {
                return `<span class="grade ${colorClass}">${grade}/20</span>`;
            } else if (type === 'homework') {
                return `<span class="grade ${colorClass}">${grade}/10</span>`;
            } else {
                return `<span class="grade ${colorClass}">${grade}</span>`;
            }
        }

        function renderCourseLevel(course) {
            const courseInfo = courseLevels[course] || { name: course, color: 'course-beginner' };
            return `<span class="course-badge ${courseInfo.color} course-tooltip" data-tooltip="${courseInfo.description}">${courseInfo.name} (${courseInfo.level})</span>`;
        }

        function getCourseName(course) {
            const courseInfo = courseLevels[course] || { name: course, level: '' };
            return `${courseInfo.name} (${courseInfo.level})`;
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –†–ê–°–ü–ò–°–ê–ù–ò–ï–ú
        function filterSchedule(filter) {
            currentScheduleFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            loadSchedule();
        }

        function getScheduleStatus(item) {
            const now = new Date();
            const lessonDate = new Date(item.date + 'T' + item.start_time);
            const lessonEnd = new Date(item.date + 'T' + item.end_time);
            
            if (now >= lessonDate && now <= lessonEnd) {
                return { status: 'ongoing', text: '–ò–¥–µ—Ç —Å–µ–π—á–∞—Å' };
            } else if (now < lessonDate) {
                return { status: 'upcoming', text: '–ü—Ä–µ–¥—Å—Ç–æ–∏—Ç' };
            } else {
                return { status: 'completed', text: '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' };
            }
        }

        // –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –°–ò–°–¢–ï–ú–´
        function updateTestGradeDisplay() {
            const gradeValue = document.getElementById('testGradeValue').value;
            document.getElementById('testGradeDisplay').textContent = `${gradeValue}/25`;
        }

        async function testConnection() {
            try {
                const { data, error } = await supabase.from('teacher').select('*').limit(1);
                if (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
                    return false;
                }
                alert('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ!');
                return true;
            } catch (err) {
                alert('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + err.message);
                return false;
            }
        }

        function showLoginTab(tab) {
            document.querySelectorAll('.login-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('teacherLogin').style.display = tab === 'teacher' ? 'block' : 'none';
            document.getElementById('studentLogin').style.display = tab === 'student' ? 'block' : 'none';
            document.getElementById('headTeacherLogin').style.display = tab === 'head_teacher' ? 'block' : 'none';
        }

        // –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø "–ó–ê–ü–û–ú–ù–ò–¢–¨ –ú–ï–ù–Ø"
        function saveCredentials(role, credentials) {
            const rememberCheckbox = document.getElementById(`remember${role.charAt(0).toUpperCase() + role.slice(1)}`);
            
            if (rememberCheckbox && rememberCheckbox.checked) {
                localStorage.setItem(`${role}Credentials`, JSON.stringify(credentials));
                localStorage.setItem(`${role}RememberMe`, 'true');
            } else {
                localStorage.removeItem(`${role}Credentials`);
                localStorage.removeItem(`${role}RememberMe`);
            }
        }

        function restoreCredentials(role) {
            const savedCredentials = localStorage.getItem(`${role}Credentials`);
            const rememberMe = localStorage.getItem(`${role}RememberMe`);
            
            if (savedCredentials && rememberMe === 'true') {
                const credentials = JSON.parse(savedCredentials);
                
                if (role === 'teacher') {
                    document.getElementById('teacherEmail').value = credentials.email || '';
                    document.getElementById('teacherPassword').value = credentials.password || '';
                    document.getElementById('rememberTeacher').checked = true;
                } else if (role === 'student') {
                    document.getElementById('studentLoginInput').value = credentials.username || '';
                    document.getElementById('studentPassword').value = credentials.password || '';
                    document.getElementById('rememberStudent').checked = true;
                } else if (role === 'headTeacher') {
                    document.getElementById('headTeacherEmail').value = credentials.email || '';
                    document.getElementById('headTeacherPassword').value = credentials.password || '';
                    document.getElementById('rememberHeadTeacher').checked = true;
                }
                
                return true;
            }
            return false;
        }

        function autoLogin() {
            const roles = ['teacher', 'student', 'headTeacher'];
            
            for (let role of roles) {
                if (restoreCredentials(role)) {
                    if (role === 'teacher') {
                        showLoginTab('teacher');
                    } else if (role === 'student') {
                        showLoginTab('student');
                    } else if (role === 'headTeacher') {
                        showLoginTab('head_teacher');
                    }
                    break;
                }
            }
        }

        // –§–£–ù–ö–¶–ò–ò –í–•–û–î–ê
        async function loginTeacher() {
            const email = document.getElementById('teacherEmail').value;
            const password = document.getElementById('teacherPassword').value;
            
            if (!email || !password) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            try {
                if (email === teacherCredentials.email && password === teacherCredentials.password) {
                    currentUser = { 
                        name: teacherCredentials.name, 
                        email: teacherCredentials.email,
                        role: 'teacher' 
                    };
                    
                    saveCredentials('teacher', { email, password });
                    
                    showMainApp('teacher');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                } else {
                    const { data, error } = await supabase
                        .from('teacher')
                        .select('*')
                        .eq('email', email)
                        .eq('password', password)
                        .single();

                    if (error) throw error;

                    currentUser = { ...data, role: 'teacher' };
                    saveCredentials('teacher', { email, password });
                    showMainApp('teacher');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                }
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + err.message);
            }
        }

        async function loginStudent() {
            const username = document.getElementById('studentLoginInput').value;
            const password = document.getElementById('studentPassword').value;
            
            if (!username || !password) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('students')
                    .select('*')
                    .eq('username', username)
                    .eq('password', password)
                    .single();

                if (error) throw error;

                currentUser = { ...data, role: 'student' };
                saveCredentials('student', { username, password });
                showMainApp('student');
                alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + err.message);
            }
        }

        async function loginHeadTeacher() {
            const email = document.getElementById('headTeacherEmail').value;
            const password = document.getElementById('headTeacherPassword').value;
            
            if (!email || !password) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            try {
                if (email === headTeacherCredentials.email && password === headTeacherCredentials.password) {
                    currentUser = { 
                        name: headTeacherCredentials.name, 
                        email: headTeacherCredentials.email,
                        role: 'head_teacher' 
                    };
                    
                    saveCredentials('headTeacher', { email, password });
                    
                    showMainApp('head_teacher');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                } else {
                    const { data, error } = await supabase
                        .from('teacher')
                        .select('*')
                        .eq('email', email)
                        .eq('password', password)
                        .single();

                    if (error) throw error;

                    currentUser = { ...data, role: 'head_teacher' };
                    saveCredentials('headTeacher', { email, password });
                    showMainApp('head_teacher');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                }
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + err.message);
            }
        }

        function showMainApp(role) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            document.getElementById('teacherHeader').style.display = 'none';
            document.getElementById('studentHeader').style.display = 'none';
            document.getElementById('headTeacherHeader').style.display = 'none';
            
            document.getElementById('teacherNav').style.display = 'none';
            document.getElementById('headTeacherNav').style.display = 'none';

            if (role === 'teacher') {
                document.getElementById('teacherHeader').style.display = 'block';
                document.getElementById('teacherNav').style.display = 'flex';
                document.getElementById('userName').textContent = currentUser.name;
                showSection('dashboard');
                loadTeacherData();
            } else if (role === 'student') {
                document.getElementById('studentHeader').style.display = 'block';
                document.getElementById('studentNameDisplay').textContent = currentUser.name;
                document.getElementById('welcomeStudentName').textContent = currentUser.name;
                showStudentGrades();
            } else if (role === 'head_teacher') {
                document.getElementById('headTeacherHeader').style.display = 'block';
                document.getElementById('headTeacherNav').style.display = 'flex';
                document.getElementById('headTeacherNameDisplay').textContent = currentUser.name;
                showSection('headTeacherDashboard');
                loadHeadTeacherData();
            }
            
            loadSchedule();
            loadCalendarEvents();
            generateCalendar();
        }

        function logout() {
            currentUser = null;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            alert('üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!');
        }

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(sectionName).classList.add('active');
            if (event) event.currentTarget.classList.add('active');
        }

        function showGradeType(type) {
            currentGradeType = type;
            document.querySelectorAll('.grade-type-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.grade-type-content').forEach(content => content.style.display = 'none');
            
            event.target.classList.add('active');
            document.getElementById(type + 'Grades').style.display = 'block';
            if (type === 'test') updateTestGradeDisplay();
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–ß–ò–¢–ï–õ–Ø
        async function loadTeacherData() {
            await loadStudents();
            await loadGradeStudentSelect();
            await loadGradesHistory();
            await updateDashboard();
        }

        async function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            const username = document.getElementById('studentUsername').value.trim();
            const password = document.getElementById('studentPasswordInput').value.trim();
            const email = document.getElementById('studentEmail').value.trim();
            const course = document.getElementById('studentCourse').value;

            if (!name || !username || !password) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('students')
                .insert([{
                    name: name,
                    username: username,
                    password: password,
                    email: email,
                    course: course,
                    join_date: new Date().toISOString().split('T')[0],
                    teacher_name: 'Radmir Nurislamov'
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            document.getElementById('studentName').value = '';
            document.getElementById('studentUsername').value = '';
            document.getElementById('studentPasswordInput').value = '';
            document.getElementById('studentEmail').value = '';
            
            loadStudents();
            updateDashboard();
            loadGradeStudentSelect();
            
            alert(`‚úÖ –£—á–µ–Ω–∏–∫ ${name} –¥–æ–±–∞–≤–ª–µ–Ω!\n\nüìã –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:\nüë§ –õ–æ–≥–∏–Ω: ${username}\nüîë –ü–∞—Ä–æ–ª—å: ${password}`);
        }

        async function addGrade() {
            const studentId = parseInt(document.getElementById('gradeStudent').value);
            const assignment = document.getElementById('gradeAssignment').value.trim();
            
            let gradeValue;
            if (currentGradeType === 'regular') {
                gradeValue = document.getElementById('gradeValue').value;
            } else if (currentGradeType === 'test') {
                gradeValue = document.getElementById('testGradeValue').value;
            } else if (currentGradeType === 'homework') {
                gradeValue = document.getElementById('homeworkGradeValue').value;
            } else if (currentGradeType === 'activity') {
                gradeValue = document.getElementById('activityGradeValue').value;
            } else if (currentGradeType === 'project') {
                gradeValue = document.getElementById('projectGradeValue').value;
            } else if (currentGradeType === 'oral') {
                gradeValue = document.getElementById('oralGradeValue').value;
            } else if (currentGradeType === 'attendance') {
                gradeValue = document.getElementById('attendanceGradeValue').value;
            }

            if (!studentId || !gradeValue || !assignment) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('grades')
                .insert([{
                    student_id: studentId,
                    grade: parseInt(gradeValue),
                    assignment: assignment,
                    type: currentGradeType,
                    grade_date: new Date().toISOString().split('T')[0],
                    teacher_name: 'Radmir Nurislamov'
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            document.getElementById('gradeAssignment').value = '';
            document.getElementById('gradeComment').value = '';
            loadGradesHistory();
            updateDashboard();
            
            const student = await getStudentById(studentId);
            alert(`‚úÖ –û—Ü–µ–Ω–∫–∞ ${gradeValue}${currentGradeType === 'test' ? '/25' : ''} –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —É—á–µ–Ω–∏–∫—É ${student.name}!`);
        }

        async function loadStudents() {
            const { data: students, error } = await supabase
                .from('students')
                .select('*')
                .order('name');

            if (error) {
                console.error('Error loading students:', error);
                return;
            }

            const list = document.getElementById('studentsList');
            
            if (!students || students.length === 0) {
                list.innerHTML = '<div class="empty-state"><div>üë®‚Äçüéì</div><h3>–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</h3><p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞</p></div>';
                return;
            }

            list.innerHTML = '';
            for (let student of students) {
                const { data: grades } = await supabase
                    .from('grades')
                    .select('grade, type')
                    .eq('student_id', student.id);

                const avgGrade = grades && grades.length > 0 
                    ? (grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0) / grades.length).toFixed(1)
                    : '‚Äî';

                const recentGrades = grades ? grades.slice(-3) : [];

                list.innerHTML += `
                    <div class="card student-card">
                        <div class="student-info">
                            <h3>${student.name}</h3>
                            <div class="login-info">
                                <strong>–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:</strong><br>
                                üë§ –õ–æ–≥–∏–Ω: <strong>${student.username}</strong><br>
                                üîë –ü–∞—Ä–æ–ª—å: <strong>${student.password}</strong>
                            </div>
                            <p>üìß ${student.email || 'Email –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                            <p>üìö –£—Ä–æ–≤–µ–Ω—å: ${renderCourseLevel(student.course)}</p>
                            <p>üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å: ${student.teacher_name || 'Radmir Nurislamov'}</p>
                            <p>üìÖ –ó–∞—á–∏—Å–ª–µ–Ω: ${student.join_date}</p>
                        </div>
                        <div class="student-stats">
                            <div class="average-grade">${avgGrade}</div>
                            <div>${recentGrades.map(grade => 
                                renderGrade(grade.grade, grade.type)
                            ).join('')}</div>
                            <button class="btn btn-danger" onclick="deleteStudent(${student.id})" style="width: auto; padding: 8px 12px;">üóëÔ∏è</button>
                        </div>
                    </div>`;
            }
        }

        function searchStudents() {
            const searchTerm = document.getElementById('searchStudent').value.toLowerCase();
            const studentCards = document.querySelectorAll('.student-card');
            
            studentCards.forEach(card => {
                const studentName = card.querySelector('h3').textContent.toLowerCase();
                if (studentName.includes(searchTerm)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        async function loadGradeStudentSelect() {
            const { data: students, error } = await supabase
                .from('students')
                .select('id, name, username')
                .order('name');

            if (error) return;

            const select = document.getElementById('gradeStudent');
            select.innerHTML = '';
            students.forEach(student => {
                select.innerHTML += `<option value="${student.id}">${student.name} (${student.username})</option>`;
            });
        }

        async function loadGradesHistory() {
            const { data: grades, error } = await supabase
                .from('grades')
                .select(`
                    *,
                    students (name)
                `)
                .order('created_at', { ascending: false })
                .limit(50);

            if (error) {
                console.error('Error loading grades:', error);
                return;
            }

            const history = document.getElementById('gradesHistory');
            
            if (!grades || grades.length === 0) {
                history.innerHTML = '<div class="empty-state"><div>üìù</div><p>–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</p></div>';
                return;
            }

            history.innerHTML = '';
            grades.forEach(grade => {
                const typeLabel = gradeTypes[grade.type]?.name || grade.type;
                
                history.innerHTML += `
                    <div style="padding: 12px; border-bottom: 1px solid #e2e8f0; display: flex; align-items: center; gap: 10px;">
                        ${renderGrade(grade.grade, grade.type)}
                        <div style="flex: 1;">
                            <strong>${grade.students.name}</strong><br>
                            <small style="color: var(--gray);">${typeLabel} ‚Ä¢ ${grade.assignment} ‚Ä¢ ${grade.grade_date}</small>
                        </div>
                    </div>`;
            });
        }

        async function updateDashboard() {
            const { data: students } = await supabase.from('students').select('id, course');
            const { data: grades } = await supabase.from('grades').select('grade, type');

            document.getElementById('totalStudents').textContent = students ? students.length : 0;
            
            const totalGrades = grades ? grades.length : 0;
            const totalGradeSum = grades ? grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0) : 0;
            const average = totalGrades > 0 ? (totalGradeSum / totalGrades).toFixed(1) : '0.0';
            
            document.getElementById('averageGrade').textContent = average;
            document.getElementById('totalGrades').textContent = totalGrades;
            
            await updateRecentGrades();
            await updateCourseLevelsStats(students);
        }

        async function updateRecentGrades() {
            const { data: grades, error } = await supabase
                .from('grades')
                .select(`
                    *,
                    students (name)
                `)
                .order('created_at', { ascending: false })
                .limit(5);

            if (error) return;

            const recent = document.getElementById('recentGrades');
            
            if (!grades || grades.length === 0) {
                recent.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 20px;">–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫</p>';
                return;
            }
            
            recent.innerHTML = '';
            grades.forEach(grade => {
                recent.innerHTML += `
                    <div style="display: flex; align-items: center; gap: 12px; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        ${renderGrade(grade.grade, grade.type)}
                        <div style="flex: 1;">
                            <strong>${grade.students.name}</strong>
                            <div style="color: var(--gray); font-size: 0.8em;">${grade.assignment}</div>
                        </div>
                        <small style="color: var(--gray); font-size: 0.8em;">${grade.grade_date}</small>
                    </div>`;
            });
        }

        async function updateCourseLevelsStats(students) {
            if (!students) return;

            const levelCounts = {};
            students.forEach(student => {
                levelCounts[student.course] = (levelCounts[student.course] || 0) + 1;
            });

            const stats = document.getElementById('courseLevelsStats');
            stats.innerHTML = '';
            
            Object.entries(levelCounts).forEach(([course, count]) => {
                const courseInfo = courseLevels[course] || { name: course, color: 'course-beginner' };
                stats.innerHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        <span class="course-badge ${courseInfo.color}">${courseInfo.name}</span>
                        <span style="font-weight: bold; color: var(--primary);">${count} —É—á.</span>
                    </div>
                `;
            });
        }

        async function deleteStudent(studentId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —É—á–µ–Ω–∏–∫–∞? –í—Å–µ –µ–≥–æ –æ—Ü–µ–Ω–∫–∏ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) return;

            try {
                const { error: gradesError } = await supabase
                    .from('grades')
                    .delete()
                    .eq('student_id', studentId);

                if (gradesError) throw gradesError;

                const { error: studentError } = await supabase
                    .from('students')
                    .delete()
                    .eq('id', studentId);

                if (studentError) throw studentError;

                loadStudents();
                loadGradeStudentSelect();
                updateDashboard();
                alert('üóëÔ∏è –£—á–µ–Ω–∏–∫ —É–¥–∞–ª–µ–Ω');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + err.message);
            }
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ó–ê–í–£–ß–ê
        async function loadHeadTeacherData() {
            await loadAcademicStatistics();
            await loadTeacherPerformance();
            await loadQualityMetrics();
        }

        async function loadAcademicStatistics() {
            const { data: students } = await supabase.from('students').select('*');
            const { data: grades } = await supabase.from('grades').select('*');
            const { data: teachers } = await supabase.from('teacher').select('*');
            
            document.getElementById('htTotalTeachers').textContent = teachers ? teachers.length : 0;
            document.getElementById('htTotalStudents').textContent = students ? students.length : 0;
            
            const totalGrades = grades ? grades.length : 0;
            const totalGradeSum = grades ? grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0) : 0;
            const schoolAverage = totalGrades > 0 ? (totalGradeSum / totalGrades).toFixed(1) : '0.0';
            document.getElementById('htSchoolAverage').textContent = schoolAverage;
            
            const goodGrades = grades ? grades.filter(g => g.grade >= 6).length : 0;
            const successRate = totalGrades > 0 ? Math.round((goodGrades / totalGrades) * 100) : 0;
            document.getElementById('htSuccessRate').textContent = successRate + '%';

            await loadLevelPerformance(students, grades);
        }

        async function loadLevelPerformance(students, grades) {
            if (!students || !grades) return;

            const levelPerformance = {};
            students.forEach(student => {
                if (!levelPerformance[student.course]) {
                    levelPerformance[student.course] = { total: 0, sum: 0, count: 0 };
                }
            });

            grades.forEach(grade => {
                const student = students.find(s => s.id === grade.student_id);
                if (student && levelPerformance[student.course]) {
                    levelPerformance[student.course].total++;
                    levelPerformance[student.course].sum += grade.type === 'test' ? grade.grade/2.5 : grade.grade;
                    levelPerformance[student.course].count++;
                }
            });

            let performanceHTML = '';
            Object.entries(levelPerformance).forEach(([course, data]) => {
                const courseInfo = courseLevels[course] || { name: course };
                const average = data.count > 0 ? (data.sum / data.count).toFixed(1) : '0.0';
                
                performanceHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        <span class="course-badge ${courseInfo.color}">${courseInfo.name}</span>
                        <div>
                            <span style="font-weight: bold; color: var(--primary);">${average}</span>
                            <small style="color: var(--gray); margin-left: 10px;">${data.count} –æ—Ü–µ–Ω.</small>
                        </div>
                    </div>
                `;
            });

            document.getElementById('levelPerformance').innerHTML = performanceHTML;
        }

        async function loadTeacherPerformance() {
            const { data: teachers } = await supabase.from('teacher').select('*');
            
            let activityHTML = '';
            if (teachers && teachers.length > 0) {
                teachers.forEach(teacher => {
                    activityHTML += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                            <span>${teacher.name}</span>
                            <span style="color: var(--secondary); font-weight: bold;">–ê–∫—Ç–∏–≤–µ–Ω</span>
                        </div>
                    `;
                });
            } else {
                activityHTML = '<p style="color: var(--gray); text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è—Ö</p>';
            }

            document.getElementById('teacherActivity').innerHTML = activityHTML;
        }

        async function loadQualityMetrics() {
            const metricsHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                        <div style="font-weight: bold;">–ö–∞—á–µ—Å—Ç–≤–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</div>
                        <div style="font-size: 1.5em; color: var(--secondary);">92%</div>
                    </div>
                    <div style="background: #fffbeb; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                        <div style="font-weight: bold;">–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å</div>
                        <div style="font-size: 1.5em; color: var(--warning);">88%</div>
                    </div>
                    <div style="background: #fef2f2; padding: 15px; border-radius: 8px; border-left: 4px solid var(--danger);">
                        <div style="font-weight: bold;">–í–Ω–∏–º–∞–Ω–∏–µ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º</div>
                        <div style="font-size: 1.5em; color: var(--danger);">95%</div>
                    </div>
                    <div style="background: #eff6ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                        <div style="font-weight: bold;">–ü—Ä–æ–≥—Ä–µ—Å—Å —É—á–µ–Ω–∏–∫–æ–≤</div>
                        <div style="font-size: 1.5em; color: var(--primary);">85%</div>
                    </div>
                </div>
            `;

            document.getElementById('qualityMetrics').innerHTML = metricsHTML;
        }

        function generateAcademicReport() {
            alert('üìÑ –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        function generateTeacherReport() {
            alert('üë®‚Äçüè´ –û—Ç—á–µ—Ç –ø–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        function generateProgressReport() {
            alert('üìà –û—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        function generateQualityReport() {
            alert('üéØ –û—Ç—á–µ—Ç –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –æ–±—É—á–µ–Ω–∏—è –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–ß–ï–ù–ò–ö–ê
        async function showStudentGrades() {
            const { data: grades, error } = await supabase
                .from('grades')
                .select('*')
                .eq('student_id', currentUser.id)
                .order('created_at', { ascending: false });

            if (error) {
                console.error('Error loading student grades:', error);
                return;
            }

            let avgGrade = '0.0';
            if (grades && grades.length > 0) {
                const total = grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0);
                avgGrade = (total / grades.length).toFixed(1);
            }
            
            document.getElementById('studentAverageGrade').textContent = avgGrade;
            document.getElementById('studentCourseDisplay').textContent = getCourseName(currentUser.course);
            document.getElementById('studentJoinDate').textContent = currentUser.join_date;
            
            await updateStudentGradeStats(grades);
            
            const gradesList = document.getElementById('studentGradesList');
            if (!grades || grades.length === 0) {
                gradesList.innerHTML = '<div class="empty-state"><div>üìù</div><p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫</p></div>';
                return;
            }
            
            gradesList.innerHTML = '';
            grades.forEach(grade => {
                const typeLabel = gradeTypes[grade.type]?.name || grade.type;
                const percentage = grade.type === 'test' ? Math.round((grade.grade / 25) * 100) : null;
                
                gradesList.innerHTML += `
                    <div class="grade-item">
                        <div style="flex: 1;">
                            <strong>${grade.assignment}</strong>
                            <div style="color: var(--gray); font-size: 0.9em;">${typeLabel} ‚Ä¢ ${grade.grade_date}</div>
                            ${grade.type === 'test' ? `
                                <div class="test-grade-progress">
                                    <div class="test-grade-progress-bar" style="width: ${percentage}%"></div>
                                </div>
                                <div class="test-grade-info">${percentage}% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (${grade.grade}/25 –±–∞–ª–ª–æ–≤)</div>
                            ` : ''}
                        </div>
                        ${renderGrade(grade.grade, grade.type)}
                    </div>
                `;
            });
            
            await loadStudentSchedule();
            showSection('studentGrades');
        }

        async function updateStudentGradeStats(grades) {
            if (!grades) return;
            
            const typeCounts = {};
            const typeSums = {};
            
            grades.forEach(grade => {
                typeCounts[grade.type] = (typeCounts[grade.type] || 0) + 1;
                typeSums[grade.type] = (typeSums[grade.type] || 0) + grade.grade;
            });

            const stats = document.getElementById('studentGradeStats');
            stats.innerHTML = '';
            
            Object.entries(typeCounts).forEach(([type, count]) => {
                const typeInfo = gradeTypes[type] || { name: type, color: '#6b7280' };
                const average = (typeSums[type] / count).toFixed(1);
                
                stats.innerHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        <span>${typeInfo.name}</span>
                        <div>
                            <span style="font-weight: bold; color: var(--primary);">${average}</span>
                            <small style="color: var(--gray); margin-left: 10px;">${count} –æ—Ü–µ–Ω.</small>
                        </div>
                    </div>
                `;
            });
        }

        // –£–õ–£–ß–®–ï–ù–ù–û–ï –†–ê–°–ü–ò–°–ê–ù–ò–ï –° –ì–†–£–ü–ü–ò–†–û–í–ö–û–ô –ü–û –î–ê–¢–ê–ú
        async function addScheduleItem() {
            const subject = document.getElementById('scheduleSubject').value;
            const teacher = document.getElementById('scheduleTeacher').value;
            const level = document.getElementById('scheduleLevel').value;
            const date = document.getElementById('scheduleDate').value;
            const startTime = document.getElementById('scheduleStartTime').value;
            const endTime = document.getElementById('scheduleEndTime').value;
            const type = document.getElementById('scheduleType').value;
            const description = document.getElementById('scheduleDescription').value;

            if (!subject || !teacher || !date || !startTime || !endTime) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('schedule')
                .insert([{
                    subject: subject,
                    teacher: teacher,
                    level: level,
                    date: date,
                    start_time: startTime,
                    end_time: endTime,
                    type: type,
                    description: description,
                    created_at: new Date().toISOString()
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            document.getElementById('scheduleSubject').value = '';
            document.getElementById('scheduleDate').value = '';
            document.getElementById('scheduleStartTime').value = '';
            document.getElementById('scheduleEndTime').value = '';
            document.getElementById('scheduleDescription').value = '';

            loadSchedule();
            alert('‚úÖ –ó–∞–Ω—è—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ!');
        }

        // –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –°–¢–ê–¢–£–°–ê –î–ù–Ø
        function getDayStatus(dateString) {
            const today = new Date().toISOString().split('T')[0];
            const date = new Date(dateString);
            const now = new Date();
            
            if (dateString === today) {
                return 'üéØ –°–µ–≥–æ–¥–Ω—è';
            } else if (date > now) {
                const diffTime = date - now;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return `üìÖ –ß–µ—Ä–µ–∑ ${diffDays} ${getRussianDays(diffDays)}`;
            } else {
                return 'üìã –ü—Ä–æ—à–µ–¥—à–∏–π –¥–µ–Ω—å';
            }
        }

        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–†–ê–í–ò–õ–¨–ù–û–ì–û –°–ö–õ–û–ù–ï–ù–ò–Ø –î–ù–ï–ô
        function getRussianDays(days) {
            if (days === 1) return '–¥–µ–Ω—å';
            if (days >= 2 && days <= 4) return '–¥–Ω—è';
            return '–¥–Ω–µ–π';
        }

        // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –£–î–ê–õ–ï–ù–ò–Ø –ó–ê–ù–Ø–¢–ò–Ø –ò–ó –†–ê–°–ü–ò–°–ê–ù–ò–Ø
        async function deleteScheduleItem(scheduleId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∑–∞–Ω—è—Ç–∏–µ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è?')) return;

            try {
                const { error } = await supabase
                    .from('schedule')
                    .delete()
                    .eq('id', scheduleId);

                if (error) throw error;

                loadSchedule();
                alert('üóëÔ∏è –ó–∞–Ω—è—Ç–∏–µ —É–¥–∞–ª–µ–Ω–æ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + err.message);
            }
        }

        async function loadSchedule() {
            const { data: schedule, error } = await supabase
                .from('schedule')
                .select('*')
                .order('date', { ascending: true })
                .order('start_time', { ascending: true });

            if (error) {
                console.error('Error loading schedule:', error);
                return;
            }

            const scheduleList = document.getElementById('scheduleList');
            const upcomingLessons = document.getElementById('upcomingLessons');
            const studentTodaySchedule = document.getElementById('studentTodaySchedule');
            
            if (!schedule || schedule.length === 0) {
                scheduleList.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏</p></div>';
                upcomingLessons.innerHTML = '<div class="no-lessons">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–Ω—è—Ç–∏–π</div>';
                if (studentTodaySchedule) {
                    studentTodaySchedule.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç</p></div>';
                }
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const now = new Date();
            
            // –§–ò–õ–¨–¢–†–ê–¶–ò–Ø –†–ê–°–ü–ò–°–ê–ù–ò–Ø
            let filteredSchedule = schedule;
            if (currentScheduleFilter === 'today') {
                filteredSchedule = schedule.filter(item => item.date === today);
            } else if (currentScheduleFilter === 'week') {
                const weekStart = new Date(now);
                weekStart.setDate(now.getDate() - now.getDay());
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                
                filteredSchedule = schedule.filter(item => {
                    const itemDate = new Date(item.date);
                    return itemDate >= weekStart && itemDate <= weekEnd;
                });
            } else if (currentScheduleFilter === 'upcoming') {
                filteredSchedule = schedule.filter(item => item.date >= today);
            } else if (currentScheduleFilter === 'past') {
                filteredSchedule = schedule.filter(item => item.date < today);
            }

            // –ì–†–£–ü–ü–ò–†–û–í–ö–ê –ü–û –î–ê–¢–ê–ú
            const scheduleByDate = {};
            filteredSchedule.forEach(item => {
                if (!scheduleByDate[item.date]) {
                    scheduleByDate[item.date] = [];
                }
                scheduleByDate[item.date].push(item);
            });

            // –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –†–ê–°–ü–ò–°–ê–ù–ò–Ø –° –ì–†–£–ü–ü–ò–†–û–í–ö–û–ô
            scheduleList.innerHTML = '';
            
            if (Object.keys(scheduleByDate).length === 0) {
                scheduleList.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É</p></div>';
            } else {
                Object.keys(scheduleByDate).forEach(date => {
                    const dateItems = scheduleByDate[date];
                    const dateObj = new Date(date);
                    const dayNames = ['–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞'];
                    const monthNames = ['—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è', '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'];
                    
                    const dayName = dayNames[dateObj.getDay()];
                    const dateString = `${dateObj.getDate()} ${monthNames[dateObj.getMonth()]} ${dateObj.getFullYear()}`;
                    
                    let dateHeaderHTML = `
                        <div class="schedule-date-header">
                            <div class="schedule-date-title">
                                ${date === today ? 'üéØ –°–ï–ì–û–î–ù–Ø - ' : ''}${dayName}, ${dateString}
                                <span class="date-badge">${dateItems.length} –∑–∞–Ω—è—Ç–∏–π</span>
                            </div>
                            <div class="schedule-day-info">
                                ${getDayStatus(date)}
                            </div>
                        </div>
                        <div class="schedule-date-content">
                            <div class="schedule-items-container">
                    `;
                    
                    dateItems.forEach(item => {
                        const status = getScheduleStatus(item);
                        const typeIcon = getScheduleTypeIcon(item.type);
                        
                        dateHeaderHTML += `
                            <div class="schedule-item ${status.status}">
                                <div class="schedule-status status-${status.status}">${status.text}</div>
                                <div class="schedule-time">‚è∞ ${formatTime(item.start_time)} - ${formatTime(item.end_time)}</div>
                                <div class="schedule-subject">${typeIcon} ${item.subject}</div>
                                <div class="schedule-teacher">üë®‚Äçüè´ ${item.teacher}</div>
                                <div style="color: var(--gray); font-size: 0.8em; margin-top: 5px;">
                                    ${item.level !== 'all' ? `üéØ ${getCourseName(item.level)} ‚Ä¢ ` : ''}
                                    üè∑Ô∏è ${getScheduleTypeName(item.type)}
                                </div>
                                ${item.description ? `
                                    <div style="color: var(--gray); font-size: 0.9em; margin-top: 8px; padding: 8px; background: #f8fafc; border-radius: 6px;">
                                        üìù ${item.description}
                                    </div>
                                ` : ''}
                                <button class="btn btn-danger" onclick="deleteScheduleItem(${item.id})" style="width: auto; padding: 6px 12px; margin-top: 10px; font-size: 0.8em;">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        `;
                    });
                    
                    dateHeaderHTML += `
                            </div>
                        </div>
                    `;
                    
                    scheduleList.innerHTML += `<div class="schedule-date-group">${dateHeaderHTML}</div>`;
                });
            }

            // –ë–õ–ò–ñ–ê–ô–®–ò–ï –ó–ê–ù–Ø–¢–ò–Ø (—Ç–æ–ø 5)
            const upcoming = schedule
                .filter(item => item.date >= today)
                .slice(0, 5);

            upcomingLessons.innerHTML = '';
            if (upcoming.length === 0) {
                upcomingLessons.innerHTML = '<div class="no-lessons">–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–Ω—è—Ç–∏–π</div>';
            } else {
                upcoming.forEach(item => {
                    const status = getScheduleStatus(item);
                    const typeIcon = getScheduleTypeIcon(item.type);
                    const dateObj = new Date(item.date);
                    const dateString = `${dateObj.getDate()}.${dateObj.getMonth() + 1}.${dateObj.getFullYear()}`;
                    
                    upcomingLessons.innerHTML += `
                        <div class="schedule-item ${status.status}">
                            <div class="schedule-status status-${status.status}">${status.text}</div>
                            <div class="schedule-time">üìÖ ${dateString} ‚è∞ ${formatTime(item.start_time)} - ${formatTime(item.end_time)}</div>
                            <div class="schedule-subject">${typeIcon} ${item.subject}</div>
                            <div class="schedule-teacher">üë®‚Äçüè´ ${item.teacher}</div>
                            <div style="color: var(--gray); font-size: 0.8em;">
                                ${item.level !== 'all' ? `üéØ ${getCourseName(item.level)} ‚Ä¢ ` : ''}üè∑Ô∏è ${getScheduleTypeName(item.type)}
                            </div>
                        </div>
                    `;
                });
            }

            // –†–ê–°–ü–ò–°–ê–ù–ò–ï –î–õ–Ø –£–ß–ï–ù–ò–ö–ê –ù–ê –°–ï–ì–û–î–ù–Ø
            if (currentUser && currentUser.role === 'student' && studentTodaySchedule) {
                const todayLessons = schedule.filter(item => item.date === today);
                
                studentTodaySchedule.innerHTML = '';
                if (todayLessons.length === 0) {
                    studentTodaySchedule.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç</p></div>';
                } else {
                    todayLessons.forEach(item => {
                        const status = getScheduleStatus(item);
                        const typeIcon = getScheduleTypeIcon(item.type);
                        
                        studentTodaySchedule.innerHTML += `
                            <div class="schedule-item ${status.status}">
                                <div class="schedule-status status-${status.status}">${status.text}</div>
                                <div class="schedule-time">‚è∞ ${formatTime(item.start_time)} - ${formatTime(item.end_time)}</div>
                                <div class="schedule-subject">${typeIcon} ${item.subject}</div>
                                <div class="schedule-teacher">üë®‚Äçüè´ ${item.teacher}</div>
                                ${item.description ? `
                                    <div style="color: var(--gray); font-size: 0.9em; margin-top: 8px;">
                                        ${item.description}
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    });
                }
            }
        }

        function getScheduleTypeIcon(type) {
            const icons = {
                'regular': 'üìö',
                'test': 'üéì',
                'conversation': 'üó£Ô∏è',
                'grammar': 'üìñ',
                'project': 'üìÅ'
            };
            return icons[type] || 'üìö';
        }

        function getScheduleTypeName(type) {
            const names = {
                'regular': '–û–±—ã—á–Ω—ã–π —É—Ä–æ–∫',
                'test': '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
                'conversation': '–†–∞–∑–≥–æ–≤–æ—Ä–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞',
                'grammar': '–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞',
                'project': '–ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞'
            };
            return names[type] || '–£—Ä–æ–∫';
        }

        async function loadStudentSchedule() {
            await loadSchedule();
        }

        // –§–£–ù–ö–¶–ò–ò –ö–ê–õ–ï–ù–î–ê–†–Ø
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const currentMonth = document.getElementById('currentMonth');
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const monthNames = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];
            currentMonth.textContent = `${monthNames[month]} ${year}`;
            
            calendarGrid.innerHTML = '';
            
            const days = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            days.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.style.fontWeight = 'bold';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            });
            
            const firstDay = new Date(year, month, 1);
            const startingDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                emptyDay.style.visibility = 'hidden';
                calendarGrid.appendChild(emptyDay);
            }
            
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                const dayOfWeek = new Date(year, month, day).getDay();
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    dayElement.classList.add('weekend');
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar();
            loadCalendarEvents();
        }

        // –§–£–ù–ö–¶–ò–ò –°–û–ë–´–¢–ò–ô –ö–ê–õ–ï–ù–î–ê–†–Ø
        async function addCalendarEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value;
            const type = document.getElementById('eventType').value;

            if (!title || !date) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('calendar_events')
                .insert([{
                    title: title,
                    date: date,
                    time: time,
                    description: description,
                    type: type,
                    created_at: new Date().toISOString()
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';

            loadCalendarEvents();
            alert('‚úÖ –°–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å!');
        }

        async function loadCalendarEvents() {
            const { data: events, error } = await supabase
                .from('calendar_events')
                .select('*')
                .order('date', { ascending: true })
                .order('time', { ascending: true });

            if (error) {
                console.error('Error loading events:', error);
                return;
            }

            const calendarEventsList = document.getElementById('calendarEventsList');
            const upcomingEvents = document.getElementById('upcomingEvents');
            const studentUpcomingEvents = document.getElementById('studentUpcomingEvents');
            
            if (!events || events.length === 0) {
                calendarEventsList.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ</p></div>';
                upcomingEvents.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                if (studentUpcomingEvents) {
                    studentUpcomingEvents.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                }
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const upcoming = events.filter(event => event.date >= today).slice(0, 5);

            calendarEventsList.innerHTML = '';
            events.forEach(event => {
                const eventTypes = {
                    'lesson': 'üìö',
                    'test': 'üéì', 
                    'meeting': 'üë•',
                    'holiday': 'üéâ',
                    'deadline': '‚è∞'
                };
                
                calendarEventsList.innerHTML += `
                    <div class="notification ${event.date === today ? 'upcoming' : ''}">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2em;">${eventTypes[event.type]}</span>
                            <div style="flex: 1;">
                                <strong>${event.title}</strong>
                                <div style="color: var(--gray); font-size: 0.9em;">
                                    üìÖ ${formatDate(event.date)}${event.time ? ` ‚è∞ ${event.time}` : ''}
                                </div>
                                ${event.description ? `<div style="margin-top: 5px;">${event.description}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });

            upcomingEvents.innerHTML = '';
            upcoming.forEach(event => {
                const eventTypes = {
                    'lesson': 'üìö',
                    'test': 'üéì',
                    'meeting': 'üë•', 
                    'holiday': 'üéâ',
                    'deadline': '‚è∞'
                };
                
                upcomingEvents.innerHTML += `
                    <div class="notification upcoming">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2em;">${eventTypes[event.type]}</span>
                            <div style="flex: 1;">
                                <strong>${event.title}</strong>
                                <div style="color: var(--gray); font-size: 0.9em;">
                                    üìÖ ${formatDate(event.date)}${event.time ? ` ‚è∞ ${event.time}` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            if (currentUser && currentUser.role === 'student' && studentUpcomingEvents) {
                studentUpcomingEvents.innerHTML = '';
                if (upcoming.length === 0) {
                    studentUpcomingEvents.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                } else {
                    upcoming.forEach(event => {
                        studentUpcomingEvents.innerHTML += `
                            <div class="notification upcoming">
                                <strong>${eventTypes[event.type]} ${event.title}</strong>
                                <div style="color: var(--gray); font-size: 0.9em;">
                                    üìÖ ${formatDate(event.date)}${event.time ? ` ‚è∞ ${event.time}` : ''}
                                </div>
                            </div>
                        `;
                    });
                }
            }
        }

        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function getCourseName(course) {
            const courseInfo = courseLevels[course] || { name: course, level: '' };
            return `${courseInfo.name} (${courseInfo.level})`;
        }

        async function getStudentById(studentId) {
            const { data, error } = await supabase
                .from('students')
                .select('*')
                .eq('id', studentId)
                .single();
            return data;
        }

        function formatTime(timeString) {
            if (!timeString) return '';
            return timeString.substring(0, 5);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        window.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ PrimeSpeak Academy –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            generateCalendar();
            updateTestGradeDisplay();
            autoLogin();
            
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('scheduleDate')) {
                document.getElementById('scheduleDate').value = today;
            }
            if (document.getElementById('eventDate')) {
                document.getElementById('eventDate').value = today;
            }
        });

    </script>
</body>
    </html><!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrimeSpeak Academy</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root { --primary: #4f46e5; --primary-dark: #3730a3; --secondary: #10b981; --danger: #ef4444; --warning: #f59e0b; --light: #f8fafc; --dark: #1e293b; --gray: #64748b; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 15px; color: var(--dark); }
        .login-container { max-width: 400px; margin: 50px auto; background: white; border-radius: 15px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); padding: 30px; text-align: center; }
        .login-container h1 { color: var(--primary-dark); margin-bottom: 10px; }
        .login-container p { color: var(--gray); margin-bottom: 25px; }
        .login-tabs { display: flex; margin-bottom: 20px; border-radius: 10px; overflow: hidden; background: #f1f5f9; }
        .login-tab { flex: 1; padding: 12px; border: none; background: none; cursor: pointer; font-weight: 600; }
        .login-tab.active { background: var(--primary); color: white; }
        .login-input { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; }
        .login-input:focus { border-color: var(--primary); outline: none; }
        .login-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .login-btn:hover { background: var(--primary-dark); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–∞ "–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è" */
        .remember-me { 
            display: flex; 
            align-items: center; 
            margin: 15px 0; 
            cursor: pointer;
            font-size: 14px;
            color: var(--gray);
        }
        .remember-me input { 
            margin-right: 8px; 
            width: 16px; 
            height: 16px;
            cursor: pointer;
        }
        
        .container { max-width: 100%; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; margin: 0 auto; display: none; }
        .header { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; padding: 25px 15px; text-align: center; position: relative; }
        .user-info { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; font-size: 0.9em; }
        .logout-btn { background: rgba(255,255,255,0.3); border: none; color: white; padding: 5px 10px; border-radius: 10px; cursor: pointer; margin-left: 10px; }
        .nav { display: flex; background: var(--primary-dark); flex-wrap: wrap; }
        .nav-btn { flex: 1; min-width: 80px; background: none; border: none; color: white; padding: 15px 10px; cursor: pointer; font-size: 12px; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .nav-btn.active { background: var(--primary); }
        .content { padding: 20px 15px; min-height: 500px; }
        .section { display: none; }
        .section.active { display: block; }
        .card { background: var(--light); border-radius: 12px; padding: 20px; margin-bottom: 15px; border-left: 4px solid var(--primary); }
        .student-card { display: flex; flex-direction: column; gap: 12px; }
        .student-info h3 { color: var(--primary-dark); margin-bottom: 6px; font-size: 1.2em; }
        .student-info p { color: var(--gray); margin: 2px 0; font-size: 0.9em; }
        .student-stats { display: flex; justify-content: space-between; align-items: center; }
        .average-grade { font-size: 1.5em; font-weight: bold; color: var(--primary); }
        .grade { display: inline-flex; align-items: center; justify-content: center; width: 35px; height: 35px; color: white; border-radius: 8px; font-weight: bold; margin: 2px; font-size: 0.9em; border: 2px solid transparent; }
        .grade-1, .grade-2, .grade-3 { background: #ef4444; }
        .grade-4, .grade-5, .grade-6 { background: #f59e0b; }
        .grade-7, .grade-8, .grade-9, .grade-10 { background: #10b981; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: var(--dark); font-size: 0.9em; }
        .input, .select { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 14px; }
        .input:focus, .select:focus { border-color: var(--primary); outline: none; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; width: 100%; margin-top: 10px; }
        .btn:hover { background: var(--primary-dark); }
        .btn-success { background: var(--secondary); }
        .btn-success:hover { background: #0da271; }
        .btn-danger { background: var(--danger); }
        .btn-danger:hover { background: #dc2626; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 20px 0; }
        .stat-card { background: white; padding: 15px; border-radius: 10px; text-align: center; box-shadow: 0 3px 10px rgba(0,0,0,0.08); border-top: 4px solid var(--primary); }
        .stat-number { font-size: 1.8em; font-weight: bold; color: var(--primary); margin: 5px 0; }
        .stat-label { color: var(--gray); font-size: 0.8em; }
        .empty-state { text-align: center; padding: 40px 15px; color: var(--gray); }
        h2 { margin-bottom: 15px; color: var(--primary-dark); font-size: 1.3em; }
        h3 { margin-bottom: 10px; color: var(--dark); font-size: 1.1em; }
        .student-grades-list { margin-top: 20px; }
        .grade-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #e2e8f0; }
        .grade-item:last-child { border-bottom: none; }
        .login-info { background: #f0f9ff; border: 2px solid #0ea5e9; border-radius: 10px; padding: 15px; margin: 10px 0; }
        .grade-type-tabs { display: flex; margin-bottom: 15px; border-radius: 8px; overflow: hidden; background: #f1f5f9; }
        .grade-type-tab { flex: 1; padding: 10px; border: none; background: none; cursor: pointer; font-weight: 600; font-size: 12px; }
        .grade-type-tab.active { background: var(--primary); color: white; }
        .save-btn { background: var(--secondary); margin-top: 5px; }
        .save-btn:hover { background: #0da271; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—Ü–µ–Ω–æ–∫ */
        .grade-type-badge { 
            display: inline-block; 
            padding: 4px 8px; 
            border-radius: 6px; 
            font-size: 0.7em; 
            font-weight: bold; 
            margin-left: 8px; 
        }
        .type-regular { background: #dbeafe; color: #1e40af; }
        .type-test { background: #f3e8ff; color: #7e22ce; }
        .type-homework { background: #dcfce7; color: #166534; }
        .type-activity { background: #fef3c7; color: #92400e; }
        .type-project { background: #ffe4e6; color: #be123c; }
        .type-oral { background: #e0e7ff; color: #3730a3; }
        .type-attendance { background: #f1f5f9; color: #475569; }
        
        .grade-display { 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            min-width: 60px; 
            height: 35px; 
            color: white; 
            border-radius: 8px; 
            font-weight: bold; 
            margin: 2px; 
            font-size: 0.9em; 
            padding: 0 10px; 
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
        .calendar { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .calendar-day { text-align: center; padding: 10px; border-radius: 8px; cursor: pointer; }
        .calendar-day:hover { background: #f1f5f9; }
        .calendar-day.today { background: var(--primary); color: white; }
        .calendar-day.has-event { background: #f0f9ff; border: 2px solid #0ea5e9; }
        .calendar-day.weekend { color: var(--danger); }
        .calendar-event { background: var(--secondary); color: white; padding: 4px 8px; border-radius: 6px; font-size: 0.8em; margin-top: 4px; }
        
        /* –£–õ–£–ß–®–ï–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –†–ê–°–ü–ò–°–ê–ù–ò–Ø */
        .schedule-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 15px; }
        .schedule-item { 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            border-left: 6px solid var(--primary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        .schedule-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12);
        }
        .schedule-item.ongoing { 
            border-left-color: var(--secondary);
            background: linear-gradient(135deg, #f0fdf4, white);
        }
        .schedule-item.upcoming { 
            border-left-color: var(--warning);
            background: linear-gradient(135deg, #fffbeb, white);
        }
        .schedule-item.completed { 
            border-left-color: var(--gray);
            opacity: 0.8;
        }
        .schedule-time { 
            font-weight: bold; 
            color: var(--primary); 
            margin-bottom: 8px;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .schedule-subject { 
            font-size: 1.2em; 
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        .schedule-teacher { 
            color: var(--gray); 
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .schedule-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.7em;
            font-weight: bold;
            text-transform: uppercase;
        }
        .status-ongoing { background: var(--secondary); color: white; }
        .status-upcoming { background: var(--warning); color: white; }
        .status-completed { background: var(--gray); color: white; }
        
        /* –§–∏–ª—å—Ç—Ä—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è */
        .schedule-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .filter-btn.active {
            background: var(--primary);
            color: white;
        }
        .filter-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π */
        .notification { background: #fef3c7; border: 2px solid #f59e0b; border-radius: 10px; padding: 15px; margin-bottom: 10px; }
        .notification.upcoming { background: #f0fdf4; border-color: var(--secondary); }
        .notification.important { background: #fee2e2; border-color: var(--danger); }
        
        /* –¶–í–ï–¢–ê –î–õ–Ø –í–°–ï–• –¢–ò–ü–û–í –û–¶–ï–ù–û–ö */
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (1-5) */
        .activity-grade-1, .activity-grade-2 { background: #ef4444; }
        .activity-grade-3 { background: #f59e0b; }
        .activity-grade-4, .activity-grade-5 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è —É—Å—Ç–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (1-5) */
        .oral-grade-1, .oral-grade-2 { background: #ef4444; }
        .oral-grade-3 { background: #f59e0b; }
        .oral-grade-4, .oral-grade-5 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π (1-10) */
        .homework-grade-1, .homework-grade-2, .homework-grade-3 { background: #ef4444; }
        .homework-grade-4, .homework-grade-5, .homework-grade-6 { background: #f59e0b; }
        .homework-grade-7, .homework-grade-8, .homework-grade-9, .homework-grade-10 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–æ–≤ (1-25) */
        .test-grade-1, .test-grade-2, .test-grade-3, .test-grade-4, .test-grade-5, 
        .test-grade-6, .test-grade-7, .test-grade-8, .test-grade-9, .test-grade-10 { background: #ef4444; }
        .test-grade-11, .test-grade-12, .test-grade-13, .test-grade-14, .test-grade-15 { background: #f59e0b; }
        .test-grade-16, .test-grade-17, .test-grade-18, .test-grade-19, .test-grade-20,
        .test-grade-21, .test-grade-22, .test-grade-23, .test-grade-24, .test-grade-25 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–æ–≤ (1-20) */
        .project-grade-1, .project-grade-2, .project-grade-3, .project-grade-4, .project-grade-5,
        .project-grade-6, .project-grade-7, .project-grade-8, .project-grade-9, .project-grade-10 { background: #ef4444; }
        .project-grade-11, .project-grade-12, .project-grade-13, .project-grade-14, .project-grade-15 { background: #f59e0b; }
        .project-grade-16, .project-grade-17, .project-grade-18, .project-grade-19, .project-grade-20 { background: #10b981; }
        
        /* –¶–≤–µ—Ç–∞ –¥–ª—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ (0-2) */
        .attendance-grade-0 { background: #ef4444; }
        .attendance-grade-1 { background: #ef4444; }
        .attendance-grade-2 { background: #10b981; }
        
        /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –¥–ª—è —Ç–µ—Å—Ç–æ–≤ */
        .test-grade-progress { background: #e2e8f0; border-radius: 10px; height: 8px; margin: 5px 0; overflow: hidden; }
        .test-grade-progress-bar { background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981); height: 100%; transition: width 0.3s; }
        .test-grade-info { font-size: 0.8em; color: var(--gray); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π –∫—É—Ä—Å–æ–≤ */
        .course-badge { 
            display: inline-block; 
            padding: 4px 12px; 
            border-radius: 20px; 
            font-size: 0.8em; 
            font-weight: bold; 
            margin: 2px;
        }
        .course-beginner { background: #dbeafe; color: #1e40af; border: 2px solid #3b82f6; }
        .course-elementary { background: #dcfce7; color: #166534; border: 2px solid #10b981; }
        .course-intermediate { background: #fef3c7; color: #92400e; border: 2px solid #f59e0b; }
        .course-advanced { background: #f3e8ff; color: #7e22ce; border: 2px solid #8b5cf6; }
        .course-fluent { background: #fce7f3; color: #be185d; border: 2px solid #ec4899; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏–π –∫—É—Ä—Å–æ–≤ */
        .course-tooltip {
            position: relative;
            cursor: help;
        }
        .course-tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8em;
            white-space: nowrap;
            z-index: 1000;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–∞–Ω–µ–ª–∏ –∑–∞–≤—É—á–∞ */
        .academic-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
        .academic-card { 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            text-align: center; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border-top: 4px solid var(--primary);
        }
        .academic-number { font-size: 2em; font-weight: bold; color: var(--primary); margin: 10px 0; }
        .performance-chart { background: white; padding: 20px; border-radius: 12px; margin: 15px 0; }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .nav-btn { min-width: 70px; font-size: 10px; padding: 12px 5px; }
            .stats-grid { grid-template-columns: 1fr; }
            .schedule-filters { justify-content: center; }
            .schedule-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="login-container" id="loginScreen">
        <h1>üìö PrimeSpeak Academy</h1>
        <p>–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</p>
        
        <div class="login-tabs">
            <button class="login-tab active" onclick="showLoginTab('teacher')">üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å</button>
            <button class="login-tab" onclick="showLoginTab('student')">üë®‚Äçüéì –£—á–µ–Ω–∏–∫</button>
            <button class="login-tab" onclick="showLoginTab('head_teacher')">üéì –ó–∞–≤—É—á</button>
        </div>

        <div id="teacherLogin">
            <input type="text" class="login-input" id="teacherEmail" placeholder="Email —É—á–∏—Ç–µ–ª—è">
            <input type="password" class="login-input" id="teacherPassword" placeholder="–ü–∞—Ä–æ–ª—å —É—á–∏—Ç–µ–ª—è">
            
            <!-- –î–û–ë–ê–í–õ–ï–ù –ß–ï–ö–ë–û–ö–° "–ó–ê–ü–û–ú–ù–ò–¢–¨ –ú–ï–ù–Ø" -->
            <label class="remember-me">
                <input type="checkbox" id="rememberTeacher">
                –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è
            </label>
            
            <button class="login-btn" onclick="loginTeacher()">–í–æ–π—Ç–∏ –∫–∞–∫ —É—á–∏—Ç–µ–ª—å</button>
        </div>

        <div id="studentLogin" style="display: none;">
            <input type="text" class="login-input" id="studentLoginInput" placeholder="–õ–æ–≥–∏–Ω —É—á–µ–Ω–∏–∫–∞">
            <input type="password" class="login-input" id="studentPassword" placeholder="–ü–∞—Ä–æ–ª—å —É—á–µ–Ω–∏–∫–∞">
            
            <!-- –î–û–ë–ê–í–õ–ï–ù –ß–ï–ö–ë–û–ö–° "–ó–ê–ü–û–ú–ù–ò–¢–¨ –ú–ï–ù–Ø" -->
            <label class="remember-me">
                <input type="checkbox" id="rememberStudent">
                –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è
            </label>
            
            <button class="login-btn" onclick="loginStudent()">–í–æ–π—Ç–∏ –∫–∞–∫ —É—á–µ–Ω–∏–∫</button>
        </div>

        <div id="headTeacherLogin" style="display: none;">
            <input type="text" class="login-input" id="headTeacherEmail" placeholder="Email –∑–∞–≤—É—á–∞">
            <input type="password" class="login-input" id="headTeacherPassword" placeholder="–ü–∞—Ä–æ–ª—å –∑–∞–≤—É—á–∞">
            
            <!-- –î–û–ë–ê–í–õ–ï–ù –ß–ï–ö–ë–û–ö–° "–ó–ê–ü–û–ú–ù–ò–¢–¨ –ú–ï–ù–Ø" -->
            <label class="remember-me">
                <input type="checkbox" id="rememberHeadTeacher">
                –ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è
            </label>
            
            <button class="login-btn" onclick="loginHeadTeacher()">–í–æ–π—Ç–∏ –∫–∞–∫ –∑–∞–≤—É—á</button>
        </div>

        <button onclick="testConnection()" style="margin-top: 20px; padding: 10px; background: #10b981; color: white; border: none; border-radius: 5px; cursor: pointer; width: 100%;">
            üß™ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
        </button>
    </div>

    <div class="container" id="mainApp">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –£—á–∏—Ç–µ–ª—è -->
        <div class="header" id="teacherHeader">
            <div class="user-info">
                üë®‚Äçüè´ <span id="userName">–£—á–∏—Ç–µ–ª—å</span>
                <button class="logout-btn" onclick="logout()">üö™</button>
            </div>
            <h1>üìö PrimeSpeak Academy</h1>
            <div class="company-name">–ü–∞–Ω–µ–ª—å —É—á–∏—Ç–µ–ª—è</div>
            <p>–û—Ü–µ–Ω–∫–∏ ‚Ä¢ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚Ä¢ –ö–∞–ª–µ–Ω–¥–∞—Ä—å ‚Ä¢ –£—á–µ–Ω–∏–∫–∏</p>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –£—á–µ–Ω–∏–∫–∞ -->
        <div class="header" id="studentHeader" style="display: none;">
            <div class="user-info">
                üë®‚Äçüéì <span id="studentNameDisplay">–£—á–µ–Ω–∏–∫</span>
                <button class="logout-btn" onclick="logout()">üö™</button>
            </div>
            <h1>üìö PrimeSpeak Academy</h1>
            <div class="company-name">–ú–æ–π —É—á–µ–±–Ω—ã–π –ø–æ—Ä—Ç–∞–ª</div>
            <p>–û—Ü–µ–Ω–∫–∏ ‚Ä¢ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚Ä¢ –ö–∞–ª–µ–Ω–¥–∞—Ä—å ‚Ä¢ –ü—Ä–æ–≥—Ä–µ—Å—Å</p>
            <p style="margin-top: 10px;"><strong>üë®‚Äçüè´ –í–∞—à —É—á–∏—Ç–µ–ª—å: Radmir Nurislamov</strong></p>
        </div>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –ó–∞–≤—É—á–∞ -->
        <div class="header" id="headTeacherHeader" style="display: none;">
            <div class="user-info">
                üéì <span id="headTeacherNameDisplay">–ó–∞–≤—É—á</span>
                <button class="logout-btn" onclick="logout()">üö™</button>
            </div>
            <h1>üìö PrimeSpeak Academy</h1>
            <div class="company-name">–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è –ø–∞–Ω–µ–ª—å –∑–∞–≤—É—á–∞</div>
            <p>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Ä¢ –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ ‚Ä¢ –û—Ç—á–µ—Ç—ã ‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</p>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –£—á–∏—Ç–µ–ª—è -->
        <div class="nav" id="teacherNav">
            <button class="nav-btn active" onclick="showSection('dashboard')">üìä<span>–î–∞—à–±–æ—Ä–¥</span></button>
            <button class="nav-btn" onclick="showSection('students')">üë®‚Äçüéì<span>–£—á–µ–Ω–∏–∫–∏</span></button>
            <button class="nav-btn" onclick="showSection('addStudent')">‚ûï<span>–î–æ–±–∞–≤–∏—Ç—å</span></button>
            <button class="nav-btn" onclick="showSection('grades')">üìù<span>–û—Ü–µ–Ω–∫–∏</span></button>
            <button class="nav-btn" onclick="showSection('schedule')">üìÖ<span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span></button>
            <button class="nav-btn" onclick="showSection('calendar')">üóìÔ∏è<span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span></button>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –¥–ª—è –ó–∞–≤—É—á–∞ -->
        <div class="nav" id="headTeacherNav" style="display: none;">
            <button class="nav-btn active" onclick="showSection('headTeacherDashboard')">üéì<span>–î–∞—à–±–æ—Ä–¥</span></button>
            <button class="nav-btn" onclick="showSection('academicAnalytics')">üìä<span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span></button>
            <button class="nav-btn" onclick="showSection('teacherManagement')">üë®‚Äçüè´<span>–£—á–∏—Ç–µ–ª—è</span></button>
            <button class="nav-btn" onclick="showSection('students')">üë®‚Äçüéì<span>–£—á–µ–Ω–∏–∫–∏</span></button>
            <button class="nav-btn" onclick="showSection('schedule')">üìÖ<span>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</span></button>
            <button class="nav-btn" onclick="showSection('qualityControl')">üéØ<span>–ö–æ–Ω—Ç—Ä–æ–ª—å</span></button>
            <button class="nav-btn" onclick="showSection('reports')">üìã<span>–û—Ç—á–µ—Ç—ã</span></button>
        </div>

        <div class="content">
            <!-- –î–ê–®–ë–û–†–î –£–ß–ò–¢–ï–õ–Ø -->
            <div id="dashboard" class="section active">
                <h2>üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                <div class="stats-grid">
                    <div class="stat-card"><div>üë®‚Äçüéì</div><div class="stat-number" id="totalStudents">0</div><div class="stat-label">–£—á–µ–Ω–∏–∫–æ–≤</div></div>
                    <div class="stat-card"><div>‚≠ê</div><div class="stat-number" id="averageGrade">0.0</div><div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</div></div>
                    <div class="stat-card"><div>üìù</div><div class="stat-number" id="totalGrades">0</div><div class="stat-label">–û—Ü–µ–Ω–æ–∫</div></div>
                    <div class="stat-card"><div>üéØ</div><div class="stat-number" id="gradeTypesCount">7</div><div class="stat-label">–¢–∏–ø–æ–≤ –æ—Ü–µ–Ω–æ–∫</div></div>
                </div>
                
                <div class="card">
                    <h3>üîî –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                    <div id="upcomingEvents"></div>
                </div>
                
                <div class="card"><h3>üìà –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏</h3><div id="recentGrades"></div></div>
                <div class="card"><h3>üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º</h3><div id="courseLevelsStats"></div></div>
            </div>

            <!-- –î–ê–®–ë–û–†–î –ó–ê–í–£–ß–ê -->
            <div id="headTeacherDashboard" class="section">
                <h2>üéì –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è –ø–∞–Ω–µ–ª—å –∑–∞–≤—É—á–∞</h2>
                
                <div class="academic-stats">
                    <div class="academic-card">
                        <div>üë®‚Äçüè´</div>
                        <div class="academic-number" id="htTotalTeachers">0</div>
                        <div class="stat-label">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="academic-card">
                        <div>üë®‚Äçüéì</div>
                        <div class="academic-number" id="htTotalStudents">0</div>
                        <div class="stat-label">–£—á–µ–Ω–∏–∫–æ–≤</div>
                    </div>
                    <div class="academic-card">
                        <div>üìä</div>
                        <div class="academic-number" id="htSchoolAverage">0.0</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω–∏–π –ø–æ —à–∫–æ–ª–µ</div>
                    </div>
                    <div class="academic-card">
                        <div>üéØ</div>
                        <div class="academic-number" id="htSuccessRate">0%</div>
                        <div class="stat-label">–£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å</div>
                    </div>
                </div>

                <div class="card">
                    <h3>üìà –£—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å –ø–æ —É—Ä–æ–≤–Ω—è–º</h3>
                    <div id="levelPerformance"></div>
                </div>

                <div class="card">
                    <h3>üë®‚Äçüè´ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</h3>
                    <div id="teacherActivity"></div>
                </div>

                <div class="card">
                    <h3>üìä –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—É—á–µ–Ω–∏—è</h3>
                    <div id="qualityMetrics"></div>
                </div>

                <div class="card">
                    <h3>üìã –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç—á–µ—Ç—ã</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button class="btn" onclick="generateAcademicReport()">üìÑ –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç</button>
                        <button class="btn" onclick="generateTeacherReport()">üë®‚Äçüè´ –û—Ç—á–µ—Ç –ø–æ —É—á–∏—Ç–µ–ª—è–º</button>
                        <button class="btn" onclick="generateProgressReport()">üìà –û—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É</button>
                        <button class="btn" onclick="generateQualityReport()">üéØ –û—Ç—á–µ—Ç –∫–∞—á–µ—Å—Ç–≤–∞</button>
                    </div>
                </div>
            </div>

            <!-- –ê–ù–ê–õ–ò–¢–ò–ö–ê –î–õ–Ø –ó–ê–í–£–ß–ê -->
            <div id="academicAnalytics" class="section">
                <h2>üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                <div class="card">
                    <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏</h3>
                    <div id="detailedAnalytics"></div>
                </div>
            </div>

            <!-- –£–ü–†–ê–í–õ–ï–ù–ò–ï –£–ß–ò–¢–ï–õ–Ø–ú–ò -->
            <div id="teacherManagement" class="section">
                <h2>üë®‚Äçüè´ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º–∏</h2>
                <div class="card">
                    <h3>–°–ø–∏—Å–æ–∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π</h3>
                    <div id="teachersList"></div>
                </div>
            </div>

            <!-- –ö–û–ù–¢–†–û–õ–¨ –ö–ê–ß–ï–°–¢–í–ê -->
            <div id="qualityControl" class="section">
                <h2>üéØ –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—É—á–µ–Ω–∏—è</h2>
                <div class="card">
                    <h3>–ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞</h3>
                    <div id="qualityControlMetrics"></div>
                </div>
            </div>

            <!-- –û–¢–ß–ï–¢–´ -->
            <div id="reports" class="section">
                <h2>üìã –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ –æ—Ç—á–µ—Ç—ã</h2>
                <div class="card">
                    <h3>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤</h3>
                    <div id="reportsSection"></div>
                </div>
            </div>

            <!-- –£–ß–ï–ù–ò–ö–ò -->
            <div id="students" class="section">
                <h2>üë®‚Äçüéì –°–ø–∏—Å–æ–∫ —É—á–µ–Ω–∏–∫–æ–≤</h2>
                <div class="card">
                    <div class="form-group">
                        <input type="text" class="input" id="searchStudent" placeholder="üîç –ü–æ–∏—Å–∫ —É—á–µ–Ω–∏–∫–∞ –ø–æ –∏–º–µ–Ω–∏..." onkeyup="searchStudents()">
                    </div>
                </div>
                <div id="studentsList"></div>
            </div>

            <!-- –î–û–ë–ê–í–õ–ï–ù–ò–ï –£–ß–ï–ù–ò–ö–ê -->
            <div id="addStudent" class="section">
                <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</h2>
                <div class="card">
                    <div class="form-group">
                        <label>üë§ –ü–æ–ª–Ω–æ–µ –∏–º—è —É—á–µ–Ω–∏–∫–∞</label>
                        <input type="text" class="input" id="studentName" placeholder="–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è">
                    </div>
                    <div class="form-group">
                        <label>üë§ –õ–æ–≥–∏–Ω –¥–ª—è –≤—Ö–æ–¥–∞</label>
                        <input type="text" class="input" id="studentUsername" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω">
                    </div>
                    <div class="form-group">
                        <label>üîë –ü–∞—Ä–æ–ª—å –¥–ª—è –≤—Ö–æ–¥–∞</label>
                        <input type="text" class="input" id="studentPasswordInput" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                    <div class="form-group">
                        <label>üìß Email —É—á–µ–Ω–∏–∫–∞</label>
                        <input type="email" class="input" id="studentEmail" placeholder="example@gmail.com">
                    </div>
                    <div class="form-group">
                        <label>üìö –£—Ä–æ–≤–µ–Ω—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ</label>
                        <select class="select" id="studentCourse">
                            <option value="beginner">BEGINNER (A1) - –ù–∞—á–∏–Ω–∞—é—â–∏–π</option>
                            <option value="elementary">ELEMENTARY (A2) - –≠–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã–π</option>
                            <option value="intermediate">INTERMEDIATE (B1) - –°—Ä–µ–¥–Ω–∏–π</option>
                            <option value="advanced">ADVANCED (B2) - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</option>
                            <option value="fluent">FLUENT (C1-C2) - –°–≤–æ–±–æ–¥–Ω—ã–π</option>
                        </select>
                    </div>
                    <button class="btn" onclick="addStudent()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å —É—á–µ–Ω–∏–∫–∞</button>
                </div>
            </div>

            <!-- –û–¶–ï–ù–ö–ò -->
            <div id="grades" class="section">
                <h2>üìù –í—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫</h2>
                <div class="card">
                    <div class="form-group">
                        <label>üë®‚Äçüéì –í—ã–±–µ—Ä–∏—Ç–µ —É—á–µ–Ω–∏–∫–∞</label>
                        <select class="select" id="gradeStudent"></select>
                    </div>
                    
                    <div class="grade-type-tabs">
                        <button class="grade-type-tab active" onclick="showGradeType('regular')">üìö –û–±—ã—á–Ω—ã–µ</button>
                        <button class="grade-type-tab" onclick="showGradeType('test')">üéì –¢–µ—Å—Ç—ã</button>
                        <button class="grade-type-tab" onclick="showGradeType('homework')">üè† –î–æ–º–∞—à–Ω–∏–µ</button>
                        <button class="grade-type-tab" onclick="showGradeType('activity')">üí™ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</button>
                        <button class="grade-type-tab" onclick="showGradeType('project')">üìÅ –ü—Ä–æ–µ–∫—Ç—ã</button>
                        <button class="grade-type-tab" onclick="showGradeType('oral')">üé§ –£—Å—Ç–Ω—ã–µ</button>
                        <button class="grade-type-tab" onclick="showGradeType('attendance')">üìÖ –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</button>
                    </div>

                    <!-- –û–±—ã—á–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏ (10 –±–∞–ª–ª–æ–≤) -->
                    <div id="regularGrades" class="grade-type-content">
                        <div class="form-group">
                            <label>‚≠ê –û—Ü–µ–Ω–∫–∞ (10-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="gradeValue">
                                <option value="1">1 - –û—á–µ–Ω—å –ø–ª–æ—Ö–æ</option>
                                <option value="2">2 - –ü–ª–æ—Ö–æ</option>
                                <option value="3">3 - –ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="4">4 - –ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ</option>
                                <option value="5">5 - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="6">6 - –•–æ—Ä–æ—à–æ</option>
                                <option value="7">7 - –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ</option>
                                <option value="8">8 - –û—Ç–ª–∏—á–Ω–æ</option>
                                <option value="9">9 - –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ</option>
                                <option value="10">10 - –ë–ª–µ—Å—Ç—è—â–µ</option>
                            </select>
                        </div>
                    </div>

                    <!-- –¢–µ—Å—Ç—ã (25 –±–∞–ª–ª–æ–≤) -->
                    <div id="testGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üéì –û—Ü–µ–Ω–∫–∞ –∑–∞ —Ç–µ—Å—Ç (25-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞) 
                                <span id="testGradeDisplay" style="color: var(--primary); font-weight: bold; margin-left: 10px;">15/25</span>
                            </label>
                            <select class="select" id="testGradeValue" onchange="updateTestGradeDisplay()">
                                <option value="1">1 –±–∞–ª–ª</option>
                                <option value="2">2 –±–∞–ª–ª–∞</option>
                                <option value="3">3 –±–∞–ª–ª–∞</option>
                                <option value="4">4 –±–∞–ª–ª–∞</option>
                                <option value="5">5 –±–∞–ª–ª–æ–≤</option>
                                <option value="6">6 –±–∞–ª–ª–æ–≤</option>
                                <option value="7">7 –±–∞–ª–ª–æ–≤</option>
                                <option value="8">8 –±–∞–ª–ª–æ–≤</option>
                                <option value="9">9 –±–∞–ª–ª–æ–≤</option>
                                <option value="10">10 –±–∞–ª–ª–æ–≤</option>
                                <option value="11">11 –±–∞–ª–ª–æ–≤</option>
                                <option value="12">12 –±–∞–ª–ª–æ–≤</option>
                                <option value="13">13 –±–∞–ª–ª–æ–≤</option>
                                <option value="14">14 –±–∞–ª–ª–æ–≤</option>
                                <option value="15" selected>15 –±–∞–ª–ª–æ–≤</option>
                                <option value="16">16 –±–∞–ª–ª–æ–≤</option>
                                <option value="17">17 –±–∞–ª–ª–æ–≤</option>
                                <option value="18">18 –±–∞–ª–ª–æ–≤</option>
                                <option value="19">19 –±–∞–ª–ª–æ–≤</option>
                                <option value="20">20 –±–∞–ª–ª–æ–≤</option>
                                <option value="21">21 –±–∞–ª–ª</option>
                                <option value="22">22 –±–∞–ª–ª–∞</option>
                                <option value="23">23 –±–∞–ª–ª–∞</option>
                                <option value="24">24 –±–∞–ª–ª–∞</option>
                                <option value="25">25 –±–∞–ª–ª–æ–≤</option>
                            </select>
                        </div>
                    </div>

                    <!-- –î–æ–º–∞—à–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è (10 –±–∞–ª–ª–æ–≤) -->
                    <div id="homeworkGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üè† –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ (10-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="homeworkGradeValue">
                                <option value="1">1 - –ù–µ —Å–¥–∞–Ω–æ</option>
                                <option value="2">2 - –û—á–µ–Ω—å –ø–ª–æ—Ö–æ</option>
                                <option value="3">3 - –ü–ª–æ—Ö–æ</option>
                                <option value="4">4 - –ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ</option>
                                <option value="5">5 - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="6">6 - –•–æ—Ä–æ—à–æ</option>
                                <option value="7">7 - –û—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ</option>
                                <option value="8">8 - –û—Ç–ª–∏—á–Ω–æ</option>
                                <option value="9">9 - –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ</option>
                                <option value="10">10 - –ò–¥–µ–∞–ª—å–Ω–æ</option>
                            </select>
                        </div>
                    </div>

                    <!-- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–∫–µ (5 –±–∞–ª–ª–æ–≤) -->
                    <div id="activityGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üí™ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–∫–µ (5-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="activityGradeValue">
                                <option value="1">1 - –ü–∞—Å—Å–∏–≤–Ω—ã–π</option>
                                <option value="2">2 - –†–µ–¥–∫–æ —É—á–∞—Å—Ç–≤—É–µ—Ç</option>
                                <option value="3">3 - –°—Ä–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</option>
                                <option value="4">4 - –ê–∫—Ç–∏–≤–Ω—ã–π</option>
                                <option value="5">5 - –û—á–µ–Ω—å –∞–∫—Ç–∏–≤–Ω—ã–π</option>
                            </select>
                        </div>
                    </div>

                    <!-- –ü—Ä–æ–µ–∫—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã (20 –±–∞–ª–ª–æ–≤) -->
                    <div id="projectGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üìÅ –ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (20-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="projectGradeValue">
                                <option value="1">1 –±–∞–ª–ª</option>
                                <option value="2">2 –±–∞–ª–ª–∞</option>
                                <option value="3">3 –±–∞–ª–ª–∞</option>
                                <option value="4">4 –±–∞–ª–ª–∞</option>
                                <option value="5">5 –±–∞–ª–ª–æ–≤</option>
                                <option value="6">6 –±–∞–ª–ª–æ–≤</option>
                                <option value="7">7 –±–∞–ª–ª–æ–≤</option>
                                <option value="8">8 –±–∞–ª–ª–æ–≤</option>
                                <option value="9">9 –±–∞–ª–ª–æ–≤</option>
                                <option value="10">10 –±–∞–ª–ª–æ–≤</option>
                                <option value="11">11 –±–∞–ª–ª–æ–≤</option>
                                <option value="12">12 –±–∞–ª–ª–æ–≤</option>
                                <option value="13">13 –±–∞–ª–ª–æ–≤</option>
                                <option value="14">14 –±–∞–ª–ª–æ–≤</option>
                                <option value="15">15 –±–∞–ª–ª–æ–≤</option>
                                <option value="16">16 –±–∞–ª–ª–æ–≤</option>
                                <option value="17">17 –±–∞–ª–ª–æ–≤</option>
                                <option value="18">18 –±–∞–ª–ª–æ–≤</option>
                                <option value="19">19 –±–∞–ª–ª–æ–≤</option>
                                <option value="20">20 –±–∞–ª–ª–æ–≤</option>
                            </select>
                        </div>
                    </div>

                    <!-- –£—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (5 –±–∞–ª–ª–æ–≤) -->
                    <div id="oralGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üé§ –£—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç (5-–±–∞–ª–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)</label>
                            <select class="select" id="oralGradeValue">
                                <option value="1">1 - –ù–µ –æ—Ç–≤–µ—Ç–∏–ª</option>
                                <option value="2">2 - –° –æ—à–∏–±–∫–∞–º–∏</option>
                                <option value="3">3 - –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ</option>
                                <option value="4">4 - –•–æ—Ä–æ—à–æ</option>
                                <option value="5">5 - –û—Ç–ª–∏—á–Ω–æ</option>
                            </select>
                        </div>
                    </div>

                    <!-- –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å (2 –±–∞–ª–ª–∞) -->
                    <div id="attendanceGrades" class="grade-type-content" style="display: none;">
                        <div class="form-group">
                            <label>üìÖ –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å</label>
                            <select class="select" id="attendanceGradeValue">
                                <option value="2">‚úÖ –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</option>
                                <option value="1">‚è∞ –û–ø–æ–∑–¥–∞–ª</option>
                                <option value="0">‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>üìÑ –ó–∞–¥–∞–Ω–∏–µ/–¢–µ–º–∞ —É—Ä–æ–∫–∞</label>
                        <input type="text" class="input" id="gradeAssignment" placeholder="Present Simple, Homework #5, Project Work">
                    </div>
                    <div class="form-group">
                        <label>üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <textarea class="input" id="gradeComment" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏..." rows="2"></textarea>
                    </div>
                    <button class="btn" onclick="addGrade()">üìù –ü–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</button>
                </div>
                <div class="card"><h3>üìã –ò—Å—Ç–æ—Ä–∏—è –æ—Ü–µ–Ω–æ–∫</h3><div id="gradesHistory"></div></div>
            </div>

            <!-- –£–õ–£–ß–®–ï–ù–ù–û–ï –†–ê–°–ü–ò–°–ê–ù–ò–ï -->
            <div id="schedule" class="section">
                <h2>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–Ω—è—Ç–∏–π</h2>
                
                <!-- –§–∏–ª—å—Ç—Ä—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è -->
                <div class="schedule-filters">
                    <button class="filter-btn active" onclick="filterSchedule('all')">üìÖ –í—Å–µ –∑–∞–Ω—è—Ç–∏—è</button>
                    <button class="filter-btn" onclick="filterSchedule('today')">üéØ –°–µ–≥–æ–¥–Ω—è</button>
                    <button class="filter-btn" onclick="filterSchedule('week')">üìÜ –≠—Ç–∞ –Ω–µ–¥–µ–ª—è</button>
                    <button class="filter-btn" onclick="filterSchedule('upcoming')">‚è∞ –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ</button>
                </div>
                
                <div class="card">
                    <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–Ω—è—Ç–∏–µ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
                    <div class="form-group">
                        <label>üìö –ü—Ä–µ–¥–º–µ—Ç</label>
                        <input type="text" class="input" id="scheduleSubject" placeholder="–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫, Grammar">
                    </div>
                    <div class="form-group">
                        <label>üë®‚Äçüè´ –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</label>
                        <input type="text" class="input" id="scheduleTeacher" placeholder="Radmir Nurislamov" value="Radmir Nurislamov">
                    </div>
                    <div class="form-group">
                        <label>üë®‚Äçüéì –£—Ä–æ–≤–µ–Ω—å/–ì—Ä—É–ø–ø–∞</label>
                        <select class="select" id="scheduleLevel">
                            <option value="all">–í—Å–µ —É—Ä–æ–≤–Ω–∏</option>
                            <option value="beginner">BEGINNER</option>
                            <option value="elementary">ELEMENTARY</option>
                            <option value="intermediate">INTERMEDIATE</option>
                            <option value="advanced">ADVANCED</option>
                            <option value="fluent">FLUENT</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üìÖ –î–∞—Ç–∞</label>
                        <input type="date" class="input" id="scheduleDate">
                    </div>
                    <div class="form-group">
                        <label>‚è∞ –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞</label>
                        <input type="time" class="input" id="scheduleStartTime">
                    </div>
                    <div class="form-group">
                        <label>‚è∞ –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                        <input type="time" class="input" id="scheduleEndTime">
                    </div>
                    <div class="form-group">
                        <label>üéØ –¢–∏–ø –∑–∞–Ω—è—Ç–∏—è</label>
                        <select class="select" id="scheduleType">
                            <option value="regular">üìö –û–±—ã—á–Ω—ã–π —É—Ä–æ–∫</option>
                            <option value="test">üéì –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                            <option value="conversation">üó£Ô∏è –†–∞–∑–≥–æ–≤–æ—Ä–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞</option>
                            <option value="grammar">üìñ –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞</option>
                            <option value="project">üìÅ –ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>üìù –û–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <textarea class="input" id="scheduleDescription" placeholder="–¢–µ–º–∞ —É—Ä–æ–∫–∞, –¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ..." rows="3"></textarea>
                    </div>
                    <button class="btn" onclick="addScheduleItem()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
                </div>

                <div class="card">
                    <h3>üóìÔ∏è –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –∑–∞–Ω—è—Ç–∏—è</h3>
                    <div id="upcomingLessons" class="schedule-grid"></div>
                </div>

                <div class="card">
                    <h3>üìã –í—Å–µ –∑–∞–Ω—è—Ç–∏—è</h3>
                    <div id="scheduleList" class="schedule-grid"></div>
                </div>
            </div>

            <!-- –ö–ê–õ–ï–ù–î–ê–†–¨ -->
            <div id="calendar" class="section">
                <h2>üóìÔ∏è –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π</h2>
                
                <div class="card">
                    <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</h3>
                    <div class="form-group">
                        <label>üéØ –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</label>
                        <input type="text" class="input" id="eventTitle" placeholder="–¢–µ—Å—Ç, –°–æ–±—Ä–∞–Ω–∏–µ, –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ">
                    </div>
                    <div class="form-group">
                        <label>üìÖ –î–∞—Ç–∞ —Å–æ–±—ã—Ç–∏—è</label>
                        <input type="date" class="input" id="eventDate">
                    </div>
                    <div class="form-group">
                        <label>‚è∞ –í—Ä–µ–º—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="time" class="input" id="eventTime">
                    </div>
                    <div class="form-group">
                        <label>üìù –û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea class="input" id="eventDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è..." rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>üé® –¢–∏–ø —Å–æ–±—ã—Ç–∏—è</label>
                        <select class="select" id="eventType">
                            <option value="lesson">üìö –£—Ä–æ–∫</option>
                            <option value="test">üéì –¢–µ—Å—Ç</option>
                            <option value="meeting">üë• –°–æ–±—Ä–∞–Ω–∏–µ</option>
                            <option value="holiday">üéâ –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</option>
                            <option value="deadline">‚è∞ –î–µ–¥–ª–∞–π–Ω</option>
                        </select>
                    </div>
                    <button class="btn" onclick="addCalendarEvent()">‚úÖ –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
                </div>

                <div class="card">
                    <div class="calendar-header">
                        <button class="btn" onclick="changeMonth(-1)" style="width: auto;">‚¨ÖÔ∏è</button>
                        <h3 id="currentMonth">–ú–∞–π 2024</h3>
                        <button class="btn" onclick="changeMonth(1)" style="width: auto;">‚û°Ô∏è</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>

                <div class="card">
                    <h3>üìÖ –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                    <div id="calendarEventsList"></div>
                </div>
            </div>

            <!-- –°–¢–†–ê–ù–ò–¶–ê –£–ß–ï–ù–ò–ö–ê -->
            <div id="studentGrades" class="section">
                <h2>üìä –ú–æ–π —É—á–µ–±–Ω—ã–π –ø–æ—Ä—Ç–∞–ª</h2>
                <div class="card">
                    <h3>üëã –ü—Ä–∏–≤–µ—Ç, <span id="welcomeStudentName">–£—á–µ–Ω–∏–∫</span>!</h3>
                    <p><strong>–¢–≤–æ–π —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª:</strong> <span id="studentAverageGrade" style="font-size: 1.5em; color: var(--primary);">0.0</span></p>
                    <p><strong>–£—Ä–æ–≤–µ–Ω—å:</strong> <span id="studentCourseDisplay">-</span></p>
                    <p><strong>–ó–∞—á–∏—Å–ª–µ–Ω:</strong> <span id="studentJoinDate">-</span></p>
                    <p><strong>üë®‚Äçüè´ –í–∞—à —É—á–∏—Ç–µ–ª—å:</strong> <span style="color: var(--primary); font-weight: bold;">Radmir Nurislamov</span></p>
                </div>

                <div class="card">
                    <h3>üìÖ –ú–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
                    <div id="studentTodaySchedule" class="schedule-grid"></div>
                </div>

                <div class="card">
                    <h3>üîî –ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h3>
                    <div id="studentUpcomingEvents"></div>
                </div>

                <div class="card">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –æ—Ü–µ–Ω–æ–∫</h3>
                    <div id="studentGradeStats"></div>
                </div>

                <div class="card">
                    <h3>üìù –ò—Å—Ç–æ—Ä–∏—è –º–æ–∏—Ö –æ—Ü–µ–Ω–æ–∫</h3>
                    <div class="student-grades-list" id="studentGradesList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø SUPABASE
        const supabaseUrl = 'https://kgkkdjujxruiakbglnop.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtna2tkanVqeHJ1aWFrYmdsbm9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyNzI0MDMsImV4cCI6MjA3ODg0ODQwM30.R8vESEB3T-wqPlsykf4YnKm3wawuu70Xeph4GUCigsM';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        let currentUser = null;
        let currentGradeType = 'regular';
        let currentDate = new Date();
        let currentScheduleFilter = 'all';

        // –°–ò–°–¢–ï–ú–ê –†–û–õ–ï–ô
        const userRoles = {
            'teacher': {
                name: 'üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å',
                permissions: ['view_students', 'add_grades', 'view_schedule', 'add_schedule'],
                dashboard: 'teacher_dashboard'
            },
            'student': {
                name: 'üë®‚Äçüéì –£—á–µ–Ω–∏–∫',
                permissions: ['view_own_grades', 'view_schedule'],
                dashboard: 'student_dashboard'
            },
            'head_teacher': {
                name: 'üéì –ó–∞–≤—É—á',
                permissions: [
                    'view_all_students', 'view_all_grades', 'view_all_teachers',
                    'manage_schedule', 'manage_curriculum', 'quality_control',
                    'progress_monitoring', 'generate_reports', 'teacher_performance',
                    'student_analytics', 'academic_planning'
                ],
                dashboard: 'head_teacher_dashboard'
            }
        };

        // –¢–ò–ü–´ –û–¶–ï–ù–û–ö
        const gradeTypes = {
            'regular': { name: 'üìö –û–±—ã—á–Ω–∞—è', max: 10, color: '#3b82f6' },
            'test': { name: 'üéì –¢–µ—Å—Ç', max: 25, color: '#8b5cf6' },
            'homework': { name: 'üè† –î–æ–º–∞—à–Ω—è—è', max: 10, color: '#10b981' },
            'activity': { name: 'üí™ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', max: 5, color: '#f59e0b' },
            'project': { name: 'üìÅ –ü—Ä–æ–µ–∫—Ç', max: 20, color: '#ec4899' },
            'oral': { name: 'üé§ –£—Å—Ç–Ω–∞—è', max: 5, color: '#06b6d4' },
            'attendance': { name: 'üìÖ –ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å', max: 2, color: '#6b7280' }
        };

        // –£–†–û–í–ù–ò –ö–£–†–°–û–í
        const courseLevels = {
            'beginner': { name: 'BEGINNER', level: 'A1', description: 'Basic vocabulary, simple sentences', color: 'course-beginner' },
            'elementary': { name: 'ELEMENTARY', level: 'A2', description: 'Everyday conversations, basic grammar', color: 'course-elementary' },
            'intermediate': { name: 'INTERMEDIATE', level: 'B1', description: 'Confident communication, complex sentences', color: 'course-intermediate' },
            'advanced': { name: 'ADVANCED', level: 'B2', description: 'Fluent speech, business English', color: 'course-advanced' },
            'fluent': { name: 'FLUENT', level: 'C1-C2', description: 'Native-like proficiency', color: 'course-fluent' }
        };

        // –î–ê–ù–ù–´–ï –î–õ–Ø –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò
        const teacherCredentials = {
            email: 'nurislamovradmir9@gmail.com',
            password: 'teacher123',
            name: 'Radmir Nurislamov'
        };

        const headTeacherCredentials = {
            email: 'nurislamovradmir9@gmail.com',
            password: 'headteacher123',
            name: 'Radmir Nurislamov'
        };

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –û–¶–ï–ù–ö–ê–ú–ò
        function getGradeColorClass(grade, type) {
            grade = parseInt(grade);
            if (type === 'test') {
                if (grade <= 10) return 'test-grade-1';
                if (grade <= 15) return 'test-grade-11';
                return 'test-grade-16';
            } else if (type === 'activity') {
                if (grade <= 2) return 'activity-grade-1';
                if (grade === 3) return 'activity-grade-3';
                return 'activity-grade-4';
            } else if (type === 'homework') {
                if (grade <= 3) return 'homework-grade-1';
                if (grade <= 6) return 'homework-grade-4';
                return 'homework-grade-7';
            } else if (type === 'project') {
                if (grade <= 10) return 'project-grade-1';
                if (grade <= 15) return 'project-grade-11';
                return 'project-grade-16';
            } else if (type === 'oral') {
                if (grade <= 2) return 'oral-grade-1';
                if (grade === 3) return 'oral-grade-3';
                return 'oral-grade-4';
            } else if (type === 'attendance') {
                return `attendance-grade-${grade}`;
            } else {
                if (grade <= 3) return `grade-${grade}`;
                if (grade <= 6) return `grade-${grade}`;
                return `grade-${grade}`;
            }
        }

        function renderGrade(grade, type) {
            const colorClass = getGradeColorClass(grade, type);
            if (type === 'test') {
                return `<span class="grade ${colorClass}">${grade}/25</span>`;
            } else if (type === 'activity') {
                return `<span class="grade ${colorClass}">${grade}/5</span>`;
            } else if (type === 'attendance') {
                const labels = { '0': '‚ùå', '1': '‚è∞', '2': '‚úÖ' };
                return `<span class="grade ${colorClass}">${labels[grade] || grade}/2</span>`;
            } else if (type === 'oral') {
                return `<span class="grade ${colorClass}">${grade}/5</span>`;
            } else if (type === 'project') {
                return `<span class="grade ${colorClass}">${grade}/20</span>`;
            } else if (type === 'homework') {
                return `<span class="grade ${colorClass}">${grade}/10</span>`;
            } else {
                return `<span class="grade ${colorClass}">${grade}</span>`;
            }
        }

        function renderCourseLevel(course) {
            const courseInfo = courseLevels[course] || { name: course, color: 'course-beginner' };
            return `<span class="course-badge ${courseInfo.color} course-tooltip" data-tooltip="${courseInfo.description}">${courseInfo.name} (${courseInfo.level})</span>`;
        }

        function getCourseName(course) {
            const courseInfo = courseLevels[course] || { name: course, level: '' };
            return `${courseInfo.name} (${courseInfo.level})`;
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –†–ê–°–ü–ò–°–ê–ù–ò–ï–ú
        function filterSchedule(filter) {
            currentScheduleFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            loadSchedule();
        }

        function getScheduleStatus(item) {
            const now = new Date();
            const lessonDate = new Date(item.date + 'T' + item.start_time);
            const lessonEnd = new Date(item.date + 'T' + item.end_time);
            
            if (now >= lessonDate && now <= lessonEnd) {
                return { status: 'ongoing', text: '–ò–¥–µ—Ç —Å–µ–π—á–∞—Å' };
            } else if (now < lessonDate) {
                return { status: 'upcoming', text: '–ü—Ä–µ–¥—Å—Ç–æ–∏—Ç' };
            } else {
                return { status: 'completed', text: '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' };
            }
        }

        // –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –°–ò–°–¢–ï–ú–´
        function updateTestGradeDisplay() {
            const gradeValue = document.getElementById('testGradeValue').value;
            document.getElementById('testGradeDisplay').textContent = `${gradeValue}/25`;
        }

        async function testConnection() {
            try {
                const { data, error } = await supabase.from('teacher').select('*').limit(1);
                if (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
                    return false;
                }
                alert('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ!');
                return true;
            } catch (err) {
                alert('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: ' + err.message);
                return false;
            }
        }

        function showLoginTab(tab) {
            document.querySelectorAll('.login-tab').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('teacherLogin').style.display = tab === 'teacher' ? 'block' : 'none';
            document.getElementById('studentLogin').style.display = tab === 'student' ? 'block' : 'none';
            document.getElementById('headTeacherLogin').style.display = tab === 'head_teacher' ? 'block' : 'none';
        }

        // –ù–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø "–ó–ê–ü–û–ú–ù–ò–¢–¨ –ú–ï–ù–Ø"
        function saveCredentials(role, credentials) {
            const rememberCheckbox = document.getElementById(`remember${role.charAt(0).toUpperCase() + role.slice(1)}`);
            
            if (rememberCheckbox && rememberCheckbox.checked) {
                localStorage.setItem(`${role}Credentials`, JSON.stringify(credentials));
                localStorage.setItem(`${role}RememberMe`, 'true');
            } else {
                localStorage.removeItem(`${role}Credentials`);
                localStorage.removeItem(`${role}RememberMe`);
            }
        }

        function restoreCredentials(role) {
            const savedCredentials = localStorage.getItem(`${role}Credentials`);
            const rememberMe = localStorage.getItem(`${role}RememberMe`);
            
            if (savedCredentials && rememberMe === 'true') {
                const credentials = JSON.parse(savedCredentials);
                
                if (role === 'teacher') {
                    document.getElementById('teacherEmail').value = credentials.email || '';
                    document.getElementById('teacherPassword').value = credentials.password || '';
                    document.getElementById('rememberTeacher').checked = true;
                } else if (role === 'student') {
                    document.getElementById('studentLoginInput').value = credentials.username || '';
                    document.getElementById('studentPassword').value = credentials.password || '';
                    document.getElementById('rememberStudent').checked = true;
                } else if (role === 'headTeacher') {
                    document.getElementById('headTeacherEmail').value = credentials.email || '';
                    document.getElementById('headTeacherPassword').value = credentials.password || '';
                    document.getElementById('rememberHeadTeacher').checked = true;
                }
                
                return true;
            }
            return false;
        }

        function autoLogin() {
            const roles = ['teacher', 'student', 'headTeacher'];
            
            for (let role of roles) {
                if (restoreCredentials(role)) {
                    if (role === 'teacher') {
                        showLoginTab('teacher');
                    } else if (role === 'student') {
                        showLoginTab('student');
                    } else if (role === 'headTeacher') {
                        showLoginTab('head_teacher');
                    }
                    break;
                }
            }
        }

        // –§–£–ù–ö–¶–ò–ò –í–•–û–î–ê
        async function loginTeacher() {
            const email = document.getElementById('teacherEmail').value;
            const password = document.getElementById('teacherPassword').value;
            
            if (!email || !password) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            try {
                if (email === teacherCredentials.email && password === teacherCredentials.password) {
                    currentUser = { 
                        name: teacherCredentials.name, 
                        email: teacherCredentials.email,
                        role: 'teacher' 
                    };
                    
                    saveCredentials('teacher', { email, password });
                    
                    showMainApp('teacher');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                } else {
                    const { data, error } = await supabase
                        .from('teacher')
                        .select('*')
                        .eq('email', email)
                        .eq('password', password)
                        .single();

                    if (error) throw error;

                    currentUser = { ...data, role: 'teacher' };
                    saveCredentials('teacher', { email, password });
                    showMainApp('teacher');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                }
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + err.message);
            }
        }

        async function loginStudent() {
            const username = document.getElementById('studentLoginInput').value;
            const password = document.getElementById('studentPassword').value;
            
            if (!username || !password) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('students')
                    .select('*')
                    .eq('username', username)
                    .eq('password', password)
                    .single();

                if (error) throw error;

                currentUser = { ...data, role: 'student' };
                saveCredentials('student', { username, password });
                showMainApp('student');
                alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + err.message);
            }
        }

        async function loginHeadTeacher() {
            const email = document.getElementById('headTeacherEmail').value;
            const password = document.getElementById('headTeacherPassword').value;
            
            if (!email || !password) {
                alert('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            try {
                if (email === headTeacherCredentials.email && password === headTeacherCredentials.password) {
                    currentUser = { 
                        name: headTeacherCredentials.name, 
                        email: headTeacherCredentials.email,
                        role: 'head_teacher' 
                    };
                    
                    saveCredentials('headTeacher', { email, password });
                    
                    showMainApp('head_teacher');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                } else {
                    const { data, error } = await supabase
                        .from('teacher')
                        .select('*')
                        .eq('email', email)
                        .eq('password', password)
                        .single();

                    if (error) throw error;

                    currentUser = { ...data, role: 'head_teacher' };
                    saveCredentials('headTeacher', { email, password });
                    showMainApp('head_teacher');
                    alert('üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ' + currentUser.name + '!');
                }
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + err.message);
            }
        }

        function showMainApp(role) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            document.getElementById('teacherHeader').style.display = 'none';
            document.getElementById('studentHeader').style.display = 'none';
            document.getElementById('headTeacherHeader').style.display = 'none';
            
            document.getElementById('teacherNav').style.display = 'none';
            document.getElementById('headTeacherNav').style.display = 'none';

            if (role === 'teacher') {
                document.getElementById('teacherHeader').style.display = 'block';
                document.getElementById('teacherNav').style.display = 'flex';
                document.getElementById('userName').textContent = currentUser.name;
                showSection('dashboard');
                loadTeacherData();
            } else if (role === 'student') {
                document.getElementById('studentHeader').style.display = 'block';
                document.getElementById('studentNameDisplay').textContent = currentUser.name;
                document.getElementById('welcomeStudentName').textContent = currentUser.name;
                showStudentGrades();
            } else if (role === 'head_teacher') {
                document.getElementById('headTeacherHeader').style.display = 'block';
                document.getElementById('headTeacherNav').style.display = 'flex';
                document.getElementById('headTeacherNameDisplay').textContent = currentUser.name;
                showSection('headTeacherDashboard');
                loadHeadTeacherData();
            }
            
            loadSchedule();
            loadCalendarEvents();
            generateCalendar();
        }

        function logout() {
            currentUser = null;
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            alert('üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!');
        }

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(sectionName).classList.add('active');
            if (event) event.currentTarget.classList.add('active');
        }

        function showGradeType(type) {
            currentGradeType = type;
            document.querySelectorAll('.grade-type-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.grade-type-content').forEach(content => content.style.display = 'none');
            
            event.target.classList.add('active');
            document.getElementById(type + 'Grades').style.display = 'block';
            if (type === 'test') updateTestGradeDisplay();
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–ß–ò–¢–ï–õ–Ø
        async function loadTeacherData() {
            await loadStudents();
            await loadGradeStudentSelect();
            await loadGradesHistory();
            await updateDashboard();
        }

        async function addStudent() {
            const name = document.getElementById('studentName').value.trim();
            const username = document.getElementById('studentUsername').value.trim();
            const password = document.getElementById('studentPasswordInput').value.trim();
            const email = document.getElementById('studentEmail').value.trim();
            const course = document.getElementById('studentCourse').value;

            if (!name || !username || !password) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('students')
                .insert([{
                    name: name,
                    username: username,
                    password: password,
                    email: email,
                    course: course,
                    join_date: new Date().toISOString().split('T')[0],
                    teacher_name: 'Radmir Nurislamov'
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            document.getElementById('studentName').value = '';
            document.getElementById('studentUsername').value = '';
            document.getElementById('studentPasswordInput').value = '';
            document.getElementById('studentEmail').value = '';
            
            loadStudents();
            updateDashboard();
            loadGradeStudentSelect();
            
            alert(`‚úÖ –£—á–µ–Ω–∏–∫ ${name} –¥–æ–±–∞–≤–ª–µ–Ω!\n\nüìã –î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:\nüë§ –õ–æ–≥–∏–Ω: ${username}\nüîë –ü–∞—Ä–æ–ª—å: ${password}`);
        }

        async function addGrade() {
            const studentId = parseInt(document.getElementById('gradeStudent').value);
            const assignment = document.getElementById('gradeAssignment').value.trim();
            
            let gradeValue;
            if (currentGradeType === 'regular') {
                gradeValue = document.getElementById('gradeValue').value;
            } else if (currentGradeType === 'test') {
                gradeValue = document.getElementById('testGradeValue').value;
            } else if (currentGradeType === 'homework') {
                gradeValue = document.getElementById('homeworkGradeValue').value;
            } else if (currentGradeType === 'activity') {
                gradeValue = document.getElementById('activityGradeValue').value;
            } else if (currentGradeType === 'project') {
                gradeValue = document.getElementById('projectGradeValue').value;
            } else if (currentGradeType === 'oral') {
                gradeValue = document.getElementById('oralGradeValue').value;
            } else if (currentGradeType === 'attendance') {
                gradeValue = document.getElementById('attendanceGradeValue').value;
            }

            if (!studentId || !gradeValue || !assignment) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('grades')
                .insert([{
                    student_id: studentId,
                    grade: parseInt(gradeValue),
                    assignment: assignment,
                    type: currentGradeType,
                    grade_date: new Date().toISOString().split('T')[0],
                    teacher_name: 'Radmir Nurislamov'
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            document.getElementById('gradeAssignment').value = '';
            document.getElementById('gradeComment').value = '';
            loadGradesHistory();
            updateDashboard();
            
            const student = await getStudentById(studentId);
            alert(`‚úÖ –û—Ü–µ–Ω–∫–∞ ${gradeValue}${currentGradeType === 'test' ? '/25' : ''} –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —É—á–µ–Ω–∏–∫—É ${student.name}!`);
        }

        async function loadStudents() {
            const { data: students, error } = await supabase
                .from('students')
                .select('*')
                .order('name');

            if (error) {
                console.error('Error loading students:', error);
                return;
            }

            const list = document.getElementById('studentsList');
            
            if (!students || students.length === 0) {
                list.innerHTML = '<div class="empty-state"><div>üë®‚Äçüéì</div><h3>–ù–µ—Ç —É—á–µ–Ω–∏–∫–æ–≤</h3><p>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ —É—á–µ–Ω–∏–∫–∞</p></div>';
                return;
            }

            list.innerHTML = '';
            for (let student of students) {
                const { data: grades } = await supabase
                    .from('grades')
                    .select('grade, type')
                    .eq('student_id', student.id);

                const avgGrade = grades && grades.length > 0 
                    ? (grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0) / grades.length).toFixed(1)
                    : '‚Äî';

                const recentGrades = grades ? grades.slice(-3) : [];

                list.innerHTML += `
                    <div class="card student-card">
                        <div class="student-info">
                            <h3>${student.name}</h3>
                            <div class="login-info">
                                <strong>–î–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞:</strong><br>
                                üë§ –õ–æ–≥–∏–Ω: <strong>${student.username}</strong><br>
                                üîë –ü–∞—Ä–æ–ª—å: <strong>${student.password}</strong>
                            </div>
                            <p>üìß ${student.email || 'Email –Ω–µ —É–∫–∞–∑–∞–Ω'}</p>
                            <p>üìö –£—Ä–æ–≤–µ–Ω—å: ${renderCourseLevel(student.course)}</p>
                            <p>üë®‚Äçüè´ –£—á–∏—Ç–µ–ª—å: ${student.teacher_name || 'Radmir Nurislamov'}</p>
                            <p>üìÖ –ó–∞—á–∏—Å–ª–µ–Ω: ${student.join_date}</p>
                        </div>
                        <div class="student-stats">
                            <div class="average-grade">${avgGrade}</div>
                            <div>${recentGrades.map(grade => 
                                renderGrade(grade.grade, grade.type)
                            ).join('')}</div>
                            <button class="btn btn-danger" onclick="deleteStudent(${student.id})" style="width: auto; padding: 8px 12px;">üóëÔ∏è</button>
                        </div>
                    </div>`;
            }
        }

        function searchStudents() {
            const searchTerm = document.getElementById('searchStudent').value.toLowerCase();
            const studentCards = document.querySelectorAll('.student-card');
            
            studentCards.forEach(card => {
                const studentName = card.querySelector('h3').textContent.toLowerCase();
                if (studentName.includes(searchTerm)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        async function loadGradeStudentSelect() {
            const { data: students, error } = await supabase
                .from('students')
                .select('id, name, username')
                .order('name');

            if (error) return;

            const select = document.getElementById('gradeStudent');
            select.innerHTML = '';
            students.forEach(student => {
                select.innerHTML += `<option value="${student.id}">${student.name} (${student.username})</option>`;
            });
        }

        async function loadGradesHistory() {
            const { data: grades, error } = await supabase
                .from('grades')
                .select(`
                    *,
                    students (name)
                `)
                .order('created_at', { ascending: false })
                .limit(50);

            if (error) {
                console.error('Error loading grades:', error);
                return;
            }

            const history = document.getElementById('gradesHistory');
            
            if (!grades || grades.length === 0) {
                history.innerHTML = '<div class="empty-state"><div>üìù</div><p>–ù–µ—Ç –æ—Ü–µ–Ω–æ–∫</p></div>';
                return;
            }

            history.innerHTML = '';
            grades.forEach(grade => {
                const typeLabel = gradeTypes[grade.type]?.name || grade.type;
                
                history.innerHTML += `
                    <div style="padding: 12px; border-bottom: 1px solid #e2e8f0; display: flex; align-items: center; gap: 10px;">
                        ${renderGrade(grade.grade, grade.type)}
                        <div style="flex: 1;">
                            <strong>${grade.students.name}</strong><br>
                            <small style="color: var(--gray);">${typeLabel} ‚Ä¢ ${grade.assignment} ‚Ä¢ ${grade.grade_date}</small>
                        </div>
                    </div>`;
            });
        }

        async function updateDashboard() {
            const { data: students } = await supabase.from('students').select('id, course');
            const { data: grades } = await supabase.from('grades').select('grade, type');

            document.getElementById('totalStudents').textContent = students ? students.length : 0;
            
            const totalGrades = grades ? grades.length : 0;
            const totalGradeSum = grades ? grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0) : 0;
            const average = totalGrades > 0 ? (totalGradeSum / totalGrades).toFixed(1) : '0.0';
            
            document.getElementById('averageGrade').textContent = average;
            document.getElementById('totalGrades').textContent = totalGrades;
            
            await updateRecentGrades();
            await updateCourseLevelsStats(students);
        }

        async function updateRecentGrades() {
            const { data: grades, error } = await supabase
                .from('grades')
                .select(`
                    *,
                    students (name)
                `)
                .order('created_at', { ascending: false })
                .limit(5);

            if (error) return;

            const recent = document.getElementById('recentGrades');
            
            if (!grades || grades.length === 0) {
                recent.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 20px;">–ù–µ—Ç –Ω–µ–¥–∞–≤–Ω–∏—Ö –æ—Ü–µ–Ω–æ–∫</p>';
                return;
            }
            
            recent.innerHTML = '';
            grades.forEach(grade => {
                recent.innerHTML += `
                    <div style="display: flex; align-items: center; gap: 12px; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        ${renderGrade(grade.grade, grade.type)}
                        <div style="flex: 1;">
                            <strong>${grade.students.name}</strong>
                            <div style="color: var(--gray); font-size: 0.8em;">${grade.assignment}</div>
                        </div>
                        <small style="color: var(--gray); font-size: 0.8em;">${grade.grade_date}</small>
                    </div>`;
            });
        }

        async function updateCourseLevelsStats(students) {
            if (!students) return;

            const levelCounts = {};
            students.forEach(student => {
                levelCounts[student.course] = (levelCounts[student.course] || 0) + 1;
            });

            const stats = document.getElementById('courseLevelsStats');
            stats.innerHTML = '';
            
            Object.entries(levelCounts).forEach(([course, count]) => {
                const courseInfo = courseLevels[course] || { name: course, color: 'course-beginner' };
                stats.innerHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        <span class="course-badge ${courseInfo.color}">${courseInfo.name}</span>
                        <span style="font-weight: bold; color: var(--primary);">${count} —É—á.</span>
                    </div>
                `;
            });
        }

        async function deleteStudent(studentId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ —É—á–µ–Ω–∏–∫–∞? –í—Å–µ –µ–≥–æ –æ—Ü–µ–Ω–∫–∏ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) return;

            try {
                const { error: gradesError } = await supabase
                    .from('grades')
                    .delete()
                    .eq('student_id', studentId);

                if (gradesError) throw gradesError;

                const { error: studentError } = await supabase
                    .from('students')
                    .delete()
                    .eq('id', studentId);

                if (studentError) throw studentError;

                loadStudents();
                loadGradeStudentSelect();
                updateDashboard();
                alert('üóëÔ∏è –£—á–µ–Ω–∏–∫ —É–¥–∞–ª–µ–Ω');
                
            } catch (err) {
                alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + err.message);
            }
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ó–ê–í–£–ß–ê
        async function loadHeadTeacherData() {
            await loadAcademicStatistics();
            await loadTeacherPerformance();
            await loadQualityMetrics();
        }

        async function loadAcademicStatistics() {
            const { data: students } = await supabase.from('students').select('*');
            const { data: grades } = await supabase.from('grades').select('*');
            const { data: teachers } = await supabase.from('teacher').select('*');
            
            document.getElementById('htTotalTeachers').textContent = teachers ? teachers.length : 0;
            document.getElementById('htTotalStudents').textContent = students ? students.length : 0;
            
            const totalGrades = grades ? grades.length : 0;
            const totalGradeSum = grades ? grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0) : 0;
            const schoolAverage = totalGrades > 0 ? (totalGradeSum / totalGrades).toFixed(1) : '0.0';
            document.getElementById('htSchoolAverage').textContent = schoolAverage;
            
            const goodGrades = grades ? grades.filter(g => g.grade >= 6).length : 0;
            const successRate = totalGrades > 0 ? Math.round((goodGrades / totalGrades) * 100) : 0;
            document.getElementById('htSuccessRate').textContent = successRate + '%';

            await loadLevelPerformance(students, grades);
        }

        async function loadLevelPerformance(students, grades) {
            if (!students || !grades) return;

            const levelPerformance = {};
            students.forEach(student => {
                if (!levelPerformance[student.course]) {
                    levelPerformance[student.course] = { total: 0, sum: 0, count: 0 };
                }
            });

            grades.forEach(grade => {
                const student = students.find(s => s.id === grade.student_id);
                if (student && levelPerformance[student.course]) {
                    levelPerformance[student.course].total++;
                    levelPerformance[student.course].sum += grade.type === 'test' ? grade.grade/2.5 : grade.grade;
                    levelPerformance[student.course].count++;
                }
            });

            let performanceHTML = '';
            Object.entries(levelPerformance).forEach(([course, data]) => {
                const courseInfo = courseLevels[course] || { name: course };
                const average = data.count > 0 ? (data.sum / data.count).toFixed(1) : '0.0';
                
                performanceHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        <span class="course-badge ${courseInfo.color}">${courseInfo.name}</span>
                        <div>
                            <span style="font-weight: bold; color: var(--primary);">${average}</span>
                            <small style="color: var(--gray); margin-left: 10px;">${data.count} –æ—Ü–µ–Ω.</small>
                        </div>
                    </div>
                `;
            });

            document.getElementById('levelPerformance').innerHTML = performanceHTML;
        }

        async function loadTeacherPerformance() {
            const { data: teachers } = await supabase.from('teacher').select('*');
            
            let activityHTML = '';
            if (teachers && teachers.length > 0) {
                teachers.forEach(teacher => {
                    activityHTML += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                            <span>${teacher.name}</span>
                            <span style="color: var(--secondary); font-weight: bold;">–ê–∫—Ç–∏–≤–µ–Ω</span>
                        </div>
                    `;
                });
            } else {
                activityHTML = '<p style="color: var(--gray); text-align: center;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è—Ö</p>';
            }

            document.getElementById('teacherActivity').innerHTML = activityHTML;
        }

        async function loadQualityMetrics() {
            const metricsHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border-left: 4px solid var(--secondary);">
                        <div style="font-weight: bold;">–ö–∞—á–µ—Å—Ç–≤–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</div>
                        <div style="font-size: 1.5em; color: var(--secondary);">92%</div>
                    </div>
                    <div style="background: #fffbeb; padding: 15px; border-radius: 8px; border-left: 4px solid var(--warning);">
                        <div style="font-weight: bold;">–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å</div>
                        <div style="font-size: 1.5em; color: var(--warning);">88%</div>
                    </div>
                    <div style="background: #fef2f2; padding: 15px; border-radius: 8px; border-left: 4px solid var(--danger);">
                        <div style="font-weight: bold;">–í–Ω–∏–º–∞–Ω–∏–µ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º</div>
                        <div style="font-size: 1.5em; color: var(--danger);">95%</div>
                    </div>
                    <div style="background: #eff6ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary);">
                        <div style="font-weight: bold;">–ü—Ä–æ–≥—Ä–µ—Å—Å —É—á–µ–Ω–∏–∫–æ–≤</div>
                        <div style="font-size: 1.5em; color: var(--primary);">85%</div>
                    </div>
                </div>
            `;

            document.getElementById('qualityMetrics').innerHTML = metricsHTML;
        }

        function generateAcademicReport() {
            alert('üìÑ –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        function generateTeacherReport() {
            alert('üë®‚Äçüè´ –û—Ç—á–µ—Ç –ø–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        function generateProgressReport() {
            alert('üìà –û—Ç—á–µ—Ç –ø–æ –ø—Ä–æ–≥—Ä–µ—Å—Å—É –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        function generateQualityReport() {
            alert('üéØ –û—Ç—á–µ—Ç –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –æ–±—É—á–µ–Ω–∏—è –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        // –§–£–ù–ö–¶–ò–ò –î–õ–Ø –£–ß–ï–ù–ò–ö–ê
        async function showStudentGrades() {
            const { data: grades, error } = await supabase
                .from('grades')
                .select('*')
                .eq('student_id', currentUser.id)
                .order('created_at', { ascending: false });

            if (error) {
                console.error('Error loading student grades:', error);
                return;
            }

            let avgGrade = '0.0';
            if (grades && grades.length > 0) {
                const total = grades.reduce((sum, g) => sum + (g.type === 'test' ? g.grade/2.5 : g.grade), 0);
                avgGrade = (total / grades.length).toFixed(1);
            }
            
            document.getElementById('studentAverageGrade').textContent = avgGrade;
            document.getElementById('studentCourseDisplay').textContent = getCourseName(currentUser.course);
            document.getElementById('studentJoinDate').textContent = currentUser.join_date;
            
            await updateStudentGradeStats(grades);
            
            const gradesList = document.getElementById('studentGradesList');
            if (!grades || grades.length === 0) {
                gradesList.innerHTML = '<div class="empty-state"><div>üìù</div><p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫</p></div>';
                return;
            }
            
            gradesList.innerHTML = '';
            grades.forEach(grade => {
                const typeLabel = gradeTypes[grade.type]?.name || grade.type;
                const percentage = grade.type === 'test' ? Math.round((grade.grade / 25) * 100) : null;
                
                gradesList.innerHTML += `
                    <div class="grade-item">
                        <div style="flex: 1;">
                            <strong>${grade.assignment}</strong>
                            <div style="color: var(--gray); font-size: 0.9em;">${typeLabel} ‚Ä¢ ${grade.grade_date}</div>
                            ${grade.type === 'test' ? `
                                <div class="test-grade-progress">
                                    <div class="test-grade-progress-bar" style="width: ${percentage}%"></div>
                                </div>
                                <div class="test-grade-info">${percentage}% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ (${grade.grade}/25 –±–∞–ª–ª–æ–≤)</div>
                            ` : ''}
                        </div>
                        ${renderGrade(grade.grade, grade.type)}
                    </div>
                `;
            });
            
            await loadStudentSchedule();
            showSection('studentGrades');
        }

        async function updateStudentGradeStats(grades) {
            if (!grades) return;
            
            const typeCounts = {};
            const typeSums = {};
            
            grades.forEach(grade => {
                typeCounts[grade.type] = (typeCounts[grade.type] || 0) + 1;
                typeSums[grade.type] = (typeSums[grade.type] || 0) + grade.grade;
            });

            const stats = document.getElementById('studentGradeStats');
            stats.innerHTML = '';
            
            Object.entries(typeCounts).forEach(([type, count]) => {
                const typeInfo = gradeTypes[type] || { name: type, color: '#6b7280' };
                const average = (typeSums[type] / count).toFixed(1);
                
                stats.innerHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #e2e8f0;">
                        <span>${typeInfo.name}</span>
                        <div>
                            <span style="font-weight: bold; color: var(--primary);">${average}</span>
                            <small style="color: var(--gray); margin-left: 10px;">${count} –æ—Ü–µ–Ω.</small>
                        </div>
                    </div>
                `;
            });
        }

        // –£–õ–£–ß–®–ï–ù–ù–û–ï –†–ê–°–ü–ò–°–ê–ù–ò–ï
        async function addScheduleItem() {
            const subject = document.getElementById('scheduleSubject').value;
            const teacher = document.getElementById('scheduleTeacher').value;
            const level = document.getElementById('scheduleLevel').value;
            const date = document.getElementById('scheduleDate').value;
            const startTime = document.getElementById('scheduleStartTime').value;
            const endTime = document.getElementById('scheduleEndTime').value;
            const type = document.getElementById('scheduleType').value;
            const description = document.getElementById('scheduleDescription').value;

            if (!subject || !teacher || !date || !startTime || !endTime) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('schedule')
                .insert([{
                    subject: subject,
                    teacher: teacher,
                    level: level,
                    date: date,
                    start_time: startTime,
                    end_time: endTime,
                    type: type,
                    description: description,
                    created_at: new Date().toISOString()
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            document.getElementById('scheduleSubject').value = '';
            document.getElementById('scheduleDate').value = '';
            document.getElementById('scheduleStartTime').value = '';
            document.getElementById('scheduleEndTime').value = '';
            document.getElementById('scheduleDescription').value = '';

            loadSchedule();
            alert('‚úÖ –ó–∞–Ω—è—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ!');
        }

        async function loadSchedule() {
            const { data: schedule, error } = await supabase
                .from('schedule')
                .select('*')
                .order('date', { ascending: true })
                .order('start_time', { ascending: true });

            if (error) {
                console.error('Error loading schedule:', error);
                return;
            }

            const scheduleList = document.getElementById('scheduleList');
            const upcomingLessons = document.getElementById('upcomingLessons');
            const studentTodaySchedule = document.getElementById('studentTodaySchedule');
            
            if (!schedule || schedule.length === 0) {
                scheduleList.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏</p></div>';
                upcomingLessons.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∑–∞–Ω—è—Ç–∏–π</p></div>';
                if (studentTodaySchedule) {
                    studentTodaySchedule.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç</p></div>';
                }
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const now = new Date();
            
            let filteredSchedule = schedule;
            if (currentScheduleFilter === 'today') {
                filteredSchedule = schedule.filter(item => item.date === today);
            } else if (currentScheduleFilter === 'week') {
                const weekStart = new Date(now);
                weekStart.setDate(now.getDate() - now.getDay());
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                
                filteredSchedule = schedule.filter(item => {
                    const itemDate = new Date(item.date);
                    return itemDate >= weekStart && itemDate <= weekEnd;
                });
            } else if (currentScheduleFilter === 'upcoming') {
                filteredSchedule = schedule.filter(item => item.date >= today);
            }

            const upcoming = schedule.filter(item => item.date >= today).slice(0, 5);
            const todayLessons = schedule.filter(item => item.date === today);

            scheduleList.innerHTML = '';
            filteredSchedule.forEach(item => {
                const status = getScheduleStatus(item);
                const typeIcon = getScheduleTypeIcon(item.type);
                
                scheduleList.innerHTML += `
                    <div class="schedule-item ${status.status}">
                        <div class="schedule-status status-${status.status}">${status.text}</div>
                        <div class="schedule-time">‚è∞ ${formatTime(item.start_time)} - ${formatTime(item.end_time)}</div>
                        <div class="schedule-subject">${typeIcon} ${item.subject}</div>
                        <div class="schedule-teacher">üë®‚Äçüè´ ${item.teacher}</div>
                        <div style="color: var(--gray); font-size: 0.8em;">
                            üìÖ ${formatDate(item.date)} 
                            ${item.level !== 'all' ? `‚Ä¢ üéØ ${getCourseName(item.level)}` : ''}
                            ${item.type ? `‚Ä¢ üè∑Ô∏è ${getScheduleTypeName(item.type)}` : ''}
                        </div>
                        ${item.description ? `<div style="color: var(--gray); font-size: 0.9em; margin-top: 8px; padding: 8px; background: #f8fafc; border-radius: 6px;">${item.description}</div>` : ''}
                    </div>
                `;
            });

            upcomingLessons.innerHTML = '';
            upcoming.forEach(item => {
                const status = getScheduleStatus(item);
                const typeIcon = getScheduleTypeIcon(item.type);
                
                upcomingLessons.innerHTML += `
                    <div class="schedule-item ${status.status}">
                        <div class="schedule-status status-${status.status}">${status.text}</div>
                        <div class="schedule-time">‚è∞ ${formatTime(item.start_time)} - ${formatTime(item.end_time)}</div>
                        <div class="schedule-subject">${typeIcon} ${item.subject}</div>
                        <div class="schedule-teacher">üë®‚Äçüè´ ${item.teacher}</div>
                        <div style="color: var(--gray); font-size: 0.8em;">üìÖ ${formatDate(item.date)}</div>
                    </div>
                `;
            });

            if (currentUser && currentUser.role === 'student' && studentTodaySchedule) {
                studentTodaySchedule.innerHTML = '';
                if (todayLessons.length === 0) {
                    studentTodaySchedule.innerHTML = '<div class="empty-state"><div>üìÖ</div><p>–ù–∞ —Å–µ–≥–æ–¥–Ω—è –∑–∞–Ω—è—Ç–∏–π –Ω–µ—Ç</p></div>';
                } else {
                    todayLessons.forEach(item => {
                        const status = getScheduleStatus(item);
                        const typeIcon = getScheduleTypeIcon(item.type);
                        
                        studentTodaySchedule.innerHTML += `
                            <div class="schedule-item ${status.status}">
                                <div class="schedule-status status-${status.status}">${status.text}</div>
                                <div class="schedule-time">‚è∞ ${formatTime(item.start_time)} - ${formatTime(item.end_time)}</div>
                                <div class="schedule-subject">${typeIcon} ${item.subject}</div>
                                <div class="schedule-teacher">üë®‚Äçüè´ ${item.teacher}</div>
                                ${item.description ? `<div style="color: var(--gray); font-size: 0.9em; margin-top: 8px;">${item.description}</div>` : ''}
                            </div>
                        `;
                    });
                }
            }
        }

        function getScheduleTypeIcon(type) {
            const icons = {
                'regular': 'üìö',
                'test': 'üéì',
                'conversation': 'üó£Ô∏è',
                'grammar': 'üìñ',
                'project': 'üìÅ'
            };
            return icons[type] || 'üìö';
        }

        function getScheduleTypeName(type) {
            const names = {
                'regular': '–û–±—ã—á–Ω—ã–π —É—Ä–æ–∫',
                'test': '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ',
                'conversation': '–†–∞–∑–≥–æ–≤–æ—Ä–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞',
                'grammar': '–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞',
                'project': '–ü—Ä–æ–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞'
            };
            return names[type] || '–£—Ä–æ–∫';
        }

        async function loadStudentSchedule() {
            await loadSchedule();
        }

        // –§–£–ù–ö–¶–ò–ò –ö–ê–õ–ï–ù–î–ê–†–Ø
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            const currentMonth = document.getElementById('currentMonth');
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            const monthNames = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];
            currentMonth.textContent = `${monthNames[month]} ${year}`;
            
            calendarGrid.innerHTML = '';
            
            const days = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            days.forEach(day => {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.style.fontWeight = 'bold';
                dayElement.textContent = day;
                calendarGrid.appendChild(dayElement);
            });
            
            const firstDay = new Date(year, month, 1);
            const startingDay = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            for (let i = 0; i < startingDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                emptyDay.style.visibility = 'hidden';
                calendarGrid.appendChild(emptyDay);
            }
            
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    dayElement.classList.add('today');
                }
                
                const dayOfWeek = new Date(year, month, day).getDay();
                if (dayOfWeek === 0 || dayOfWeek === 6) {
                    dayElement.classList.add('weekend');
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        function changeMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar();
            loadCalendarEvents();
        }

        // –§–£–ù–ö–¶–ò–ò –°–û–ë–´–¢–ò–ô –ö–ê–õ–ï–ù–î–ê–†–Ø
        async function addCalendarEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const description = document.getElementById('eventDescription').value;
            const type = document.getElementById('eventType').value;

            if (!title || !date) {
                alert('‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            const { data, error } = await supabase
                .from('calendar_events')
                .insert([{
                    title: title,
                    date: date,
                    time: time,
                    description: description,
                    type: type,
                    created_at: new Date().toISOString()
                }])
                .select();

            if (error) {
                alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
                return;
            }

            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventDescription').value = '';

            loadCalendarEvents();
            alert('‚úÖ –°–æ–±—ã—Ç–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä—å!');
        }

        async function loadCalendarEvents() {
            const { data: events, error } = await supabase
                .from('calendar_events')
                .select('*')
                .order('date', { ascending: true })
                .order('time', { ascending: true });

            if (error) {
                console.error('Error loading events:', error);
                return;
            }

            const calendarEventsList = document.getElementById('calendarEventsList');
            const upcomingEvents = document.getElementById('upcomingEvents');
            const studentUpcomingEvents = document.getElementById('studentUpcomingEvents');
            
            if (!events || events.length === 0) {
                calendarEventsList.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ</p></div>';
                upcomingEvents.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                if (studentUpcomingEvents) {
                    studentUpcomingEvents.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                }
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const upcoming = events.filter(event => event.date >= today).slice(0, 5);

            calendarEventsList.innerHTML = '';
            events.forEach(event => {
                const eventTypes = {
                    'lesson': 'üìö',
                    'test': 'üéì', 
                    'meeting': 'üë•',
                    'holiday': 'üéâ',
                    'deadline': '‚è∞'
                };
                
                calendarEventsList.innerHTML += `
                    <div class="notification ${event.date === today ? 'upcoming' : ''}">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2em;">${eventTypes[event.type]}</span>
                            <div style="flex: 1;">
                                <strong>${event.title}</strong>
                                <div style="color: var(--gray); font-size: 0.9em;">
                                    üìÖ ${formatDate(event.date)}${event.time ? ` ‚è∞ ${event.time}` : ''}
                                </div>
                                ${event.description ? `<div style="margin-top: 5px;">${event.description}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });

            upcomingEvents.innerHTML = '';
            upcoming.forEach(event => {
                const eventTypes = {
                    'lesson': 'üìö',
                    'test': 'üéì',
                    'meeting': 'üë•', 
                    'holiday': 'üéâ',
                    'deadline': '‚è∞'
                };
                
                upcomingEvents.innerHTML += `
                    <div class="notification upcoming">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.2em;">${eventTypes[event.type]}</span>
                            <div style="flex: 1;">
                                <strong>${event.title}</strong>
                                <div style="color: var(--gray); font-size: 0.9em;">
                                    üìÖ ${formatDate(event.date)}${event.time ? ` ‚è∞ ${event.time}` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            if (currentUser && currentUser.role === 'student' && studentUpcomingEvents) {
                studentUpcomingEvents.innerHTML = '';
                if (upcoming.length === 0) {
                    studentUpcomingEvents.innerHTML = '<div class="empty-state"><div>üóìÔ∏è</div><p>–ù–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–æ–±—ã—Ç–∏–π</p></div>';
                } else {
                    upcoming.forEach(event => {
                        studentUpcomingEvents.innerHTML += `
                            <div class="notification upcoming">
                                <strong>${eventTypes[event.type]} ${event.title}</strong>
                                <div style="color: var(--gray); font-size: 0.9em;">
                                    üìÖ ${formatDate(event.date)}${event.time ? ` ‚è∞ ${event.time}` : ''}
                                </div>
                            </div>
                        `;
                    });
                }
            }
        }

        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        function getCourseName(course) {
            const courseInfo = courseLevels[course] || { name: course, level: '' };
            return `${courseInfo.name} (${courseInfo.level})`;
        }

        async function getStudentById(studentId) {
            const { data, error } = await supabase
                .from('students')
                .select('*')
                .eq('id', studentId)
                .single();
            return data;
        }

        function formatTime(timeString) {
            if (!timeString) return '';
            return timeString.substring(0, 5);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        window.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ PrimeSpeak Academy –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            generateCalendar();
            updateTestGradeDisplay();
            autoLogin();
            
            const today = new Date().toISOString().split('T')[0];
            if (document.getElementById('scheduleDate')) {
                document.getElementById('scheduleDate').value = today;
            }
            if (document.getElementById('eventDate')) {
                document.getElementById('eventDate').value = today;
            }
        });

    </script>
</body>
                </html>
